<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0065)http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru-ru" lang="ru-ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <!--<base href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html">--><base href=".">
  
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="AVR, GCC, inline, assembler">
  
  <meta name="author" content="microsin">
  <meta name="description" content="Руководство по встраиванию кода ассемблера в код на C для компилятора AVR GCC.">
  
  <title>AVR-GCC: руководство по встраиванию кода на ассемблере | AVR | programming</title>
  <link href="http://microsin.net/component/option,com_jcomments/format,raw/object_group,com_content/object_id,1509/task,rss/" rel="alternate" type="application/rss+xml" title="AVR-GCC: руководство по встраиванию кода на ассемблере">
  <link rel="stylesheet" href="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/style.css" type="text/css">
  <link rel="stylesheet" href="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/acesearch.css" type="text/css">
  <script type="text/javascript" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/proofreader.js"></script>
  <script type="text/javascript" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/xajax.js"></script>
  <script type="text/javascript" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/jcomments-v2.1.js"></script>
  <script type="text/javascript" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/ajax.js"></script>
  <script type="text/javascript" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/mootools.js"></script>
  <script type="text/javascript" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/caption.js"></script>
  <script type="text/javascript" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/autocompleter12.js"></script>
  <script language="JavaScript" type="text/javascript"><!-- // --><![CDATA[
				function pr_setup() {
					xajaxRequestUri='http://microsin.net/index.php?option=com_proofreader&task=sendmistake&tmpl=component';
					xajaxWaitCursor=true;
					xajaxDefinedPost=1;
					xajaxDebug=false;
					xajaxStatusMessages=false;
					xajaxDefinedGet=0;
				}

			var xajaxRequestUri='http://microsin.net/index.php?option=com_proofreader&task=sendmistake&tmpl=component';
			var xajaxWaitCursor=true;
			var xajaxDefinedPost=1;
			var xajaxDebug=false;
			var xajaxStatusMessages=false;
			var xajaxDefinedGet=0;

			function addEventPR(obj, evType, fn){ 
				 if (obj.addEventListener){ 
					obj.addEventListener(evType, fn, false); 
					return true; 
				} else if (obj.attachEvent){
					var r = obj.attachEvent("on"+evType, fn); 
					return r; 
				} else { 
					return false; 
				} 
			}

		 var pr_alt = false;  var pr_shift = true;  var pr_ctrl = false; 
				var PReader_cur_page = "http://microsin.net/index.php?option=com_content&Itemid=44&catid=26&id=1509&lang=ru&view=article";
				addEventPR(window, 'load',  addDivWindow);
				addEventPR(window, 'load',  keyPressInit);
			// ]]></script>
  <script type="text/javascript">
/*<![CDATA[*/
	var jax_live_site = 'http://microsin.net/index.php';
	var jax_site_type = '1.5';
/*]]>*/
</script><script type="text/javascript" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/ajax_1.0.js"></script>
  <link rel="stylesheet" type="text/css" href="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/style(1).css">
<link rel="stylesheet" type="text/css" href="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/comment_style.css">

<script type="text/javascript">
/*<![CDATA[*/
var jc_option           = "";
var jc_autoUpdate       = "0";
var jc_update_period    = 300*1000;
var jc_orderBy          = "1";
var jc_livesite_busyImg = "http://microsin.net/components/com_jomcomment/busy.gif";
var jc_username         = "";
var jc_email            = "";
var jc_commentForm;
/*]]>*/
</script>

<link rel="stylesheet" href="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/system.css" type="text/css">
<link rel="stylesheet" href="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/general.css" type="text/css">
<link rel="stylesheet" href="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/template_css.css" type="text/css">
<!-- <link rel="shortcut"   href="/templates/microsin/images/favicon16x16-8b.gif" type="image/x-icon"/> -->
<link rel="shortcut icon" href="http://microsin.net/templates/microsin/images/favicon16x16-8b.gif">
<meta http-equiv="Content-Language" content="en"><style type="text/css"></style><style type="text/css" id="ya_share_style">.b-share-popup-wrap{z-index:1073741823;position:absolute;width:500px}.b-share-popup{position:absolute;z-index:1073741823;border:1px solid #888;background:#FFF;color:#000}.b-share-popup-wrap .b-share-popup_down{top:0}.b-share-popup-wrap .b-share-popup_up{bottom:0}.b-share-popup-wrap_state_hidden{position:absolute!important;top:-9999px!important;right:auto!important;bottom:auto!important;left:-9999px!important;visibility:hidden!important}.b-share-popup,x:nth-child(1){border:0;padding:1px!important}@media all and (resolution=0){.b-share-popup,x:nth-child(1),x:-o-prefocus{padding:0!important;border:1px solid #888}}.b-share-popup__i{display:-moz-inline-box;display:inline-block;padding:5px 0!important;overflow:hidden;vertical-align:top;white-space:nowrap;visibility:visible;background:#FFF;-webkit-box-shadow:0 2px 9px rgba(0,0,0,.6);-moz-box-shadow:0 2px 9px rgba(0,0,0,.6);box-shadow:0 2px 9px rgba(0,0,0,.6)}.b-share-popup__item{font:1em/1.25em Arial,sans-serif;display:block;padding:5px 15px!important;white-space:nowrap;background:#FFF}.b-share-popup__item,a.b-share-popup__item:link,a.b-share-popup__item:visited{text-decoration:none!important;border:0!important}a.b-share-popup__item{cursor:pointer}a.b-share-popup__item .b-share-popup__item__text{display:inline;text-decoration:underline;color:#1A3DC1}a.b-share-popup__item:hover{word-spacing:0}a.b-share-popup__item:hover .b-share-popup__item__text{color:red;cursor:pointer}.b-share-popup__icon{display:-moz-inline-box;display:inline-block;margin:-3px 0 0;padding:0 5px 0 0!important;vertical-align:middle}.b-share-popup__icon_input{width:21px;height:16px;margin-top:-6px;padding:0!important}.b-share-popup__icon__input{margin-right:0;margin-left:2px;vertical-align:top}.b-share-popup__spacer{display:block;padding-top:10px!important}.b-share-popup__header{font:86%/1em Verdana,sans-serif;display:block;padding:10px 15px 5px!important;color:#999}.b-share-popup__header_first{padding-top:5px!important}.b-share-popup__input{font:86%/1em Verdana,sans-serif;display:block;padding:5px 15px!important;color:#999;text-align:left}.b-share-popup__input__input{font:1em/1em Verdana,sans-serif;display:block;width:10px;margin:5px 0 0;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;resize:none;text-align:left;direction:ltr}.b-share-popup_down .b-share-popup_with-link .b-share-popup__input_link{position:absolute;top:5px;right:0;left:0}.b-share-popup_up .b-share-popup_with-link .b-share-popup__input_link{position:absolute;right:0;bottom:5px;left:0}.b-share-popup_down .b-share-popup_with-link{padding-top:55px!important}.b-share-popup_up .b-share-popup_with-link{padding-bottom:55px!important}.b-share-popup_down .b-share-popup_expandable .b-share-popup__main{padding-bottom:25px!important}.b-share-popup_up .b-share-popup_expandable .b-share-popup__main{padding-top:25px!important}.b-share-popup_down .b-share-popup_yandexed{padding-bottom:10px!important}.b-share-popup_up .b-share-popup_yandexed{padding-top:10px!important}.b-share-popup__yandex{position:absolute;right:4px;bottom:2px;font:78.125%/1em Verdana,sans-serif;padding:3px!important;background:0 0}a.b-share-popup__yandex:link,a.b-share-popup__yandex:visited{color:#C6C5C5;text-decoration:none}a.b-share-popup__yandex:link:hover,a.b-share-popup__yandex:visited:hover{color:red;text-decoration:underline}.b-share-popup_up .b-share-popup__yandex{top:2px;bottom:auto}.b-share-popup_expandable .b-share-popup__yandex{right:auto;left:4px}.b-share-popup_to-right .b-share-popup_expandable .b-share-popup__yandex{right:4px;left:auto}.b-share-popup__expander .b-share-popup__item{position:absolute;bottom:5px;font:86%/1em Verdana,sans-serif;margin:10px 0 0;padding:5px 10px!important;cursor:pointer;color:#999;background:0 0}.b-share-popup_to-right,.b-share-popup_to-right .b-share-popup__expander{direction:rtl}.b-share-popup_to-right .b-share-popup__expander .b-share-popup__icon{padding:0 0 0 5px!important}.b-share-popup_up .b-share-popup__expander .b-share-popup__item{top:-5px;bottom:auto}.b-share-popup__expander .b-share-popup__item:hover .b-share-popup__item__text{text-decoration:underline}.b-share-popup__expander .b-ico_action_rarr,.b-share-popup_to-right .b-share-popup__expander .b-ico_action_larr,.b-share-popup_full .b-share-popup__expander .b-ico_action_larr,.b-share-popup_to-right .b-share-popup_full .b-share-popup__expander .b-ico_action_rarr,.b-share-popup__expander .b-share-popup__item__text_collapse,.b-share-popup_full .b-share-popup__item__text_expand{display:none}.b-share-popup_to-right .b-share-popup__expander .b-ico_action_rarr,.b-share-popup_full .b-share-popup__item__text_collapse,.b-share-popup_full .b-share-popup__expander .b-ico_action_rarr,.b-share-popup_to-right .b-share-popup_full .b-share-popup__expander .b-ico_action_larr{display:inline}.b-ico_action_rarr,.b-ico_action_larr{width:8px;height:7px;border:0}.b-share-popup__main,.b-share-popup__extra{direction:ltr;vertical-align:bottom;text-align:left}.b-share-popup_down .b-share-popup__main,.b-share-popup_down .b-share-popup__extra{vertical-align:top}.b-share-popup__main{display:-moz-inline-stack;display:inline-block}.b-share-popup__extra{display:none;margin:0 -10px 0 0}.b-share-popup_full .b-share-popup__extra{display:-moz-inline-stack;display:inline-block}.b-share-popup_to-right .b-share-popup__extra{margin:0 0 0 -10px}.b-share-popup__tail{position:absolute;width:21px;height:10px;margin:0 0 0 -11px}.b-share-popup_down .b-share-popup__tail{top:-10px;background:url("//yastatic.net/share/static/b-share-popup_down__tail.gif") 0 0 no-repeat}.b-share-popup_up .b-share-popup__tail{bottom:-10px;background:url("//yastatic.net/share/static/b-share-popup_up__tail.gif") 0 0 no-repeat}.b-share-popup_down .b-share-popup__tail,x:nth-child(1){top:-9px;background-image:url("//yastatic.net/share/static/b-share-popup_down__tail.png")}.b-share-popup_up .b-share-popup__tail,x:nth-child(1){bottom:-9px;background-image:url("//yastatic.net/share/static/b-share-popup_up__tail.png")}@media all and (resolution=0){.b-share-popup_down .b-share-popup__tail,x:nth-child(1),x:-o-prefocus{top:-10px;background-image:url("//yastatic.net/share/static/b-share-popup_down__tail.gif")}.b-share-popup_up .b-share-popup__tail,x:nth-child(1),x:-o-prefocus{bottom:-10px;background-image:url("//yastatic.net/share/static/b-share-popup_up__tail.gif")}}.b-share-popup .b-share-popup_show_form_mail,.b-share-popup .b-share-popup_show_form_html{padding:0!important}.b-share-popup .b-share-popup_show_form_mail .b-share-popup__main,.b-share-popup .b-share-popup_show_form_html .b-share-popup__main,.b-share-popup .b-share-popup_show_form .b-share-popup__main,.b-share-popup .b-share-popup_show_form_mail .b-share-popup__extra,.b-share-popup .b-share-popup_show_form_html .b-share-popup__extra,.b-share-popup .b-share-popup_show_form .b-share-popup__extra{height:15px;padding:0!important;overflow:hidden;visibility:hidden}.b-share-popup_show_form_mail .b-share-popup__expander,.b-share-popup_show_form_html .b-share-popup__expander,.b-share-popup_show_form .b-share-popup__expander,.b-share-popup_show_form_mail .b-share-popup__input_link,.b-share-popup_show_form_html .b-share-popup__input_link,.b-share-popup_show_form .b-share-popup__input_link{display:none}.b-share-popup__form{position:relative;display:none;overflow:hidden;padding:5px 0 0!important;margin:0 0 -15px;white-space:normal}.b-share-popup_show_form_mail .b-share-popup__form_mail,.b-share-popup_show_form_html .b-share-popup__form_html,.b-share-popup_show_form .b-share-popup__form{display:block}.b-share-popup__form__link{padding:5px!important;margin:0 0 5px 10px;text-decoration:underline;cursor:pointer;color:#1A3DC1}.b-share-popup__form__link,.b-share-popup__form__button{font:86%/1.4545em Verdana,sans-serif;float:left;display:inline}.b-share-popup__form__button{margin:5px 0 0 15px}.b-share-popup__form__close{font:86%/1.4545em Verdana,sans-serif;float:right;display:inline;padding:5px!important;margin:0 10px 5px 0;cursor:pointer;color:#999}a.b-share-popup__form__link:hover,a.b-share-popup__form__close:hover{text-decoration:underline;color:red}.b-share-popup_font_fixed .b-share-popup__item{font-size:12.8px}.b-share-popup_font_fixed .b-share-popup__header,.b-share-popup_font_fixed .b-share-popup__input,.b-share-popup_font_fixed .b-share-popup__expander .b-share-popup__item,.b-share-popup_font_fixed .b-share-popup__form__link,.b-share-popup_font_fixed .b-share-popup__form__button,.b-share-popup_font_fixed .b-share-popup__form__close{font-size:11px}.b-share-popup_font_fixed .b-share-popup__yandex{font-size:10px}.b-share-form-button{font:86%/17px Verdana,Arial,sans-serif;display:-moz-inline-box;display:inline-block;position:relative;height:19px;margin:0 3px;padding:0 4px;cursor:default;white-space:nowrap;text-decoration:none!important;color:#000!important;border:none;outline:none;background:url("//yastatic.net/share/static/b-share-form-button.png") 0 -20px repeat-x}.b-share-form-button:link:hover,.b-share-form-button:visited:hover{color:#000!important}.b-share-form-button__before,.b-share-form-button__after{position:absolute;width:3px;height:19px;background:url("//yastatic.net/share/static/b-share-form-button.png")}.b-share-form-button__before{margin-left:-7px}.b-share-form-button__after{margin-left:4px;background-position:-3px 0}.b-share-form-button::-moz-focus-inner{border:none}button.b-share-form-button .b-share-form-button__before,button.b-share-form-button .b-share-form-button__after{margin-top:-1px}@-moz-document url-prefix(){button.b-share-form-button .b-share-form-button__after{margin-top:-2px;margin-left:6px}button.b-share-form-button .b-share-form-button__before{margin-top:-2px;margin-left:-9px}}SPAN.b-share-form-button:hover,.b-share-form-button_state_hover{background-position:0 -60px}SPAN.b-share-form-button:hover .b-share-form-button__before,.b-share-form-button_state_hover .b-share-form-button__before{background-position:0 -40px}SPAN.b-share-form-button:hover .b-share-form-button__after,.b-share-form-button_state_hover .b-share-form-button__after{background-position:-3px -40px}.b-share-form-button_state_pressed,.b-share-form-button_state_pressed .b-share-form-button_share{background-position:0 -100px!important}.b-share-form-button_state_pressed .b-share-form-button__before{background-position:0 -80px!important}.b-share-form-button_state_pressed .b-share-form-button__after{background-position:-3px -80px!important}button.b-share-form-button_state_pressed{overflow:visible}.b-share-form-button_icons{position:relative;padding:0;background-position:0 -20px!important}.b-share-form-button_icons .b-share-form-button__before{left:0;margin-left:-3px;background-position:0 0!important}.b-share-form-button_icons .b-share-form-button__after{z-index:-1;margin-left:0;background-position:-3px 0!important}.b-share-form-button_icons .b-share__handle{padding:2px!important}.b-share-form-button_icons .b-share__handle_more{position:relative;padding-right:6px!important;margin-right:-4px}.b-share-form-button_icons .b-share-icon{opacity:.5;background-image:url("//yastatic.net/share/static/b-share-icon_size_14.png")}.b-share-form-button_icons A.b-share__handle:hover .b-share-icon{opacity:1}.b-share{font:86%/1.4545em Arial,sans-serif;display:-moz-inline-box;display:inline-block;padding:1px 3px 1px 4px!important;vertical-align:middle}.b-share .b-share-form-button{font-size:1em}.b-share__text .b-share-icon{margin:0 5px 0 0;border:none}.b-share__text{margin-right:5px}.b-share__handle{float:left;height:16px;padding:5px 3px 5px 2px!important;cursor:pointer;text-align:left;text-decoration:none!important}.b-share__handle_cursor_default{cursor:default}.b-share__handle .b-share-form-button{margin-top:-2px}.b-share__hr{display:none;float:left;width:1px;height:26px;margin:0 3px 0 2px}a.b-share__handle:hover .b-share__text{text-decoration:underline;color:red}.b-share_bordered{padding:0 2px 0 3px!important;border:1px solid #E4E4E4;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px}.b-share_bordered .b-share__hr{display:inline;background:#E4E4E4}.b-share_link{margin:-8px 0}a.b-share_link{margin:0}.b-share_link .b-share__text{text-decoration:underline;color:#1A3DC1}.b-share-form-button_share{padding-left:26px!important;vertical-align:top}.b-share-form-button_share .b-share-form-button__before{margin-left:-29px}.b-share-form-button_share .b-share-form-button__icon{position:absolute;width:20px;height:17px;margin:1px 0 0 -23px;background:url("//yastatic.net/share/static/b-share-form-button_share__icon.png") 0 0 no-repeat}.b-share-pseudo-link{border-bottom:1px dotted;cursor:pointer;text-decoration:none!important}.b-share_font_fixed{font-size:11px}.b-share__handle_more{font-size:9px;margin-top:-1px;color:#7B7B7B}A.b-share__handle_more:hover{color:#000}.b-share__group{float:left}.b-share-icon{float:left;display:inline;overflow:hidden;width:16px;height:16px;padding:0!important;vertical-align:top;border:0;background:url("//yastatic.net/share/static/b-share-icon.png") 0 99px no-repeat}.b-share-icon_vkontakte,.b-share-icon_custom{background-position:0 0}.b-share-icon_yaru,.b-share-icon_yaru_photo,.b-share-icon_yaru_wishlist{background-position:0 -17px}.b-share-icon_lj{background-position:0 -34px}.b-share-icon_twitter{background-position:0 -51px}.b-share-icon_facebook{background-position:0 -68px}.b-share-icon_moimir{background-position:0 -85px}.b-share-icon_friendfeed{background-position:0 -102px}.b-share-icon_mail{background-position:0 -119px}.b-share-icon_html{background-position:0 -136px}.b-share-icon_postcard{background-position:0 -153px}.b-share-icon_odnoklassniki{background-position:0 -170px}.b-share-icon_blogger{background-position:0 -187px}.b-share-icon_delicious{background-position:0 -221px}.b-share-icon_gbuzz{background-position:0 -238px}.b-share-icon_linkedin{background-position:0 -255px}.b-share-icon_myspace{background-position:0 -272px}.b-share-icon_evernote{background-position:0 -289px}.b-share-icon_digg{background-position:0 -306px}.b-share-icon_juick{background-position:0 -324px}.b-share-icon_moikrug{background-position:0 -341px}.b-share-icon_yazakladki{background-position:0 -358px}.b-share-icon_liveinternet{background-position:0 -375px}.b-share-icon_tutby{background-position:0 -392px}.b-share-icon_diary{background-position:0 -409px}.b-share-icon_gplus{background-position:0 -426px}.b-share-icon_pocket{background-position:0 -443px}.b-share-icon_surfingbird{background-position:0 -460px}.b-share-icon_pinterest{background-position:0 -477px}.b-share-icon_renren{background-position:0 0}.b-share-icon_renren,.b-share-icon_sina_weibo{background:url("//yastatic.net/share/static/b-share-icon__china.png") no-repeat}.b-share-icon_sina_weibo{background-position:-18px 0}.b-share-icon_qzone{background-position:-36px 0}.b-share-icon_qzone,.b-share-icon_tencent_weibo{background:url("//yastatic.net/share/static/b-share-icon__china.png") no-repeat}.b-share-icon_tencent_weibo{background-position:-54px 0}.b-share_theme_dark .b-share-icon{background:url("//yastatic.net/share/static/b-share-icons__theme_dark.png") 99px 0 no-repeat}.b-share_theme_dark .b-share-icon_odnoklassniki{background-position:-4px -3px}.b-share_theme_dark .b-share-icon_vkontakte{background-position:-24px -3px}.b-share_theme_dark .b-share-icon_twitter{background-position:-44px -3px}.b-share_theme_dark .b-share-icon_facebook{background-position:-64px -3px}.b-share_theme_dark .b-share-icon_lj{background-position:-85px -3px}.b-share_theme_dark .b-share-icon_yaru{background-position:-105px -3px}.b-share_theme_dark .b-share-popup .b-share-icon_odnoklassniki,.b-share_theme_dark .b-share-icon_odnoklassniki:hover{background-position:-4px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_vkontakte,.b-share_theme_dark .b-share-icon_vkontakte:hover{background-position:-24px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_twitter,.b-share_theme_dark .b-share-icon_twitter:hover{background-position:-44px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_facebook,.b-share_theme_dark .b-share-icon_facebook:hover{background-position:-64px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_lj,.b-share_theme_dark .b-share-icon_lj:hover{background-position:-85px -28px}.b-share_theme_dark .b-share-popup .b-share-icon_yaru,.b-share_theme_dark .b-share-icon_yaru:hover{background-position:-105px -28px}.b-share_theme_dark .b-share-form-button_share .b-share-form-button__icon{background-image:url("//yastatic.net/share/static/b-share-form-button_share__icon_dark.png")}.b-share_theme_dark .b-share-form-button{color:#fff!important;opacity:.8}.b-share_theme_dark .b-share__handle:hover .b-share-form-button,.b-share_theme_dark .b-share-form-button:hover{opacity:1;cursor:pointer}.b-share_theme_dark .b-share-form-button,.b-share_theme_dark .b-share-form-button__before,.b-share_theme_dark .b-share-form-button__after{background:0 0}.b-share_theme_dark .b-share-popup__i{background-color:#333;border-radius:10px;-webkit-box-shadow:0 2px 9px rgba(255,255,255,.6);-moz-box-shadow:0 2px 9px rgba(255,255,255,.6);box-shadow:0 2px 9px rgba(255,255,255,.6)}.b-share_theme_dark .b-share__text{color:#AAA}.b-share_theme_dark .b-share-popup{color:#AAA;border-radius:10px;background-color:#333;background-color:rgba(50,50,50,.3)}.b-share_theme_dark .b-share-popup__item{background:0 0;color:#ccc}.b-share_theme_dark .b-share-popup .b-share-popup__item__text{color:#ccc}.b-share_theme_counter .b-share{display:inline-block;vertical-align:middle;white-space:nowrap}.b-share-counter{font:14px Arial,sans-serif;line-height:18px;display:none;float:left;margin:3px 6px 3px 3px;color:#fff}.b-share_theme_counter .b-share_type_small .b-share-counter{font-size:11px;line-height:14px;margin:2px 6px 2px 1px}.b-share_theme_counter .b-share-btn__counter .b-share-counter{display:block}.b-share-btn__counter{text-decoration:none}.b-share_theme_counter .b-share-btn__wrap{position:relative;float:left;margin-left:5px}.b-share_theme_counter .b-share_type_small .b-share-btn__wrap{margin-left:4px}.b-share_theme_counter .b-share-btn__wrap:first-child{margin-left:0}.b-share_theme_counter .b-share__link{display:inline-block;cursor:pointer;-webkit-border-radius:3px;border-radius:3px}.b-share_theme_counter .b-share_type_small .b-share__link{-webkit-border-radius:2px;border-radius:2px}.b-share_theme_counter .b-share-icon{display:block;float:left;width:24px;height:24px;background-image:url("//yastatic.net/share/static/b-share_counter_large.png");background-position:-20px 0}.b-share_theme_counter .b-share_type_small .b-share-icon{width:18px;height:18px;background-image:url("//yastatic.net/share/static/b-share_counter_small.png")}.b-share_theme_counter .b-share-icon_facebook{background-position:0 0}.b-share_theme_counter .b-share-btn__facebook{background-color:#3c5a98}.b-share_theme_counter .b-share-btn__facebook:hover{background-color:#30487a}.b-share_theme_counter .b-share-btn__facebook:active{border-top:2px solid #24365a;background-color:#334d81}.b-share_theme_counter .b-share-icon_moimir{background-position:0 -29px}.b-share_theme_counter .b-share-btn__moimir{background-color:#226eb7}.b-share_theme_counter .b-share-btn__moimir:hover{background-color:#1b5892}.b-share_theme_counter .b-share-btn__moimir:active{border-top:2px solid #14426d;background-color:#1d5e9c}.b-share_theme_counter .b-share-icon_vkontakte{background-position:0 -58px}.b-share_theme_counter .b-share-btn__vkontakte{background-color:#48729e}.b-share_theme_counter .b-share-btn__vkontakte:hover{background-color:#3a5b7e}.b-share_theme_counter .b-share-btn__vkontakte:active{border-top:2px solid #2b445e;background-color:#3d6186}.b-share_theme_counter .b-share-icon_twitter{background-position:0 -87px}.b-share_theme_counter .b-share-btn__twitter{background-color:#00aced}.b-share_theme_counter .b-share-btn__twitter:hover{background-color:#008abe}.b-share_theme_counter .b-share-btn__twitter:active{border-top:2px solid #00668d;background-color:#0092ca}.b-share_theme_counter .b-share-icon_odnoklassniki{background-position:0 -116px}.b-share_theme_counter .b-share-btn__odnoklassniki{background-color:#ff9f4d}.b-share_theme_counter .b-share-btn__odnoklassniki:hover{background-color:#cc7f3e}.b-share_theme_counter .b-share-btn__odnoklassniki:active{border-top:2px solid #975e2e;background-color:#d98742}.b-share_theme_counter .b-share-icon_gplus{background-position:0 -145px}.b-share_theme_counter .b-share-btn__gplus{background-color:#c25234}.b-share_theme_counter .b-share-btn__gplus:hover{background-color:#9b422a}.b-share_theme_counter .b-share-btn__gplus:active{border-top:2px solid #73311f;background-color:#a5462c}.b-share_theme_counter .b-share-icon_yaru{background-position:0 -174px}.b-share_theme_counter .b-share-btn__yaru{background-color:#d83933}.b-share_theme_counter .b-share-btn__yaru:hover{background-color:#ad2e29}.b-share_theme_counter .b-share-btn__yaru:active{border-top:2px solid #80221e;background-color:#b8312b}.b-share_theme_counter .b-share-icon_pinterest{background-position:0 -203px}.b-share_theme_counter .b-share-btn__pinterest{background-color:#cd1e27}.b-share_theme_counter .b-share-btn__pinterest:hover{background-color:#a4181f}.b-share_theme_counter .b-share-btn__pinterest:active{border-top:2px solid #7b1217;background-color:#ae1921}.b-share_theme_counter .b-share__link:active{height:22px}.b-share_theme_counter .b-share_type_small .b-share__link:active{height:16px}.b-share_theme_counter .b-share__link:active .b-share-icon,.b-share_theme_counter .b-share__link:active .b-share-counter{position:relative;top:-1px}.b-share_theme_counter .b-share__link::after{position:absolute;top:0;right:0;bottom:0;left:0;content:"";background-image:url(data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)}.b-share_theme_counter .b-share__handle{height:auto;padding:0!important}</style></head>

<body topmargin="0" leftmargin="0" rightmargin="0" bottommargin="0">
<a name="top" id="top"></a>
  <table border="0" cellpadding="0" cellspacing="0" width="780" align="center">
    <tbody><tr height="20">
      <td>&nbsp;</td>
      <td width="100%">&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td valign="top" background="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shad_left.gif">
      <img border="0" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shad_top_left.gif" width="11" height="17"></td>
      <td width="100%" valign="top">
      <table border="0" cellspacing="1" width="100%" bgcolor="#000000">
        <tbody><tr>
          <td width="100%">
            <table border="0" cellpadding="0" cellspacing="0" width="100%">
              <tbody><tr>
                <td class="pathway" valign="center" align="left"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/arrow.png" hspace="5">
                <span class="breadcrumbs pathway">
<a href="http://microsin.net/programming/index.html" class="pathway">Программирование</a> <img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/arrow.png" alt=""> <a href="http://microsin.net/programming/AVR/index.html" class="pathway">AVR</a> <img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/arrow.png" alt=""> AVR-GCC: руководство по встраиванию кода на ассемблере</span>

                </td>
                <td class="pathway" valign="center" align="right">
                Tue, March 17 2015&nbsp;&nbsp;</td>
              </tr>
            </tbody></table>
          </td>
        </tr>
        <tr height="80">
          <td width="100%" bgcolor="#54647A" align="left" background="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/logo_bar_logo.jpg"></td>
        </tr>
        <tr>
          <td width="100%" bgcolor="#AFC6DB" background="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/but_bar_back.gif">

          		<div class="moduletable_topmenu">
					<table width="100%" border="0" cellpadding="0" cellspacing="1"><tbody><tr><td nowrap="nowrap"><span class="mainlevel">  | </span><a href="http://microsin.net/" class="mainlevel">Главная</a><span class="mainlevel">  | </span><a href="http://microsin.net/mycontacts.html" class="mainlevel">Контакты</a><span class="mainlevel">  | </span><a href="http://microsin.net/adminstuff/index.html" class="mainlevel">Администрирование</a><span class="mainlevel">  | </span><a href="http://microsin.net/programming/index.html" class="mainlevel" id="active_menu">Программирование</a><span class="mainlevel">  | </span><a href="http://microsin.net/Ssyilki/index.html" class="mainlevel">Ссылки</a><span class="mainlevel">  | </span></td></tr></tbody></table>		</div>
	

                    </td>
        </tr>
        <tr>
          <td width="100%" bgcolor="#FFFFFF">
          <table border="0" cellpadding="4" cellspacing="0" style="border-collapse: collapse" width="100%" id="AutoNumber1">
            <tbody><tr>
              <!-- LEFT Modules -->
              
                  <td valign="top" width="150" bgcolor="#F0F0F0">
                    <div class="modules" style="width:155px;">
                    		<div class="moduletable">
					<table border="0">
<tbody>
<tr>
<td><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/UK-flag-ico.png" border="0" alt="UK-flag-ico.png" title="English site version" align="bottom"></td>
<td><a href="http://translate.google.ru/translate?hl=ru&sl=ru&tl=en&u=http%3A%2F%2Fmicrosin.net%2F">English Version</a></td>
</tr>
<tr>
<td><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/GERMAN-flag-ico.png" border="0" alt="GERMAN-flag-ico.png" title="Die deutsche Version der Webseite" align="bottom"></td>
<td><a href="http://translate.google.ru/translate?hl=ru&sl=ru&tl=de&u=http%3A%2F%2Fmicrosin.net%2F">Die deutsche Version</a></td>
</tr>
</tbody>
</table>
<a href="http://microsin.net/xmap-1.html">Карта сайта</a>		</div>
			<div class="moduletable">
					<h3>Поделиться</h3>
					<!-- http://api.yandex.ru/share/ -->
<script type="text/javascript" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/share.js" charset="utf-8"></script> <div class="yashare-auto-init" data-yasharel10n="ru" data-yasharetype="none" data-yasharequickservices="vkontakte,facebook,twitter,moimir,lj,yaru,friendfeed"><span class="b-share"><a rel="nofollow" target="_blank" title="ВКонтакте" class="b-share__handle b-share__link b-share-btn__vkontakte" href="http://share.yandex.ru/go.xml?service=vkontakte&url=http%3A%2F%2Fmicrosin.net%2Fprogramming%2FAVR%2Favr-gcc-inline-assembler.html&title=AVR-GCC%3A%20%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE%20%D0%BF%D0%BE%20%D0%B2%D1%81%D1%82%D1%80%D0%B0%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E%20%D0%BA%D0%BE%D0%B4%D0%B0%20%D0%BD%D0%B0%20%D0%B0%D1%81%D1%81%D0%B5%D0%BC%D0%B1%D0%BB%D0%B5%D1%80%D0%B5%20%7C%20AVR%20%7C%20programming" data-service="vkontakte"><span class="b-share-icon b-share-icon_vkontakte"></span></a><a rel="nofollow" target="_blank" title="Facebook" class="b-share__handle b-share__link b-share-btn__facebook" href="http://share.yandex.ru/go.xml?service=facebook&url=http%3A%2F%2Fmicrosin.net%2Fprogramming%2FAVR%2Favr-gcc-inline-assembler.html&title=AVR-GCC%3A%20%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE%20%D0%BF%D0%BE%20%D0%B2%D1%81%D1%82%D1%80%D0%B0%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E%20%D0%BA%D0%BE%D0%B4%D0%B0%20%D0%BD%D0%B0%20%D0%B0%D1%81%D1%81%D0%B5%D0%BC%D0%B1%D0%BB%D0%B5%D1%80%D0%B5%20%7C%20AVR%20%7C%20programming" data-service="facebook"><span class="b-share-icon b-share-icon_facebook"></span></a><a rel="nofollow" target="_blank" title="Twitter" class="b-share__handle b-share__link b-share-btn__twitter" href="http://share.yandex.ru/go.xml?service=twitter&url=http%3A%2F%2Fmicrosin.net%2Fprogramming%2FAVR%2Favr-gcc-inline-assembler.html&title=AVR-GCC%3A%20%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE%20%D0%BF%D0%BE%20%D0%B2%D1%81%D1%82%D1%80%D0%B0%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E%20%D0%BA%D0%BE%D0%B4%D0%B0%20%D0%BD%D0%B0%20%D0%B0%D1%81%D1%81%D0%B5%D0%BC%D0%B1%D0%BB%D0%B5%D1%80%D0%B5%20%7C%20AVR%20%7C%20programming" data-service="twitter"><span class="b-share-icon b-share-icon_twitter"></span></a><a rel="nofollow" target="_blank" title="Мой Мир" class="b-share__handle b-share__link b-share-btn__moimir" href="http://share.yandex.ru/go.xml?service=moimir&url=http%3A%2F%2Fmicrosin.net%2Fprogramming%2FAVR%2Favr-gcc-inline-assembler.html&title=AVR-GCC%3A%20%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE%20%D0%BF%D0%BE%20%D0%B2%D1%81%D1%82%D1%80%D0%B0%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E%20%D0%BA%D0%BE%D0%B4%D0%B0%20%D0%BD%D0%B0%20%D0%B0%D1%81%D1%81%D0%B5%D0%BC%D0%B1%D0%BB%D0%B5%D1%80%D0%B5%20%7C%20AVR%20%7C%20programming" data-service="moimir"><span class="b-share-icon b-share-icon_moimir"></span></a><a rel="nofollow" target="_blank" title="LiveJournal" class="b-share__handle b-share__link b-share-btn__lj" href="http://share.yandex.ru/go.xml?service=lj&url=http%3A%2F%2Fmicrosin.net%2Fprogramming%2FAVR%2Favr-gcc-inline-assembler.html&title=AVR-GCC%3A%20%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE%20%D0%BF%D0%BE%20%D0%B2%D1%81%D1%82%D1%80%D0%B0%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E%20%D0%BA%D0%BE%D0%B4%D0%B0%20%D0%BD%D0%B0%20%D0%B0%D1%81%D1%81%D0%B5%D0%BC%D0%B1%D0%BB%D0%B5%D1%80%D0%B5%20%7C%20AVR%20%7C%20programming" data-service="lj"><span class="b-share-icon b-share-icon_lj"></span></a><a rel="nofollow" target="_blank" title="FriendFeed" class="b-share__handle b-share__link b-share-btn__friendfeed" href="http://share.yandex.ru/go.xml?service=friendfeed&url=http%3A%2F%2Fmicrosin.net%2Fprogramming%2FAVR%2Favr-gcc-inline-assembler.html&title=AVR-GCC%3A%20%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE%20%D0%BF%D0%BE%20%D0%B2%D1%81%D1%82%D1%80%D0%B0%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E%20%D0%BA%D0%BE%D0%B4%D0%B0%20%D0%BD%D0%B0%20%D0%B0%D1%81%D1%81%D0%B5%D0%BC%D0%B1%D0%BB%D0%B5%D1%80%D0%B5%20%7C%20AVR%20%7C%20programming" data-service="friendfeed"><span class="b-share-icon b-share-icon_friendfeed"></span></a></span></div>		</div>
			<div class="moduletable">
					<script type="text/javascript">
		window.addEvent('load', function() {
		var url = '/component/option,com_acesearch/format,raw/task,complete/';
		var completer = new Autocompleter.Ajax.Json($('qr-10034'), url, {'postVar': 'q'});
	});
		
	function acesearchsubmit(){
		var moquery = document.getElementById("qr-10034").value.length;
		
		if (moquery >= "3"  ) {
			return true;
		} 
		else {
			alert("Пожалуйста убедитесь, что Ваш запрос длиннее, чем 3 символов.");
			return false;
		}
	}
</script>

<form id="acesearchModule-10034" action="http://microsin.net/component/option,com_acesearch/view,search/" method="post" name="acesearchModule" onsubmit="return acesearchsubmit();">
	<div class="search acesearch_bg_module">
		<input type="text" name="query" value="..." id="qr-10034" class="acesearch_input_module_modif" onblur="if(this.value==&#39;&#39;) this.value=&#39;...&#39;;" onfocus="if(this.value==&#39;...&#39;) this.value=&#39;&#39;;" style="margin-right:5px;" autocomplete="off"><a style="float:left;padding-left:5px;" href="http://microsin.net/component/option,com_acesearch/view,advancedsearch/" title="Расширенный поиск">Расширенный поиск</a><input type="hidden" name="lang" value="ru">	</div>
	
	<input type="hidden" name="option" value="com_acesearch">
	<input type="hidden" name="view" value="search">
	<input type="hidden" name="task" value="search">
</form>
<div class="acesearch_clear_mod_bottom"></div>		</div>
			<div class="moduletable">
					<h3>нашли опечатку?</h3>
					Пожалуйста, сообщите об этом - просто выделите ошибочное слово или фразу и нажмите <b>Shift Enter</b>.		</div>
	
<br> <!-- ��� ��� ������� �� ���������� ������ -->
                    </div>
                  </td>
                                <td valign="top">
              <!-- Top Modules -->
                                          <div class="nopad"><table class="contentpaneopen">
<tbody><tr>
		<td class="contentheading" width="100%">
					AVR-GCC: руководство по встраиванию кода на ассемблере			</td>
				
				<td align="right" width="100%" class="buttonheading">
		<a href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler/Pechat.html" title="Печать" onclick="window.open(this.href,&#39;win2&#39;,&#39;status=no,toolbar=no,scrollbars=yes,titlebar=no,menubar=no,resizable=yes,width=640,height=480,directories=no,location=no&#39;); return false;" rel="nofollow"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/printButton.png" alt="Печать"></a>		</td>
		
					</tr>
</tbody></table>

<table class="contentpaneopen">
<tbody><tr>
	<td valign="top">
		<span class="small">
			Добавил(а) microsin		</span>
		&nbsp;&nbsp;
	</td>
</tr>



<tr>
<td valign="top">
<p>Компилятор GNU C (<strong>gcc</strong>) для микроконтроллеров Atmel <strong>AVR</strong> RISC предоставляет специальные возможности для встраивания кода на ассемблере в программы на языке C. Это очень полезная возможность может использоваться для ручной оптимизации критических частей программного обеспечения или для использования специфических инструкций микроконтроллера, которые не доступны на языке C. Имейте в виду, что этот документ не касается модуля, полностью написанного на языке ассемблера, поэтому за дополнительной информацией обращайтесь к avr-libc и примерам кода на ассемблере. Здесь и далее дан перевод документации Inline Assembler Cookbook [1]. Этот документ описывает поведение компилятора GCC версии 3.3. Извинения автора и другие отступления от главной темы опущены.</p>



<p>[<strong>Оператор asm компилятора GCC</strong>]</p>
<p>Начнем с простого примера чтения данных из ножек порта D:</p>
<pre class="c" style="font-family: monospace;">asm<span style="color: #009900;">(</span><span style="color: #ff0000;">"in %0, %1"</span> <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=r"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span> <span style="color: #339933;">:</span> <span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>_SFR_IO_ADDR<span style="color: #009900;">(</span>PORTD<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Каждый оператор <strong>asm</strong> разделен двоеточием на части. Всего может быть 4 части:</p>
<p><strong>1</strong>. Инструкции ассемблера, заданные как одиночная строковая константа:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #ff0000;">"in %0, %1"</span></pre>
<p><strong>2</strong>. Список выходных операндов, разделенных запятыми. В нашем примере используется только один операнд:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #ff0000;">"=r"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span></pre>
<p><strong>3</strong>. Список входных операндов, разделенных запятыми. И снова в нашем примере используется только один операнд:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>_SFR_IO_ADDR<span style="color: #009900;">(</span>PORTD<span style="color: #009900;">)</span><span style="color: #009900;">)</span></pre>
<p><strong>4</strong>. Используемые регистры (<strong>clobbered registers</strong>), в нашем примере эта часть пустая (не используется). Список используемых регистров сообщает компилятору, что мы будем использовать эти регистры в ассемблерном коде, и будем менять их значение самостоятельно. Таким образом, компилятор не будет предполагать, что можно использовать эти регистры для промежуточных вычислений. Подробнее см. раздел "Clobbers".</p>
<p>Вы можете написать ассемблерные инструкции точно так же, как если бы Вы писали программу на ассемблере. Однако регистры и константы используются по-другому, если они задействованы в Вашей программе на C. Связь между регистрами и операндами C указывается во второй и третьей части инструкции asm (соответственно входные и выходные операнды). Общая форма оператора asm следующая:</p>
<pre class="c" style="font-family: monospace;">asm<span style="color: #009900;">(</span>code <span style="color: #339933;">:</span> output operand list <span style="color: #339933;">:</span> input operand list <span style="color: #009900;">[</span><span style="color: #339933;">:</span> clobber list<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>В секции кода операнды обозначены символом процента, за которым идет одна цифра. %0 относится к первому операнду, %1 ко второму и так далее. Из нашего примера:</p>
<p>%0 относится к "=r" (value)<br> и<br>%1 относится к "I" (_SFR_IO_ADDR(PORTD)).</p>
<p>Пока это может выглядеть немного странным (что такое =r, что такое I?), но синтаксис списка операндов будет скоро объяснен. Сначала посмотрим, какой код сгенерирует компилятор от оператора asm из нашего примера:</p>
<pre class="asm" style="font-family: monospace;">        <span style="color: #00007f; font-weight: bold;">lds</span> r24<span style="color: #339933;">,</span>value
<span style="color: #339933;">/*</span> #APP <span style="color: #339933;">*/</span>
        <span style="color: #00007f; font-weight: bold;">in</span> r24<span style="color: #339933;">,</span> <span style="color: #0000ff;">12</span>
<span style="color: #339933;">/*</span> #NOAPP <span style="color: #339933;">*/</span>
        sts value<span style="color: #339933;">,</span>r24</pre>
<p>Комментарии добавлены компилятором, чтобы информировать ассемблер, что сгенерированный код был получен не генерацией операторов C, а операторов встраивания ассемблера (<strong>inline assembler</strong>). Компилятор выбрал регистр r24 как место хранения значения, прочитанного из PORTD, но компилятор может выбрать и другой регистр. Он даже может неявно загрузить или сохранить значение, или может не включать вообще Ваш код ассемблера. Все эти принятия решений являются частью стратегии оптимизации кода. К примеру, если Вы не используете значение переменной в остальной части программы на C, то компилятор удалит Ваш код, если не отключите оптимизацию. Чтобы избежать такого поведения, добавляйте атрибут <strong>volatile</strong> к оператору asm:</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span><span style="color: #ff0000;">"in %0, %1"</span> <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=r"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span> <span style="color: #339933;">:</span> <span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>_SFR_IO_ADDR<span style="color: #009900;">(</span>PORTD<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Это необязательно, но операндам могут быть даны имена. Имя заключается в квадратные скобки в списке операндов, и обращение к именованному операнду использует имя в квадратных скобках вместо цифры после знака %. Таким образом, предыдущий пример может быть переписан следующим образом:</p>
<pre class="c" style="font-family: monospace;">asm<span style="color: #009900;">(</span><span style="color: #ff0000;">"in %[retval], %[port]"</span> <span style="color: #339933;">:</span>
    <span style="color: #009900;">[</span>retval<span style="color: #009900;">]</span> <span style="color: #ff0000;">"=r"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span> <span style="color: #339933;">:</span>
    <span style="color: #009900;">[</span>port<span style="color: #009900;">]</span> <span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>_SFR_IO_ADDR<span style="color: #009900;">(</span>PORTD<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Последняя часть инструкции asm, так называемый clobber list (об этом далее), используется для ручного указания компилятору о модификациях, которые выполняются в коде ассемблера. Эта часть может быть опущена (как в нашем примере), и все другие части должны присутствовать, но могут быть оставлены пустыми. Если Ваш код ассемблера не использует входные и/или выходные операнды, два символа двоеточия должны все еще завершать строку кода ассемблера. Хороший пример - простой оператор, запрещающий прерывания:</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span><span style="color: #ff0000;">"cli"</span><span style="color: #339933;">::</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>[<strong>Код ассемблера</strong>]</p>
<p>Вы можете использовать те же мнемоники инструкций ассемблера, которые используете с любым другим ассемблером AVR. И Вы можете написать много операторов ассемблера в одну строку кода - сколько хотите, сколько поместится в память FLASH микроконтроллера.</p>
<p>Внимание: допустимые директивы ассемблера меняются от одного ассемблера к другому.</p>
<p>Чтобы сделать код более читаемым, Вы можете разместить каждый оператор на отдельной строке:</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span><span style="color: #ff0000;">"nop\n\t"</span>
             <span style="color: #ff0000;">"nop\n\t"</span>
             <span style="color: #ff0000;">"nop\n\t"</span>
             <span style="color: #ff0000;">"nop\n\t"</span>
             <span style="color: #339933;">::</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Символ перевода строки <strong>\n</strong> и символ табуляции <strong>\t</strong> делают генерируемый листинг ассемблера более читаемым. Поначалу это может показаться немного странным, однако это способ, с помощью которого компилятор создает свой собственный листинг кода на ассемблере.</p>
<p>Вы можете также использовать некоторые специальные регистры, обозначенные специальными символами.</p>
<table border="0">
    <tbody>
        <tr style="background-color: #0000ff;">
            <td><span style="color: #ffffff;"><strong>Символ</strong></span></td>
            <td><span style="color: #ffffff;"><strong>Регистр</strong></span></td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>__SREG__</td>
            <td>Status register, регистр статуса по адресу 0x3F</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>__SP_H__</td>
            <td>Старший байт указателя стека по адресу 0x3E</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>__SP_L__</td>
            <td>Младший байт указателя стека по адресу 0x3D</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>__tmp_reg__</td>
            <td>Регистр r0, используется для временного хранения</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>__zero_reg__</td>
            <td>Регистр r1, всегда нуль</td>
        </tr>
    </tbody>
</table>
<p>Регистр r0 может свободно использоваться в Вашем коде на ассемблере, и его не нужно восстанавливать по окончании Вашего ассемблерного кода. Хорошая идея - использовать __tmp_reg__ и __zero_reg__ вместо r0 или r1, потому что в случае новой версии компилятора могут поменяться правила использования регистров.</p>
<p>[<strong>Входные и выходные операнды</strong>]</p>
<p>Каждый входной и выходной операнд описывается ограничивающей строкой, за которой идет выражение C в круглых скобках. Для AVR-GCC 3.3 определены следующие ограничивающие символы:</p>
<table border="0">
    <tbody>
        <tr style="background-color: #0000ff;">
            <td><span style="color: #ffffff;"><strong>Символ</strong></span></td>
            <td><span style="color: #ffffff;"><strong>Для чего используется</strong></span></td>
            <td><span style="color: #ffffff;"><strong>Диапазон</strong></span></td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>a</td>
            <td>Просто верхние регистры</td>
            <td>от r16 до r23</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>b</td>
            <td>Базовые пары регистров указателей</td>
            <td>y, z</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>d</td>
            <td>Верхние регистры</td>
            <td>от r16 до r31</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>e</td>
            <td>Пары регистров указателей</td>
            <td>x, y, z</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>q</td>
            <td>Регистр указателя стека</td>
            <td>SPH:SPL</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>r</td>
            <td>Любой регистр</td>
            <td>от r0 до r31</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>t</td>
            <td>Временный регистр</td>
            <td>r0</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>w</td>
            <td>Специальные верхние пары регистров</td>
            <td>r24, r26, r28, r30</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>x</td>
            <td>Пара регистров для указателя X</td>
            <td>x (r27:r26)</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>y</td>
            <td>Пара регистров для указателя Y</td>
            <td>y (r29:r28)</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>z</td>
            <td>Пара регистров для указателя Z</td>
            <td>z (r31:r30)</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>G</td>
            <td>Константа в формате с плавающей запятой</td>
            <td>0.0</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>I</td>
            <td>6-битное положительное целое число-константа</td>
            <td>от 0 до 63</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>J</td>
            <td>6-битное отрицательное целое число-константа</td>
            <td>-63 до 0</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>K</td>
            <td>Целочисленная константа</td>
            <td>2</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>L</td>
            <td>Целочисленная константа</td>
            <td>0</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>l</td>
            <td>Нижние регистры</td>
            <td>от r0 до r15</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>M</td>
            <td>8-битная целая константа</td>
            <td>от 0 до 255</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>N</td>
            <td>Целочисленная константа</td>
            <td>-1</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>O</td>
            <td>Целочисленная константа</td>
            <td>8, 16, 24</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>P</td>
            <td>Целочисленная константа</td>
            <td>1</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>Q</td>
            <td>(GCC &gt;= 4.2.x) Адрес памяти со смещением, базирующийся на указателе Y или Z.</td>
            <td></td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>R</td>
            <td>(GCC &gt;= 4.3.x) Целочисленная константа.</td>
            <td>от -6 до 5</td>
        </tr>
    </tbody>
</table>
<p>Выбор правильного ограничивающего (constraints) символа зависит от диапазона констант или регистров, которые должны быть совместимы с используемыми с ними инструкциями AVR. Компилятор C не проверяет ни одну строку Вашего кода ассемблера. Но он может проверить ограничивающий символ на Ваше C выражение. Однако, если Вы укажете неправильный ограничивающий символ, то компилятор может без всяких предупреждений передать ошибочный код ассемблеру. И, конечно, ассемблер выдаст сообщение (часто малопонятное) об ошибке, или сообщение о внутренней ошибке. Например, если Вы укажете ограничение "r" и будете использовать этот регистр с инструкцией "ori" Вашего кода на ассемблере, то компилятор может выбрать любой регистр. Ошибка произойдет, если компилятор выберет регистры от r2 до r15 (регистры r0 или r1 не будут выбраны, потому что они используются для особых целей). Для этого случая правильным ограничивающим символом будет "d". Если Вы выберете символ "M", то компилятор удостоверится, что Вы не передаете ничего, кроме 8-битного значения. Позже мы увидим, как передавать многобайтовые выражения в код ассемблера.</p>
<p>В следующей таблице показаны все инструкции AVR, которым требуются операнды, и соответствующие им ограничивающие символы. Они недостаточно строги из-за неподходящих определений ограничивающих символов в версии 3.3. Нет, например, никакого ограничения, которое ограничивает константы целого числа диапазоном от 0 до 7 для набора бит и операций очистки бит.</p>
<table style="background-color: #feffe2;">
    <tbody>
        <tr style="background-color: #0000ff;">
            <td><span style="color: #ffffff;"><strong>Mnemonic</strong></span></td>
            <td><span style="color: #ffffff;"><strong>Constraints</strong></span></td>
            <td style="background-color: #ffffff;"><span style="color: #ffffff;">&nbsp;</span></td>
            <td><span style="color: #ffffff;"><strong>Mnemonic</strong></span></td>
            <td><span style="color: #ffffff;"><strong>Constraints</strong></span></td>
        </tr>
        <tr>
            <td>adc</td>
            <td>r,r</td>
            <td style="background-color: #ffffff;"></td>
            <td>add</td>
            <td>r,r</td>
        </tr>
        <tr>
            <td>adiw</td>
            <td>w,I</td>
            <td style="background-color: #ffffff;"></td>
            <td>and</td>
            <td>r,r</td>
        </tr>
        <tr>
            <td>andi</td>
            <td>d,M</td>
            <td style="background-color: #ffffff;"></td>
            <td>asr</td>
            <td>r</td>
        </tr>
        <tr>
            <td>bclr</td>
            <td>I</td>
            <td style="background-color: #ffffff;"></td>
            <td>bld</td>
            <td>r,I</td>
        </tr>
        <tr>
            <td>brbc</td>
            <td>I,label</td>
            <td style="background-color: #ffffff;"></td>
            <td>brbs</td>
            <td>I,label</td>
        </tr>
        <tr>
            <td>bset</td>
            <td>I</td>
            <td style="background-color: #ffffff;"></td>
            <td>bst</td>
            <td>r,I</td>
        </tr>
        <tr>
            <td>cbi</td>
            <td>I,I</td>
            <td style="background-color: #ffffff;"></td>
            <td>cbr</td>
            <td>d,I</td>
        </tr>
        <tr>
            <td>com</td>
            <td>r</td>
            <td style="background-color: #ffffff;"></td>
            <td>cp</td>
            <td>r,r</td>
        </tr>
        <tr>
            <td>cpc</td>
            <td>r,r</td>
            <td style="background-color: #ffffff;"></td>
            <td>cpi</td>
            <td>d,M</td>
        </tr>
        <tr>
            <td>cpse</td>
            <td>r,r</td>
            <td style="background-color: #ffffff;"></td>
            <td>dec</td>
            <td>r</td>
        </tr>
        <tr>
            <td>elpm</td>
            <td>t,z</td>
            <td style="background-color: #ffffff;"></td>
            <td>eor</td>
            <td>r,r</td>
        </tr>
        <tr>
            <td>in</td>
            <td>r,I</td>
            <td style="background-color: #ffffff;"></td>
            <td>inc</td>
            <td>r</td>
        </tr>
        <tr>
            <td>ld</td>
            <td>r,e</td>
            <td style="background-color: #ffffff;"></td>
            <td>ldd</td>
            <td>r,b</td>
        </tr>
        <tr>
            <td>ldi</td>
            <td>d,M</td>
            <td style="background-color: #ffffff;"></td>
            <td>lds</td>
            <td>r,label</td>
        </tr>
        <tr>
            <td>lpm</td>
            <td>t,z</td>
            <td style="background-color: #ffffff;"></td>
            <td>lsl</td>
            <td>r</td>
        </tr>
        <tr>
            <td>lsr</td>
            <td>r</td>
            <td style="background-color: #ffffff;"></td>
            <td>mov</td>
            <td>r,r</td>
        </tr>
        <tr>
            <td>movw</td>
            <td>r,r</td>
            <td style="background-color: #ffffff;"></td>
            <td>mul</td>
            <td>r,r</td>
        </tr>
        <tr>
            <td>neg</td>
            <td>r</td>
            <td style="background-color: #ffffff;"></td>
            <td>or</td>
            <td>r,r</td>
        </tr>
        <tr>
            <td>ori</td>
            <td>d,M</td>
            <td style="background-color: #ffffff;"></td>
            <td>out</td>
            <td>I,r</td>
        </tr>
        <tr>
            <td>pop</td>
            <td>r</td>
            <td style="background-color: #ffffff;"></td>
            <td>push</td>
            <td>r</td>
        </tr>
        <tr>
            <td>rol</td>
            <td>r</td>
            <td style="background-color: #ffffff;"></td>
            <td>ror</td>
            <td>r</td>
        </tr>
        <tr>
            <td>sbc</td>
            <td>r,r</td>
            <td style="background-color: #ffffff;"></td>
            <td>sbci</td>
            <td>d,M</td>
        </tr>
        <tr>
            <td>sbi</td>
            <td>I,I</td>
            <td style="background-color: #ffffff;"></td>
            <td>sbic</td>
            <td>I,I</td>
        </tr>
        <tr>
            <td>sbiw</td>
            <td>w,I</td>
            <td style="background-color: #ffffff;"></td>
            <td>sbr</td>
            <td>d,M</td>
        </tr>
        <tr>
            <td>sbrc</td>
            <td>r,I</td>
            <td style="background-color: #ffffff;"></td>
            <td>sbrs</td>
            <td>r,I</td>
        </tr>
        <tr>
            <td>ser</td>
            <td>d</td>
            <td style="background-color: #ffffff;"></td>
            <td>st</td>
            <td>e,r</td>
        </tr>
        <tr>
            <td>std</td>
            <td>b,r</td>
            <td style="background-color: #ffffff;"></td>
            <td>sts</td>
            <td>label,r</td>
        </tr>
        <tr>
            <td>sub</td>
            <td>r,r</td>
            <td style="background-color: #ffffff;"></td>
            <td>subi</td>
            <td>d,M</td>
        </tr>
        <tr>
            <td>swap</td>
            <td>r</td>
            <td style="background-color: #ffffff;"></td>
            <td></td>
            <td></td>
        </tr>
    </tbody>
</table>
<p>Символы ограничения (constraints)&nbsp;могут быть с одиночным префиксом-модификатором. Ограничения без модификатора указывают на операнды только для чтения. Вот эти модификаторы:</p>
<table border="0">
    <tbody>
        <tr style="background-color: #0000ff;">
            <td><span style="color: #ffffff;"><strong>Модификатор</strong></span></td>
            <td><span style="color: #ffffff;"><strong>Что он указывает</strong></span></td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>=</td>
            <td>Операнд только для записи, обычно используется для всех выходных операндов.</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>+</td>
            <td>Операнд для чтения и записи.</td>
        </tr>
        <tr style="background-color: #fafad2;">
            <td>&amp;</td>
            <td>Регистр, который должен использоваться только для вывода.</td>
        </tr>
    </tbody>
</table>
<p>Выходные операнды должны быть только для записи, и выражение C должно быть <strong>lvalue</strong> [3]. Lvalue означает, что операнды должны существовать и быть допустимы для левой стороны операции присваивания. Имейте в виду, что компилятор не будет проверять, имеют ли операнды разумный тип для вида операции, используемой в инструкциях ассемблера.</p>
<p>Входные операнды, как Вы уже догадались, должны быть только для чтения. Однако как быть в случае, если нужен один и тот же операнд для ввода и вывода? В inline-коде ассемблера не поддерживаются операнды read-write. Но тут есть другое решение. Для входного операнда возможно использовать одиночную цифру на месте символа-ограничителя. Использование цифры n говорит компилятору использовать тот же самый регистр как для n-ного операнда, начиная с 0. Пример:</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span><span style="color: #ff0000;">"swap %0"</span> <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=r"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span> <span style="color: #339933;">:</span> <span style="color: #ff0000;">"0"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Оператор поменяет местами нибблы в 8-битной переменной с именем value. Ограничитель "0" говорит компилятору использовать тот же самый входной регистр, что касается первого операнда. Однако имейте в виду, что это автоматически не подразумевает обратный случай. Компилятор может выбрать те же самые регистры для входа и выхода, даже если ему не сказали сделать так. Это не составит проблемы в большинстве случаев, однако может стать фатальным, если выходной операнд модифицирован в коде ассемблера перед тем, как был использован входной операнд. В ситуации, когда Ваш код зависит от разных регистров для входных и выходных операндов, Вы должны добавить модификатор ограничителя &amp; к операнду выхода. Следующий пример демонстрирует эту проблему:</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span><span style="color: #ff0000;">"in %0,%1"</span>    <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"out %1, %2"</span>  <span style="color: #ff0000;">"\n\t"</span> 
             <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=&amp;r"</span> <span style="color: #009900;">(</span>input<span style="color: #009900;">)</span> 
             <span style="color: #339933;">:</span> <span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>_SFR_IO_ADDR<span style="color: #009900;">(</span>port<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">"r"</span> <span style="color: #009900;">(</span>output<span style="color: #009900;">)</span>
            <span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>В этом примере входное значение читается из порта и затем выходное значение пишется в тот же самый порт. Если вдруг компилятор выберет тот же самый регистр для входа и для выхода, то выходное значение будет уничтожено первой инструкцией ассемблера. К счастью, этот пример использует &amp; constraint modifier для инструктирования компилятора не выбирать любой регистр для выходного значения, которое используется для любых их входных операндов. Вернемся обратно к перестановке. Вот пример кода для перестановки младшего и старшего байта в 16-битном значении:</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span><span style="color: #ff0000;">"mov __tmp_reg__, %A0"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %A0, %B0"</span>         <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %B0, __tmp_reg__"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=r"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span>
             <span style="color: #339933;">:</span> <span style="color: #ff0000;">"0"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span>
            <span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Сначала Вы заметите использование регистра __tmp_reg__, который был упомянут в секции "Код ассемблера". Вы можете использовать этот регистр без сохранения его содержимого. Полностью новыми являются буквы A и B в %A0 и %B0. Фактически они обращаются к двум различным 8-битным регистрам, и оба содержат часть имеющегося значения. Другой пример, перестановка байт в 32-битном значении:</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span><span style="color: #ff0000;">"mov __tmp_reg__, %A0"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %A0, %D0"</span>         <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %D0, __tmp_reg__"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov __tmp_reg__, %B0"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %B0, %C0"</span>         <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %C0, __tmp_reg__"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=r"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span>
             <span style="color: #339933;">:</span> <span style="color: #ff0000;">"0"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span>
            <span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Вместо того, чтобы перечислить тот же самый операнд как операнд входа и выхода, этот операнд может быть объявлен как операнд для чтения и записи (read-write). Соответствующий модификатор должен быть добавлен к операнду вывода, и соответствующий входной операнд оставляется пустым:</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span><span style="color: #ff0000;">"mov __tmp_reg__, %A0"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %A0, %D0"</span>         <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %D0, __tmp_reg__"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov __tmp_reg__, %B0"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %B0, %C0"</span>         <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #ff0000;">"mov %C0, __tmp_reg__"</span> <span style="color: #ff0000;">"\n\t"</span>
             <span style="color: #339933;">:</span> <span style="color: #ff0000;">"+r"</span> <span style="color: #009900;">(</span>value<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Если операнды не помещаются в один регистр, то компилятор будет автоматически назначать достаточное количество регистров, чтобы принять весь операнд. В коде ассемблера %A0 соответствует самому младшему байту первого операнда, %A1 самому младшему байту второго операнда, и так далее. Следующий байт первого операнда будет соответствовать %B0, следующий %C0 и так далее.</p>
<p>Это также подразумевает, что часто нужно привести тип входного операнда к желаемому размеру.</p>
<p>Заключительная проблема может возникнуть при использовании регистровых пар - указателей. Если Вы зададите входной операнд как</p>
<pre class="c" style="font-family: monospace;"><span style="color: #ff0000;">"e"</span> <span style="color: #009900;">(</span>ptr<span style="color: #009900;">)</span></pre>
<p>и компилятор выберет регистр Z (r30:r31), то</p>
<p>%A0 будет соответствовать r30<br> и<br>%B0 будет соответствовать r31.</p>
<p>Но обе версии потерпят ошибку на стадии ассемблирования, если Вы явно нуждаетесь в Z, наподобие</p>
<pre class="asm" style="font-family: monospace;">      ld r24<span style="color: #339933;">,</span>Z</pre>
<p>Если Вы напишете</p>
<pre class="asm" style="font-family: monospace;">      ld r24<span style="color: #339933;">,</span> <span style="color: #339933;">%</span>a0</pre>
<p>с буквой a в нижнем регистре, то компилятор создаст правильную ассемблерную строку.</p>
<p>[<strong>Clobbers</strong>]</p>
<p>Как было упомянуто ранее, последняя часть оператора asm является списком clobbers, который может быть опущен, включая разделитель в виде двоеточия. Однако, если Вы используете в коде ассемблера какие-то регистры, которые не были переданы как операнды, то Вы должны сообщить компилятору об этом. Следующий пример делает атомарный инкремент. То есть сразу инкрементируется 8-битное значение, на которое указывает переменная указателя, и гарантируется, что эта операция не будет прервана обработчиком прерывания или другим потоком в многопоточной среде выполнения. Обратите внимание, что мы должны использовать указатель, потому что увеличенное значение должно быть сохранено прежде, чем будут снова разрешены прерывания.</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span>
    <span style="color: #ff0000;">"cli"</span>               <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #ff0000;">"ld r24, %a0"</span>       <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #ff0000;">"inc r24"</span>           <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #ff0000;">"st %a0, r24"</span>       <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #ff0000;">"sei"</span>               <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #339933;">:</span>
    <span style="color: #339933;">:</span> <span style="color: #ff0000;">"e"</span> <span style="color: #009900;">(</span>ptr<span style="color: #009900;">)</span>
    <span style="color: #339933;">:</span> <span style="color: #ff0000;">"r24"</span>
<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Компилятор может сгенерировать следующий код:</p>
<pre class="asm" style="font-family: monospace;">    <span style="color: #00007f; font-weight: bold;">cli</span>
    ld r24<span style="color: #339933;">,</span> Z
    <span style="color: #00007f; font-weight: bold;">inc</span> r24
    <span style="color: #00007f;">st</span> Z<span style="color: #339933;">,</span> r24
    sei</pre>
<p>Простое решение для того, чтобы избежать порчи регистра r24 - использовать специальный временный регистр __tmp_reg__, определенный компилятором.</p>
<pre class="c" style="font-family: monospace;">asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span>
    <span style="color: #ff0000;">"cli"</span>                       <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #ff0000;">"ld __tmp_reg__, %a0"</span>       <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #ff0000;">"inc __tmp_reg__"</span>           <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #ff0000;">"st %a0, __tmp_reg__"</span>       <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #ff0000;">"sei"</span>                       <span style="color: #ff0000;">"\n\t"</span>
    <span style="color: #339933;">:</span>
    <span style="color: #339933;">:</span> <span style="color: #ff0000;">"e"</span> <span style="color: #009900;">(</span>ptr<span style="color: #009900;">)</span>
<span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Компилятор подготовлен перезагрузить этот регистр в следующий раз, когда регистр будет использоваться. Другая проблема с вышеуказанным кодом (что нельзя было упомянуть в предыдущих секциях) - случаи, когда вообще прерывания запрещены и должны остаться запрещенными, так как мы разрешили прерывания в конце нашего кода. Мы могли бы для решения проблемы сохранить текущее состояние, но тогда для этого нужен другой регистр. Снова мы можем разрешить проблему без резервирования фиксированного регистра (clobbering), но позволив компилятору выбрать его. Это можно сделать с помощью локальной переменной C.</p>
<pre class="c" style="font-family: monospace;"><span style="color: #009900;">{</span>
    uint8_t s<span style="color: #339933;">;</span>
    asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span>
        <span style="color: #ff0000;">"in %0, __SREG__"</span>           <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"cli"</span>                       <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"ld __tmp_reg__, %a1"</span>       <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"inc __tmp_reg__"</span>           <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"st %a1, __tmp_reg__"</span>       <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"out __SREG__, %0"</span>          <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=&amp;r"</span> <span style="color: #009900;">(</span>s<span style="color: #009900;">)</span>
        <span style="color: #339933;">:</span> <span style="color: #ff0000;">"e"</span> <span style="color: #009900;">(</span>ptr<span style="color: #009900;">)</span>
    <span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre>
<p>Теперь все кажется корректным, но на самом деле это не так. Код ассемблера модифицирует переменную, на которую указывает ptr. Компилятор не распознает это, и может удерживать её значение в любом другом из доступных регистров. Мало того, что компилятор работает с неверным значением, но и код ассемблера делает то же самое. Программа на языке C может также модифицировать значение, но компилятор не обновит содержимое памяти по причине оптимизации. Вот самое худшее, что Вы можете сделать в таком случае:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #009900;">{</span>
    uint8_t s<span style="color: #339933;">;</span>
    asm <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span>
        <span style="color: #ff0000;">"in %0, __SREG__"</span>           <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"cli"</span>                       <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"ld __tmp_reg__, %a1"</span>       <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"inc __tmp_reg__"</span>           <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"st %a1, __tmp_reg__"</span>       <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"out __SREG__, %0"</span>          <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=&amp;r"</span> <span style="color: #009900;">(</span>s<span style="color: #009900;">)</span>
        <span style="color: #339933;">:</span> <span style="color: #ff0000;">"e"</span> <span style="color: #009900;">(</span>ptr<span style="color: #009900;">)</span>
        <span style="color: #339933;">:</span> <span style="color: #ff0000;">"memory"</span>
    <span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre>
<p>Специальный clobber "memory" информирует компилятор, что код ассемблера может модифицировать любое место в памяти. Это принудит компилятор обновить все переменные, которые в настоящий момент содержатся в регистрах, перед выполнением кода ассемблера. И конечно, эти переменные должны быть перезагружены заново после выполнения этого кода.</p>
<p>В большинстве ситуаций есть решение лучше, декларировать саму переменную указателя как volatile:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #993333;">volatile</span> uint8_t <span style="color: #339933;">*</span>ptr<span style="color: #339933;">;</span></pre>
<p>Тогда компилятор ожидает, что значение, на которое указывает ptr, будет изменено, и загрузит его в любом случае, и сохранит его всегда, когда изменено.</p>
<p>Ситуации, когда понадобятся clobbers, встречаются редко. Зарезервированные, модифицируемые в коде ассемблера (clobbered) регистры принудят компилятор сохранять их значение перед вызовом кода ассемблера, и соответственно восстанавливать их значение после завершения кода ассемблера. Использование clobbers нежелательно, поскольку это не только лишние накладные расходы, но и не дает компилятору свободы по оптимизации Вашего кода.</p>
<p>[<strong>Макросы на ассемблере (Assembler Macros)</strong>]</p>
<p>Чтобы повторно использовать части Вашего кода, написанные на языке ассемблера, полезно задать их как макрос и разместить в подключаемых файлах (заголовки *.h, include files). AVR Libc поставляется с набором готовых макросов, которые можно найти в папке avr/include. Использование этих заголовочных файлов может приводить к предупреждающим сообщениям компилятора, если они используются в модулях, которые компилируются в режиме жесткого ANSI (strict ANSI mode). Чтобы избежать этого, Вы можете написать<strong> __asm__</strong> вместо asm и <strong>__volatile__</strong> вместо volatile. Это эквивалентные алиасы.</p>
<p>Другая проблема при использовании макросов возникнет, если Вы используете метки в коде. В таких случаях для меток используйте специальный паттерн <strong>%=</strong>, который будет заменен уникальным числом в каждом операторе asm. Вот пример, который взят из <em>avr/include/iomacros.h</em>:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #339933;">#define loop_until_bit_is_clear(port,bit) </span>
        __asm__ __volatile__ <span style="color: #009900;">(</span>             
        <span style="color: #ff0000;">"L_%=: "</span> <span style="color: #ff0000;">"sbic %0, %1"</span> <span style="color: #ff0000;">"\n\t"</span>      
                 <span style="color: #ff0000;">"rjmp L_%="</span>               
                 <span style="color: #339933;">:</span> <span style="color: #808080; font-style: italic;">/* no outputs */</span>        
                 <span style="color: #339933;">:</span> <span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>_SFR_IO_ADDR<span style="color: #009900;">(</span>port<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>  
                   <span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>bit<span style="color: #009900;">)</span>    
        <span style="color: #009900;">)</span></pre>
<p>Когда макрос используется в первый раз, то метка L_%= может быть оттранслирована в L_1404, в следующий раз она может быть оттранслирована в L_1405 или что-то подобное. В любом случае каждый раз метки будут уникальными.</p>
<p>Другим вариант - использование стиля Unix-assembler для нумерации меток. Это объяснено в статье "Как отлаживать файл ассемблера в avr-gdb" ("How do I trace an assembler file in avr-gdb?") [2]. Вышеупомянутый пример будет выглядеть так:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #339933;">#define loop_until_bit_is_clear(port,bit) </span>
        __asm__ __volatile__ <span style="color: #009900;">(</span>             
        <span style="color: #ff0000;">"1: "</span> <span style="color: #ff0000;">"sbic %0, %1"</span> <span style="color: #ff0000;">"\n\t"</span>      
                 <span style="color: #ff0000;">"rjmp 1b"</span>               
                 <span style="color: #339933;">:</span> <span style="color: #808080; font-style: italic;">/* no outputs */</span>        
                 <span style="color: #339933;">:</span> <span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>_SFR_IO_ADDR<span style="color: #009900;">(</span>port<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>  
                   <span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>bit<span style="color: #009900;">)</span>    
        <span style="color: #009900;">)</span></pre>
<p>[<strong>Функции-заглушки на C (C Stub Functions)</strong>]</p>
<p>Макрос будет вставлять кусок кода во все места, которые ссылаются на макрос. Это может быть неприемлемо для больших блоков кода ассемблера, поскольку приведет к быстрому расходу памяти программ. В этом случае можно задать <strong>stub</strong> функцию C, которая не содержит ничего, кроме как Ваш код ассемблера. Пояснение: обычно Stub-функциями называют функции-заглушки, которые заданы, но не содержат реального кода на C.</p>
<pre class="c" style="font-family: monospace;"><span style="color: #993333;">void</span> delay<span style="color: #009900;">(</span>uint8_t ms<span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    uint16_t cnt<span style="color: #339933;">;</span>
    asm <span style="color: #993333;">volatile</span> <span style="color: #009900;">(</span>
        <span style="color: #ff0000;">"n"</span>
        <span style="color: #ff0000;">"L_dl1%=:"</span> <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"mov %A0, %A2"</span> <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"mov %B0, %B2"</span> <span style="color: #ff0000;">"\n"</span>
        <span style="color: #ff0000;">"L_dl2%=:"</span> <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"sbiw %A0, 1"</span> <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"brne L_dl2%="</span> <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"dec %1"</span> <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"brne L_dl1%="</span> <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=&amp;w"</span> <span style="color: #009900;">(</span>cnt<span style="color: #009900;">)</span>
        <span style="color: #339933;">:</span> <span style="color: #ff0000;">"r"</span> <span style="color: #009900;">(</span>ms<span style="color: #009900;">)</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">"r"</span> <span style="color: #009900;">(</span>delay_count<span style="color: #009900;">)</span>
        <span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre>
<p>Назначение этой функции состоит в задержке выполнения программы на указанное количество миллисекунд - с помощью подсчета циклов. Глобальная 16-битная переменная delay_count должна содержать тактовую частоту CPU в герцах, деленную на 4000, и она должна быть установлена перед вызовом этой подпрограммы в первый раз. Как было описано в секции "Clobbers", эта подпрограмма использует локальную переменную для того, чтобы хранить временное значение.</p>
<p>Другое использование локальной переменной заключается в возврате значения. Следующая функция возвращает 16-битное значение, прочитанное из двух последовательных адресов порта.</p>
<pre class="c" style="font-family: monospace;">uint16_t inw<span style="color: #009900;">(</span>uint8_t port<span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    uint16_t result<span style="color: #339933;">;</span>
    asm <span style="color: #993333;">volatile</span> <span style="color: #009900;">(</span>
        <span style="color: #ff0000;">"in %A0,%1"</span> <span style="color: #ff0000;">"\n\t"</span>
        <span style="color: #ff0000;">"in %B0,(%1) + 1"</span>
        <span style="color: #339933;">:</span> <span style="color: #ff0000;">"=r"</span> <span style="color: #009900;">(</span>result<span style="color: #009900;">)</span>
        <span style="color: #339933;">:</span> <span style="color: #ff0000;">"I"</span> <span style="color: #009900;">(</span>_SFR_IO_ADDR<span style="color: #009900;">(</span>port<span style="color: #009900;">)</span><span style="color: #009900;">)</span>
        <span style="color: #009900;">)</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">return</span> result<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre>
<p>Примечание: функция inw() поставляется в составе avr-libc.</p>
<p>[<strong>Использование имен C в коде ассемблера</strong>]</p>
<p>По умолчанию AVR-GCC использует те же самые символические имена функций или переменных и в C, и в коде на ассемблере. Вы можете указать разные имена для кода ассемблера путем использования специальной формы оператора asm:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #993333;">unsigned</span> <span style="color: #993333;">long</span> value asm<span style="color: #009900;">(</span><span style="color: #ff0000;">"clock"</span><span style="color: #009900;">)</span> <span style="color: #339933;">=</span> <span style="color: #0000dd;">3686400</span><span style="color: #339933;">;</span></pre>
<p>Этот оператор инструктирует компилятор использовать символическое имя clock, а не значение. Это имеет смысл только для внешних или статических переменных, потому что у локальных переменных нет символических имен в коде ассемблера. Однако локальные переменные могут храниться в регистрах.</p>
<p>Для компилятора AVR-GCC Вы можете указать использовать конкретный регистр:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #993333;">void</span> Count<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    <span style="color: #993333;">register</span> <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> counter asm<span style="color: #009900;">(</span><span style="color: #ff0000;">"r3"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
    ... тут некоторый код ...
    <span style="color: #202020;">asm</span> <span style="color: #993333;">volatile</span><span style="color: #009900;">(</span><span style="color: #ff0000;">"clr r3"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
    ... тут еще код ...
<span style="color: #009900;">}</span></pre>
<p>Инструкция ассемблера "clr r3" очистит переменную счетчика. AVR-GCC не будет полностью резервировать указанный регистр. Если оптимизатор определит, что переменная больше не используется, то регистр может быть задействован для других целей. Но компилятор не в состоянии проверить, находится ли это использование регистра в конфликте с другими предопределенными регистрами. если Вы зарезервируете слишком много регистров таким способом, то компилятор может даже исчерпать регистры во время генерации кода.</p>
<p>Чтобы поменять имя функции, Вам нужно декларировать прототип, потому что компилятор не будет принимать ключевое слово asm в определении функции:</p>
<pre class="c" style="font-family: monospace;"><span style="color: #000000; font-weight: bold;">extern</span> <span style="color: #993333;">long</span> Calc<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span> asm <span style="color: #009900;">(</span><span style="color: #ff0000;">"CALCULATE"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span></pre>
<p>Вызов функции Calc() создаст инструкции ассемблера, вызывающие функцию CALCULATE.</p>
<p>Для получения дополнительной информации по использованию inline-ассемблера см. руководство gcc [4].</p>
<p>[<strong>Разбор примера кода inline-ассемблера GCC</strong>]</p>
<p>Для того, чтобы лучше понять, как по-настоящему используется inline-ассемблер, полезно разобрать хороший рабочий пример [5]. Это код ассемблера AVR, который работает на частоте 16 МГц и управляет светодиодной RGB-лентой, сделанной на основе драйвера WS2811 [6]. Вот этот код целиком, а потом разберем его строчка за строчкой.</p>
<p><!-- HTML generated using hilite.me --></p><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-style: italic">/*</span>
<span style="color: #008800; font-style: italic"> * Copyright 2012 Alan Burlison, alan@bleaklow.com.  All rights reserved.</span>
<span style="color: #008800; font-style: italic"> * Use is subject to license terms.</span>
<span style="color: #008800; font-style: italic"> */</span>

<span style="color: #008800; font-style: italic">/*</span>
<span style="color: #008800; font-style: italic"> * WS2811 RGB LED driver. Рассчитан на частоту кварца 16 МГц, выдает скорость </span>
<span style="color: #008800; font-style: italic"> *  выходных данных 800 кГц. Проверялся на Minumus 32 board с микроконтроллером </span>
<span style="color: #008800; font-style: italic"> *  Atmel ATmega32U2. Компилятор AVR GCC, пример кода для использования см.</span>
<span style="color: #008800; font-style: italic"> *  в файле threepixeldemo.c.</span>
<span style="color: #008800; font-style: italic"> * http://bleaklow.com/2012/12/02/driving_the_ws2811_at_800khz_with_a_16mhz_avr.html</span>
<span style="color: #008800; font-style: italic"> *</span>
<span style="color: #008800; font-style: italic"> * Прим. переводчика: WS2811.h был успешно протестирован на макетной плате</span>
<span style="color: #008800; font-style: italic"> *  AVR-USB-MEGA16 с микроконтроллером ATmega32A, кварцевым резонатором 20 МГц,</span>
<span style="color: #008800; font-style: italic"> *  на светодиодной ленте GE60RGB2811C из 300 шт. RGB-светодиодов 5050 RGB LED.</span>
<span style="color: #008800; font-style: italic"> */</span>

<span style="color: #008080">#ifndef WS2811_h</span>
<span style="color: #008080">#define WS2811_h</span>

<span style="color: #008800; font-style: italic">// Структура для значения цветов RGB.</span>
<span style="color: #000080; font-weight: bold">typedef</span> <span style="color: #000080; font-weight: bold">struct</span> __attribute__ ((__packed__)) {
    <span style="color: #000080; font-weight: bold">uint8_t</span> r;
    <span style="color: #000080; font-weight: bold">uint8_t</span> g;
    <span style="color: #000080; font-weight: bold">uint8_t</span> b;
} RGB_t;

<span style="color: #008080">#ifndef ARRAYLEN</span>
<span style="color: #008080">#define ARRAYLEN(A) (sizeof(A) / sizeof(A[0]))</span>
<span style="color: #008080">#endif</span>

<span style="color: #008800; font-style: italic">/*</span>
<span style="color: #008800; font-style: italic"> * Inline asm macro для вывода 24-битного цвета RGB в прядке (G,R,B), старший бит MSB</span>
<span style="color: #008800; font-style: italic"> *  идет первым.</span>
<span style="color: #008800; font-style: italic"> * 0 биты кодируются интервалами 250ns hi, 1000ns lo, 1 биты 1000ns hi, 250ns lo.</span>
<span style="color: #008800; font-style: italic"> * r18 = red байт для вывода</span>
<span style="color: #008800; font-style: italic"> * r19 = green байт для вывода</span>
<span style="color: #008800; font-style: italic"> * r20 = blue байт для вывода</span>
<span style="color: #008800; font-style: italic"> * r26 = сохраненный SREG</span>
<span style="color: #008800; font-style: italic"> * r27 = внутренний счетчик циклов</span>
<span style="color: #008800; font-style: italic"> */</span>
<span style="color: #008080">#define WS2811(PORT, PIN, RGB, LEN) \</span>
<span style="color: #008080">asm volatile( \</span>
<span style="color: #008800; font-style: italic">/* инициализация */</span><span style="color: #008080"> \</span>
<span style="color: #008080">"    cp %A[len], r1      ; проверка len &gt; 0, и немедленный возврат если это так\n" \</span>
<span style="color: #008080">"    cpc %B[len], r1\n" \</span>
<span style="color: #008080">"    brne 1f\n" \</span>
<span style="color: #008080">"    rjmp 16f\n" \</span>
<span style="color: #008080">"1:  ld r18, Z+           ; сначала загрузка байта red для вывода\n" \</span>
<span style="color: #008080">"    ld r19, Z+           ; загрузка первого байта green для вывода\n" \</span>
<span style="color: #008080">"    ld r20, Z+           ; загрузка первого байта blue для вывода\n" \</span>
<span style="color: #008080">"    ldi r27, 8           ; загрузка внутреннего счетчика циклов\n" \</span>
<span style="color: #008080">"    in r26, __SREG__     ; код критичен по времени выполнения, так что запретим прерывания\n" \</span>
<span style="color: #008080">"    cli\n" \</span>
<span style="color: #008800; font-style: italic">/* green - цикл вывода 8 бит */</span><span style="color: #008080"> \</span>
<span style="color: #008080">"2:  sbi  %[port], %[pin] ; перевод вывода в лог. 1, lo -&gt; hi\n" \</span>
<span style="color: #008080">"    sbrc r19, 7          ; проверка - в нуле ли старший бит\n" \</span>
<span style="color: #008080">"    rjmp 3f              ; true, пропуск перевода hi -&gt; lo\n" \</span>
<span style="color: #008080">"    cbi  %[port], %[pin] ; false, перевод hi -&gt; lo\n" \</span>
<span style="color: #008080">"3:  sbrc r19, 7          ; выравнивание задержки для двух ветвей кода\n" \</span>
<span style="color: #008080">"    rjmp 4f\n" \</span>
<span style="color: #008080">"4:  nop                  ; задержка для формирования импульса\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    lsl r19              ; сдвиг к следующему биту\n" \</span>
<span style="color: #008080">"    dec r27              ; декремент счетчика бит\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    brne 2b\n            ; если не передали все биты, цикл\n" \</span>
<span style="color: #008080">"    ldi r27, 7           ; перезагрузка внутреннего счетчика бит\n" \</span>
<span style="color: #008800; font-style: italic">/* red - цикл вывода первых 7 бит */</span><span style="color: #008080"> \</span>
<span style="color: #008080">"5:  sbi %[port], %[pin]  ; pin lo -&gt; hi\n" \</span>
<span style="color: #008080">"    sbrc r18, 7          ; проверка, в нуле ли старший бит\n" \</span>
<span style="color: #008080">"    rjmp 6f              ; true, пропуск pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; false, pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"6:  sbrc r18, 7          ; выравнивание задержки для двух ветвей кода\n" \</span>
<span style="color: #008080">"    rjmp 7f\n" \</span>
<span style="color: #008080">"7:  nop                  ; задержка для формирования импульса\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    lsl r18              ; сдвиг к следующему биту\n" \</span>
<span style="color: #008080">"    dec r27              ; декремент счетчика бит\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    brne 5b              ; если не передали все биты, цикл\n" \</span>
<span style="color: #008080">"    nop                  ; выравнивание задержки для двух ветвей кода\n" \</span>
<span style="color: #008800; font-style: italic">/* red, 8-й бит - вывод его и выборка следующих значений */</span><span style="color: #008080"> \</span>
<span style="color: #008080">"    sbi %[port], %[pin]  ; pin lo -&gt; hi\n" \</span>
<span style="color: #008080">"    sbrc r18, 7          ; проверка, нулевой ли старший бит\n" \</span>
<span style="color: #008080">"    rjmp 8f              ; true, пропуск pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; false, pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"8:  sbrc r18, 7          ; выравнивание задержки для двух ветвей кода\n" \</span>
<span style="color: #008080">"    rjmp 9f\n" \</span>
<span style="color: #008080">"9:  nop                  ; задержка для формирования импульса\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    ld r18, Z+           ; загрузка следующего red байта\n" \</span>
<span style="color: #008080">"    ld r19, Z+           ; загрузка следующего green байта\n" \</span>
<span style="color: #008080">"    ldi r27, 7           ; перезагрузка внутреннего счетчика бит\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    nop                  ; продолжение формирования задержки\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008800; font-style: italic">/* blue - цикл вывода первых 7 бит */</span><span style="color: #008080"> \</span>
<span style="color: #008080">"10:  sbi %[port], %[pin] ; pin lo -&gt; hi\n" \</span>
<span style="color: #008080">"    sbrc r20, 7          ; проверка на нуль старшего бита\n" \</span>
<span style="color: #008080">"    rjmp 11f             ; true, пропуск pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; false, pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"11: sbrc r20, 7          ; выравнивание задержки для двух ветвей кода\n" \</span>
<span style="color: #008080">"    rjmp 12f\n" \</span>
<span style="color: #008080">"12: nop                  ; задержка для формирования импульса\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    lsl r20              ; сдвиг к следующему биту\n" \</span>
<span style="color: #008080">"    dec r27              ; декремент счетчика бит\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    brne 10b             ; если не передали все биты, цикл\n" \</span>
<span style="color: #008080">"    nop                  ; выравнивание задержки для двух ветвей кода\n" \</span>
<span style="color: #008800; font-style: italic">/* blue, 8-й бит - вывод &amp; обработка внешнего цикла */</span><span style="color: #008080"> \</span>
<span style="color: #008080">"    sbi %[port], %[pin]  ; pin lo -&gt; hi\n" \</span>
<span style="color: #008080">"    sbrc r20, 7          ; проверка, нулевой ли старший бит\n" \</span>
<span style="color: #008080">"    rjmp 13f             ; true, пропуск pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; false, pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"13: sbrc r20, 7          ; выравнивание задержки для двух ветвей кода\n" \</span>
<span style="color: #008080">"    rjmp 14f\n" \</span>
<span style="color: #008080">"14: nop                  ; задержка для формирования импульса\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    ldi r27, 8           ; перезагрузка внутреннего счетчика бит\n" \</span>
<span style="color: #008080">"    sbiw %A[len], 1      ; декремент внешнего счетчика цикла\n" \</span>
<span style="color: #008080">"    breq 15f             ; выход, если внешний счетчик обнулился\n" \</span>
<span style="color: #008080">"    ld r20, Z+           ; загрузка следующего байта blue\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    rjmp 2b              ; внешний цикл, если это нужно\n" \</span>
<span style="color: #008080">"15: nop                  ; задержка для формирования импульса\n" \</span>
<span style="color: #008080">"    cbi %[port], %[pin]  ; pin hi -&gt; lo\n" \</span>
<span style="color: #008080">"    nop                  ; задержка для формирования импульса\n" \</span>
<span style="color: #008080">"    nop\n" \</span>
<span style="color: #008080">"    out __SREG__, r26    ; снова разрешим прерывания\n" \</span>
<span style="color: #008080">"16:\n" \</span>
<span style="color: #008080">: \</span>
<span style="color: #008080">: [rgb] "z" (RGB), \</span>
<span style="color: #008080">  [len] "w" (LEN), \</span>
<span style="color: #008080">  [port] "I" (_SFR_IO_ADDR(PORT)), \</span>
<span style="color: #008080">  [pin] "I" (PIN) \</span>
<span style="color: #008080">: "r18", "r19", "r20", "r26", "r27", "cc", "memory" \</span>
<span style="color: #008080">)</span>

<span style="color: #008800; font-style: italic">/*</span>
<span style="color: #008800; font-style: italic"> * Определение функции C, чтобы обернуть inline WS2811 для указанного порта и вывода pin.</span>
<span style="color: #008800; font-style: italic"> */</span>
<span style="color: #008080">#define DEFINE_WS2811_FN(NAME, PORT, PIN) \</span>
<span style="color: #008080">extern void NAME(const RGB_t *rgb, uint16_t len) __attribute__((noinline)); \</span>
<span style="color: #008080">void NAME(const RGB_t *rgb, uint16_t len) { WS2811(PORT, PIN, rgb, len); }</span>

<span style="color: #008080">#endif </span><span style="color: #008800; font-style: italic">/* WS2811_h */</span><span style="color: #008080"></span>
</pre></td></tr></tbody></table></div><p></p>
<p><strong>Строки 14, 15, 157</strong>. Задается стандартное определение, защищающее хедер от многократного включения.</p>
<p><strong>Строки 17..22</strong>. Эта структура предназначена для хранения цветов одной RGB-ячейки (RGB-светодиод, управляемый одной микросхемой WS2811). Для хранения данных светодиодной ленты, состоящей из нескольких светодиодов, задается массив таких структур. Например, если у Вас заводская RGB-лента GE60RGB2811C (влагозащищенная лента 5 метров длиной), состоящая из 300 RGB-светодиодов, то для её управления нужно задать массив из 300 ячеек RGB_t:</p>
<!-- HTML generated using hilite.me -->
<div style="background: #ffffff; overflow: auto; width: auto; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
    <pre style="margin: 0; line-height: 125%;">RGB_t rgb[<span style="color: #0000ff;">300</span>];
</pre>
</div>
<p><strong>Строки 24..26</strong>. Макрос ARRAYLEN, который используется для получения размера массива ячеек RGB_t. Макрос используется так:</p>
<!-- HTML generated using hilite.me -->
<div style="background: #ffffff; overflow: auto; width: auto; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
    <pre style="margin: 0; line-height: 125%;">WS2811RGB(rgb, ARRAYLEN(rgb));
</pre>
</div>
<p>Для нашего примера (RGB-лента GE60RGB2811C из 300 RGB-ячеек) вызов макроса ARRAYLEN(rgb) вернет 300. Очевидно, что этот макрос задан чисто для наглядности и удобства, так как в нашем примере вместо него можно было просто указать константу 300 с тем же самым результатом:</p>
<!-- HTML generated using hilite.me -->
<div style="background: #ffffff; overflow: auto; width: auto; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
    <pre style="margin: 0; line-height: 125%;"><span style="color: #008080;">#define GE60RGB2811C_CELLS 200</span>
RGB_t rgb[GE60RGB2811C_CELLS];
...
WS2811RGB(rgb, GE60RGB2811C_CELLS);
</pre>
</div>
<p><strong>Строки 38, 39</strong>. Здесь начинается самое интересное - определение inline-макроса WS2811 с 4 параметрами:</p>
<p>PORT задает 8-битный регистр AVR, которому принадлежит ножка выхода данных для ленты PIN. Например, это может быть регистр PORTB. См. строку 149.<br>PIN номер бита PORT, который работает как выход данных для ленты. См. строку 150.<br>RGB адрес массива, где лежат данные всех светодиодов. Для нашего примера это массив RGB_t rgb[300]. Адрес массива rgb будет загружен в индексный регистр z, см. строку 147.<br>LEN последний параметр макроса, сюда передается длина светодиодной ленты (сколько в ней RGB-светодиодов). Для нашего примера это 300. Значение LEN будет загружено в одну из верхних пар регистров компилятора, см. строку 148.</p>
<p>Строки 45..48. Здесь проверяется на 0 значение регистровой пары, в которую попал параметр LEN. На первый взгляд сложно, но если разобраться, то все просто.</p>
<!-- HTML generated using hilite.me -->
<div style="background: #ffffff; overflow: auto; width: auto; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
    <pre style="margin: 0; line-height: 125%;">    cp %A[len], r1
    cpc %B[len], r1
    brne <span style="color: #0000ff;">1</span>f
    rjmp <span style="color: #0000ff;">16</span>f
</pre>
</div>
<p>В регистр r1 загружен 0 (это правило inline-ассемблера GCC, о чем упоминалось выше). Хитрыми обозначениями %A[len] и %B[len] просто кодируются соответственно младший и старший байты регистровой пары, в которой хранится параметр LEN. В результате, если в регистровой паре не 0, то произойдет переход по метке 1 (brne 1f). Если же регистровая пара обнулилась, то значит весь массив данных передан, и происходит переход по метке 16 (rjmp 16f). Буква f ничего не значит, просто добавляется к имени метки.</p>
<p><strong>Строки 49..51</strong>. Во временные регистры r18, r19, r20 загружаются последовательно байты по адресу в индексе z (как мы помним, туда загружен адрес массива rgb).</p>
<p><strong>Строка 52</strong>. В регистр r27 (счетчик бит) загружается значение 8.</p>
<p><strong>Строки 53, 54</strong>. Значение регистра SREG запоминается в r26 и запрещается работа прерываний.</p>
<p><strong>Строки 56..67</strong>. Здесь идет работа по формированию передачи одного бита по данным в регистре r19. Сигнал данных переводится в уровень лог. 1 и лог. 0 соответственно командами sbi и cbi. Операнды этих команд %[port], и %[pin] берутся из параметров PORT и PIN макроса WS2811.</p>
<p><strong>Строки 68..71</strong>. Обработка всех битов в регистре r19 по порядку - с декрементом счетчика бит и сдвигом к следующему биту.</p>
<p><strong>Строки 74..139</strong>. Аналогичным образом обрабатываются r19, r20, и передаются оттуда данные в светодиодную ленту. Отличие от предыдущего кода только в том, что иногда подряд передаются только 7 бит, и 8-й бит передается отдельно. Это сделано для того, чтобы выделить время для загрузки в регистры r18, r19, r20 новой порции байт R, G, B. В строке 135 делается декремент регистровой пары len, и в строке 136 делается проверка на 0 - если счетчик обнулился, то произойдет переход по метке 15 и завершение всей передачи. При этом восстанавливается оригинальное значение SREG, и будут разрешены прерывания, если до работы кода inline-ассемблера они были разрешены. Если же len не равен нулю, то в строке 139 произойдет зацикливание по метке 2 (будут передаваться остальные данные RGB).</p>
<p><strong>Строки 147..150</strong>. Здесь с помощью хитрого синтаксиса задается соответствие входных параметров макроса и внутренним именам кода inline кода ассемблера. Имена "z", "w", "I" кодируют используемые регистры для указанных имен, z соответствует регистровой паре R31:R30, w регистровой паре из верхних регистров (по выбору компилятора), I задает 6-битное число-константу (см. таблицу в разделе "Входные и выходные операнды").</p>
<p><strong>Строка 151</strong>. Здесь задаются используемые регистры (clobbered registers). Понятно, что означает "r18", "r19", "r20", "r26", "r27" - с этими регистрами мы встречались в коде. "cc" означает, что инструкции кода inline-ассемблера могут менять регистр флагов (condition code register, для AVR это регистр SREG). "memory" означает, что код inline-ассемблера может получать доступ к памяти непредсказуемым образом. Это приводит к тому, что GCC не делает кэширование значений памяти в регистрах и не оптимизирует сохранение в память или загрузку оттуда. Зачем тут это указано в контексте AVR и кода, который на самом деле не меняет память - непонятно, наверное "на всякий случай".</p>
<p><strong>Строки 157..159</strong>. Здесь специальным образом задается C-имя функции, соответствующее вызову inline-ассемблера.</p>
<p>[<strong>Ссылки</strong>]</p>
<p><strong>1</strong>. <span style="color: #333399;">Inline Assembler Cookbook site:nongnu.org</span>.<br><strong>2</strong>. <span style="color: #333399;">How do I trace an assembler file in avr-gdb? site:nongnu.org</span>.<br><strong>3</strong>. <a href="http://microsin.net/programming/ARM/lvalue-rvalue.html">Что такое lvalue и rvalue</a>?<br><strong>4</strong>. <span style="color: #333399;">GCC online documentation site:gcc.gnu.org</span>.<br><strong>5</strong>. <span style="color: #333399;">Driving the WS2811 at 800KHz with a 16MHz AVR site:bleaklow.com</span>.<br><strong>6</strong>. <a href="http://microsin.net/adminstuff/hardware/ws2811-led-driver.html">WS2811: микросхема для управления трехцветным RGB-светодиодом</a>.<br><strong>7</strong>. <a href="http://microsin.net/programming/AVR/mixing-c-and-asm-code.html">Как комбинировать программу на Си (C) с кодом ассемблера (ASM)</a>.</p></td>
</tr>

</tbody></table>
<span class="article_separator">&nbsp;</span>
<script type="text/javascript">
<!--
var jcomments=new JComments(1509, 'com_content','/index.php?option=com_jcomments&amp;tmpl=component');
jcomments.setList('comments-list');
//-->
</script>
<div id="jc">
<div id="comments"><h4>Комментарии<a class="rss" href="http://microsin.net/component/option,com_jcomments/format,raw/object_group,com_content/object_id,1509/task,rss/" title="RSS лента комментариев этой записи" target="_blank">&nbsp;</a><a class="refresh" href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#" title="Обновить список комментариев" onclick="jcomments.showPage(1509,&#39;com_content&#39;,0);return false;">&nbsp;</a></h4>
<div id="comments-list" class="comments-list">
        <div class="even" id="comment-item-2609"><div class="rbox"><div class="rbox_tr"><div class="rbox_tl"><div class="rbox_t">&nbsp;</div></div></div><div class="rbox_m">
<div class="comment-box usertype-guest">
<span class="comments-vote">
	<span id="comment-vote-holder-2609">
<a href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#" class="vote-good" title="Хороший комментарий!" onclick="jcomments.voteComment(2609, 1);return false;"></a><a href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#" class="vote-poor" title="Плохой комментарий!" onclick="jcomments.voteComment(2609, -1);return false;"></a>
<span class="vote-none">0</span>
	</span>
</span>
<a class="comment-anchor" href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#comment-2609" id="comment-2609">#1</a>
<span class="comment-author">samsim</span>
<span class="comment-date">07.02.2015 13:13</span>
<div class="comment-body" id="comment-body-2609">Программа работает превосходно. Спасибо автору за такой полезный материал, мне очень пригодился. Буду и дальше посещать Ваш сайт.</div>
<span class="comments-buttons">
<a href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#" onclick="jcomments.quoteComment(2609); return false;">Цитировать</a>
</span>
</div><div class="clear"></div>
</div><div class="rbox_br"><div class="rbox_bl"><div class="rbox_b">&nbsp;</div></div></div></div>
</div>
</div>
<div id="comments-list-footer"><a class="refresh" href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#" title="Обновить список комментариев" onclick="jcomments.showPage(1509,&#39;com_content&#39;,0);return false;">Обновить список комментариев</a><br><a class="rss" href="http://microsin.net/component/option,com_jcomments/format,raw/object_group,com_content/object_id,1509/task,rss/" target="_blank">RSS лента комментариев этой записи</a></div>
</div>
<h4>Добавить комментарий</h4>
<a id="addcomments" href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#addcomments"></a>
<form id="comments-form" name="comments-form" action="javascript:void(null);">
<p>
	<input id="comments-form-name" type="text" name="name" value="" maxlength="20" size="22" tabindex="1">
	<label for="comments-form-name">Имя (обязательное)</label>
</p>
<p>
	<input id="comments-form-email" type="text" name="email" value="" size="22" tabindex="2">
	<label for="comments-form-email">E-Mail (обязательное)</label>
</p>
<p>
	<input id="comments-form-homepage" type="text" name="homepage" value="" size="22" tabindex="3">
	<label for="comments-form-homepage">Сайт</label>
</p>
<p>
	<div class="smiles"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/laugh.gif" alt=":D" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/lol.gif" alt=":lol:" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/smile.gif" alt=":-)" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/wink.gif" alt=";-)" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/cool.gif" alt="8)" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/normal.gif" alt=":-|" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/whistling.gif" alt=":-*" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/redface.gif" alt=":oops:" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/sad.gif" alt=":sad:" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/cry.gif" alt=":cry:" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/surprised.gif" alt=":o" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/confused.gif" alt=":-?" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/sick.gif" alt=":-x" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shocked.gif" alt=":eek:" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/sleeping.gif" alt=":zzz" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/tongue.gif" alt=":P" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/rolleyes.gif" alt=":roll:" class="smile"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/unsure.gif" alt=":sigh:" class="smile"></div><textarea id="comments-form-comment" name="comment" cols="65" rows="8" tabindex="5"></textarea><div class="grippie"><span class="counter">Осталось: <span>1000</span>  символов</span></div>
</p>
<p>
	<input class="checkbox" id="comments-form-subscribe" type="checkbox" name="subscribe" value="1" tabindex="5">
	<label for="comments-form-subscribe">Подписаться на уведомления о новых комментариях</label><br>
</p>
<p>
	<img class="captcha" onclick="jcomments.clear(&#39;captcha&#39;);" id="comments-form-captcha-image" name="captcha-image" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/index.php" width="121" height="60" alt="Защитный код"><br>
	<span class="captcha" onclick="jcomments.clear(&#39;captcha&#39;);">Обновить</span><br>
	<input class="captcha" id="comments-form-captcha" type="text" name="captcha-refid" value="" size="5" tabindex="6"><br>
</p>
<div id="comments-form-buttons">
	<div class="btn" id="comments-form-send"><div><a href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#" tabindex="7" onclick="jcomments.saveComment();return false;" title="Отправить (Ctrl+Enter)">Отправить</a></div></div>
	<div class="btn" id="comments-form-cancel" style="display: none;"><div><a href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#" tabindex="8" onclick="return false;" title="Отменить">Отменить</a></div></div>
	<div style="clear:both;"></div>
</div>
	<input type="hidden" name="object_id" value="1509">
	<input type="hidden" name="object_group" value="com_content">
</form>
<script type="text/javascript">
<!--
function JCommentsInitializeForm()
{
	var jcEditor = new JCommentsEditor('comments-form-comment', true);
	jcEditor.initSmiles('http://microsin.net/components/com_jcomments/images/smiles');
	jcEditor.addSmile(':D','laugh.gif');
	jcEditor.addSmile(':lol:','lol.gif');
	jcEditor.addSmile(':-)','smile.gif');
	jcEditor.addSmile(';-)','wink.gif');
	jcEditor.addSmile('8)','cool.gif');
	jcEditor.addSmile(':-|','normal.gif');
	jcEditor.addSmile(':-*','whistling.gif');
	jcEditor.addSmile(':oops:','redface.gif');
	jcEditor.addSmile(':sad:','sad.gif');
	jcEditor.addSmile(':cry:','cry.gif');
	jcEditor.addSmile(':o','surprised.gif');
	jcEditor.addSmile(':-?','confused.gif');
	jcEditor.addSmile(':-x','sick.gif');
	jcEditor.addSmile(':eek:','shocked.gif');
	jcEditor.addSmile(':zzz','sleeping.gif');
	jcEditor.addSmile(':P','tongue.gif');
	jcEditor.addSmile(':roll:','rolleyes.gif');
	jcEditor.addSmile(':sigh:','unsure.gif');
	jcEditor.addCounter(1000, 'Осталось:', ' символов', 'counter');
	jcomments.setForm(new JCommentsForm('comments-form', jcEditor));
}

if (window.addEventListener) {window.addEventListener('load',JCommentsInitializeForm,false);}
else if (document.addEventListener){document.addEventListener('load',JCommentsInitializeForm,false);}
else if (window.attachEvent){window.attachEvent('onload',JCommentsInitializeForm);}
else {if (typeof window.onload=='function'){var oldload=window.onload;window.onload=function(){oldload();JCommentsInitializeForm();}} else window.onload=JCommentsInitializeForm;} 
//-->
</script>
<div id="comments-footer" align="center"><a href="http://www.joomlatune.ru/" title="JComments" target="_blank">JComments</a></div>
<script type="text/javascript">
<!--
jcomments.setAntiCache(1,0,0);
//-->
</script> 
</div></div>
              </td>
              <!-- RIGHT Modules -->
              
            </tr>
          </tbody></table>
          </td>
        </tr>
      </tbody></table>
      </td>
      <td valign="top" background="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shad_right.gif">
      <img border="0" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shad_top_right.gif" width="11" height="17"></td>
    </tr>
    <tr>
      <td><img border="0" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shad_bottom_left.gif" width="11" height="19"></td>
      <td width="100%" background="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shad_bottom.gif">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tbody><tr>
          <td>
          <img border="0" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shad_bottom_inner_left.gif" width="19" height="19"></td>
          <td align="left"><a href="http://microsin.net/programming/AVR/avr-gcc-inline-assembler.html#top"><img src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/top_of_page.gif" vspace="5" border="0" alt="Top of Page"></a></td>
          <td align="right" width="100%"><!--���������������� ��� ���������� ������ "File does not exist:
           /home/microsig/public_html/images/poweredbyLong.gif"<img src="/images/poweredbyLong.gif" width="169" height="8" vspace="5" border="0" alt="Powered by Mambo Open Source">--></td>
          <td>
          <img border="0" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shad_bottom_inner_right.gif" width="19" height="19"></td>
        </tr>
      </tbody></table>
      </td>
      <td>
      <img border="0" src="./AVR-GCC  руководство по встраиванию кода на ассемблере   AVR   programming_files/shad_bottom_right.gif" width="11" height="19"></td>
    </tr>
  </tbody></table>
  <table align="center" border="0" cellpadding="3" cellspacing="0" width="780">
    <tbody><tr>
      <td align="center">
      
                      </td>
    </tr>
  </tbody></table>



<div id="MistWindow" style="position: absolute; display: none; width: 375px; height: 380px; top: 50px; left: 50px; z-index: 999;"></div><ul class="autocompleter-choices" style="z-index: 1000; visibility: hidden; zoom: 1; opacity: 0;"></ul></body></html>