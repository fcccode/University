<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>2.htm</title>
<meta http-equiv="Content-Type" content="text/html;charset=windows-1251">
</head>
<body background="back1.jpg">

<p>
<font face="Times New Roman" size=5><b>2. Последовательные интерфейсы</b></font>

<p>
<font face="Times New Roman" size=2>Последовательный интерфейс для передачи данных исполь-<br>
зует одну сигнальную линию, по которой информационные<br>
биты передаются друг за другом последовательно. Отсюда -<br>
название интерфейса и порта. Английские термины - <i>Serial<br>
Interface</i> и <i>Serial Port</i> (иногда их неправильно переводят как<br>
"серийные"). Последовательная передача позволяет сокра-<br>
тить количество сигнальных линий и увеличить дальность<br>
связи. Характерной особенностью является применение не-<br>
ТТЛ сигналов. В ряде последовательных интерфейсов при-<br>
меняется гальваническая развязка внешних (обычно вход-<br>
ных) сигналов от схемной земли устройства, что позволяет<br>
соединять устройства, находящиеся под разными потенциа-<br>
лами. Ниже будут рассмотрены интерфейсы RS-232C, RS-<br>
422А, RS-423A, RS-485, токовая петля, MIDI, а также<br>
СОМ-порт.</font>

<p>
<font face="Times New Roman" size=4><b>2.1. Способы последовательной передачи</b></font>

<p>
<font face="Times New Roman" size=2>Последовательная передача данных может осуществляться в<br>
асинхронном или синхронном режимах. При <i>асинхронной</i> пе-<br>
редаче каждому байту предшествует <i>старт-бит,</i> сигнализи-<br>
рующий приемнику о начале посылки, за которым следуют<br>
<i>биты данных</i> и, возможно, <i>бит паритета</i> (четности^). Завер-<br>
шает посылку <i>стоп-бит,</i> гарантирующий паузу межцу посыл-<br>
ками (рис. 2.1). Старт-бит следующего байта посылается в<br>
любой момент после стоп-бита, то есть между передачами воз-<br>
можны паузы произвольной длительности. Старт-бит, имею-<br>
щий всегда строго определенное значение (логический 0), обес-<br>
печивает простой механизм синхронизации приемника по<br>
сигналу от передатчика. Подразумевается, что приемник и<br>
передатчик работают на одной скорости обмена. Внутренний<br>
генератор синхронизации приемника использует счетчик-де-<br>
литель опорной частоты, обнуляемый в момент приема нача-<br>
ла старт-бита. Этот счетчик генерирует внутренние стробы,<br>
по которым приемник фиксирует последующие принимаемые</font>
<hr>

<p>
<font face="Times New Roman" size=2>биты. В идеале стробы располагаются в середине битовых<br>
интервалов, что позволяет принимать данные и при незна-<br>
чительном рассогласовании скоростей приемника и пере-<br>
датчика. Очевидно, что при передаче 8 бит данных, одного<br>
контрольного и одного стоп-бита предельно допустимое рас-<br>
согласование скоростей, при котором данные будут распоз-<br>
наны верно, не может превышать 5%. С учетом фазовых ис-<br>
кажений и дискретности работы внутреннего счетчика<br>
синхронизации реально допустимо меньшее отклонение час-<br>
тот. Чем меньше коэффициент деления опорной частоты внут-<br>
реннего генератора (чем выше частота передачи), тем больше<br>
погрешность привязки стробов к середине битового интерва-<br>
ла, и требования к согласованности частот становятся более<br>
строгими. Чем выше частота передачи, тем больше влияние<br>
искажений фронтов на фазу принимаемого сигнала. Взаимо-<br>
действие этих факторов приводит к повышению требований<br>
к согласованности частот приемника и передатчика с ростом<br>
частоты обмена.</font>

<p>
<img border=0 vspace=3 hspace=3 src="21.jpg"alt="21.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.1.</b> Формат асинхронной передачи</font>

<p>
<font face="Times New Roman" size=2>Формат асинхронной посылки позволяет выявлять возмож-<br>
ные <i>ошибки передачи'.</i></font>

<p>
<font face="Times New Roman" size=2><i>^</i> Если принят перепад, сигнализирующий о начале посыл-<br>
ки, а по стробу старт-бита зафиксирован уровень логи-<br>
ческой единицы, старт-бит считается ложным и прием-<br>
ник снова переходит в состояние ожидания. Об этой<br>
ошибке приемник может и не сообщать.</font>

<p align=center>
<font face="Times New Roman" size=2>й" Если во время, отведенное под стоп-бит, обнаружен уро-<br>
вень логического нуля, фиксируется ошибка стоп-бита.</font>

<p>
<font face="Times New Roman" size=2>55й Если применяется контроль четности, то после посылки<br>
бит данных передается <i>контрольный бит.</i> Этот бит до-</font>

<p>
<font face="Times New Roman" size=1>3 Зак.№530</font>
<hr>

<p>
<font face="Times New Roman" size=2>полняет количество единичных бит данных до четного<br>
или нечетного в зависимости от принятого соглашения.<br>
Прием байта с неверным значением контрольного бита<br>
приводит к фиксации ошибки.</font>

<p>
<font face="Times New Roman" size=2>Контроль формата позволяет обнаруживать обрыв линии:</font>

<p>
<font face="Times New Roman" size=2>при этом принимаются логический нуль, который сначала<br>
трактуется как старт-бит, и нулевые биты данных, потом<br>
срабатывает контроль стоп-бита.</font>

<p>
<font face="Times New Roman" size=2>Для асинхронного режима принят ряд <i>стандартных скоро-<br>
стей обмена:</i> 50, 75, 110, 150, 300, 600, 1200, 2400, 4800, 9600,<br>
19 200, 38 400, 57 600 и 115 200 бит/с. Иногда вместо еди-<br>
ницы измерения "бит/с" используют "бод" (baud), но при<br>
рассмотрении двоичных передаваемых сигналов это некор-<br>
ректно. В бодах принято измерять частоту изменения со-<br>
стояния линии, а при недвоичном способе кодирования (ши-<br>
роко применяемом в современных модемах) в канале связи<br>
скорости передачи бит (бит/с) и изменения сигнала (бод)<br>
могут отличаться в несколько раз (подробнее см. в прило-<br>
жении А).</font>

<p>
<font face="Times New Roman" size=2>Количество <i>бит данных</i> может составлять 5, 6, 7 или 8 (5- и<br>
6-битные форматы распространены незначительно). Коли-<br>
чество <i>стоп-бит</i> может быть 1, 1,5 или 2 ("полтора бита"<br>
означает только длительность стопового интервала).</font>

<p>
<font face="Times New Roman" size=2><i>Асинхронный обмен</i> в PC реализуется с помощью <i>СОМ-пор-<br>
та</i> с использованием протокола <i>RS-232C.</i></font>

<p>
<font face="Times New Roman" size=2><i>Синхронный</i> режим передачи предполагает постоянную ак-<br>
тивность канала связи. Посылка начинается с синхробайта,<br>
за которым сразу же следует поток информационных бит.<br>
Если у передатчика нет данных для передачи, он заполняет<br>
паузу непрерывной посылкой байтов синхронизации. Оче-<br>
видно, что при передаче больших массивов данных наклад-<br>
ные расходы на синхронизацию в данном режиме будут ниже,<br>
чем в асинхронном. Однако в синхронном режиме необхо-<br>
дима внешняя синхронизация приемника с передатчиком,<br>
поскольку даже малое отклонение частот приведет к ис-<br>
кажению принимаемых данных. Внешняя синхронизация<br>
возможна либо с помощью отдельной линии для передачи<br>
сигнала синхронизации, либо с использованием самосин-</font>
<hr>

<p>
<font face="Times New Roman" size=2>хронизирующего кодирования данных, при котором на сто-<br>
роне приемника из принятого сигнала могут быть выделены<br>
импульсы синхронизации. В любом случае синхронный ре-<br>
жим требует дорогих линий связи или оконечного оборудо-<br>
вания. Для PC существуют специальные платы - адаптеры<br>
SDLC (дорогие), поддерживающие синхронный режим об-<br>
мена. Они используются в основном для связи с большими<br>
машинами (mainframes) IBM и мало распространены. Из<br>
синхронных адаптеров в настоящее время применяются адап-<br>
теры интерфейса V.35.</font>

<p>
<img border=0 vspace=3 hspace=3 src="22.jpg"alt="22.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.2.</b> Стандарты последовательного интерфейса</font>

<p>
<font face="Times New Roman" size=2>На <i>физическом уровне</i> последовательный интерфейс имеет<br>
различные реализации, различающиеся способом передачи<br>
электрических сигналов. Существует ряд родственных меж-<br>
дународных стандартов: <i>RS-232C, RS-423A, RS-422A</i> и<br>
<i>RS-485.</i> На рис. 2.2 приведены схемы соединения приемни-<br>
ков и передатчиков, а также показаны ограничения на дли-<br>
ну линии (L) и максимальную скорость передачи данных (V).</font>

<p>
<font face="Times New Roman" size=2>Несимметричные линии интерфейсов <i>RS-232C</i> и <i>RS-423A<br>
</i>имеют самую низкую защищенность от синфазной помехи,<br>
хотя дифференциальный вход приемника <i>RS-423A</i> несколь-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ко смягчает ситуацию. Лучшие параметры имеет двухточеч-<br>
ный интерфейс <i>RS-422A</i> и его магистральный (шинный)<br>
аналог <i>RS-485,</i> работающие на симметричных линиях свя-<br>
зи. В них для передачи каждого сигнала используются диф-<br>
ференциальные сигналы с отдельной (витой) парой прово-<br>
дов.</font>

<p>
<font face="Times New Roman" size=2>В перечисленных стандартах сигнал представляется <i>потен-<br>
циалом.</i> Существуют последовательные интерфейсы, где<br>
информативен ток, протекающий по общей цепи передат-<br>
чик-приемник - "токовая петля" и MIDI. Для связи на ко-<br>
роткие расстояния приняты стандарты беспроводной инф-<br>
ракрасной связи. Наибольшее распространение в PC<br>
получил простейший из перечисленных - стандарт <i>RS-232C,<br>
</i>реализуемый СОМ-портами. В промышленной автоматике<br>
широко применяется <i>RS-485,</i> а также <i>RS-422A,</i> встречаю-<br>
щийся и в некоторых принтерах. Существуют преобразо-<br>
ватели сигналов для согласования этих родственных ин-<br>
терфейсов.</font>

<p>
<font face="Times New Roman" size=4><b>2.2. Интерфейс RS-232C</b></font>

<p>
<font face="Times New Roman" size=2>Интерфейс предназначен для подключения аппаратуры,<br>
передающей или принимающей данные <i>{О ОД -</i> оконечное<br>
оборудование данных или <i>АПД -</i> аппаратура передачи дан-<br>
ных; <i>DTE - Data Terminal Equipment),</i> к оконечной аппарату-<br>
ре каналов данных <i>(АКД', DCE - Data Communication<br>
Equipment).</i> В роли АПД может выступать компьютер, прин-<br>
тер, плоттер и другое периферийное оборудование. В роли<br>
АКД обычно выступает модем. Конечной целью подключе-<br>
ния является соединение двух устройств АПД. Полная схе-<br>
ма соединения приведена на рис. 2.3. Интерфейс позволяет<br>
исключить канал удаленной связи вместе с парой устройств<br>
АПД, соединив устройства непосредственно с помощью нуль-<br>
модемного кабеля (рис. 2.4).</font>

<p>
<font face="Times New Roman" size=2>Стандарт описывает управляющие сигналы интерфейса, пе-<br>
ресылку данных, электрический интерфейс и типы разъе-<br>
мов. В стандарте предусмотрены асинхронный и синхрон-<br>
ный режимы обмена, но СОМ-порты поддерживают только</font>
<hr>

<p>
<font face="Times New Roman" size=2><i>асинхронный режим.</i> Функционально <i>RS-232C</i> эквивалентен<br>
стандарту МККТТ V.24/ V.28 и стыку С2, но они имеют раз-<br>
личные названия сигналов.</font>

<p>
<img border=0 vspace=3 hspace=3 src="23.jpg"alt="23.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.4.</b> Соединение по RS-232C нуль-модемным кабелем</font>

<p>
<font face="Times New Roman" size=3><b>2.2.1. Электрический интерфейс</b></font>

<p>
<font face="Times New Roman" size=2>Стандарт <i>RS-232C</i> использует несимметричные передатчи-<br>
ки и приемники - сигнал передается относительно общего<br>
провода - схемной земли (симметричные дифференциаль-<br>
ные сигналы используются в других интерфейсах - напри-<br>
мер, <i>RS-422).</i> Интерфейс <i>НЕ ОБЕСПЕЧИВАЕТ ГАЛЬВАНИ-<br>
ЧЕСКОЙ РАЗВЯЗКИ</i> устройств. Логической единице<br>
соответствует напряжение на <i>входе приемника</i> в диапазоне<br>
-12...-3 В. Для линий управляющих сигналов это состояние<br>
называется <i>ON(</i> "включено"), для линий последовательных<br>
данных - <i>MARK.</i> Логическому нулю соответствует диапазон<br>
+3...+12 В. Для линий управляющих сигналов состояние<br>
называется OFF ("выключено"), а для линий последователь-<br>
ных данных - <i>SPACE.</i> Диапазон -3...+3 В - зона нечувстви-<br>
тельности, обусловливающая гистерезис приемника: состоя-<br>
ние линии будет считаться измененным только после<br>
пересечения порога (рис. 2.5). Уровни сигналов на выходах<br>
передатчиков должны быть в диапазонах -12...-5 В и<br>
+5...+12 В для представления единицы и нуля соответствен-<br>
но. Разность потенциалов между схемными землями (SG)<br>
соединяемых устройств должна быть менее 2 В, при более<br>
высокой разности потенциалов возможно неверное воспри-<br>
ятие сигналов.</font>
<hr>

<p>
<font face="Times New Roman" size=2>Интерфейс предполагает наличие <i>ЗАЩИТНОГО ЗАЗЕМЛЕ-<br>
НИЯ</i> для соединяемых устройств, если они оба питаются от<br>
сети переменного тока и имеют сетевые фильтры.</font>

<p>
<font face="Times New Roman" size=2><i>Подключение и отключение интерфейсных кабелей</i> устройств<br>
с автономным питанием должно производиться <i>при отклю-<br>
ченном питании.</i> Иначе разность невыровненных потенциа-<br>
лов устройств в момент коммутации может оказаться при-<br>
ложенной к выходным или входным (что опаснее) цепям<br>
интерфейса и вывести из строя микросхемы.</font>

<p>
<img border=0 vspace=3 hspace=3 src="24.jpg"alt="24.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.5.</b> Прием сигналов RS-232C</font>

<p>
<font face="Times New Roman" size=2>Для интерфейса <i>RS-232C</i> специально выпускаются буфер-<br>
ные микросхемы приемников (с гистерезисом и передатчи-<br>
ком двуполярного сигнала). При несоблюдении правил за-<br>
земления и коммутации они обычно являются первыми<br>
жертвами "пиротехнических" эффектов. Иногда их устанав-<br>
ливают в "кроватках", что облегчает замену. Цоколевка мик-<br>
росхем формирователей сигналов <i>RS-232C</i> приведена на<br>
рис. 2.6. Часто буферные схемы входят прямо в состав ин-<br>
терфейсных БИС. Это удешевляет изделие, экономит место<br>
на плате, но в случае аварии оборачивается крупными фи-<br>
нансовыми потерями. Вывести из строя интерфейсные мик-<br>
росхемы замыканием сигнальных цепей маловероятно: ток<br>
короткого замыкания передатчиков обычно не превосходит<br>
20 мА.</font>
<hr>

<p>
<img border=0 vspace=3 hspace=3 src="25.jpg"alt="25.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.6.</b> Формирование сигналов RS-232C: а - приемник 1489<br>
(А - вход RS-232, С - управление гистерезисом (ТТЛ), Y - выход<br>
ТТЛ); <i>б -</i> передатчик 1488 (А, В - входы ТТЛ, Y - выход RS-232,<br>
VDD = +12 В, VEE = -12 В); в - таблица состояния выходов<br>
передатчика (*1В - логическая 1)</font>

<p>
<font face="Times New Roman" size=2>Стандарт <i>RS-232C</i> регламентирует <i>типы применяемых разъе-<br>
мов.</i></font>

<p>
<font face="Times New Roman" size=2>На аппаратуре <i>АПД</i> (в том числе на СОМ-портах) принято<br>
устанавливать <i>вилки</i> (male - "папа") <i>DB-25P</i> или более ком-<br>
пактный вариант - <i>DB-9P.</i> Девятиштырьковые разъемы не<br>
имеют контактов для дополнительных сигналов, необходи-<br>
мых для синхронного режима (в большинстве 25-штырько-<br>
вых разъемов эти контакты не используются).</font>

<p>
<font face="Times New Roman" size=2>На аппаратуре <i>АКД</i> (модемах) устанавливают <i>розетки<br>
</i>(female - "мама") <i>DB-25S</i> или <i>DB-9S.</i></font>

<p>
<font face="Times New Roman" size=2>Это правило предполагает, что разъемы <i>АКД</i> могут подклю-<br>
чаться к разъемам <i>АПД</i> непосредственно или через переход-<br>
ные "прямые" кабели с розеткой и вилкой, у которых кон-<br>
такты соединены "один в один". Переходные кабели могут<br>
являться и переходниками с 9- на 25-штырьковые разъемы<br>
(рис. 2.7).</font>

<p>
<img border=0 vspace=3 hspace=3 src="26.jpg"alt="26.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.7.</b> Кабели подключения модемов</font>
<hr>

<p>
<font face="Times New Roman" size=2>Если аппаратура <i>АПД</i> соединяется без модемов, то разъемы<br>
устройств (вилки) соединяются между собой <i>нуль-модемным<br>
кабелем</i> (Zero-modem или Z-modem), имеющим на обоих кон-<br>
цах розетки, контакты которых соединяются перекрестно по<br>
одной из схем, приведенных на рис. 2.8.</font>

<p>
<img border=0 vspace=3 hspace=3 src="27.jpg"alt="27.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.8.</b> Нуль-модемный кабель: а - минимальный, б - полный</font>

<p>
<font face="Times New Roman" size=2>Если на каком-либо устройстве <i>АПД</i> установлена розетка -<br>
это почти стопроцентный признак того, что к другому уст-<br>
ройству оно должно подключаться прямым кабелем, анало-<br>
гичным кабелю подключения модема. Розетка устанавли-<br>
вается обычно на тех устройствах, у которых удаленное<br>
подключение через модем не предусмотрено.</font>

<p>
<font face="Times New Roman" size=2>В табл. 2.1 приведено назначение контактов разъемов СОМ-<br>
портов (и любой другой аппаратуры <i>АПД).</i> Контакты разъема<br>
DB-25S определены стандартом EIA/TIA-232-E, разъем<br>
DB-9S описан стандартом EIA/ TIA-574. У модемов назва-<br>
ние цепей и контактов такое же, но роли сигналов (вход-<br>
выход) меняются на противоположные.</font>

<p>
<font face="Times New Roman" size=2>Подмножество сигналов <i>RS-232C,</i> относящихся к асинхрон-<br>
ному режиму, рассмотрим с точки зрения СОМ-порта PC.<br>
Следует помнить, что активному состоянию сигнала ("вклю-<br>
чено") и <i>логической единице</i> передаваемых данных соответ-<br>
ствует <i>отрицательный потенциал</i> (ниже -3 В) сигнала ин-<br>
терфейса, а состоянию "выключено" и <i>логическому нулю -<br>
положительный</i> (выше +3 В). Назначение сигналов интер-<br>
фейса приведено в табл. 2.2.</font>
<hr>

<p>

<table align=left border=1>
<tr>
<td colspan=2 rowspan=2>

<p>
<font face="Times New Roman" size=1>Обозначение<br>
цепи</font>
</td>
<td colspan=2 rowspan=2>

<p>
<font face="Times New Roman" size=1>Контакт<br>
разъема</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Номе<br>
кабе<br>
разъ"</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>рпровс<br>
ля выно<br>
вмаРСи</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1><i>W</i></font>

<p>
<font face="Times New Roman" size=1>СНОГО</font>

<p>
<font face="Times New Roman" size=1>контакта</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=1>Направление<br>
I/O</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>внутр</font>
</td>
<td colspan=2>

<p>

</td>
<td colspan=2>

<p>

</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>RS-232</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Стык 2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>DB-25S</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>DB-9S</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>I*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>2*</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>3*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>4*</font>
</td>
<td>

<p>

</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>PG</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>101</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>(10)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>(10)</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>(10)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>-</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>SG</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>102</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>9</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>13</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>-</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>TD</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>103</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>5</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>RD</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>104</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>3</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>I</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>RTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>105</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>4</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>CTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>106</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>6</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>I</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>DSR</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>107</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>2</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>11</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>I</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>DTR</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>108/2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>20</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>7</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>14</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>DCD</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>109</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>15</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>I</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>RI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>125</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>22</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>8</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>/"</font>

<p>
<font face="Times New Roman" size=1>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>18</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>I</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>1*- шлейф 8-битных мультикарт.</font>

<p>
<font face="Times New Roman" size=2>2*- шлейф 16-битных мультикарт и портов на системных платах.<br>
3* - вариант шлейфа портов на системных платах.<br>
4*- широкий шлейф к 25-контактному разъему.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Сигнал</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>PG</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Protected Ground -</i> защитная земля, соединяется с кор-<br>
пусом устройства и экраном кабеля</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>SG</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Signal Ground -</i> сигнальная (схемная) земля, относи-<br>
тельно которой действуют уровни сигналов</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>ТО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Transmit Data -</i> последовательные данные - выход пе-<br>
редатчика</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>RD</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Receive Data -</i> последовательные данные - вход при-<br>
емника</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>RTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Request To Send -</i> выход запроса передачи данных:<br>
состояние "включено" уведомляет модем о наличии у<br>
терминала данных для передачи. В полудуплексном<br>
режиме используется для управления направлением -<br>
состояние "включено" служит сигналом модему<br>
на переключение в режим передачи</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Сигнал</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>CTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Clear To Send -</i> вход разрешения терминалу передавать<br>
данные. Состояние "выключено" аппаратно запрещает<br>
передачу данных. Сигнал используется для аппарат-<br>
ного управления потоками данных</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>DSR</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Data Set Ready -</i> вход сигнала готовности от аппа-<br>
ратуры передачи данных (модем в рабочем режиме<br>
подключен к каналу и закончил действия по согла-<br>
сованию с аппаратурой на противоположном конце<br>
канала)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>DTP</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Data Terminal Ready -</i> выход сигнала готовности тер-<br>
минала к обмену данными. Состояние "включено" под-<br>
держивает коммутируемый канал в состоянии соеди-<br>
нения</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>DCD</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Data Carrier Detected -</i> вход сигнала обнаружения несу-<br>
щей удаленного модема</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Rl</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Ring Indicator -</i> вход индикатора вызова (звонка).<br>
В коммутируемом канале этим сигналом модем сигна-<br>
лизирует о принятии вызова</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=3>2.2.2. Управление потоком данных</font>

<p>
<font face="Times New Roman" size=2>Для управления потоком данных (Flow Control) могут ис-<br>
пользоваться два варианта протокола - аппаратный и про-<br>
граммный. Иногда управление потоком путают с квитиро-<br>
ванием, но это разные методы достижения одной цели -<br>
согласования темпа передачи и приема. <i>Квитирование<br>
</i>(Handshaking) подразумевает посылку уведомления о полу-<br>
чении элемента, в то время как <i>управление потоком</i> предпо-<br>
лагает посылку уведомления о невозможности последующе-<br>
го приема данных.</font>

<p>
<font face="Times New Roman" size=2><i>Аппаратный протокол управления потоком</i> RTS/CTS<br>
(Hardware Flow Control) использует сигнал CTS, который поз-<br>
воляет остановить передачу данных, если приемник не готов<br>
к их приему (рис. 2.9). Передатчик "выпускает" очередной<br>
байт только при включенной линии CTS. Байт, который уже<br>
начал передаваться, задержать сигналом CTS невозможно (это<br>
гарантирует целостность посылки). Аппаратный протокол<br>
обеспечивает самую быструю реакцию передатчика на состо-<br>
яние приемника. Микросхемы асинхронных приемопередат-<br>
чиков имеют не менее двух регистров в приемной части -</font>
<hr>

<p>
<font face="Times New Roman" size=2>сдвигающий, для приема очередной посылки, и хранящий, из<br>
которого считывается принятый байт. Это позволяет реали-<br>
зовать обмен по аппаратному протоколу без потери данных.</font>

<p>
<img border=0 vspace=3 hspace=3 src="28.jpg"alt="28.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.9.</b> Аппаратное управление потоком</font>

<p>
<font face="Times New Roman" size=2>Аппаратный протокол удобно использовать при подключе-<br>
нии принтеров и плоттеров, если они его поддерживают<br>
(рис. 2.10). При непосредственном (без модемов) соедине-<br>
нии двух компьютеров аппаратный протокол требует пере-<br>
крестного соединения линий RTS - CTS.</font>

<p>
<font face="Times New Roman" size=2>Если аппаратный протокол не используется, у передающего<br>
терминала должно быть обеспечено состояние "включено"<br>
на линии CTS перемычкой RTS - CTS. В противном случае<br>
передатчик будет "молчать".</font>

<p>
<img border=0 vspace=3 hspace=3 src="29.jpg"alt="29.jpg">
<br clear=all>


<p>
<font face="Times New Roman" size=2><b>Рис. 2.10.</b> Кабель подключения принтера с протоколом RTS-CTS</font>

<p>
<font face="Times New Roman" size=2><i>Программный протокол управления потоком XON/XOFF</i> пред-<br>
полагает наличие двунаправленного канала передачи данных.<br>
Работает протокол следующим образом: если устройство,<br>
принимающее данные, обнаруживает причины, по которым<br>
не может их дальше принимать, оно по обратному последо-<br>
вательному каналу посылает байт-символ <i>XOFF</i> (13h). Про-<br>
тивоположное устройство, приняв этот символ, приостанав-<br>
ливает передачу. Когда принимающее устройство снова<br>
становится готовым к приему данных, оно посылает символ</font>
<hr>

<p>
<font face="Times New Roman" size=2><i>XON</i> (llh), приняв который противоположное устройство<br>
возобновляет передачу. Время реакции передатчика на из-<br>
менение состояния приемника по сравнению с аппаратным<br>
протоколом увеличивается по крайней мере на время пере-<br>
дачи символа <i>(XON</i> или <i>XOFF)</i> плюс время реакции програм-<br>
мы передатчика на прием символа (рис. 2.11). Из этого сле-<br>
дует, что данные без потерь могут приниматься только<br>
приемником, имеющим дополнительный буфер принимае-<br>
мых данных и сигнализирующим о неготовности заблаго-<br>
временно (имея в буфере свободное место).</font>

<p>
<img border=0 vspace=3 hspace=3 src="210.jpg"alt="210.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.11.</b> Программное управление потоком XON/XOFF</font>

<p>
<font face="Times New Roman" size=2>Преимущество программного протокола заключается в от-<br>
сутствии необходимости передачи управляющих сигналов<br>
интерфейса - минимальный кабель для двустороннего об-<br>
мена может иметь только 3 провода (см. рис. 2.8а). Недо-<br>
статком, кроме требования наличия буфера и большего вре-<br>
мени реакции (снижающего общую производительность<br>
канала из-за ожидания сигнала <i>XON),</i> является сложность<br>
реализации полнодуплексного режима обмена. В этом слу-<br>
чае из потока принимаемых данных должны выделяться (и<br>
обрабатываться) символы управления потоком, что ограни-<br>
чивает набор передаваемых символов. Минимальный вари-<br>
ант кабеля для подключения принтера (плоттера) с прото-<br>
колом <i>XON/XOFF</i> приведен на рис. 2.12.</font>

<p>
<font face="Times New Roman" size=2>Кроме этих двух распространенных стандартных протоко-<br>
лов, поддерживаемых и ПУ, и ОС, существуют и другие.<br>
Некоторые плоттеры с последовательным интерфейсом ис-<br>
пользуют программное управление, но посылают не стан-<br>
дартные символы <i>XON/XOFF,</i> а <i>слова</i> (ASCII-строки). Такой<br>
обмен на уровне системной поддержки протокола практи-<br>
чески не поддерживается (эти плоттеры непосредственно</font>
<hr>

<p>
<font face="Times New Roman" size=2>"разговаривают" с прикладной программой). Конечно, можно<br>
написать драйвер СОМ-порта (перехватчик <i>INT 14h),</i> но не-<br>
обходимость обработки в нем текстовых сообщений от уст-<br>
ройства вывода обычно не вызывает восторга у системного<br>
программиста. Кабель для подключения совпадает с приве-<br>
денным на рис. 2.12.</font>

<p>
<img border=0 vspace=3 hspace=3 src="211.jpg"alt="211.jpg">
<br clear=all>


<p>
<font face="Times New Roman" size=2><b>Рис. 2.12.</b> Кабель подключения принтера по протоколу XON/XOFF</font>

<p>
<font face="Times New Roman" size=4><b>2.3. Интерфейс "токовая петля"</b></font>

<p>
<font face="Times New Roman" size=2>Распространенным вариантом последовательного интерфей-<br>
са является токовая петля. В ней электрическим сигналом<br>
является не уровень напряжения относительно общего про-<br>
вода, а <i>ток</i> в двухпроводной линии, соединяющей приемник<br>
и передатчик. Логической единице (состоянию "включено")<br>
соответствует протекание тока 20 мА, а логическому нулю -<br>
отсутствие тока. Такое представление сигналов для описан-<br>
ного формата асинхронной посылки позволяет обнаружить<br>
обрьго линии - приемник заметит отсутствие стоп-бита (об-<br>
рыв линии действует как постоянный логический нуль).</font>

<p>
<font face="Times New Roman" size=2>Токовая петля обычно предполагает <i>гальваническую развяз-<br>
ку</i> входных цепей приемника от схемы устройства. При этом<br>
источником тока в петле является передатчик (этот вариант<br>
называют активным передатчиком). Возможно и питание от<br>
приемника (активный приемник), при этом выходной ключ<br>
передатчика может быть также гальванически развязан с ос-<br>
тальной схемой передатчика. Существуют упрощенные ва-<br>
рианты без гальванической развязки, но это уже вырожден-<br>
ный случай интерфейса.</font>
<hr>

<p>
<font face="Times New Roman" size=2>Токовая петля с гальванической развязкой позволяет пере-<br>
давать сигналы на расстояния до нескольких километров.<br>
Расстояние определяется сопротивлением пары проводов и<br>
уровнем помех. Поскольку интерфейс требует пары прово-<br>
дов для каждого сигнала, обычно используют только два сиг-<br>
нала интерфейса. В случае двунаправленного обмена при-<br>
меняются только сигналы передаваемых и принимаемых<br>
данных, а для управления потоком используется программ-<br>
ный метод <i>XON/XOFF.</i> Если двунаправленный обмен не тре-<br>
буется, используют одну линию данных, а для управления<br>
потоком обратная линия задействуется для сигнала CTS (ап-<br>
паратный протокол) или встречной линии данных (про-<br>
граммный протокол).</font>

<p>
<font face="Times New Roman" size=2>Преобразовать сигналы <i>RS-232C</i> в токовую петлю можно с<br>
помощью несложной схемы (рис. 2.13). Здесь принтер под-<br>
ключается по токовой петле к СОМ-порту с аппаратным<br>
управлением потоком. Для получения двуполярного сигна-<br>
ла, требуемого для входных сигналов СОМ-порта, приме-<br>
няется питание от интерфейса.</font>

<p>
<font face="Times New Roman" size=2>При надлежащем ПО одной токовой петлей можно обеспечить<br>
двунаправленную полудуплексную связь двух устройств. При<br>
этом каждый приемник "слышит" как сигналы передатчика<br>
на противоположной стороне канала, так и сигналы своего<br>
передатчика. Они расцениваются коммуникационными паке-<br>
тами просто как эхо-сигнал. Для безошибочного приема пе-<br>
редатчики должны работать поочередно.</font>

<p>
<img border=0 vspace=3 hspace=3 src="212.jpg"alt="212.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.13.</b> Подключение принтера с интерфейсом "токовая петля"<br>
к СОМ-порту</font>
<hr>

<p>
<font face="Times New Roman" size=4><b>2.4. Интерфейс MIDI</b></font>

<p>
<font face="Times New Roman" size=2>Цифровой интерфейс музыкальных инструментов <i>MIDI<br>
</i>(Musical Instrument Digital Interface) является двунаправ-<br>
ленным последовательным асинхронным интерфейсом с ча-<br>
стотой передачи 31,25 Кбит/с. Этот интерфейс, разработан-<br>
ный в 1983 году, стал фактическим стандартом для<br>
сопряжения компьютеров, синтезаторов, записывающих и<br>
воспроизводящих устройств, микшеров, устройств специаль-<br>
ных эффектов и другой электромузыкальной техники.</font>

<p>
<font face="Times New Roman" size=2>В интерфейсе применяется <i>токовая петля 10 мА</i> (возможно<br>
5 мА) с гальванической развязкой входной цепи. Это исклю-<br>
чает связь "схемных земель" соединяемых устройств через<br>
интерфейсный кабель, устраняя помехи, крайне нежелатель-<br>
ные для звуковой техники. Снижению интерференционных<br>
помех служит и выбор частоты передачи, которая совпадает<br>
с одним из значений частот квантования, принятых в циф-<br>
ровой звукозаписи.</font>

<p>
<font face="Times New Roman" size=2><i>Асинхронная посылка</i> содержит старт-бит, 8 бит информации<br>
и 1 стоп-бит, контроль четности отсутствует. Старший бит<br>
посылки является признаком "команда/данные". Его нуле-<br>
вое значение указывает на наличие семи бит данных в млад-<br>
ших разрядах. При единичном значении биты [6:4] содер-<br>
жат <i>код команды,</i> а биты [3:0] - <i>номер канала.</i> Команды могут<br>
быть как адресованными конкретному каналу, так и широ-<br>
ковещательными безадресными. К последней группе отно-<br>
сятся команды старта, стопа и отметки времени, обеспечи-<br>
вающие синхронизацию устройств (система синхронизации<br>
<i>MIDI Sync</i> и <i>МТС - MIDI Time Code).</i></font>

<p>
<font face="Times New Roman" size=2>Интерфейс определяет три типа портов: <i>MIDI-In, MIDI-Out<br>
</i>и <i>MIDI-Thru.</i></font>

<p>
<font face="Times New Roman" size=2><i>Входной порт MIDI-In</i> представляет собой вход интерфейса<br>
"токовая петля 10 мА", гальванически развязанного от при-<br>
емника оптроном с быстродействием не хуже 2 мкс. Устрой-<br>
ство отслеживает информационный поток на этом входе и<br>
реагирует на адресованные ему команды и данные.</font>

<p>
<font face="Times New Roman" size=2><i>Выходной порт MIDI-Out</i> представляет собой выход источ-<br>
ника тока 10 мА, гальванически связанного со схемой уст-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ройства. Ограничительные резисторы предохраняют выход-<br>
ные цепи от повреждения при замыкании на землю или ис-<br>
точник 5 В. На выход подается информационный поток от<br>
данного устройства. В потоке может содержаться и транс-<br>
лированный входной поток.</font>

<p>
<font face="Times New Roman" size=2><i>Транзитный порт MIDI-Thru</i> (не обязателен) служит для ре-<br>
трансляции входного сигнала.</font>

<p>
<font face="Times New Roman" size=2>В качестве разъемов применяются 5-контактные разъемы DIN,<br>
распространенные в бытовой звуковой аппаратуре. На всех<br>
устройствах устанавливаются розетки, на кабелях - вилки. Все<br>
соединительные кабели MIDI унифицированы (рис. 2.14).<br>
Контакт 2 - экран кабеля - соединяется с общим проводом<br>
только на стороне передатчика (на разъемах <i>MIDI-Out</i> и<br>
<i>MIDI-Thru).</i></font>

<p>
<img border=0 vspace=3 hspace=3 src="213.jpg"alt="213.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.14.</b> Соединительные кабели MIDI</font>

<p>
<font face="Times New Roman" size=2>В маркировке входов и выходов, указанной около разъемов,<br>
бывают разночтения. Одни производители пишут "In" или<br>
"Out" в соответствии с функцией разъема данного устрой-<br>
ства (и это, правильно), тогда любой кабель соединяет "In" и<br>
"Out". Другие считают, что подпись должна обозначать функ-<br>
цию подключаемого устройства. Тогда кабель будет соединять<br>
разъемы с обозначениями "In" - "In" и "Out" - "Out".</font>

<p>
<font face="Times New Roman" size=2>Интерфейс позволяет объединить группу до 16 устройств в<br>
локальную сеть. Топология должна подчиняться правилу:</font>

<p>
<font face="Times New Roman" size=2>вход <i>MIDI-In</i> одного устройства должен подключаться к<br>
выходу <i>MIDI-Out</i> или <i>MIDI-Thru</i> другого. При планирова-<br>
нии MIDI-сети необходимо руководствоваться информа-<br>
ционными потоками и связью устройств. Управляющие<br>
устройства - клавиатуры, секвенсоры (в режиме воспроиз-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ведения), источники синхронизации - должны находиться<br>
перед управляемыми. Если устройства нуждаются в двуна-<br>
правленном обмене, они соединяются в кольцо. Возможно<br>
применение специальных мультиплексоров, позволяющих<br>
логически коммутировать несколько входных потоков в один<br>
выходной. Вырожденным случаем кольца является двуна-<br>
правленное соединение двух устройств. Несколько вариан-<br>
тов соединения приведено на рис. 2.15.</font>

<p>
<font face="Times New Roman" size=2>В PC MIDI-порт имеется на большинстве звуковых адапте-<br>
ров, его сигналы выведены на неиспользуемые контакты (12<br>
и 15) разъема игрового адаптера. Для подключения устройств<br>
MIDI требуется <i>переходной адаптер,</i> реализующий интер-<br>
фейс "токовая петля". Переходной адаптер обычно встраи-<br>
вается в специальный кабель, схема которого приведена на<br>
рис. 2.16. Некоторые модели PC имеют встроенные адапте-<br>
ры и стандартные 5-штырьковые разъемы MIDI.</font>

<p>
<img border=0 vspace=3 hspace=3 src="214.jpg"alt="214.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.15.</b> Варианты топологии сети MIDI: a - цепь,<br>
б - кольцо с мультиплексором</font>

<p>
<font face="Times New Roman" size=2>В PC для интерфейса MIDI применяются порты, совмести-<br>
мые с контроллером <i>MPU-401</i> (Roland) в режиме UART.<br>
В пространстве ввода/вывода <i>MPU-401</i> занимает два смеж-<br>
ных адреса MPЈ/ (обычно ЗЗОп)иМР[/+^:</font>

<p align=center>
<font face="Times New Roman" size=2>^ Порт <i>DATA</i> (адрес <i>MPU+0) -</i> запись и считывание байт,<br>
передаваемых и принимаемых по интерфейсу MIDI.</font>
<hr>

<p>
<font face="Times New Roman" size=2>Порт <i>STATUS/COMMAND</i> (адрес <i>MPU+1) -</i> чтение со-<br>
стояния / запись команд (запись - только для интеллек-<br>
туального режима). В байте состояния определены сле-<br>
дующие биты:</font>

<p>
<font face="Times New Roman" size=2>Бит 7 - <i>DSR</i> (Data Set Ready) - готовность <i>(DSR=0)</i> при-<br>
нятых данных для чтения. Бит устанавливается в "I",<br>
когда все принятые байты считаны из регистра данных.</font>

<p>
<font face="Times New Roman" size=2>Бит 6 - <i>DRR</i> (Data Read Ready) - готовность <i>(DRR=0)<br>
</i>UART к записи в регистр данных или команд. Условие<br>
готовности к записи не возникнет, если приемник имеет<br>
непрочитанный байт данных.</font>

<p>
<img border=0 vspace=3 hspace=3 src="215.jpg"alt="215.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.16.</b> Вариант схемы кабеля-адаптера MIDI</font>

<p>
<font face="Times New Roman" size=2>На некоторых системных платах применяются БИС контрол-<br>
леров интерфейсов, в которых UART, используемая для<br>
СОМ-порта, конфигурированием через BIOS SETUP может<br>
быть переведена в режим MIDI-порта.</font>

<p>
<font face="Times New Roman" size=4><b>2.5. СОМ-порт</b></font>

<p>
<font face="Times New Roman" size=2>Последовательный интерфейс <i>СОМ-порт</i> (Communication<br>
Port - коммуникационный порт) появился в первых моделях<br>
IBM PC. Он был реализован на микросхеме асинхронного при-<br>
емопередатчика Intel 8250. Порт имел поддержку BIOS<br>
(/Л/Т 74/?), однако широко применялось (и применяется) взаи-<br>
модействие с портом на уровне регистров. Поэтому во всех PC-<br>
совместимых компьютерах для последовательного интерфейса<br>
применяют микросхемы приемопередатчиков, совместимые с</font>
<hr>

<p>
<font face="Times New Roman" size=2>i8250. В ряде отечественных PC-совместимых (почти) компь-<br>
ютеров для последовательного интерфейса применялась мик-<br>
росхема КР580ВВ51 - аналог 18251. Однако эта микросхема<br>
является универсальным синхронно-асинхронным приемопе-<br>
редатчиком (УСАПП или USART - Universal Asynchronous<br>
Receiver-Transmitter). Совместимости с PC на уровне регист-<br>
ров СОМ-порта такие компьютеры не имеют. Хорошо, если у<br>
соответствующих компьютеров имеется "честный" драйвер<br>
B/OS /Л/Т <i>14h,</i> а не заглушка, возвращающая состояние модема<br>
"всегда готов" и ничего не делающая. Совместимость на уров-<br>
не регистров СОМ-порта считается необходимой. Многие раз-<br>
работчики коммуникационных пакетов предлагают работу и<br>
через B/OS /Л/Т <i>14h,</i> однако на высоких скоростях это неэффек-<br>
тивно. Говоря о СОМ-порте PC, по умолчанию будем подра-<br>
зумевать совместимость регистровой модели с i8250 и реали-<br>
зацию асинхронного интерфейса <i>RS-232C.</i></font>

<p>
<font face="Times New Roman" size=3><b>2.5.1. Использование СОМ-портов</b></font>

<p>
<font face="Times New Roman" size=2>СОМ-порты чаще всего применяют для<b> подключения<br>
манипуляторов</b> (мышь, трекбол). В этом случае порт исполь-<br>
зуется в режиме последовательного ввода; питание произво-<br>
дится от интерфейса. Мышь с последовательным интерфей-<br>
сом - <i>Serial Mouse</i> -может подключаться к любому исправному<br>
порту. Для согласования разъемов порта и мыши возможно при-<br>
менение переходника DB-9S-DB-25P или DB-25S-DB-9P. Для<br>
мыши требуется прерывание, для порта <i>СОМ1 -</i> IRQ4, для<br>
<i>COM2 -</i> IRQ3. Жесткая привязка номера IRQ к номеру порта<br>
обусловлена свойствами драйверов. Каждое событие - пере-<br>
мещение мыши или нажатие-отпускание кнопки - кодируется<br>
двоичной посылкой по интерфейсу <i>RS-232C.</i> Применяется асин-<br>
хронная передача; двуполярное питание обеспечивается от уп-<br>
равляющих линий интерфейса (табл. 2.3).</font>

<p>

<table align=left border=1>
<tr>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Сигнал</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>Контакты</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DB-9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DB-25</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Data</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>7</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>+V (питание)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>4,7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>4,20</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>-V (питание)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>9</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>
<font face="Times New Roman" size=2>Две разновидности Serial Mouse - <i>MS-Mouse</i> и <i>PC-Mouse<br>
</i>(Mouse Systems Mouse) - требуют соответствующих драй-<br>
веров, многие мыши имеют переключатель MS/PC. Мышь<br>
с "чужим" драйвером либо не отзывается, либо "скачет" за-<br>
гадочным образом. Эти разновидности используют различ-<br>
ные форматы посылок: при одинаковой скорости 1200 бит/с,<br>
одном стоп-бите и отсутствии контроля четности Microsoft<br>
Mouse использует 7 бит данных, a PC-Mouse - 8 бит. Мышь<br>
посылает пакет при каждом изменении состояния - переме-<br>
щении, нажатии или отпускании кнопки. Пакет, передавае-<br>
мый MS-Mouse, состоит из трех байт (табл. 2.4). PC-Mouse<br>
передает 5 байт (табл. 2.5). Здесь <i>LB</i> (Left Buttom), <i>MB<br>
</i>(Middle Buttom) и <i>RB</i> (Right Buttom) означают состояние<br>
левой, средней и правой кнопок, <i>Х[7:0]</i> и <i>Y[7:0] -</i> биты от-<br>
носительного перемещения мыши с момента предыдущей<br>
посылки по координатам Х и Y. Положительным значениям<br>
соответствует перемещение по координате Х вправо, а по<br>
координате Y вниз для MS-Mouse и вверх для PC-Mouse.<br>
Отсюда становятся понятными беспорядочные перемещения<br>
курсора на экране при несоответствии драйвера типу мыши.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Биты</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>02</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>01</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>00</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>1-й байт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>LB</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>RB</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y7</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y6</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х7</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х6</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>2-й байт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х5</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х4</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>ХЗ</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х2</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х1</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>хо</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3-й байт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y5</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y4</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y3</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y2</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y1</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>YO</i></font>
</td>
</tr>
</table>
<br clear=all>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Биты</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>07</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Об</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>05</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>04</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>03</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>02</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>01</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DO</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>1-й байт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>о</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>LB</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>MB</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>RB</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>2-й байт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х7</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х6</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х5</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х4</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>ХЗ</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х2</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Х1</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>ХО</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3-й байт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y7</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y6</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y5</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y4</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y3</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y2</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Y1</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>YO</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>4-й байт</font>
</td>
<td colspan=8>

<p>
<font face="Times New Roman" size=2>Совпадает со 2-м байтом</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>5-й байт</font>
</td>
<td colspan=8>

<p>
<font face="Times New Roman" size=2>Совпадает с 3-м байтом</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>Для<b> подключения внешних модемов</b> используется полный<br>
(9-проводный) кабель <i>АПД-АКД,</i> схема которого приведена<br>
на рис. 2.7. Этот же кабель используется для согласования</font>
<hr>

<p>
<font face="Times New Roman" size=2>разъемов (по количеству контактов); возможно применение<br>
переходников 9-25, предназначенных для мышей. Для ра-<br>
боты коммуникационного ПО обычно требуется использо-<br>
вание прерываний, но здесь есть свобода выбора номера (ад-<br>
реса) порта и линии прерывания. Если предполагается работа<br>
на скоростях 9600 бит/с и выше, то СОМ-порт должен быть<br>
реализован на микросхеме UART 16550A или совместимой.<br>
Возможности работы с использованием FIFO-буферов и об-<br>
мена по каналам DMA зависят от коммуникационного ПО.</font>

<p>
<font face="Times New Roman" size=2>Для<b> связи двух компьютеров,</b> удаленных друг от друга на<br>
небольшое расстояние, используют и непосредственное со-<br>
единение их СОМ-портов нуль-модемным кабелем (рис. 2.8).<br>
Использование программ типа Norton Commander или<br>
Interink MS-DOS позволяет обмениваться файлами со ско-<br>
ростью до 115,2 Кбит/с без применения аппаратных преры-<br>
ваний. Это же соединение может использоваться и сетевым<br>
пакетом Lantastic, предоставляющим более развитый сервис.</font>

<p>
<font face="Times New Roman" size=2><b>Подключение принтеров и плоттеров</b> к СОМ-порту требу-<br>
ет применения кабеля, соответствующего выбранному про-<br>
токолу управления потоком: программному <i>XON/XOFF</i> или<br>
аппаратному RTS/CTS. Схемы кабелей приведены на рис. 2.10<br>
и 2.12. Аппаратный протокол предпочтительнее. Прерыва-<br>
ния при выводе средствами DOS (командами <i>COPY</i> или<br>
<i>PRINT)</i> не используются.</font>

<p>
<font face="Times New Roman" size=2>СОМ-порт используется для<b> подключения электронных<br>
ключей</b> (Security Devices), предназначенных для защиты от<br>
нелицензированного использования ПО. Эти устройства мо-<br>
гут быть как "прозрачными", позволяя воспользоваться тем<br>
же портом для подключения периферии, так и полностью<br>
занимающими порт.</font>

<p>
<font face="Times New Roman" size=2>СОМ-порт при наличии соответствующей программной под-<br>
держки позволяет превратить PC в <i>терминал,</i> эмулируя си-<br>
стему команд распространенных специализированных тер-<br>
миналов (VT-52, VT-100 и т. д.). Простейший терминал<br>
получается, если замкнуть друг на друга функции BIOS об-<br>
служивания СОМ-порта <i>(INT 14h),</i> телетайпного вывода<br>
(/Л/Т <i>10h)</i> и клавиатурного ввода <i>(INT 16h).</i> Однако такой тер-<br>
минал будет работать лишь на малых скоростях обмена (если,</font>
<hr>

<p>
<font face="Times New Roman" size=2>конечно, его делать не на Pentium), поскольку функции BIOS<br>
хоть и универсальны, но не слишком быстры.</font>

<p>
<font face="Times New Roman" size=2>Интерфейс <i>RS-232C</i> широко распространен в различных ПУ<br>
и терминалах. СОМ-порт может использоваться и как дву-<br>
направленный интерфейс, у которого имеется 3 программно-<br>
управляемые выходные линии и 4 программно-читаемые<br>
входные линии с двуполярными сигналами. Их использова-<br>
ние определяется разработчиком. Существует, например, схе-<br>
ма однобитного широтно-импульсного преобразователя, по-<br>
зволяющего записывать звуковой сигнал на диск PC,<br>
используя входную линию СОМ-порта. Воспроизведение<br>
этой записи через обычный динамик PC позволяет передать<br>
речь. В настоящее время, когда звуковая карта стала почти<br>
обязательным устройством PC, это не впечатляет, но когда-<br>
то такое решение было интересным.</font>

<p>
<font face="Times New Roman" size=2>СОМ-порт используют для<b> беспроводных коммуникаций</b></font>

<p>
<font face="Times New Roman" size=2>с применением излучателей и приемников инфракрасного<br>
диапазона - <i>IR (Infra Red) Connection.</i> Этот интерфейс по-<br>
зволяет осуществлять связь между парой устройств, уда-<br>
ленных на расстояние, достигающее нескольких метров. Раз-<br>
личают инфракрасные системы низкой (до 115,2 Кбит/с),<br>
средней (1,152 Мбит/с) и высокой (4 Мбит/с) скорости.<br>
Низкоскоростные системы служат для обмена короткими<br>
сообщениями, высокоскоростные - для обмена файлами<br>
между компьютерами, подключения к компьютерной сети,<br>
вывода на принтер, проекционный аппарат и т. п. Ожида-<br>
ются более высокие скорости обмена, которые позволят<br>
передавать "живое видео". В 1993 году создана ассоциация<br>
разработчиков систем инфракрасной передачи данных <i>IrDA<br>
</i>(Infrared Data Association), призванная обеспечить совмес-<br>
тимость оборудования от различных производителей. В<br>
настоящее время действует стандарт <i>IrDA 1.1.</i> Имеются соб-<br>
ственные системы фирм Hewlett Packard - <i>HP-SIR</i> (Hewlett<br>
Packard Slow Infra Red) - и Sharp - <i>ASK</i> (Amplitude Shifted<br>
Keyed IR). Основные характеристики интерфейсов следу-<br>
ющие:</font>

<p>
<font face="Times New Roman" size=2><i>т</i> IrDA SIR (Slow Infra Red), HP-SIR - 9,6-115,2 Кбит/с;</font>

<p>
<font face="Times New Roman" size=2>^ IrDA MIR (Middle Infra Red) - 1,2 Мбит/с;</font>
<hr>

<p>
<font face="Times New Roman" size=2>^ IrDA FIR (Fast Infra Red) - 4 Мбит/с;</font>

<p>
<font face="Times New Roman" size=2>^ Sharp ASK - 9,6-57,6 Кбит/с.</font>

<p>
<font face="Times New Roman" size=2>На скоростях до 115 200 бит/с для инфракрасной связи ис-<br>
пользуются UART, совместимые с 16450/16550. В современ-<br>
ных системных платах на использование инфракрасной связи<br>
может конфигурироваться порт <i>COM2.</i> В этом случае на пе-<br>
реднюю панель компьютера устанавливается внешний при-<br>
емопередатчик - "инфракрасный глаз", который подключа-<br>
ется к разъему <i>IR-Connector</i> системной платы.</font>

<p>
<font face="Times New Roman" size=2>На средних и высоких скоростях обмена применяются спе-<br>
циализированные микросхемы, ориентированные на интен-<br>
сивный программно-управляемый обмен или DMA с воз-<br>
можностью прямого управления шиной.</font>

<p>
<font face="Times New Roman" size=2>Инфракрасные излучатели не создают помех в радиочастот-<br>
ном диапазоне и обеспечивают конфиденциальность пере-<br>
дачи. ИК-лучи не проходят через стены, поэтому зона при-<br>
ема ограничивается небольшим легко контролируемым<br>
пространством. Инфракрасная технология привлекательна<br>
для связи портативных компьютеров со стационарными ком-<br>
пьютерами или док-станциями. Инфракрасный интерфейс<br>
имеют некоторые модели принтеров.</font>

<p>
<font face="Times New Roman" size=3><b>2.5.2. Микросхемы асинхронных приемопередатчиков</b></font>

<p>
<font face="Times New Roman" size=2>Преобразование параллельного кода в последовательный для<br>
передачи и обратное преобразование при приеме данных вы-<br>
полняют специализированные микросхемы UART (Universal<br>
Asynchronous Receiver-Transmitter - универсальный асинхрон-<br>
ный приемопередатчик). Эти же микросхемы формируют и<br>
обрабатывают управляющие сигналы интерфейса. СОМ-пор-<br>
ты IBM PC XT/AT базируются на микросхемах, совместимых<br>
на уровне регистров с UART 18250 - 8250/16450/16550А. Это<br>
семейство представляет собой усовершенствование начальной<br>
модели, направленное на повышение быстродействия, сниже-<br>
ние потребляемой мощности и загрузки процессора при ин-<br>
тенсивном обмене. Отметим следующее:</font>

<p>
<font face="Times New Roman" size=2><i>т</i> 8250 имеет ошибки (появление ложных прерываний),<br>
учтенные в XT BIOS.</font>
<hr>

<p>
<font face="Times New Roman" size=2>&quot;; 8250А - ошибки исправлены, в результате чего потеряна<br>
совместимость с BIOS. Работает в некоторых моделях AT,<br>
но непригоден для скорости 9600 бит/с.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> 8250В - исправлены ошибки 8250 и 8250А, восстановле-<br>
на ошибка в прерываниях - возвращена совместимость<br>
с XT BIOS. Работает в AT под DOS (кроме скорости<br>
9600 бит/с).</font>

<p>
<font face="Times New Roman" size=2>Микросхемы 8250х имеют невысокое быстродействие по об-<br>
ращениям со стороны системной шины. Они не допускают<br>
обращения к своим регистрам в смежных шинных циклах<br>
процессора - для корректной работы с ними требуется вве-<br>
дение программных задержек между обращениями CPU.</font>

<p>
<font face="Times New Roman" size=2>В компьютерах класса AT применяют микросхемы UART<br>
следующих модификаций:</font>

<p>
<font face="Times New Roman" size=2>а? 16450 - быстродействующая версия 8250 для AT. Оши-<br>
бок 8250 и полной совместимости с XT BIOS не имеет.<br>
Требуется для работы OS/2 с СОМ-портами.</font>

<p>
<font face="Times New Roman" size=2>^ 16550 - развитие 16450. Может использовать канал<br>
DMA для обмена данными. Имеет FIFO-буфер, но<br>
некорректность его работы не позволяет им воспользо-<br>
ваться.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> 16550А - имеет работающие 16-байтные FIFO-буферы<br>
приема и передачи и возможность использования DMA.<br>
Именно этот тип UART должен применяться в AT при<br>
интенсивных обменах на скоростях 9600 бит/с и выше.<br>
Совместимость с этой микросхемой обеспечивает боль-<br>
шинство микросхем контроллеров портов ввода/вывода,<br>
входящих в современные чипсеты.</font>

<p>
<font face="Times New Roman" size=2>Микросхемы UART 16550А с программной точки зрения<br>
представляют собой набор регистров, доступ к которым<br>
определяется адресом (смещением адреса регистра относи-<br>
тельно базового адреса порта) и значением бита <i>DLAB</i> (бита 7<br>
регистра <i>LCR).</i> В адресном пространстве микросхема зани-<br>
мает 8 смежных адресов. Список регистров UART 16550А и<br>
способы доступа к ним приведены в табл. 2.6. Микросхе-<br>
мы 8250 отличаются отсутствием регистра <i>FCR</i> и всех воз-<br>
можностей FIFO и DMA.</font>
<hr>

<p>

<table align=left border=1>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>Доступ</font>
</td>
<td colspan=2>

<p>
<font face="Times New Roman" size=1>Регистр</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=1>Чтение/запись<br>
R/W</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Смещение</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>DLAB</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Имя</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Название</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Oh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>THR</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Transmit Holding Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>WO</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Oh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>RBR</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Receiver Buffer Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>RO</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Oh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>DLL</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Divisor Latch LSB</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Ih</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>DLM</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Divisor Latch MSB</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Ih</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>IER</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Interrupt Enable Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>2h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>IIR</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Interrupt Identification<br>
Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>RO</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>2h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>FCR</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>FIFO Control Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>WO</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>3h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>LCR</i></font>
</td>
<td>

<p>
<font face="Times New Roman Narrow" size=1><i>Line Control Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>4h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>MCR</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Modem Control Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>5h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>LSR</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Line Status Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W'</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>6h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>MSR</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Modem Status Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W*</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>7h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>SCR</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1><i>Scratch Pad Register</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>* Некоторые биты допускают только чтение. Запись в регистр может<br>
привести к сбою протокола.</font>

<p>
<font face="Times New Roman" size=2><i>THR -</i> промежуточный регистр данных передатчика (только<br>
для записи). Данные, записанные в регистр, будут пересланы<br>
в выходной сдвигающий регистр (когда он будет свободен),<br>
из которого поступят на выход при наличии разрешающего<br>
сигнала CTS. Бит 0 передается (и принимается) первым. При<br>
длине посылки менее 8 бит старшие биты игнорируются.</font>

<p>
<font face="Times New Roman" size=2><i>RBR -</i> буферный регистр принимаемых данных (только для<br>
чтения). Данные, принятые входным сдвигающим регистром,<br>
помещаются в регистр <i>RBR,</i> откуда они могут быть считаны<br>
процессором. Если к моменту окончания приема очередно-<br>
го символа предыдущий не был считан из регистра, фикси-<br>
руется ошибка переполнения. При длине посылки менее<br>
8 бит старшие биты в регистре имеют нулевое значение.</font>

<p>
<font face="Times New Roman" size=2><i>DLL -</i> регистр младшего байта делителя частоты.</font>

<p>
<font face="Times New Roman" size=2><i>DLM -</i> регистр старшего байта делителя частоты. Делитель<br>
определяется по формуле D==115200/V, где V - скорость пе-</font>
<hr>

<p>
<font face="Times New Roman" size=2>редачи, бит/с. Входная частота синхронизации 1,8432 МГц<br>
делится на заданный коэффициент, после чего получается<br>
16-кратная частота передачи данных.</font>

<p>
<font face="Times New Roman" size=2><i>IER -</i> регистр разрешения прерываний. Единичное значение<br>
бита разрешает прерывание от соответствующего источника.</font>

<p>
<font face="Times New Roman" size=2><b>Назначение бит регистра <i>IER:</b></i></font>

<p>
<font face="Times New Roman" size=2><i>^</i> Биты 7-4=0 - не используются.</font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 3 - <i>Mod IE-no</i> изменению состояния модема (лю-<br>
бой из линий CTS, DSR, Rl, DCD).</font>

<p>
<font face="Times New Roman" size=2>йа Бит 2 - <i>RxL IE-no</i> обрыву/ошибке линии.<br>
^ Бит 1 - <i>TxD IE - по</i> завершении передачи.</font>

<p>
<font face="Times New Roman" size=2>ай Бит 0 - <i>RxD IE-no</i> приему символа (в режиме FIFO -<br>
прерывание по тайм-ауту).</font>

<p>
<font face="Times New Roman" size=2><i>IIR -</i> регистр идентификации (только для чтения) прерыва-<br>
ний и признака режима FIFO. Для упрощения программного<br>
анализа UART выстраивает внутренние запросы прерывания<br>
по четырехуровневой системе приоритетов. Порядок приори-<br>
тетов (по убыванию): состояние линии, прием символа, осво-<br>
бождение регистра передатчика, состояние модема. При воз-<br>
никновении условий прерывания UART указывает на<br>
источник с высшим приоритетом до тех пор, пока он не будет<br>
сброшен соответствующей операцией. Только после этого<br>
будет выставлен запрос с указанием следующего источника.</font>

<p>
<font face="Times New Roman" size=2><b>Назначение бит регистра <i>IIR:</b></i></font>

<p>
<font face="Times New Roman" size=2>^ Биты [7:6] - признак режима FIFO:</font>

<p>
<font face="Times New Roman" size=2>11 -режим FIFO 16550A,</font>

<p>
<font face="Times New Roman" size=2>10 - режим FIFO 16550,</font>

<p>
<font face="Times New Roman" size=2>00 - обычный.</font>

<p>
<font face="Times New Roman" size=2>^ Биты [5:4] - не используются.<br>
:в? Бит 3 - прерывание по тайм-ауту (не в режиме FIFO).</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Биты [2:1] - причина прерывания с наивысшим приори-<br>
тетом (в обычном, не FIFO-режиме):</font>

<p>
<font face="Times New Roman" size=2>11 - ошибка/обрыв линии; сброс - чтением регистра со-<br>
стояния линии,</font>
<hr>

<p>
<font face="Times New Roman" size=2>10 - принят символ; сброс - чтением данных,<br>
01 - передан символ (регистр <i>THR</i> пуст); сброс - запи-<br>
сью данных,</font>

<p>
<font face="Times New Roman" size=2>00 - изменение состояния модема; сброс - чтением ре-<br>
гистра состояния модема.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 0 - признак необслуженного запроса прерывания:</font>

<p>
<font face="Times New Roman" size=2>1 - нет запроса,<br>
О -есть запрос.</font>

<p>
<font face="Times New Roman" size=2><b>Идентификация прерываний в режиме FIFO, <i>IIR</i> [3:1]:</b></font>

<p>
<font face="Times New Roman" size=2>^ Oil - ошибка/обрыв линии; сброс - чтением регистра<br>
состояния линии.</font>

<p>
<font face="Times New Roman" size=2>^ 010 - принят символ; сброс - чтением регистра данных<br>
приемника.</font>

<p>
<font face="Times New Roman" size=2>^ 110 - индикатор тайм-аута (за 4-кратный интервал вре-<br>
мени символа не передано и не принято ни одного сим-<br>
вола, хотя в буфере имеется по крайней мере один).<br>
Сброс - чтением регистра данных приемника.</font>

<p>
<font face="Times New Roman" size=2>^ 001 - регистр <i>THR</i> пуст; сброс - записью данных.</font>

<p>
<font face="Times New Roman" size=2>^ 000 - изменение состояния модема (CTS, DSR, R1 или<br>
DCD), сброс - чтением регистра <i>MSR.</i></font>

<p>
<font face="Times New Roman" size=2><i>FCR -</i> регистр управления FIFO (только для записи).<br>
<b>Назначение бит регистра</b> <i>FCR:</i></font>

<p>
<font face="Times New Roman" size=2>^ Биты [7:6] - <i>ITL (Interrupt Trigger Level) -</i> уровень запол-<br>
нения FIFO-буфера, при котором вырабатывается пре-<br>
рывание:</font>

<p>
<font face="Times New Roman" size=2>00-1 байт (по умолчанию),<br>
01-4 байта,</font>

<p>
<font face="Times New Roman" size=2>10 -8байт,</font>

<p>
<font face="Times New Roman" size=2>11 -14 байт.</font>

<p>
<font face="Times New Roman" size=2>^ Биты [5:4] зарезервированы.<br>
^ Бит 3 - разрешение операций DMA.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 2 <i>-RESETTF(Reset Transmitter FIFO) -</i> сброс счетчи-<br>
ка FIFO-передатчика (записью единицы; сдвигающий<br>
регистр не сбрасывается).</font>
<hr>

<p>
<font face="Times New Roman" size=2>^ Бит 1 - <i>RESETRFfReset Receiver FIFO) -</i> сброс счетчика<br>
FIFO-приемника (записью единицы; сдвигающий регистр<br>
не сбрасывается).</font>

<p>
<font face="Times New Roman" size=2>- Бит 0 - <i>TRFIFOE(Transmit And Receive FIFO Enable) -</i> раз-<br>
решение (единицей) режима FIFO для передатчика и<br>
приемника. При смене режима FIFO-буферы автомати-<br>
чески очищаются.</font>

<p>
<font face="Times New Roman" size=2><i>LCR -</i> регистр управления линией (настройки параметров<br>
канала).</font>

<p>
<font face="Times New Roman" size=2><b>Назначения бит регистра <i>LCR:</b></i></font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 7 - <i>DLAB (Divisor Latch Access Bit) -</i> управление до-<br>
ступом к делителю частоты.</font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 6 - <i>BRCON( Break Control)</i> - формирование обрыва<br>
линии (посылка нулей) при <i>BRCON=i.</i></font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 5 <i>- STICPARf Sticky Parity) -</i> принудительное форми-<br>
рование бита паритета:</font>

<p>
<font face="Times New Roman" size=2>О - контрольный бит генерируется в соответствии с па-<br>
ритетом выводимого символа,</font>

<p>
<font face="Times New Roman" size=2>1 - постоянное значение контрольного бита: при<br>
<i>lEVENPAR^i -</i> нулевое, при <i>EVENPAFf^O -</i> единичное.</font>

<p>
<font face="Times New Roman" size=2>s&reg; Бит 4 <i>- EVENPARf Even Parity Select)</i> - выбор типа конт-<br>
роля: 0 - нечетность, 1 - четность.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Бит 3 - <i>PAREN( Parity Enable)</i> - разрешение контрольно-<br>
го бита:</font>

<p>
<font face="Times New Roman" size=2>1 - контрольный бит (паритет или постоянный) разре-<br>
шен,</font>

<p>
<font face="Times New Roman" size=2>О - запрещен.<br>
is Бит 2 - STOPS <i>(Stop Bits) -</i> количество стоп-бит:</font>

<p>
<font face="Times New Roman" size=2>0-1 стоп-бит,</font>

<p>
<font face="Times New Roman" size=2>1-2 стоп-бита (для 5-битного кода стоп-бит будет иметь<br>
длину 1,5 бита).</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Биты [1:0] - <i>SERIALDBf Serial Data Bits) -</i> количество бит<br>
данных:</font>

<p>
<font face="Times New Roman" size=2>00 -5 бит, 01 -6 бит, 10 -7 бит, 11 -8 бит.</font>
<hr>

<p>
<font face="Times New Roman" size=2><i>MCR -</i> регистр управления модемом.<br>
<b>Назначение бит регистра</b> <i>MCR-.</i></font>

<p>
<font face="Times New Roman" size=2><i>ш</i> Биты [7:5]=0 - зарезервированы.</font>

<p>
<font face="Times New Roman" size=2>*&sect; Бит 4 - <i>LME(Loopback Mode Enable) -</i> разрешение режи-<br>
ма диагностики:</font>

<p>
<font face="Times New Roman" size=2>О - нормальный режим,<br>
1 - режим диагностики (см. ниже).</font>

<p>
<font face="Times New Roman" size=2>ж Бит 3 <i>- 1Е( Interrupt Enable)</i> - разрешение прерываний с<br>
помощью внешнего выхода <i>OUT2;</i> в режиме диагностики<br>
поступает на вход <i>MSR. 7:</i></font>

<p>
<font face="Times New Roman" size=2><i>О -</i> прерывания запрещены,<br>
1 - разрешены.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 2 - <i>OUT1C(OUT1 Bit Control) -</i> управление выходным<br>
сигналом 1 (не используется); в режиме диагностики по-<br>
ступает на вход <i>MSR.6.</i></font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 1 - <i>RTSC (Request To Send Control) -</i> управление</font>

<p>
<font face="Times New Roman" size=2>выходом RTS; в режиме диагностики поступает на вход</font>

<p>
<font face="Times New Roman" size=2><b><i>MSR.4:</b></i></font>

<p>
<font face="Times New Roman" size=2>1 - активен (-V),</font>

<p>
<font face="Times New Roman" size=2>О - пассивен (+V).<br>
^ Бит 0 - <i>DTRCfData Terminal Ready Control) -</i> управление</font>

<p>
<font face="Times New Roman" size=2>выходом DTR; в режиме диагностики поступает на вход</font>

<p>
<font face="Times New Roman" size=2><b><i>MSR.5:</b></i></font>

<p>
<font face="Times New Roman" size=2>1 - активен (-V),</font>

<p>
<font face="Times New Roman" size=2>О - пассивен (+V).</font>

<p>
<font face="Times New Roman" size=2><i>LSR -</i> регистр состояния линии (точнее, состояния приемо-<br>
передатчика).</font>

<p>
<font face="Times New Roman" size=2><b>Назначение бит регистра <i>LSR:</b></i></font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 7 - <i>FIFOE( FIFO Error Status)</i> - ошибка принятых дан-<br>
ных в режиме FIFO (буфер содержит хотя бы один сим-<br>
вол, принятый с ошибкой формата, паритета или обры-<br>
вом). В ne-FIFO-режиме всегда 0.</font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 6 - <i>TEMPT(Transmitter Empty Status)</i> - регистр пере-<br>
датчика пуст (нет данных для передачи ни в сдвиговом<br>
регистре, ни в буферных, <i>THR</i> или FIFO).</font>
<hr>

<p>
<font face="Times New Roman" size=2>?&sect; Бит 5 - <i>THRE(Transmitter Holding Register Empty) -</i> регистр<br>
передатчика готов принять байт для передачи. В режиме<br>
FIFO указывает на отсутствие символов в FIFO-буфере<br>
передачи. Может являться источником прерывания.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 4 - <i>BD (Break Detected) -</i> индикатор обрыва линии<br>
(вход приемника находится в состоянии 0 не менее, чем<br>
время посылки символа).</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Бит 3 - <i>FE(Framing Error) -</i> ошибка кадра (неверный стоп-<br>
бит).</font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 2 - <i>РЕ (Parity Error) -</i> ошибка контрольного бита (па-<br>
ритета или фиксированного).</font>

<p>
<font face="Times New Roman" size=2>^ Бит 1 - <i>ОЕ(Overrun Error) -</i> переполнение (потеря сим-<br>
вола). Если прием очередного символа начинается до того,<br>
как предыдущий был выгружен из сдвигающего регист-<br>
ра в буферный или FIFO, прежний символ в сдвигаю-<br>
щем регистре теряется.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 0 - <i>DR(Receiver</i> Data <i>Ready) -</i> принятые данные гото-<br>
вы (в <i>DHR</i> или FIFO-буфере). Сброс - чтением приемника.</font>

<p>
<font face="Times New Roman" size=2>Индикаторы ошибок - биты [4:1] - сбрасываются после чте-<br>
ния регистра <i>LSR.</i> В режиме FIFO признаки ошибок хранят-<br>
ся в FIFO-буфере вместе с каждым символом. В регистре они<br>
устанавливаются (и вызывают прерывание) в тот момент, когда<br>
символ, принятый с ошибкой, находится на вершине FIFO<br>
(первый в очереди на считывание). В случае обрыва линии в<br>
FIFO заносится только один "обрывной" символ, и UART<br>
ждет восстановления и последующего старт-бита.</font>

<p>
<font face="Times New Roman" size=2><i>MSR -</i> регистр состояния модема.<br>
<b>Назначение бит регистра</b> <i>MSR:</i></font>

<p>
<font face="Times New Roman" size=2><i>т</i> Бит 7 - <i>DCD (Data Carrier Detect) -</i> состояние линии DCD.<br>
та Бит 6 - <i>Rl(Ring Indicator)</i> - состояние линии Rl.<br>
ак Бит 5 - <i>DSR(Data Set Ready) -</i> состояние линии DSR.<br>
<i>ss</i> Бит 4 - <i>CTS(Clear To Send) -</i> состояние линии CTS.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Бит 3 - <i>DDCD(Delta Data Carrier Detect)</i> - изменение со-<br>
стояния DCD.</font>

<p>
<font face="Times New Roman" size=2><i>ss</i> Бит 2 - <i>TERI(Trailing Edge OfRing Indicator)</i> -спад огиба-<br>
ющей Rl (окончание звонка).</font>
<hr>

<p>
<font face="Times New Roman" size=2>^ Бит 1 - <i>DDSR (Delta Data Set Ready) -</i> изменение состоя-<br>
ния DSR.</font>

<p>
<font face="Times New Roman" size=2>ss? Бит 0 - <i>DCTS (Delta Clear To Send) -</i> изменение состоя-<br>
ния CTS.</font>

<p>
<font face="Times New Roman" size=2>Признаки изменения (биты [3:0]) сбрасываются по чтению<br>
регистра.</font>

<p>
<font face="Times New Roman" size=2><i>SCFt -</i> рабочий регистр (8 бит), на работу UART не влияет,<br>
предназначен для временного хранения данных (в 8250 от-<br>
сутствует).</font>

<p>
<font face="Times New Roman" size=2>В <i>диагностическом режиме</i> (при <i>LME=i)</i> внутри UART орга-<br>
низуется внутренняя заглушка:</font>

<p>
<font face="Times New Roman" size=2>^ Выход передатчика переводится в состояние логической 1.<br>
^ Вход приемника отключается.</font>

<p>
<font face="Times New Roman" size=2>^ Выход сдвигающего регистра передатчика логически со-<br>
единяется со входом приемника.</font>

<p align=center>
<font face="Times New Roman" size=2>^ Входы DSR, CTS, RI и DCD отключаются от входных линий<br>
и внутренне управляются битами <i>DTRC, RTSC, OUT1C, IE.</i></font>

<p>
<font face="Times New Roman" size=2><i>•^</i> Выходы управления модемом переводятся в пассивное<br>
состояние (логический ноль).</font>

<p>
<font face="Times New Roman" size=2>Переданные данные в последовательном виде немедленно<br>
принимаются, что позволяет проверять внутренний канал<br>
данных порта (включая сдвигающие регистры) и отработку<br>
прерываний, а также определять скорость работы UART.</font>

<p>
<font face="Times New Roman Narrow" size=3><b>2.5.3. Ресурсы и конфигурирование СОМ-портов</b></font>

<p>
<font face="Times New Roman" size=2>Компьютер может иметь до четырех последовательных пор-<br>
тов <i>СОМ 1-COM4</i> (для машин класса AT типично наличие<br>
двух портов). СОМ-порты имеют внешние <i>разъемы-вилки<br>
DB25P</i> или <i>DB9P,</i> выведенные на заднюю панель компьюте-<br>
ра (назначение выводов приведено в табл. 2.1).</font>

<p>
<font face="Times New Roman" size=2>СОМ-порты реализуются на микросхемах <i>UART,</i> совмести-<br>
мых с семейством <i>18250.</i> Они занимают в пространстве вво-<br>
да/вывода по 8 смежных 8-битных регистров и могут рас-<br>
полагаться по стандартным <i>базовым адресам.</i> Порты<br>
вырабатывают <i>аппаратные прерывания.</i> Возможность разде-<br>
ляемого использования одной линии запроса несколькими</font>
<hr>

<p>
<font face="Times New Roman" size=2>портами (или ее разделения с другими устройствами) зави-<br>
сит от реализации аппаратного подключения и ПО. При ис-<br>
пользовании портов, установленных на шину ISA, разделяе-<br>
мые прерывания обычно не работают.</font>

<p>
<font face="Times New Roman" size=2>Управление последовательным портом разделяется на два<br>
этапа - предварительное конфигурирование (Setup) аппарат-<br>
ных средств порта и текущее (оперативное) переключение<br>
режимов работы прикладным или системным ПО. Конфи-<br>
гурирование СОМ-порта зависит от его исполнения. Порт<br>
на плате расширения конфигурируется джамперами на са-<br>
мой плате. Порт на системной плате конфигурируется через<br>
BIOS Setup.</font>

<p>
<font face="Times New Roman" size=2>Конфигурированию подлежат следующие параметры:</font>

<p>
<font face="Times New Roman" size=2>^ <i>Базовый адрес,</i> который может иметь значения 3F8h, 2F8h,<br>
3E8h (ЗЕОЬ, 338h) или 2E8h (2EOh, 238h). При инициа-<br>
лизации BIOS проверяет наличие портов по адресам<br>
именно в этом порядке и присваивает обнаруженным<br>
портам логические имена <i>СОМ1, COM2, COM3</i> и <i>COM4.<br>
</i>Для PS/2 стандартными для портов <i>СОМЗ-СОМ8</i> явля-<br>
ются адреса 3220h, 3228h, 4220h, 4228h, 5220h и 5228h<br>
соответственно.</font>

<p>
<font face="Times New Roman" size=2>^ Используемая <i>линия запроса прерывания:</i> для <i>СОМ1</i> и<br>
COM3 обычно используется IRQ4 или IRQ11, для <i>COM2<br>
</i>и <i>COM4 -</i> IRQ3 или IRQ 10. В принципе номер прерыва-<br>
ния можно назначать в произвольных сочетаниях с ба-<br>
зовым адресом (номером порта), но некоторые програм-<br>
мы и драйверы (например, драйверы последовательной<br>
мыши) настроены на стандартные сочетания. Каждому<br>
порту, нуждающемуся в аппаратном прерывании, назна-<br>
чают отдельную линию, не совпадающую с линиями за-<br>
проса прерываний других устройств. Прерывания необ-<br>
ходимы для портов, к которым подключаются устройства<br>
ввода, UPS или модемы. При подключении принтера или<br>
плоттера прерываниями пользуются только многозадач-<br>
ные ОС (не всегда), и этот дефицитный ресурс PC мож-<br>
но сэкономить. Также прерываниями обычно не пользу-<br>
ются при связи двух компьютеров нуль-модемным<br>
кабелем.</font>
<hr>

<p>
<font face="Times New Roman" size=2>^ <i>Канал DMA</i> (для UART 16450/16550, расположенных на<br>
системной плате) - разрешение использования и номер<br>
канала DMA. Режим DMA при работе с СОМ-портами<br>
используют редко.</font>

<p>
<font face="Times New Roman" size=2>Режим работы порта по умолчанию (2400 бит/с, 7 бит дан-<br>
ных, 1 стоп-бит и контроль четности), заданный при ини-<br>
циализации порта во время BIOS POST, может изменяться<br>
в любой момент при настройке коммуникационных программ<br>
или командой DOS <i>MODECOMx: с</i> указанием параметров.</font>

<p>
<font face="Times New Roman" size=3><b>2.5.4. Неисправности и тестирование СОМ-портов</b></font>

<p>
<font face="Times New Roman" size=2>Неполадки с СОМ-портами случаются (выявляются) при<br>
установке новых портов или неудачном подключении внеш-<br>
них устройств.</font>

<p>
<font face="Times New Roman" size=2><b>Проверка конфигурирования</b></font>

<p>
<font face="Times New Roman" size=2>Тестирование последовательных портов (как и параллельных)<br>
начинают с проверки их опознавания системой. Список <i>ад-<br>
ресов</i> установленных портов обычно появляется в таблице,<br>
выводимой BIOS перед загрузкой ОС. Список можно по-<br>
смотреть с помощью тестовых программ или прямо в BIOS<br>
Data AREA с помощью отладчика.</font>

<p>
<font face="Times New Roman" size=2>Если BIOS обнаруживает меньше портов, чем установлено<br>
физически, вероятно, двум портам присвоен один адрес или<br>
установлен нестандартный адрес какого-либо порта. Пробле-<br>
мы могут возникать с адресами портов <i>COM3</i> и <i>COM4:</i> не<br>
все версии BIOS будут искать порты по альтернативным<br>
адресам 3EOh, 338h, 2EOh и 238h; иногда не производится<br>
поиск по адресам 3E8h и 2E8h. Нумерация найденных пор-<br>
тов, отображаемая в заставке, может вводить в заблуждение:</font>

<p>
<font face="Times New Roman" size=2>если установлены два порта с адресами 3F8h и 3E8h, в за-<br>
ставке они могут называться <i>СОМ1</i> и <i>COM2,</i> и по этим име-<br>
нам на них можно ссылаться. Однако те же порты в застав-<br>
ке могут называться и <i>СОМ 1</i> и <i>COM3</i> (поскольку 3E8h<br>
является штатным адресом для <i>COM3),</i> но попытка сослать-<br>
ся на порт <i>COM3</i> будет неудачной, поскольку в данном слу-<br>
чае адрес 3E8h будет находиться в ячейке 0:402h <i>BIOS Data<br>
Area,</i> соответствующей порту <i>COM2,</i> а в ячейке порта <i>COM3<br>
</i>(0:404h) будет нуль - признак отсутствия такового порта.</font>

<p>
<font face="Times New Roman" size=1>4 Зак.№530</font>
<hr>

<p>
<font face="Times New Roman" size=2>"Объяснить" системе, где какой порт, можно вручную лю-<br>
бым отладчиком, занеся правильные значения базовых ад-<br>
ресов в ячейки <i>BIOS Data Area</i> (это придется делать каждый<br>
раз после перезагрузки ОС перед использованием "потерян-<br>
ного" порта). Существуют тестовые утилиты, позволяющие<br>
находить порты (например, Port Finder).</font>

<p>
<font face="Times New Roman" size=2>Если двум портам назначен один и тот же адрес, тестовая<br>
программа обнаружит ошибки порта только с использова-<br>
нием внешней заглушки <i>(External LoopBack).</i> Программное<br>
тестирование порта без заглушки не покажет ошибок,<br>
поскольку при этом включается диагностический режим<br>
(см. описание UART) и конфликтующие (по отдельности ис-<br>
правные) порты будут работать параллельно, обеспечивая со-<br>
впадение считываемой информации. В реальной жизни нор-<br>
мальная работа конфликтующих портов невозможна.<br>
Разбираться с конфликтом адресов удобно, последователь-<br>
но устанавливая порты и наблюдая за адресами, появляю-<br>
щимися в списке.</font>

<p>
<font face="Times New Roman" size=2>Если физически установлен только один порт и его не обна-<br>
руживает BIOS, причины те же, что с LPT-портом: либо он<br>
отключен при конфигурировании, либо вышел из строя.<br>
Неисправность может устраниться при вынимании/вставке<br>
платы адаптера в слот системной шины.</font>

<p>
<font face="Times New Roman" size=2>При работе с СОМ-портом задействуются соответствующие<br>
<i>аппаратные прерывания -</i> их используют при подключении<br>
модема, мыши и других устройств ввода. Неработоспособ-<br>
ность этих устройств может быть вызвана некорректной на-<br>
стройкой запроса прерывания. Здесь возможны как конф-<br>
ликты с другими устройствами, так и несоответствие номера<br>
прерывания адресу порта.</font>

<p>
<font face="Times New Roman" size=2><b>Функциональное тестирование</b></font>

<p>
<font face="Times New Roman" size=2>В первом приближении СОМ-порт можно проверить диаг-<br>
ностической программой (Checkit) без использования за-<br>
глушек. Этот режим тестирования проверяет микросхему<br>
UART (внутренний диагностический режим) и вырабатыва-<br>
ние прерываний, но не входные и выходные буферные мик-<br>
росхемы, которые являются более частыми источниками не-<br>
приятностей. Если тест не проходит, причину следует искать</font>
<hr>

<p>
<font face="Times New Roman" size=2>или в конфликте адресов/прерываний, или в самой микро-<br>
схеме UART.</font>

<p>
<font face="Times New Roman" size=2>Для более достоверного тестирования рекомендуется исполь-<br>
зовать <i>внешнюю заглушку,</i> подключаемую к разъему СОМ-<br>
порта (рис. 2.17). В отличие от LPT-порта у СОМ-порта<br>
количество входных сигналов превышает количество выход-<br>
ных, что позволяет выполнить полную проверку всех цепей.<br>
Заглушка соединяет выход приемника со входом передат-<br>
чика. Обязательная для всех схем заглушек перемычка RTS-<br>
CTS позволяет работать передатчику - без нее символы не<br>
смогут передаваться. Выходной сигнал DTR обычно исполь-<br>
зуют для проверки входных линий DSR, DCD и RI.</font>

<p>
<img border=0 vspace=3 hspace=3 src="216.jpg"alt="216.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.17.</b> Заглушка для проверки СОМ-портов (LoopBack)</font>

<p>
<font face="Times New Roman" size=2>Если тест с внешней заглушкой не проходит, причину сле-<br>
дует искать во внешних буферах, их питании или в шлей-<br>
фах подключения внешних разъемов. Здесь может помочь<br>
осциллограф или вольтметр. Последовательность проверки<br>
может быть следующей:</font>

<p>
<font face="Times New Roman" size=2>1. Проверить наличие двуполярного питания выходных схем<br>
передатчиков (этот шаг логически первый, но поскольку<br>
он технически самый сложный, его можно отложить на<br>
крайний случай, когда появится желание заменить бу-<br>
ферные микросхемы).</font>

<p>
<font face="Times New Roman" size=2>2. Проверить напряжение на выходах TD, RTS и DTR: после<br>
аппаратного сброса на выходе TD должен быть отри-<br>
цательный потенциал около -12 В (по крайней мере<br>
ниже -5 В), а на выходах RTS и DTR - такой же положи-<br>
тельный. Если этих потенциалов нет, возможна ошибка</font>
<hr>

<p>
<font face="Times New Roman" size=2>подключения разъема к плате через шлейф. Распростра-<br>
ненные варианты:</font>

<p>
<font face="Times New Roman" size=2><i>ш</i> шлейф не подключен;</font>

<p>
<font face="Times New Roman" size=2><i>^</i> шлейф подключен неправильно (разъем перевернут<br>
или вставлен со смещением);</font>

<p align=center>
<font face="Times New Roman" size=2>^ раскладка шлейфа не соответствует разъему платы.</font>

<p>
<font face="Times New Roman" size=2>Первые два варианта проверяются при внимательном<br>
осмотре, третий же может потребовать некоторых усилий.<br>
В табл. 2.1 приведены три варианта раскладки 10-проводного<br>
шлейфа разъема СОМ-порта, известных автору; для СОМ-<br>
портов на системных платах возможно существование и<br>
других. Теоретически шлейф должен поставляться в соот-<br>
ветствии с разъемом платы, на которой расположен порт.</font>

<p>
<font face="Times New Roman" size=2>Если дело в ошибочной раскладке, то эти три выходных<br>
сигнала удастся обнаружить на других контактах разъе-<br>
мов (на входных контактах потенциал совсем небольшой).<br>
Если эти сигналы обнаружить не удалось, очевидно, вы-<br>
шли из строя буферные формирователи.</font>

<p>
<font face="Times New Roman" size=2>3. Соединив контакты линий RTS и CTS (или установив за-<br>
глушку), следует попытаться вывести небольшой файл на<br>
СОМ-порт (например, командой <i>COPYC:\AUTOEXEC. BAT<br>
СОМ</i> 7;). С исправным портом эта команда успешно вы-<br>
полнится за несколько секунд с сообщением об успеш-<br>
ном копировании. При этом потенциалы на выходах RTS<br>
и DTR должны измениться на отрицательные, а на выхо-<br>
де TD должна появиться пачка двуполярных импульсов<br>
с амплитудой более 5 В. Если потенциалы RTS и DTR не<br>
изменились, ошибка в буферных формирователях. Если<br>
на выходе RTS (и входе CTS) появился отрицательный<br>
потенциал, а команда <i>COPY</i> завершается с ошибкой, ско-<br>
рее всего, вышел из строя приемник линии CTS (или<br>
опять-таки ошибка в шлейфе). Если команда <i>COPY</i> ус-<br>
пешно проходит, а изменения на выходе TD не обнару-<br>
живаются (их можно увидеть стрелочным вольтметром,<br>
но оценить амплитуду импульсов не удастся), виноват<br>
буферный передатчик сигнала <i>TD.</i></font>
<hr>

<p>
<font face="Times New Roman" size=2>Замена микросхем приемников и передатчиков существен-<br>
но облегчается, если они установлены в "кроватки". Перед<br>
заменой следует с помощью осциллографа или вольтметра<br>
удостовериться в неисправности конкретной микросхемы.<br>
Расположение выводов микросхем приведено на рис. 2.6.</font>

<p>
<font face="Times New Roman" size=2>Если буферные элементы включены в состав интерфейсной<br>
БИС (что теперь весьма распространено), то такой порт ре-<br>
монту не подлежит (по крайней мере в обычных условиях).<br>
Неисправный СОМ-порт, установленный на системной плате,<br>
можно попытаться отключить в BIOS SETUP, но порт мог<br>
сгореть и вместе со схемой своего отключения - тогда он<br>
останется "живым мертвецом" в карте портов ввода/вывода<br>
и прерываний. Иногда он полностью выводит из строя сис-<br>
темную плату.</font>

<p>
<font face="Times New Roman" size=2>Источниками ошибок могут являться <i>разъемы</i> и <i>кабели.<br>
</i>В разъемах встречаются плохие контакты, а кабели кроме воз-<br>
можных обрывов могут иметь плохие частотные характери-<br>
стики. Частотные свойства кабелей обычно сказываются при<br>
большой длине (десятки метров) на высоких скоростях об-<br>
мена (56 или 115 Кбит/с). При необходимости использова-<br>
ния длинных кабелей на высоких скоростях сигнальные про-<br>
вода данньк должны быть перевиты с отдельными проводами<br>
"схемной земли".</font>

<p>
<font face="Times New Roman" size=2><b>Питание от интерфейса, или Почему может не работать мышь</b></font>

<p>
<font face="Times New Roman" size=2>При подключении к СОМ-порту устройств с небольшим энер-<br>
гопотреблением возникает соблазн использования питания от<br>
выходных линий интерфейса. Если линии управления DTR и<br>
RTS не используются по прямому назначению, их можно за-<br>
действовать как питающие с напряжением около 12 В. Ток<br>
короткого замыкания на "схемную землю" ограничен буфер-<br>
ной микросхемой передатчика на уровне 20 мА. При иници-<br>
ализации порта эти линии переходят в состояние "выключе-<br>
но", то есть вырабатывают <i>положительное</i> напряжение. Линия<br>
TD в покое находится в состоянии логической единицы, так<br>
что на выходе вырабатывается <i>отрицательное</i> напряжение.<br>
Потенциалами линий можно управлять через регистры СОМ-<br>
порта (выход TD вырабатывает положительное напряжение,<br>
если установить бит <i>BRCON).</i></font>
<hr>

<p>
<font face="Times New Roman" size=2>Двуполярным питанием от линий интерфейса (+V от DTR и<br>
RTS, -V от TD) пользуются все манипуляторы, подключае-<br>
мые к СОМ-портам. Зная это, в случае неработоспособнос-<br>
ти мыши с данным портом следует проверить напряжения<br>
на соответствующих контактах разъема. Бывает, что с конк-<br>
ретным портом не работает только конкретная мышь (мо-<br>
дель или экземпляр), хотя другие мыши с этим портом и<br>
эти же мыши с другими портами работают нормально. Здесь<br>
дело может быть в уровнях напряжений. Стандарт требует<br>
от порта выходного напряжения не менее 5 В (абсолютного<br>
значения), и, если данный порт обеспечивает только этот<br>
минимум, некоторым мышам не хватит мощности для пита-<br>
ния светодиодов (главных потребителей энергии).</font>

<p>
<font face="Times New Roman" size=2>Порт получает двуполярное питание через системную плату<br>
от блока питания компьютера. Отсутствие на выходе блока<br>
питания напряжения +12 В обычно обнаружится по нера-<br>
ботоспособности дисков. Отсутствие напряжения -12 В "за-<br>
метят" только устройства, подключенные к СОМ-портам.<br>
Блок питания теоретически контролирует наличие этих на-<br>
пряжений на своем выходе (сообщая о неполадках сигна-<br>
лом Power Good, вызывающим аппаратный сброс). Встреча-<br>
ются упрощенные схемы блоков питания, у которых<br>
контролируются не все напряжения. Кроме того, возможны<br>
плохие контакты в разъеме подключения питания к систем-<br>
ной плате.</font>

<p>
<font face="Times New Roman" size=3><b>2.5.5. Функции BIOS для СОМ-портов</b></font>

<p>
<font face="Times New Roman" size=2>В процессе начального тестирования POST BIOS проверяет<br>
наличие последовательных портов (регистров UART 8250 или<br>
совместимых) по стандартным адресам и помещает базовые<br>
адреса обнаруженных портов в ячейки <i>BIOS Data<br>
Area</i> 0:0400, 0402, 0404, 0406. Эти ячейки хранят адреса пор-<br>
тов с логическими именами <i>СОМ 1-COM4.</i> Нулевое значе-<br>
ние адреса является признаком отсутствия порта с данным<br>
номером. В ячейки 0:047С, 047D, 047Е, 047F заносятся кон-<br>
станты, задающие тайм-аут для портов.</font>

<p>
<font face="Times New Roman" size=2>Обнаруженные порты <i>инициализируются</i> на скорость обме-<br>
на 2400 бит/с, 7 бит данных с контролем на четность</font>
<hr>

<p>
<font face="Times New Roman" size=2>(even), 1 стоп-бит. Управляющие сигналы интерфейса DTR<br>
и RTS переводятся в исходное состояние ("выключено" -<br>
положительное напряжение).</font>

<p>
<font face="Times New Roman" size=2>Порты поддерживаются <i>сервисом BIOS INT 14h,</i> который обес-<br>
печивает следующие функции:</font>

<p>
<font face="Times New Roman" size=2>^ ООЬ - <i>инициализация</i> (установка скорости обмена и фор-<br>
мата посылок, заданных регистром <i>AL;</i> запрет источни-<br>
ков прерываний). На сигналы DTR и RTS влияния не ока-<br>
зывает (после аппаратного сброса они пассивны).</font>

<p>
<font face="Times New Roman" size=2>^ Olh - <i>вывод символа</i> из регистра <i>AL</i> (без аппаратных пре-<br>
рываний). Активируются сигналы DTR и RTS, и после<br>
освобождения регистра <i>THR</i> в него помещается выводи-<br>
мый символ. Если за заданное время регистр не освобож-<br>
дается, фиксируется ошибка тайм-аута и функция завер-<br>
шается.</font>

<p>
<font face="Times New Roman" size=2>^ 02h - <i>ввод символа</i> (без аппаратных прерываний). Акти-<br>
вируется только сигнал DTR (RTS переходит в пассивное<br>
состояние), и ожидается готовность принятых данных,<br>
принятый символ помещается в регистр <i>AL.</i> Если за за-<br>
данное время данные не получены, функция завершает-<br>
ся с ошибкой тайм-аута.</font>

<p>
<font face="Times New Roman" size=2>^ 03h - <i>опрос состояния</i> модема и линии (чтение регист-<br>
ров <i>MSR</i> и <i>LSR).</i> Эту гарантированно быструю функцию<br>
обычно вызывают перед функциями ввода/вывода во из-<br>
бежание риска ожидания тайм-аута.</font>

<p>
<font face="Times New Roman" size=2>При вызове <i>INT 14h</i> номер функции задается в регистре <i>АН,<br>
</i>номер порта (0-3) - в регистре DX(0 - <i>СОМ 1,</i> 1 - <i>COM2...).<br>
</i>При возврате из функций 0,1 и 3 регистр <i>АН</i> содержит <i>байт<br>
состояния линии</i> (регистр <i>LSR), AL - байт состояния моде-<br>
ма (MSR).</i> При возврате из функции 2 нулевое значение<br>
бита 7 регистра <i>АН</i> указывает на наличие принятого симво-<br>
ла в регистре <i>AL',</i> ненулевое значение бита 7 - на ошибку<br>
приема, которую можно уточнить функцией 3.</font>

<p>
<font face="Times New Roman" size=2><b>Формат байта состояния линии (регистр <i>АН):</b></i></font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 7 - ошибка тайм-аута (после вызова функции 2 -<br>
признак любой ошибки).</font>
<hr>

<p>
<font face="Times New Roman" size=2>^ Бит 6 - регистр сдвига передатчика пуст (пауза передачи).</font>

<p>
<font face="Times New Roman" size=2>^ Бит 5 - промежуточный регистр передатчика пуст (го-<br>
 тов принять символ для передачи).</font>

<p>
<font face="Times New Roman" size=2>SB Бит 4 - обнаружен обрыв линии.</font>

<p>
<font face="Times New Roman" size=2>вя Бит 3 - ошибка кадра (отсутствие стоп-бита).</font>

<p>
<font face="Times New Roman" size=2>а? Бит 2 - ошибка паритета принятого символа.</font>

<p>
<font face="Times New Roman" size=2><i>ш </i>Бит 1 - переполнение (потеря символа).</font>

<p>
<font face="Times New Roman" size=2>^ Бит 0 - регистр данных содержит принятый символ.</font>

<p>
<font face="Times New Roman" size=2><b>Формат байта состояния модема (регистр <i>AL):</b></i></font>

<p>
<font face="Times New Roman" size=2><i>^ </i>Бит 7 - состояние линии DCD.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 6 - состояние линии RI.</font>

<p>
<font face="Times New Roman" size=2>?й Бит 5 - состояние линии DSR.</font>

<p>
<font face="Times New Roman" size=2>si Бит 4 - состояние линии CTS.</font>

<p>
<font face="Times New Roman" size=2><i>т </i>Бит 3 - изменение состояния DCD.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 2 - изменение огибающей RI.</font>

<p>
<font face="Times New Roman" size=2>as Бит 1 - изменение состояния DSR.</font>

<p>
<font face="Times New Roman" size=2>ss Бит 0 - изменение состояния CTS.<br>
<b>Формат регистра</b> <i>AL<b></i> при инициализации:</b></font>

<p>
<font face="Times New Roman" size=2>^ Биты [7:5] - скорость обмена:</font>

<p>
<font face="Times New Roman" size=2>000-110; 010-300; 100-1200; 110-4800,</font>

<p>
<font face="Times New Roman" size=2>001-150; 011-600; 101-2400; 111-9600 бит/с.<br>
^ Биты [4:3] - контроль паритета:</font>

<p>
<font face="Times New Roman" size=2>01 - число единиц нечетное,</font>

<p>
<font face="Times New Roman" size=2>11 -четное,</font>

<p>
<font face="Times New Roman" size=2>00 и 10 - без контроля.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 2 - количество стоп-бит: 0-1 бит, 1-2 бита<br>
 (на скорости 110 бит/с - 1,5 стоп-бита).</font>

<p>
<font face="Times New Roman" size=2><i>т </i>Биты [1:0] - длина посылки: 00-5 бит, 01-6 бит,<br>
 10-7 бит, 11-8 бит.</font>
<hr>

<p>
<font face="Times New Roman" size=3><b>2.5.6. СОМ-порт и РпР</b></font>

<p>
<font face="Times New Roman" size=2>Современные ПУ, подключаемые к СОМ-порту, могут под-<br>
держивать спецификацию РпР. Основная задача ОС заклю-<br>
чается в идентификации подключенного устройства, для чего<br>
разработан несложный протокол, реализуемый на любых<br>
СОМ-портах чисто программным способом (рис. 2.18):</font>

<p>
<img border=0 vspace=3 hspace=3 src="217.jpg"alt="217.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 2.18.</b> Запрос идентификатора устройства РпР</font>

<p>
<font face="Times New Roman" size=2>1. Порт инициализируется с состоянием линий DTR=OA/,<br>
RTS=OFF, <i>TXD=Mark -</i> состояние покоя (Idle).</font>

<p>
<font face="Times New Roman" size=2>2. Некоторое время (0,2 с) ожидается появление сигнала<br>
DSR, которое указало бы на наличие устройства, подклю-<br>
ченного к порту. В простейшем случае устройство имеет<br>
на разъеме перемычку DTR-DSR, обеспечивающую ука-<br>
занный ответ. Если устройство обнаружено, выполняют-<br>
ся манипуляции управляющими сигналами DTR и RTS<br>
для получения информации от устройства. Если ответ не<br>
получен, ОС, поддерживающая динамическое реконфи-<br>
гурирование, периодически опрашивает состояние порта<br>
для обнаружения новых устройств.</font>

<p>
<font face="Times New Roman" size=2>3. Порт программируется на режим 1200 бит/с, 7 бит дан-<br>
ных, без паритета, 1 стоп-бит, и на 0,2 с снимается сиг-<br>
нал DTR. После этого устанавливается DTR=1, а еще<br>
через 0,2 с устанавливается и RTS=1.</font>

<p>
<font face="Times New Roman" size=2>4. В течение 0,2 с ожидается приход первого символа от ус-<br>
тройства. По приходе символа начинается прием иден-<br>
тификатора (см. ниже). Если за это время символ не<br>
пришел (рис. 2.18), выполняется вторая попытка опроса<br>
(см. п. 5), несколько отличающаяся от первой.</font>

<p>
<font face="Times New Roman" size=2>5. На 0,2 с снимаются оба сигнала (DTR=0 и RTS=0), после<br>
чего они оба устанавливаются (DTR=1 и RTS==1).</font>
<hr>

<p>
<font face="Times New Roman" size=2>6. В течение 0,2 с ожидается приход первого символа от ус-<br>
тройства, по приходе символа начинается прием иденти-<br>
фикатора (см. ниже). Если за это время символ не пришел,<br>
то в зависимости от состояния сигнала DSR переходят к<br>
проверке отключения <i>Verify Disconnect</i> (при DSR^O) или<br>
в дежурное состояние <i>Connect Idle</i> (при DSR=1).</font>

<p>
<font face="Times New Roman" size=2>7. В дежурном состоянии <i>Connect Idle</i> устанавливается<br>
DTR=1, RTS=0, порт программируется на режим 300 бит/с,<br>
7 бит данных, без паритета, 1 стоп-бит. Если в этом со-<br>
стоянии обнаружится DSR=0, ОС следует уведомить об<br>
отключении устройства.</font>

<p>
<font face="Times New Roman" size=2>Посимвольный прием идентификатора устройства имеет<br>
ограничения по тайм-ауту в 0,2 с на символ, а также общее<br>
ограничение в 2,2 с, позволяющее принять строку длиной до<br>
256 символов. Строка идентификатора РпР должна иметь мар-<br>
керы начала (28h или 08h) и конца (29h или 09h), между ко-<br>
торыми располагается тело идентификатора в стандарти-<br>
зованном формате. Перед маркером начала может находиться<br>
до 16 символов, не относящихся к идентификатору РпР. Если<br>
за первые 0,2 с ожидания символа (шаг 4 или 6) маркер на-<br>
чала не пришел, или же сработал тайм-аут, а маркер конца не<br>
получен, или же какой-либо символ принят с ошибкой, про-<br>
исходит переход в состояние <i>Connect Idle.</i> Если получена кор-<br>
ректная строка идентификатора, она передается ОС.</font>

<p>
<font face="Times New Roman" size=2>Для <i>проверки отключения (Verify Disconnect)</i> устанавливает-<br>
ся DTR=1, RTS=0 и через 5 с проверяется состояние сигнала<br>
DSR. При DSR=1 происходит переход в состояние <i>Connect<br>
Idle</i> (см. п. 7), при DSR^O происходит переход в состояние<br>
<i>Disconnect Idle,</i> в котором система может периодически<br>
опрашивать сигнал DSR для обнаружения подключения уст-<br>
ройства.</font>

<p>
<font face="Times New Roman" size=2>Описанный механизм разрабатывался фирмой Microsoft с<br>
учетом совместимости с не-РпР-устройствами - невозмож-<br>
ность их вывода из строя и устойчивость системы к сообще-<br>
ниям, не являющимся РпР-идентификаторами. Например,<br>
обычная Microsoft Mouse при включении питания от интер-<br>
фейса ответит ASCII-символом "М" (трехкнопочная - стро-<br>
кой "МЗ").</font>
<HR>
<TABLE WIDTH=100%>
<TR>
<TD align=right valign=top> 
<p>
<DIV ALIGN=center><i><h5>Электронная библиотека InfoCity</i></h5></DIV>
<DIV ALIGN=center><i><h5>Автор и координатор проекта:<a href=mailto:mpinkus@mail.ru>Михаил Пинкус</a></i></h5></DIV>
<DIV ALIGN=center><i><h5>У Вас есть документация, которой нет в нашей библиотеке? <a href="mailto:icity@mail.ru?subject=InfoCity - Doc">Присылайте.</a></h5>
</TD>
</TR></table>
</body>
</html>
