<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>6.htm</title>
<meta http-equiv="Content-Type" content="text/html;charset=windows-1251">
</head>
<body background="back1.jpg">

<p>
<font face="Times New Roman" size=5><b>6. Интерфейс АТА</b></font>

<p>
<font face="Times New Roman" size=2>Интерфейс <i>АТА- AT Attachment for Disk Drives -</i> разрабаты-<br>
вался в 1986-1990 гг. для подключения накопителей на жест-<br>
ких магнитных дисках к компьютерам IBM PC AT с шиной<br>
ISA. Стандарт, выработанный комитетом ХЗТ10, определя-<br>
ет набор регистров и назначение сигналов 40-контактного<br>
интерфейсного разъема. Интерфейс появился в результате<br>
переноса контроллера жесткого диска ближе к накопителю,<br>
то есть создания устройств со встроенным контроллером -<br>
<i>IDE (Integrated Device Electronic).</i> Стандартный для AT кон-<br>
троллер жесткого диска был перенесен на плату электрони-<br>
ки накопителя с сохранением регистровой модели. При этом<br>
удлинилась связь с устройством со стороны системной шины,<br>
которую непосредственно выводить на длинный ленточный<br>
кабель было нецелесообразно. Это сказалось бы на скорости<br>
работы шины, надежности и цене. Из всех сигналов шины<br>
ISA выбрали минимальный набор сигналов, часть из кото-<br>
рых буферизовали на небольшой плате, устанавливаемой в<br>
слот, а часть направили прямо на разъем ленточного кабеля<br>
нового интерфейса. Из сигналов системной шины потребо-<br>
вались следующие:</font>

<p>
<font face="Times New Roman" size=2>^ шина данных - используется полностью;</font>

<p>
<font face="Times New Roman" size=2><i>т</i> шина адреса - 3 младших бита поступают в интерфейс,<br>
старшие биты и сигнал AEN проходят через дешифратор,<br>
вырабатывающий сигналы выбора устройства CSO# и<br>
CS1#;</font>

<p>
<font face="Times New Roman" size=2>^ шина управления - используются сигналы чтения и за-<br>
писи портов и аппаратного сброса, запрос прерывания,<br>
пара сигналов канала DMA, сигналы готовности и<br>
управления разрядностью передачи.</font>

<p>
<font face="Times New Roman" size=2>Поскольку стандартный контроллер AT позволял подклю-<br>
чать до двух накопителей, эту возможность получил и ин-<br>
терфейс АТА. Однако теперь два накопителя стали означать<br>
и два контроллера. Их подключили к одной интерфейсной</font>
<hr>

<p>
<font face="Times New Roman" size=2>шине, а для программной совместимости бит выбора нако-<br>
пителя <i>(DEV)</i> в регистре номера головки и номера устрой-<br>
ства <i>(Drive/Head register)</i> стали использовать для выбора ус-<br>
тройства. Для взаимодействия пары устройств на шине ввели<br>
несколько дополнительных сигналов. Так появился интерфейс<br>
<i>АТА</i> для подключения устройств IDE к шине ISA. Позже их<br>
стали подключать и к локальным шинам, но набор сигналов<br>
интерфейса и протоколы обмена сохранились. Достаточно<br>
универсальный набор сигналов позволяет подключать любое<br>
устройство со встроенным контроллером, которому в про-<br>
странстве портов ввода/вывода достаточно того же набора<br>
регистров и которое способно поддержать режим выбора уст-<br>
ройства через вышеупомянутый бит. Принятая система ко-<br>
манд и регистров, являющаяся частью спецификации АТА,<br>
ориентирована на блочный обмен данными с устройствами<br>
прямого доступа. Для иных устройств существует специфи-<br>
кация <i>ATAPI,</i> основанная на тех же аппаратных средствах, но<br>
позволяющая обмениваться пакетами управляющей инфор-<br>
мации <i>(PI - Package Interface).</i> Пакетный интерфейс позво-<br>
ляет расширить границы применения шины АТА.</font>

<p>
<font face="Times New Roman" size=2><i>Адресация</i> в АТА тоже имеет "дисковые корни": для нако-<br>
пителей изначально указывали адрес цилиндра (Cylinder),<br>
головки (Head) и сектора (Sector) - так называемая <i>трех-<br>
мерная адресация CHS.</i> Позже по ряду причин стали разли-<br>
чать <i>физическую</i> (реальную для накопителя) и <i>логическую<br>
</i>(по которой с устройством общается программа) <i>адресацию<br>
CHS.</i> При этом одно и то же устройство могло иметь раз-<br>
личную  <i>логическую  геометрию</i>   (но,   естественно,<br>
CxHxSnor &lt; CxHxStjHo). Преобразование логической адреса-<br>
ции в физическую выполняется встроенным контроллером<br>
устройства. Позже пришли к <i>линейной адресации логических<br>
блоков LBA</i> (Logical Block Addressing), где адрес блока (сек-<br>
тора) определяется 28-битным числом.</font>

<p>
<font face="Times New Roman" size=2>В спецификации АТА фигурируют следующие компоненты:</font>

<p>
<font face="Times New Roman" size=2>^ <i>Хост-адаптер -</i> средства сопряжения интерфейса АТА с<br>
системной шиной (набор буферных схем между шинами<br>
ISA и АТА). <i>Хостом</i> мы будем называть компьютер с хост-<br>
адаптером интерфейса АТА.</font>
<hr>

<p>
<font face="Times New Roman" size=2>^ <i>Кабель-шлейф с</i> двумя или тремя 40-контактными IDC-<br>
разъемами. В стандартном кабеле одноименные контак-<br>
ты всех разъемов соединяются вместе.</font>

<p>
<font face="Times New Roman" size=2>^ <i>Ведущее устройство</i> (Master) - ПУ, в спецификации АТА<br>
официально называемое <i>Device-0</i> (устройство 0).</font>

<p>
<font face="Times New Roman" size=2>^ <i>Ведомое устройство</i> (Slave) - ПУ, в спецификации офи-<br>
циально называемое D^ice-У (устройство 1).</font>

<p>
<font face="Times New Roman" size=2>Если к шине АТА подключено одно устройство, оно должно<br>
быть ведущим. Если подключены два устройства, одно долж-<br>
но быть ведущим, другое - ведомым. О своей роли (ведущее<br>
или ведомое) устройства "узнают" с помощью предваритель-<br>
но установленных конфигурационных джамперов. Если при-<br>
меняется "кабельная выборка" (см. ниже), роль устройства<br>
определяется его положением на специальном кабеле-шлейфе.</font>

<p>
<font face="Times New Roman" size=2>Оба устройства воспринимают команды от хост-адаптера од-<br>
новременно. Однако исполнять команду будет лишь <i>выбран-<br>
ное</i> устройство. Если бит <i>DEV^O,</i> выбрано ведущее устрой-<br>
ство, если DЈV=1 - ведомое. Выходные сигналы на шину АТА<br>
имеет право выводить только выбранное устройство. Такая<br>
система подразумевает, что, <i>начав операцию обмена с одним<br>
из устройств, хост-адаптер не может переключиться на об-<br>
служивание другого</i> до завершения начатой операции. Парал-<br>
лельно могут работать только устройства IDE, подключаемые<br>
к разным шинам (каналам) АТА. Спецификация АТА-4 оп-<br>
ределяет способ обхода этого ограничения (см. 6.6).</font>

<p>
<font face="Times New Roman" size=2>Выполняемая операция и направление обмена данными меж-<br>
ду устройством и хост-адаптером определяются предвари-<br>
тельно записанной <i>командой.</i> Непременным компонентом ус-<br>
тройства является <i>буферная память.</i> Ее наличие позволяет<br>
выполнять обмен данными в темпе, предлагаемом хост-адап-<br>
тером (в пределах возможности устройства), без оглядки на<br>
внутреннюю скорость передачи данных между носителем и<br>
буферной памятью ПУ.</font>

<p>
<font face="Times New Roman" size=2>Для подключения устройств IDE существует несколько <i>раз-<br>
новидностей интерфейса:</i></font>

<p>
<font face="Times New Roman" size=2>^ АТА, он же AT-BUS - 16-битный интерфейс подключения<br>
к шине компьютера AT. Наиболее распространенный</font>

<p>
<font face="Times New Roman" size=1>8 Зак.№530</font>
<hr>

<p>
<font face="Times New Roman" size=2>40-проводной сигнальный и 4-проводной питающий интер-<br>
фейс для подключения дисковых накопителей к компью-<br>
терам AT. Для миниатюрных (2,5&quot; и менее) накопителей<br>
используют 44-проводной кабель, по которому передается<br>
и питание.</font>

<p>
<font face="Times New Roman" size=2>^ PC Card ATA - 16-битный интерфейс с 68-контактным<br>
разъемом PC Card (PCMCIA) для подключения к блок-<br>
нотным PC.</font>

<p align=center>
<font face="Times New Roman" size=2><i>т</i> XT IDE (8-бит), он же XT-BUS - 40-проводный интер-<br>
фейс, похожий на ATA, но несовместимый с ним.</font>

<p align=center>
<font face="Times New Roman" size=2>^ МСА IDE (16-бит) - 72-проводный интерфейс, предназ-<br>
наченный специально для шины и накопителей PS/2.</font>

<p>
<font face="Times New Roman" size=2>^ <i>АТА-2 -</i> расширенная спецификация ATA. Включает 2 ка-<br>
нала, 4 устройства, PIO Mode 3, multiword DMA mode 1,<br>
Block mode, объем диска до 8 Гбайт, поддержка LBA и CHS.</font>

<p>
<font face="Times New Roman" size=2><i>ш Fast АТА-2</i> разрешает использовать Multiword DMA<br>
Mode 2 (13,3 Мбайт/с), PIO Mode 4.</font>

<p>
<font face="Times New Roman" size=2>^ <i>АТА-3 -</i> расширение АТА-2. Включает средства парольной<br>
защиты, улучшенного управления питанием, самотести-<br>
рования с предупреждением приближения отказа -<br>
SMART (Self Monitoring Analysis and Report Technology).</font>

<p>
<font face="Times New Roman" size=2>^ <i>ATA/ATAPI-4 -</i> расширение АТА-3, включающее режим<br>
<i>Ultra DMA</i> со скоростью обмена до 33 Мбайт/с и пакет-<br>
ный интерфейс ATAPI.</font>

<p>
<font face="Times New Roman" size=2>^ <i>E-IDE(EnhancedЮЕ) -</i> расширенный интерфейс, введенный<br>
фирмой Western Digital. Реализуется в адаптерах для шин<br>
PCI и VLB. Позволяет подключать до 4 устройств (к двум<br>
каналам), включая CD-ROM и стриммеры (ATAPI). Поддер-<br>
живает PIO Mode 3, multiword DMA mode 1, объем диска<br>
до 8 Гбайт, LBA и CHS. С аппаратной точки зрения прак-<br>
тически полностью соответствует спецификации АТА-2.</font>

<p>
<font face="Times New Roman" size=2>Устройства ATA IDE, E-IDE, АТА-2, Fast АТА-2, АТА-3 и ATA/<br>
ATAPI-4 электрически совместимы. Степень логической со-<br>
вместимости достаточно высока (все базовые возможности<br>
ATA доступны). Однако для полного использования всех рас-<br>
ширений необходимо соответствие спецификаций устройств,<br>
хост-адаптера и его ПО. В настоящее время наиболее широко</font>
<hr>

<p>
<font face="Times New Roman" size=2>распространен и четко стандартизован интерфейс, официаль-<br>
но называемый <i>А ТА -2, о</i> котором в основном и пойдет речь.</font>

<p>
<font face="Times New Roman" size=4><b>6.1. Электрический интерфейс</b></font>

<p>
<font face="Times New Roman" size=2>Все информационные сигналы интерфейса передаются через<br>
40-контактный разъем, у которого ключом является отсут-<br>
ствующий на вилке и закрытый на розетке контакт № 20. Ис-<br>
пользование в качестве ключа выступа на корпусе розетки и<br>
прорези в бандаже вилки стандартом не приветствуется. Для<br>
соединения устройств спецификация требует применения<br>
плоского многожильного кабеля (Flat cable stranded 28 AWG)<br>
типа ЗМ 3365-40 или эквивалентного. Возможно применение<br>
экранированного кабеля (Flat cable stranded 28 AWG ЗМ 3517-<br>
40 shielded). Длина кабеля не должна превышать 0,46 м (18&quot;),<br>
допустимая емкость проводников не более 35 пФ. Термина-<br>
торы стандартом не предусматриваются (они имеются в каж-<br>
дом устройстве и хост-адаптере), но если кабель с тремя разъе-<br>
мами (розетками) используют для подключения одного<br>
устройства, то и его, и хост-адаптер рекомендуется подклю-<br>
чать к противоположным концам кабеля. Состав информа-<br>
ционных сигналов интерфейса АТА приведен в табл. 6.1. Все<br>
сигналы АТА являются логическими со стандартными ТТЛ-<br>
уровнями. Вид кабеля приведен на рис. 6.1. Одноименные<br>
контакты всех разъемов соединяются своими проводами.<br>
Встречается (редко) шлейф с кабельной выборкой (рис. 6.2).<br>
В нем провод 28 в шлейфе перерезан, так что контакт 28<br>
<i>(CSEL)</i> для ведущего устройства заземлен через хост-адаптер,<br>
а для ведомого - не подключен. Кабель должен соответство-<br>
вать системе адресации, выбранной для обоих устройств. Для<br>
устойчивой работы в режиме Ultra DMA рекомендуется при-<br>
менение 80-проводных кабелей, обеспечивающих чередование<br>
сигнальных цепей и проводов схемной земли (эти кабели<br>
"разделываются" на обычные 40-контактные разъемы).<br>
Устройства и адаптеры, рассчитанные на использование Ultra<br>
DMA, должны иметь в сигнальных цепях последовательные<br>
согласующие резисторы с сопротивлением для различных це-<br>
пей 22, 33 или 82 Ом. Спецификация АТА "узаконивает"<br>
40-контактный сигнальный и 4-контактный разъемы пита-<br>
ния (рис. 6.36), но для малогабаритных устройств питание<br>
может подаваться по 44-проводному интерфейсному кабелю.</font>
<hr>

<p>
<img border=0 vspace=3 hspace=3 src="61.jpg"alt="61.jpg">
<br clear=all>


<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Сигнал</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Тип1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контакт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контакт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Тип1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Сигнал</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>RESET*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DD8</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DD9</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DD10</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Сигнал</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Тип1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контакт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контакт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Тип'</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Сигнал</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>10</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DD 11</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>11</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>12</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DD12</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>13</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>14</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DD13</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD 1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>15</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>16</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DD14</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DDO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>17</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>18</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DD15</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>19</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>20</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Клкм<br>
(нет штырька)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DMARQ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OTS2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>21</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>22</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DIOW#<br>
/STOP3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>23</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>24</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DIOFW<br>
/HDMARDY#<br>
/HSTROBE з</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>25</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>26</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IORDY<br>
/DDMARDY*<br>
/DSTROBE 3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OTS2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>27</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>28</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/O</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SPSYNC/CSEL</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DMACK#</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>29</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>30</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>INTRQ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OTS2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>31</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>32</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ООК</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>IOCS16#</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DA1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>33</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>34</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I.04</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PDIAG#<br>
/CBLID з</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DAO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>35</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>36</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DA 2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>CSO#</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>37</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>38</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CS1#</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DASP#</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/O OK5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>39</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>40</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>+5 В (Logic)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>416</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>426</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>+5 В (Motor)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>436</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>446</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервирован</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>) Тип сигнала для устройства: I - вход, О - выход, I/O - двунаправ-<br>
ленный, TS - трйстабильный, ОС - открытый коллектор.</font>

<p>
<font face="Times New Roman" size=2>2 У старых устройств сигнал может иметь тип ОС (при разнотипных<br>
сигналах на одной шине возможен конфликт).</font>

<p>
<font face="Times New Roman" size=2>3 Сигналы, приведенные после символа /, используются только в режиме<br>
Ultra DMA (ATA-4).</font>

<p>
<font face="Times New Roman" size=2>4 У ведущего устройства - вход, у ведомого - выход.</font>

<p>
<font face="Times New Roman" size=2>5 У ведомого устройства - только выход.</font>

<p>
<font face="Times New Roman" size=2>6 Контакты 41-44 используются только для миниатюрных дисков.</font>
<hr>

<p>
<font face="Times New Roman" size=2>В документации на устройства могут применяться несколь-<br>
ко отличающиеся обозначения сигналов. Здесь приведены<br>
обозначения из стандарта ATA/ATAPI-4. Сигналы имеют<br>
следующее назначение:</font>

<p>
<font face="Times New Roman" size=2>RESET# (Device reset) - сброс устройства (инвертированный<br>
сигнал сброса системной шины). Сигнал длительностью не<br>
менее 25 мкс вырабатывается после установления питающих<br>
напряжений.</font>

<p>
<font face="Times New Roman" size=2>DA[2:0] (Device Address) - три младших бита системной<br>
шины адреса, используемые для выбора регистров устройств.</font>

<p>
<font face="Times New Roman" size=2>DD[15:0] (Device Data) -двунаправленная 16-битная шина<br>
данных между адаптером и устройствами. При 8-битных<br>
обменах используются младшие биты D[7:0].</font>

<p>
<font face="Times New Roman" size=2>DIOFW (Device I/O Read) - строб чтения портов ввода/вы-<br>
вода. Данные фиксируются по положительному перепаду<br>
сигнала.</font>

<p>
<font face="Times New Roman" size=2>DIOW# (Device I/O Write) - строб записи портов ввода/вы-<br>
вода. Данные фиксируются по положительному перепаду<br>
сигнала.</font>

<p>
<font face="Times New Roman" size=2>IORDY (I/O channel ready) - готовность устройства завер-<br>
шить цикл обмена. Низким уровнем сигнала во время цик-<br>
ла обмена устройство может ввести такты ожидания шины.<br>
Сигнал требуется при обмене в РЮ MODE 3 и выше.</font>

<p>
<font face="Times New Roman" size=2>IOCS16# - разрешение 16-битных операций. Обращение ко<br>
всем регистрам, кроме регистра данных, всегда 8-битное. Для<br>
PIO MODE О, 1, 2 при активном сигнале обращения 16-бит-<br>
ные, при неактивном - 8-битные. Для PIO MODE 3, 4 и<br>
DMA все обмены 16-битные, кроме дополнительных байт<br>
(выходящих за границу 512-байтного сектора) "длинного"<br>
считывания и записи.</font>

<p>
<font face="Times New Roman" size=2>DMARQ (DMA ReQuest) - запрос обмена по каналу DMA (сиг-<br>
нал необязательный). При разрешении обмена сигнал (высо-<br>
кий уровень) вводится устройством по готовности к обмену.<br>
Введя сигнал DMARQ, устройство должно дождаться подтвер-<br>
ждения от хост-адаптера сигналом DMACK#, после чего мо-<br>
жет снять запрос DMARQ. Для очередной передачи запрос дол-<br>
жен быть введен снова. В режиме <i>Multi-Word DMA</i> запрос может</font>
<hr>

<p>
<font face="Times New Roman" size=2>удерживаться на время передачи всех данных. Выход должен<br>
быть тристабильным, в активном состоянии (0 или 1) он<br>
может быть только у выбранного устройства во время рабо-<br>
ты с DMA. В АТА-1 для этого сигнала мог использоваться<br>
как тристабильный, так и стандартный ТТЛ-выход. Работа<br>
на одной шине устройств с разнотипными выходами DMARQ<br>
может привести к конфликтам.</font>

<p>
<font face="Times New Roman" size=2>DMACK# (DMA aCKnowledge) - подтверждение DMA. Сиг-<br>
нал вырабатывается хост-адаптером как подтверждение цикла<br>
передачи. Передача слова данных управляется сигналами<br>
DIOR# или DIOW#. Во время обмена по каналу DMA сигна-<br>
лы IOCS16#, CSO# и CS1# не используются, обмен всегда<br>
производится 16-битными словами.</font>

<p>
<font face="Times New Roman" size=2>INTRQ (Device interrupt) - запрос прерывания. Выход дол-<br>
жен быть тристабильным, активный сигнал (логическую 1)<br>
вырабатывает только выбранное устройство, когда у него<br>
имеется необслуженный запрос прерывания и его выраба-<br>
тывание не запрещено битом <i>nIEN</i> в регистре <i>Device Control.<br>
</i>Запрос сбрасывается по сигналу RESET#, установке бита<br>
<i>SRST</i> в регистре <i>Device Control,</i> записи в регистр команд или<br>
чтении регистра состояния. При обменах PIO запрос уста-<br>
навливается в начале передачи каждого блока (сектора или<br>
группы секторов при многосекторных операциях). Ис-<br>
ключения: по командам <i>Format Track, Write Sector(S), Write<br>
Buffer</i> и <i>Write Long</i> в начале передачи первого блока данных<br>
запрос прерывания не вырабатывается. При обменах DMA<br>
запрос прерывания вырабатывается только по завершении<br>
операции.</font>

<p>
<font face="Times New Roman" size=2>CSO# (СЫр Select 0) - сигнал выбора блока командных ре-<br>
гистров <i>(Command Block Registers).</i> Для первого канала он<br>
вырабатывается при наличии на системной шине адреса пор-<br>
та ввода/вывода в диапазоне lFOh~lF7h (сигнал также на-<br>
зывают CS1FX#).</font>

<p>
<font face="Times New Roman" size=2>CS1# (Chip Select 1) - выбор блока управляющих регист-<br>
ров <i>(Control Block Registers).</i> Для первого канала он выраба-<br>
тывается при наличии на системной шине адреса порта<br>
ввода/вывода в диапазоне 3F6h-3F7h (часто этот сигнал на-<br>
зывается CS3FX#/</font>
<hr>

<p>
<font face="Times New Roman" size=2>PDIAGft (Passed diagnostics) - сигнал о прохождении диаг-<br>
ностики. Ведущее устройство наблюдает за этим сигналом,<br>
который ведомое устройство должно выработать в ответ на<br>
сброс или команду диагностики. Если ведомое устройство<br>
обнаружено (по сигналу DASP#), ведущее устройство ожи-<br>
дает сигнал в течение 31с после сброса и 6 с после команды<br>
диагностики. Если за это время сигнал не появился, веду-<br>
щее устройство отмечает этот факт установкой бита 7 реги-<br>
стра ошибок. Если ведомое устройство не обнаружено, ве-<br>
дущее обнуляет регистр состояния ведомого устройства и<br>
сообщает свое состояние сразу после завершения собствен-<br>
ной самодиагностики. Сигнал служит только для связи двух<br>
устройств и хост-адаптером не используется (в АТА-4 кон-<br>
такт задействован для сигнала CBLID#).</font>

<p>
<font face="Times New Roman" size=2>CBUD# (Cable assembly type identifier) - идентификация типа<br>
кабеля. В 80-проводной сборке контакт 34 на разъеме хост-<br>
адаптера соединяется с шиной GND, а контакты 34 разъемов<br>
устройств соединяются между собой, но связи с разъемом<br>
хост-адаптера не имеют. После прохождения сброса (когда<br>
сигнал PDIAG# снимается) хост может определить наличие<br>
80-проводного кабеля по низком/уровню сигнала.</font>

<p>
<font face="Times New Roman" size=2>DASP# (Device Active, Slave Present) - сигнал двойного на-<br>
значения: индикатор активности устройства и присутствия<br>
ведомого устройства. Устройства имеют выход типа "откры-<br>
тый коллектор" с нагрузочным резистором 10 кОм к шине<br>
+5 В. После сброса по сигналу RESET# или при инициали-<br>
зации по включении питания оба устройства в течение 1 мс<br>
должны деактивировать этот сигнал, после чего не позже чем<br>
через 400 мс его вводит ведомое устройство для сообщения<br>
о своем присутствии. Ведущее устройство не активирует этот<br>
сигнал в течение 450 мс. Сигнал деактивируется ведомым<br>
устройством после получения им команды или через 31 с<br>
автоматически (смотря что произойдет раньше). После это-<br>
го сигнал может быть введен любым устройством как инди-<br>
катор активности. Адаптер использует этот сигнал для вклю-<br>
чения светодиодного индикатора доступа к диску.</font>

<p>
<font face="Times New Roman" size=2>SPSYNC/CSEL (Spindle Synchronization/Cable Select) - син-<br>
хронизация шпинделя/выборка кабелем. Сигнал двойного</font>
<hr>

<p>
<font face="Times New Roman" size=2>назначения, которое должно быть единым для обоих уст-<br>
ройств. Сигнал SPSYNC позволяет синхронизировать шпин-<br>
дели устройств (актуально для RAID-массивов); использу-<br>
ется по усмотрению производителя накопителя. Сигнал CSEL<br>
позволяет устройствам определять свой адрес по положению<br>
на специальном кабеле с разрывом провода 28 между разъе-<br>
мами двух устройств (малораспространенная "кабельная<br>
выборка"). Эта линия на хост-адаптере заземлена, и веду-<br>
щее устройство получает заземленную линию, а ведомое -<br>
не подключенную. Состояние сигнала (если он управляется<br>
хост-адаптером) должно удерживаться по крайней мере 31с<br>
после сигнала RESET*.</font>

<p>
<font face="Times New Roman" size=2>При использовании режима <i>Ultra DMA</i> четыре линии полу-<br>
чают новое назначение сигналов:</font>

<p>
<font face="Times New Roman" size=2>^ STOP (Stop Ultra DMA burst) - останов передачи паке-<br>
та Ultra DMA.</font>

<p>
<font face="Times New Roman" size=2>^ DDMARDY# (Device Ultra DMA ready) - готовность ус-<br>
тройства при приеме пакета Ultra DMA (управление по-<br>
током).</font>

<p>
<font face="Times New Roman" size=2>^ DSTROBE (Host Ultra DMA data strobe) - строб данных<br>
устройства при передаче пакета хосту. Данные переда-<br>
ются по обоим перепадам DSTROBE.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> HDMARDY# (Host Ultra DMA ready) - готовность хос-<br>
та при приеме им пакета Ultra DMA (управление по-<br>
током).</font>

<p>
<font face="Times New Roman" size=2>^ HSTROBE (Host Ultra DMA data strobe) - строб данных<br>
хоста при передаче пакета устройству. Данные переда-<br>
ются по обоим перепадам HSTROBE.</font>

<p>
<font face="Times New Roman" size=2>Для компьютеров класса XT существует 8-битная версия ин-<br>
терфейса, называемая <i>XT-IDE,</i> реже - <i>XT-Bus.</i> Этот интер-<br>
фейс (табл. 6.2), как и АТА, реализован на 40-проводном<br>
кабеле, и многие его сигналы совпадают с 16-битной шиной<br>
АТА. Интерфейс XT-IDE можно рассматривать как подмно-<br>
жество АТА, хотя прямой совместимости нет. Ряд устройств<br>
АТА имеют джампер выбора режима XT/AT (в накопите-<br>
лях Seagate на это указывает окончание АХ в обозначении<br>
модели).</font>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Сигнал</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Тип'</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контакт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контакт</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Сигнал</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>RESET*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>10</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>11</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>12</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>13</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>14</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DD 1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>15</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>16</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DDO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/OTS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>17</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>18</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>19</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>20</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Ключ<br>
(нет штырька)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>AEN</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>21</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>22</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DIOW#</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>23</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>24</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DIOR#</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>25</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>26</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DMACK#</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>27</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>28</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DMARQ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ooc</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>29</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>30</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>INTRQ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OTS2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>31</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>32</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DA 1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>33</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>34</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DAO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>35</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>36</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>CSO#</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>37</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>38</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>DASP#</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>I/O ОС3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>39</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>40</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>GND</font>
</td>
</tr>
</table>
<br clear=all>

<p align=center>
<font face="Times New Roman" size=2>' Тип сигнала для устройства: I - вход, О - выход, I/O - дву-<br>
направленный, TS - тристабильный, ОС - открытый коллектор.</font>

<p>
<font face="Times New Roman" size=2>2 У старых устройств сигнал может иметь тип ОС (при разнотипных<br>
сигналах на одной шине возможен конфликт).</font>

<p>
<font face="Times New Roman" size=2>3 У ведомого устройства - только выход.</font>

<p>
<font face="Times New Roman Narrow" size=4>6.2. Регистры устройств</font>

<p>
<font face="Times New Roman" size=2>Каждое устройство АТА имеет <i>стандартный набор регист-<br>
ров,</i> адресуемых сигналами от хост-адаптера (CSOff, CS1#,<br>
DA2, DA1, DAO, DIOR# и DIOW#). Набор регистров (табл. 6.3)</font>
<hr>

<p>
<font face="Times New Roman" size=2>состоит из двух блоков, выбираемых сигналом CSO^/CS1#.<br>
<i>Блок командных регистров</i> служит для посылки команд уст-<br>
ройству и чтения информации о его состоянии. <i>Блок управ-<br>
ляющих регистров</i> используется для управления устройством<br>
и получения более подробной информации о его состоянии.<br>
На действительность содержимого регистров командного бло-<br>
ка и альтернативного регистра состояния указывает нулевое<br>
значение бита <i>BSY</i> регистра состояния. Если устройство под-<br>
держивает управление энергопотреблением, в "спящем" ре-<br>
жиме содержимое этих регистров недействительно.</font>

<p>

<table align=left border=1>
<tr>
<td colspan=5>

<p>
<font face="Times New Roman" size=1>Адрес</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=1>Назначение<br>
(R - чтение, W - запись)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>CSOff</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>CS1#</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>DA2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>DA1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>DAO</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Не используется<br>
(шина данных в третьем<br>
состоянии)</font>
</td>
</tr>
<tr>
<td colspan=6>

<p>
<font face="Times New Roman" size=1><i>Control Block Registers - блок</i> управляющих регистров</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Не используется (шина данных<br>
в третьем состоянии)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Не используется (шина данных<br>
в третьем состоянии)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R: <i>Alternate Status (AS) -<br>
</i>альтернативный регистр<br>
состояния<br>
W: <i>Device Control (DC) -</i> регистр<br>
управления устройством</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Не используется1</font>
</td>
</tr>
<tr>
<td colspan=6>

<p>
<font face="Times New Roman" size=1><i>Command Block Registers -</i> блок командных регистров</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W: <i>Data (DR) -</i> регистр<br>
данных</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R: <i>Error (ER) -</i> регистр ошибок<br>
W: <i>Features (FR) -</i> регистр свойств</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W: <i>Sector Count (SC) -</i> регистр<br>
счетчика секторов</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>R/W: <i>Sector Number (SN) -<br>
</i>регистр номера сектора LBA<br>
[7:0]2</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td colspan=5>

<p>
<font face="Times New Roman" size=2>Адрес</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Назначение<br>
(R - чтение, W - запись)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>CSO"</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CSIff</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DA2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DA1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ОАО</font>
</td>
</tr>
<tr>
<td colspan=6>

<p>
<font face="Times New Roman" size=2><i>Command Block Registers -</i> блок командных регистров</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R/W: <i>Cylinder Low (CL) -</i> регистр<br>
младшего байта номера цилиндра<br>
LBA[15:8]2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R/W: <i>CyhnderHigh (CH) -<br>
</i>регистр старшего байта номера<br>
цилиндра LBA[23:16]2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R/W: <i>Deuice/Head (DH) -</i> регистр<br>
номера устройства<br>
и головки LBA[27:24]2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R: <i>Status (SR) -</i> регистр состояния<br>
W: <i>Command (CR) -</i> регистр<br>
команд</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Недопустимый адрес</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>' Регистр выпадает из блока. Рекомендуется, чтобы на сигнал чтения<br>
по этому адресу устройство не отвечало. Если устройство отвечает,<br>
то оно не должно управлять битом DD7 во избежание конфликта<br>
с контроллером НГМД.</font>

<p>
<font face="Times New Roman" size=2>2 Регистры сектора, цилиндра и головки в режиме LBA содержат ука-<br>
занные биты логического адреса.</font>

<p>
<font face="Times New Roman" size=2><i>Регистр состояния SR</i> отражает текущее состояние устрой-<br>
ства в процессе выполнения команд. Чтение регистра состо-<br>
яния разрешает дальнейшее изменение его бит и сбрасывает<br>
запрос аппаратного прерывания.</font>

<p>
<font face="Times New Roman" size=2><b>Назначение бит регистра <i>SR:</b></i></font>

<p>
<font face="Times New Roman" size=2><i>т</i> Бит 7 - <i>BSY(Busy)</i> указывает на занятость устройства. При<br>
<i>BSY=1</i> устройство игнорирует попытки записи в команд-<br>
ный блок регистров, а чтение этих регистров дает неопре-<br>
деленный результат. При <i>BSY=0</i> регистры командного блока<br>
доступны, а устройство может изменять только значение<br>
бит <i>IDX, DRDY, DF, DSC</i> и <i>CORR.</i> Бит устанавливается при<br>
аппаратном/программном сбросе устройства и по получе-<br>
нии команды. Бит может устанавливаться на кратковре-<br>
менный интервал, так что хост может этого не заметить.</font>
<hr>

<p>
<font face="Times New Roman" size=2>is Бит 6 - <i>DRDY(Device Ready)</i> указывает на готовность ус-<br>
тройства к восприятию любых кодов команд. Если со-<br>
стояние бита изменилось, оно не может измениться<br>
обратно до чтения регистра состояния. При <i>DRDY=0</i> уст-<br>
ройство воспринимает только команды <i>Execute Device<br>
Diagnostic</i> и <i>Initialize Device Parameters,</i> прекращая выпол-<br>
нение текущей команды и сообщая об этом флагом <i>ABRT<br>
</i>в регистре ошибок и <i>ERR</i> в регистре состояния. Другие<br>
команды приводят к непредсказуемым результатам.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 5 - <i>DF(Device Fault) -</i> индикатор отказа устройства.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 4 - <i>DSC(Device Seek Complete) -</i> индикатор завер-<br>
шения поиска трека. В командах, допускающих перекры-<br>
тие (см. 6.6), бит называется <i>SERV (Service Required) -<br>
</i>устройство требует обслуживания.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 3 - <i>DRQfData Request) -</i> индикатор готовности к об-<br>
мену словом или байтом данных.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 2 - <i>CORR(Corrected Data)</i> - индикатор исправлен-<br>
ной ошибки данных.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 1 - <i>IDX (InDeX) -</i> индекс, трактуется особо каждым<br>
производителем.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 0 - <i>ERR (Error) -</i> индикатор ошибки выполнения пре-<br>
дыдущей операции. Дополнительная информация содер-<br>
жится в регистре ошибок. Если установлен бит <i>ERR,</i> до<br>
приема следующей команды, программного или аппарат-<br>
ного сброса устройство не изменит состояние этого бита,<br>
а также регистра ошибок, регистра количества секторов<br>
и регистров цилиндра, головки и номера сектора.</font>

<p>
<font face="Times New Roman" size=2>В стандарте АТА-4 для некоторых команд биты 4 и 5 могут<br>
иметь иное назначение, а биты 1 и 2 объявлены устаревшими.</font>

<p>
<font face="Times New Roman" size=2><i>Альтернативный регистр состояния AS</i> имеет те же биты,<br>
что и основной, но его чтение не приводит ни к каким изме-<br>
нениям состояния устройства.</font>

<p>
<font face="Times New Roman" size=2>Назначение <i>регистра команд CR</i> очевидно из названия. Уст-<br>
ройство начинает исполнять команду сразу, как только ее<br>
код записан в данный регистр.</font>

<p>
<font face="Times New Roman" size=2><i>Регистры номера цилиндра</i> (старшего <i>СН</i> и младшего байта<br>
<i>CL)</i> и <i>номера сектора SN</i> имеют двоякое назначение в зави-<br>
симости от выбранной системы адресации (CHS или LBA).</font>
<hr>

<p>
<font face="Times New Roman" size=2>Они инициализируются хост-адаптером, а в случае возник-<br>
новения ошибки при операции устройство поместит в них<br>
адрес, по которому встретилась ошибка.</font>

<p>
<font face="Times New Roman" size=2><i>Регистр номера устройства и головки DH</i> кроме хранения<br>
части адресной информации служит для выбора ведущего<br>
или ведомого устройства и метода адресации.</font>

<p>
<font face="Times New Roman" size=2><b>Назначение бит регистра <i>DH:</b></i></font>

<p>
<font face="Times New Roman" size=2>йя Биты 7 и 5 зарезервированы.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Бит 6 - <i>L -</i> единичным значением указывает на приме-<br>
нение режима адресации LBA. При нулевом значении би-<br>
та используется режим CHS.</font>

<p>
<font face="Times New Roman" size=2>as Бит 4 - <i>DEV (Device) -</i> выбор устройства. При <i>DEV=0<br>
</i>выбрано ведущее, при DEH=1 - ведомое.</font>

<p>
<font face="Times New Roman" size=2>^ Биты [3:0] имеют двоякое назначение в зависимости от<br>
выбранной системы адресации. В режиме CHS они со-<br>
держат номер головки, в режиме LBA - старшие биты<br>
логического адреса. Как и предыдущие, этот адресный<br>
регистр инициализируется хост-адаптером, а в случае<br>
возникновения ошибки при операции устройство помес-<br>
тит в них адрес, по которому встретилась ошибка.</font>

<p>
<font face="Times New Roman" size=2>До принятия АТА-2 считалось, что адресные регистры дол-<br>
жны модифицироваться и после успешного выполнения опе-<br>
рации, отражая текущее значение адреса в носителе.</font>

<p>
<font face="Times New Roman" size=2>После включения питания, сброса или выполнения диаг-<br>
ностики устройство в блоке командных регистров содержит<br>
<i>сигнатуру,</i> определяющую его тип:</font>

<p>
<font face="Times New Roman" size=2><i>т</i> SC=01h, S/V=01h, CL=OOh, CH==OOh, DH-OOh - устройст-<br>
ва ATA;</font>

<p>
<font face="Times New Roman" size=2><i>Щ</i> SC=01h, SA/=01h, <i>CL=Uh,</i> CH=EBh, DH=OOh или Olh -</font>

<p>
<font face="Times New Roman" size=2>устройства ATAPI.</font>

<p>
<font face="Times New Roman" size=2><i>Регистр данных DR</i> может использоваться как 8-битный<br>
или 16-битный в зависимости от типа данных, передаваемых<br>
в текущей команде.</font>

<p>
<font face="Times New Roman" size=2>Из <i>регистра управления устройством CR</i> используются толь-<br>
ко два бита.</font>

<p>
<font face="Times New Roman" size=2><b>Назначение бит регистра <i>CR:</b></i></font>

<p>
<font face="Times New Roman" size=2><i>ш</i> Биты [7:3] зарезервированы.</font>
<hr>

<p>
<font face="Times New Roman" size=2>iss Бит 2 - <i>SRST(Software Reset) -</i> программный сброс, дей-<br>
ствует все время, пока бит не будет снят. Оба устройства<br>
на шине воспринимают программный сброс одновре-<br>
менно. На устройства ATAPI не действует.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 1 - <i>nlEN(Interrupt Enable)</i> - инверсный бит разреше-<br>
ния прерывания. При нулевом значении бита выбранное<br>
устройство может вырабатывать сигнал INTRQ через три-<br>
стабильный выход.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 0 всегда должен быть нулевым.</font>

<p>
<font face="Times New Roman" size=2><i>Регистр ошибок ER</i> хранит состояние выполнения последней<br>
операции или диагностический код. После завершения опе-<br>
рации на наличие ошибки указывает бит <i>ERR</i> регистра со-<br>
стояния.</font>

<p>
<font face="Times New Roman" size=2><b>Назначение бит регистра <i>ER:</b></i></font>

<p>
<font face="Times New Roman" size=2><i>^</i> Бит 7 зарезервирован.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 6 - <i>UNC(Uncorrectable Data Error)</i> -неисправимая<br>
ошибка данных.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 5 - <i>МС (Media Changed) -</i> смена носителя. После<br>
смены носителя первая команда обращения отвергается<br>
и устанавливается данный бит. После сброса бита следу-<br>
ющие команды будут выполняться нормальным образом.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 4 - <i>IDNFfID Not Found) -</i> указывает на ненайденный<br>
идентификатор сектора.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 3 - <i>ABRT(AbortedCommand) -</i> устанавливается, если<br>
команда отвергнута как недействительная или в случае<br>
возникновения иной ошибки.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 2 - <i>MCR(Media Change Requested)</i> - индикатор за-<br>
проса смены носителя. После обнаружения запроса сме-<br>
ны носителя следующие команды <i>Door Lock</i> будут воз-<br>
вращать бит ошибки <i>ERR</i> и установленный бит <i>MCR.</i> Бит<br>
<i>MCR</i> сбрасывается командами <i>Door Unlock, Media Eject</i> или<br>
аппаратным сбросом.</font>

<p align=center>
<font face="Times New Roman" size=2>^ Бит 1 - <i>TKONF(Track 0 Not Found) -</i> указывает на то, что<br>
по команде <i>Recalibrate</i> не удалось найти нулевой трек.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 0 <i>- AMNF( Address Mark Not Found)</i> - не найден ад-<br>
ресный маркер данных в заголовке сектора.</font>
<hr>

<p>
<font face="Times New Roman" size=2>После включения питания, сброса или команды <i>Execute Device<br>
Diagnostic</i> регистр ошибок содержит диагностический код.</font>

<p>
<font face="Times New Roman" size=2><i>Регистр свойств FR</i> используется в зависимости от команды. В<br>
команде <i>Set Features</i> через него задается код подкоманды. Не-<br>
которые устройства могут игнорировать запись в этот регистр.<br>
До принятия АТА-2 в этот регистр помещали значение реко-<br>
мендуемого номера цилиндра для предкомпенсации записи.</font>

<p>
<font face="Times New Roman" size=2><i>Регистр счетчика секторов SC</i> содержит число секторов, уча-<br>
ствующих в обмене. Хост инициализирует этот регистр до<br>
подачи команды (нулевое значение соответствует 256 секто-<br>
рам). По успешному завершению операции доступа' к дан-<br>
ным регистр должен обнулиться. Если команда завершилась<br>
с ошибкой, в регистре будет число секторов, которые долж-<br>
ны быть переданы для успешного завершения предыдущего<br>
запроса. Команды <i>Initialize Device Parameters</i> или <i>Write Same<br>
</i>могут переопределить значение этого регистра.</font>

<p>
<font face="Times New Roman" size=4><b>6.3. Система команд</b></font>

<p>
<font face="Times New Roman" size=2>Стандарт АТА задает <i>систему команд,</i> ориентированную на<br>
накопители на магнитных дисках. В табл. 6.4 графа "Прото-<br>
кол" определяет протокол передачи данных, требуемых для<br>
команды (см. 6.5): <i>PI -</i> ввод данных от устройства в режиме<br>
PIO, <i>РО -</i> вывод данных в устройство в режиме PIO, <i>Р -</i> про-<br>
токол передачи командного пакета (16 байт вывода в режиме<br>
PIO), <i>DM -</i> обмен данными по каналу DMA, <i>DMQ -</i> обмен<br>
DMA с очередями, <i>ND -</i> нет обмена данными, <i>DR -</i> протокол<br>
сброса, <i>VS -</i> специфично для устройства. Графа "Тип" опреде-<br>
ляет характеристику команды: О - обязательная для всех уст-<br>
ройств,/? -обязательная для ATAPI,/? - дополнительная, С -<br>
специфическая. Графа "Код" содержит шестнадцатеричный<br>
код, загружаемый в регистр команды. Коды, помеченные звез-<br>
дочкой, поддерживаются для совместимости со старым ПО.<br>
В графе "Использование регистров" приняты следующие обо-<br>
значения: <i>СУ -</i> регистры цилиндров, SC - регистр счетчика<br>
секторов, <i>DH -</i> регистр номера устройства и головки, <i>SN -<br>
</i>регистр номера сектора, <i>FR -</i> регистр свойств. Назначение<br>
регистров: <i>у -</i> регистр содержит параметры для команды (для<br>
регистра номера устройства и головки используются оба пара-</font>
<hr>

<p>

<table align=left border=1>
<tr>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Команда</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Протокол</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Тип</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Код</font>
</td>
<td colspan=5>

<p>
<font face="Times New Roman" size=2>Использование регистров</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>FR</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>sc</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SN</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CY</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>он</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Door Unlock -<br>
</i>разрешить смену<br>
носителя3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>VS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DFh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Device Reset -</i> сброс<br>
устройства ATAPI2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DR</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>п</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>08h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Download<br>
Microcode -<br>
</i>загрузка микрокода<br>
внутреннего ПО4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>92h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Execute Device<br>
Diagnostic -<br>
</i>диагностика</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>90h</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>DOS</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Flush Cache -<br>
</i>выгрузка кэша записи<br>
на носитель (время<br>
выполнения может<br>
достигать 30 с)2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>E7h</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Format Track -<br>
</i>форматирование<br>
трека3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>VS</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>с</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>50h</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D8</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Get Media Status -<br>
</i>получение<br>
информации<br>
о состоянии носителя<br>
(наличие, смена,<br>
защита записи)2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DAh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Identify Device -<br>
</i>идентификация<br>
устройства<br>
(не пакетного)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Ech</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Identify Device<br>
DMA-<br>
</i>идентификация<br>
устройства с ответом<br>
в режиме DMA5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DM</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>EEh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Identify Packet<br>
Device -</i> идентифи-<br>
кация устройства<br>
(пакетного)2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>п</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Alh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Команда</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Протокол</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Тип</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Код</font>
</td>
<td colspan=5>

<p>
<font face="Times New Roman" size=2>Использование регистров</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>FR</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>sc</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SN</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CY</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ОН</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Idle -</i> переход в со-<br>
стояние ожидания</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>97h<br>
E3h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Idle Immediate -<br>
</i>немедленный<br>
переход в состояние<br>
ожидания</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>95h<br>
Elh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Initialize Device<br>
Parameters -<br>
</i>инициализация<br>
параметров<br>
устройства</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>91h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Media Eject -<br>
</i>извлечь носитель4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>EDh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Media Lock -<br>
</i>заблокировать<br>
носитель (не<br>
ATAPI)2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DEh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Media Unlock -<br>
</i>разблокировать<br>
носитель (не<br>
ATAPI)2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DFh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Nop -</i> холостая<br>
команда</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OOh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Packet -</i> посылка<br>
командного пакета2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Р</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>п</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>AOh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read Buffer-<br>
</i>чтение буфера</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>E4h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read DMA<br>
(w/retry) -</i> чтение<br>
по DMA с повторами</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DM</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>C8h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read DMA (w/o<br>
retry) -</i> чтение по<br>
DMA без повторов</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DM</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>C9h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read DMA Queued -<br>
</i>чтение по DMA<br>
с возможностью<br>
постановки команды<br>
в очередь<br>
и освобождения<br>
шины2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DMQ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>C7h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>y8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Команда</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Протокол</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Тип</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Код</font>
</td>
<td colspan=5>

<p>
<font face="Times New Roman" size=2>Использование регистров</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>FR</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SC</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SN</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CY</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DH</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read Long<br>
(w/retry) -<br>
</i>"длинное" чтение<br>
с повторами3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>22h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read Long (w/o<br>
retry) -</i> "длинное"<br>
чтение без повторов3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>23h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read Multiple -<br>
</i>множественное<br>
чтение</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>C4h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read Native<br>
Address -</i> чтение<br>
максимального<br>
адреса сектора (за-<br>
водской установки)2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F8h</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read Sector(s)<br>
(w/retry) -</i> чтение<br>
секторов с повторами</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>20h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read Sectors)<br>
(w/o retry) -</i> чтение<br>
секторов без повторов</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>21h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read Verify<br>
Sectorfs)<br>
(w/retry) -<br>
</i>верификационное<br>
чтение секторов<br>
с повторами</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>40h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Read Verify<br>
Sector(s)<br>
(w/o retry) -<br>
</i>верификационное<br>
чтение секторов<br>
без повторов</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>41h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Recalibrate -<br>
</i>рекалибровка (поиск<br>
нулевого трека)3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Ixh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Security Disable<br>
Password -</i> отмена<br>
защиты (с посылкой<br>
пароля)6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F6h</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Команда</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Протокол</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Тип</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Код</font>
</td>
<td colspan=5>

<p>
<font face="Times New Roman" size=2>Использование регистров</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>FR</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>sc</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SN</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CY</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>он</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Security Erase<br>
Prepare -<br>
</i>подготовка к защит-<br>
ному стиранию6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F3h</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Security Erase Unit -<br>
</i>защитное стирание<br>
(с посылкой пароля)6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F4h</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Security Freeze<br>
Lock -</i> блокировка<br>
команд защиты6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F5h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>^-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>^~</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Security Set<br>
Password -</i> установ-<br>
ка пароля защиты6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Flh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Security Unlock -<br>
</i>снятие защиты6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Flh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>-</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Seek -</i> поиск</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>7xh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Service -</i> передача<br>
данных и/или<br>
состояния команды,<br>
освободившей шину2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Рили<br>
DMQ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>A2h</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Set Features -<br>
</i>установка свойств</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Efh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Set Max Address -<br>
</i>установка макси-<br>
мального адреса2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F9h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>У8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Set Multiple Mode -<br>
</i>установка множест-<br>
венного режима</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>C6h</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Steep - перевод<br>
в "спящий" режим</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>99h<br>
E6h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>SMART -</i> группа<br>
команд мониторинга6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND,PI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>BOh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>"D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Standby -</i> перевод<br>
в дежурный режим</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>96h<br>
E2h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Standby<br>
Immediate -</i> немед-<br>
ленный перевод<br>
в дежурный режим</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ND</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>94h<br>
EOh</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Команда</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Протокол</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Тип</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Код</font>
</td>
<td colspan=5>

<p>
<font face="Times New Roman" size=2>Использование регистров</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>FR</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>sc</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SN</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CY</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>он</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write Buffer -<br>
</i>запись в буфер</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>E8h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>D</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write DMA<br>
(w/retry) -</i> запись<br>
по DMA с повторами</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DM</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CAh</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write DMA<br>
(w/o retry) -</i> запись<br>
no DMA без повторов</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DM</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CBh</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write DMA<br>
Queued -</i> запись<br>
no DMA с возмож-<br>
ностью постановки<br>
команды в очередь<br>
и освобождения<br>
шины2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>DMQ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CCh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write Long<br>
(w/retry)-<br>
</i>&lt;длинная" запись<br>
с повторами3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>32h7</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write Long<br>
(w/o retry)<br>
</i>•"длинная" запись<br>
без повторов3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>33h7</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>У</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write Multiple -<br>
</i>множественная<br>
запись</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>C5h7</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write Same -</i> запись<br>
с размножением</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>E9h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write Sectorfs)<br>
(with retry) -</i> запись<br>
секторов с повторами</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>30h7</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write Sectorfs)<br>
(without retry) -<br>
</i>запись секторов<br>
без повторов</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>31h7</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Write Verify -</i> запись<br>
с верификацией</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>РО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>д</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3Ch7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>у</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>' В АТА-3+ команда не определена.<br>
2 Только для АТА-4.</font>
<hr>

<p>
<font face="Times New Roman" size=2>3 В АТА-4 команда не определена.</font>

<p>
<font face="Times New Roman" size=2>4 Для АТА-2 и выше.</font>

<p>
<font face="Times New Roman" size=2>5 Только для АТА-3.</font>

<p>
<font face="Times New Roman" size=2>6 Для АТА-3 и выше.</font>

<p>
<font face="Times New Roman" size=2>7 Коды поддерживаются для совместимости.</font>

<p>
<font face="Times New Roman" size=2>8 Использование регистра зависит от производителя.</font>

<p>
<font face="Times New Roman" size=3><b>6.3.1. Основные команды</b></font>

<p>
<font face="Times New Roman" size=2>К этой группе относятся команды АТА для доступа к дан-<br>
ным. Для устройств, существенно отличающихся от НЖМД,<br>
имеется альтернативный способ доставки команд и парамет-<br>
ров - команда <i>Packet.</i> По этой команде, используя вывод в<br>
режиме PIO, хост-адаптер передает <i>пакет с блоком дескрип-<br>
тора команды.</i> Подробнее о пакетном интерфейсе см. в 6.7.</font>

<p>
<font face="Times New Roman" size=2>Минимальной адресуемой единицей <i>команд чтения и запи-<br>
си</i> является 512-байтный сектор.</font>

<p>
<font face="Times New Roman" size=2>Команды чтения секторов в режимах обмена PIO - <i>Read<br>
Sectorfs)</i> и DMA - <i>Read DMA</i> позволяют считывать после-<br>
довательно расположенные секторы, количество которых за-<br>
дано в регистре SC, а адрес начального сектора - в регист-<br>
рах <i>СН, CL, DH</i> и <i>SN.</i> Команды чтения бывают с повторами<br>
или без них. В первом случае, если при чтении сектора об-<br>
наружена неисправимая ошибка, устройство автоматически<br>
делает несколько повторных попыток чтения. После испол-<br>
нения команды в случае неисправимой ошибки блок команд-<br>
ных регистров содержит адрес сектора с ошибкой. Если уст-<br>
ройство использует ЕСС-код, то некоторые ошибки чтения<br>
оно исправляет без повторов, но указывает на этот факт в<br>
регистре ошибок.</font>

<p>
<font face="Times New Roman" size=2>Команда чтения в блочном режиме передачи <i>Read Multiple<br>
</i>отличается от обычного (с обменом PIO) тем, что запросы<br>
прерывания вырабатываются не на каждый сектор, а на блок<br>
секторов, размер которого задан командой <i>Set Multiple Mode.<br>
</i>Кроме того, в случае появления неисправимой ошибки чте-<br>
ния содержимое блока командных регистров не определено<br>
(не указывает на сбойный сектор). За счет сокращения чис-<br>
ла прерываний, которые должен обслужить процессор, блоч-<br>
ный режим в многозадачной системе позволяет повысить</font>
<hr>

<p>
<font face="Times New Roman" size=2>производительность на 30%. Производительность обмена за-<br>
висит от размера блока. Размер, оптимальный для устрой-<br>
ства, может не быть оптимальным для ОС.</font>

<p>
<font face="Times New Roman" size=2>Команда "длинного" чтения <i>Read Long</i> считывает сектор<br>
данных вместе с контрольными байтами. При ее вызове ре-<br>
гистр SC должен указывать на запрос только одного секто-<br>
ра. Блок данных считывается 16-битными словами, а конт-<br>
рольные байты - 8-битными. Некоторые устройства АТА-1<br>
неспособны быстро передавать байты ЕСС вслед за данны-<br>
ми. Для их считывания используют 8-битный обмен в ре-<br>
жиме PIO Mode 0.</font>

<p>
<font face="Times New Roman" size=2>Команда верификации <i>Read Verify Sectors)</i> в отличие от<br>
обычного чтения не передает данные от устройства. В слу-<br>
чае ошибки на адрес сбойного сектора указывает блок ко-<br>
мандных регистров. Запрос прерывания выполняется после<br>
исполнения команды.</font>

<p>
<font face="Times New Roman" size=2>Команды записи <i>Write DMA, Write Sectors), Write Long, Write<br>
Multiple</i> работают аналогично соответствующим им коман-<br>
дам чтения и также имеют версии с повторами и без. Ко-<br>
манда записи с верификацией <i>Write Verify</i> аналогична команде<br>
<i>Write Sectors),</i> но для каждого сектора после записи выпол-<br>
няется контрольное считывание. Для логической инициали-<br>
зации (очистки области) дисков имеется команда записи <i>Write<br>
Same,</i> которая позволяет содержимое 512 байт, принятых от<br>
хоста, записать в группу секторов. Если в регистр свойств<br>
занесен код 22h, область записываемых секторов определя-<br>
ется регистрами командного блока. Если в регистр свойств<br>
занесен код DDh, запись производится во все доступные сек-<br>
торы устройства.</font>

<p>
<font face="Times New Roman" size=2>Команды чтения и записи буфера <i>Read Buffer</i> и <i>Write Buffer<br>
</i>служат для обмена в режиме PIO с 512-байтной буферной<br>
памятью устройства (но не сектором носителя).</font>

<p>
<font face="Times New Roman" size=2>Команда форматирования трека <i>Format Track</i> по входным пара-<br>
метрам специфична для каждого устройства, и ее использова-<br>
ние не рекомендуется. Многие устройства ее отвергают как<br>
недопустимую. Поскольку команда форматирования традици-<br>
онно ориентирована на один трек, форматирование дисков<br>
АТА в режиме трансляции геометрии, при котором физическая</font>
<hr>

<p>
<font face="Times New Roman" size=2>организация не совпадает с логической, невозможно. В накопи-<br>
телях с зонным форматом записи форматирование логичес-<br>
кого трека будет "накрывать" переменное число физических.</font>

<p>
<font face="Times New Roman" size=2>Вспомогательное назначение имеют <i>команды поиска.</i> По ко-<br>
манде поиска <i>Seek</i> устройство устанавливает головки на за-<br>
данный цилиндр/трек и считывает идентификатор сектора.</font>

<p>
<font face="Times New Roman" size=2>Команда рекалибровки <i>Recalibrate</i> заставляет устройство<br>
найти нулевой цилиндр. Если устройству это не удается,<br>
устанавливается бит ошибки <i>Track O Not Found.</i> Эту коман-<br>
ду обычно применяют при обработке ошибок: часто после<br>
такого "встряхивания" ошибка не повторяется. После ус-<br>
пешного выполнения команды блок командных регистров<br>
содержит адрес первого сектора диска в формате, завися-<br>
щем от режима адресации (LBA или CHS).</font>

<p>
<font face="Times New Roman" size=2>Для <i>накопителей со сменными носителями</i> в АТА-2 были<br>
предназначены команды загрузки и выгрузки, подтверждения<br>
смены носителя, блокировки и разблокировки устройства -<br>
<i>Boot - Post-Boot, Boot - Pre-Boot, Media Eject, Acknowledge<br>
Media Change, Door Lock, Door Unlock.</i> Их реализация специ-<br>
фична для каждой модели устройства. В АТА-4 набор этих<br>
команд сокращен. Смену носителя вызывает только коман-<br>
да <i>Media Eject</i> (для устройств ATAPI - пакетная команда<br>
<i>Start/Stop Unit).</i> Здесь может работать один из двух меха-<br>
низмов защиты от несанкционированной смены носителя.<br>
При использовании уведомления о смене носителя <i>Removable<br>
Media Status Notification</i> нажатие кнопки на накопителе сме-<br>
ны носителя не вызывает, этот факт и состояние носителя<br>
могут определяться по команде <i>Get Media Status.</i> Этот меха-<br>
низм включается и отключается соответствующими подко-<br>
мандами Set <i>Features',</i> по любому сбросу устройства он от-<br>
ключается. Когда механизм уведомления отключен, работает<br>
другой: для запрета/разрешения смены носителей от кноп-<br>
ки устройства (только для непакетных устройств) применя-<br>
ют команды <i>Media Lock/Media Unlock,</i> они же используются<br>
для определения состояния (наличия, защиты записи и факта<br>
смены носителя).</font>

<p>
<font face="Times New Roman" size=2>Для <i>запоминающих устройств на флэш-памяти</i> в АТА-4 вве-<br>
ли команды, начинающиеся с аббревиатуры CFA (Compact</font>
<hr>

<p>
<font face="Times New Roman" size=2>Flash Association - ассоциация производителей компактных<br>
флэш-карт). Специфика этих устройств заключается в за-<br>
писи: запись обеспечивается лишь в предварительно стер-<br>
тые ячейки (сектор), хотя есть устройства, автоматически<br>
осуществляющие стирание при записи. Операция записи<br>
выполняется существенно медленнее, чем чтения, скорость<br>
которого приближается к скорости динамической памяти.<br>
Операция стирания занимает еще больше времени. Интерес<br>
представляет информация о состоянии сектора: стертый или<br>
нет и сколько раз выполнялась запись.</font>

<p>
<font face="Times New Roman" size=3><b>6.3.2. Служебные команды</b></font>

<p>
<font face="Times New Roman" size=2>В системе команд имеются средства <i>идентификации и<br>
управления свойствами</i> устройств. Команда идентификации<br>
<i>Identify Device</i> позволяет считать из контроллера блок из 256<br>
слов, характеризующих устройство АТА. Устройства с па-<br>
кетным интерфейсом эту команду должны отвергать, для них<br>
имеется команда <i>Identify Packet Device</i> (см. 6.7). Блок пара-<br>
метров может храниться как в энергонезависимой памяти<br>
устройства, так и на самом носителе в месте, недоступном<br>
для обычных обращений. Состав полей блока для непакет-<br>
ных устройств приведен в табл. 6.5. Графа <i>"F/V"</i> определяет<br>
свойства соответствующих полей: F - содержимое фиксиро-<br>
вано, <i>V -</i> содержимое меняется в зависимости от состояния<br>
устройства или выполненных команд, <i>Х -</i> специфично для<br>
данного устройства (может быть и F, и <i>V), R -</i> зарезервиро-<br>
ванные поля. Для устройств со сменными носителями зна-<br>
чения полей F могут меняться при смене носителя.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Оби^ конфигурационная информация<br>
</i>Бит 15: 0 для всех устройств АТА<br>
Бит 7: 1 - устройство со сменным носителем<br>
Бит 6: 1 - устройство (контроллер) с несменным<br>
носителем<br>
Бит 0 - зарезервирован<br>
Значение остальных бит специфично для устройств</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Число логических цилиндров</i></font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Оюво</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Число логических головок</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Специфично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Специфично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Число логических секторов на логическом треке</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>7-9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Специфично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>10-19</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Серийный номер</i> (20 символов ASCII), если слово 10<br>
ненулевое, иначе - специфичная информация</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>20</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Специфично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>21</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Специфично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>22</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Число дополнительных байт</i> в командах "длинного"<br>
чтения и записи (в АТА-4 объявлено устаревшим)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>23-26</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Версия встроенного ПО</i> (8 символов ASCII), если<br>
слово 23 ненулевое, иначе - специфичная<br>
информация</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>27-46</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Номер модели</i> (40 символов ASCII), если слово 27<br>
ненулевое, иначе - специфичная информация</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>47</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-8 специфичны (в АТА-4 - 80h)</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 7-0 - возможности множественных операций:<br>
0 - зарезервирован, Olh-FFh - максимальное<br>
количество секторов, передаваемых за сеанс</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>48</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>49</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R<br>
F</font>

<p>
<font face="Times New Roman" size=2>R</font>

<p>
<font face="Times New Roman" size=2>F</font>

<p>
<font face="Times New Roman" size=2>F<br>
F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Возможности.</i></font>

<p>
<font face="Times New Roman" size=2>Биты 15-14 - зарезервированы для <i>Identify Packet<br>
Device</i></font>

<p>
<font face="Times New Roman" size=2>Бит 13 - значения таймера режима Standby:<br>
1 - соответствуют стандарту,<br>
0 - задаются особо</font>

<p>
<font face="Times New Roman" size=2>Бит 12 зарезервирован для <i>Identify Packet Device</i></font>

<p>
<font face="Times New Roman" size=2>Бит 11:<br>
1 - IORDY поддерживается (для PIO Mode 3 и<br>
выше - обязательно),<br>
0 - IORDY может поддерживаться</font>

<p>
<font face="Times New Roman" size=2>Бит 10: 1 - сигнал IORDY может быть запрещен<br>
командой <i>Set Features</i></font>

<p>
<font face="Times New Roman" size=2>Бит 9 =1 (в АТА-4 используется для <i>Identify Packet<br>
Device,</i> в АТА-2 - как указание<br>
на поддержку LBA и действительности слов 60-61)</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F<br>
X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 8=1 (в АТА-4 используется для <i>Identify Packet<br>
Device,</i> в АТА-2 - как указание<br>
на поддержку DMA)</font>

<p>
<font face="Times New Roman" size=2>Биты 7-0 специфичны</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>50</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Возможности</i> (АТА-4):<br>
Бит 15&deg;0<br>
Бит 14-1<br>
Биты 13-1 - зарезервирован<br>
Бит О&quot;! указывает на специфичное значение<br>
минимума для Standby Timer</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>51</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F<br>
X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-8: <i>длительность цикла обмена в режиме PIO.<br>
</i>Если значение параметра не соответствует<br>
режимам 0, 1 или 2, используется PIO Mode 0</font>

<p>
<font face="Times New Roman" size=2>Биты 7-0 специфичны</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>52</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F<br>
X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Специфично.<br>
В АТА-2 биты 15-8: временной режим цикла<br>
одиночного обмена DMA (Single Word DMA). Если<br>
значение параметра не соответствует режимам 0, 1<br>
или 2, используется Mode 0. Если поддерживаются<br>
слова 62 или 63, значение поля игнорируется</font>

<p>
<font face="Times New Roman" size=2>Биты 7-0 специфичны</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>53</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R<br>
F</font>

<p>
<font face="Times New Roman" size=2>F</font>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-3 зарезервированы<br>
Бит 2:<br>
1 - поля в слове 88 действительны,<br>
О-нет</font>

<p>
<font face="Times New Roman" size=2>Бит 1:<br>
1 - поля в словах 64-70 действительны,<br>
О-нет.<br>
Любое устройство, поддерживающее PIO Mode 3<br>
и старше или Multiword DMA Mode 1 и выше,<br>
должно использовать эти поля</font>

<p>
<font face="Times New Roman" size=2>Бит 0:<br>
1 - поля в словах 54-58 действительны,<br>
0 - поля могут быть действительны</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>54</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Текущее число логических цилиндров.</i> Для устройств<br>
АТА-1, если команда <i>Initialize Device Parameters<br>
</i>не применялась, значение слова специфично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>55</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Текущее число логических головок.</i> Для устройств<br>
АТА-1, если команда <i>Initialize Device Parameters<br>
</i>не применялась, значение слова специфично</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>56</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Текущее число логических секторов на трек.</i> Для<br>
устройств АТА-1, если команда <i>Initialize Device<br>
Parameters</i> не применялась, значение слова<br>
специфично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>57-58</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Текущая емкость в секторах</i> (произведение слов 54,<br>
55, 56)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>59</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R<br>
V</font>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-9 зарезервированы</font>

<p>
<font face="Times New Roman" size=2>Бит 8: 1 - установка для многосекторной передачи<br>
действительна</font>

<p>
<font face="Times New Roman" size=2>Биты 7-0: текущая установка максимального числа<br>
секторов для многосекторных команд</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>60-61</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Общее число секторов,</i> адресуемых пользователем<br>
(только в режиме LBA)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>62</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>V<br>
F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Для АТА-4 специфично, в АТА-2 - <i>режим одиночного<br>
обмена DMA:<br>
</i>Биты 15-8: активный режим:<br>
бит 8=1 - Mode 0,<br>
бит 9=1 - Mode 1 и т. д. Единичное значение может<br>
иметь только один бит</font>

<p>
<font face="Times New Roman" size=2>Биты 7-0 - поддерживаемые режимы:<br>
бит 0=1 - Mode 0,<br>
бит 1=1 - Mode 1 и т. д.</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>63</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>V<br>
F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Режим множественного обмена Multiword DMA:<br>
</i>Биты 15-8: активный режим, аналогично слову 62</font>

<p>
<font face="Times New Roman" size=2>БИТЬ! 7-0: поддерживаемые режимы, аналогично<br>
слову 62</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>64</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R<br>
F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-8 зарезервированы</font>

<p>
<font face="Times New Roman" size=2>Биты 7-0 - <i>поддерживаемые прогрессивные режимы<br>
программного обмена (Advanced PIO):<br>
</i>бит 0=1 - PIO Mode 3,<br>
бит 1=1 -PIO Mode 4,<br>
биты 2-7 - зарезервированы</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>65</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Минимальная длительность цикла передачи<br>
множественного DMA</i> (в наносекундах)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>66</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Рекомендованная длительность цикла передачи<br>
множественного DMA</i> (в наносекундах). При<br>
многосекторной передаче обеспечивает оптимальную<br>
скорость, при которой устройство не будет тормозить<br>
поток снятием запроса DMARQ</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>67</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Минимальная длительность цикла передачи РЮ без<br>
использования сигнала готовности<br>
</i>(в наносекундах)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>68</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Минимальная длительность цикла передачи РЮ с<br>
использованием сигнала готовности<br>
</i>(в наносекундах)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>69-70</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано для поддержки перекрытия команд<br>
и очередей</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>71-74</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано для команды <i>Identify Packet Device</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>75</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Глубина очереди команд-.<br>
</i>Биты 15-5 - зарезервированы<br>
Биты 4-0 - максимальная глубина очереди</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>76-79</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>80</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Номер основной версии</i> интерфейса (если не OOOOh или<br>
FFFFh):<br>
1 -АТА-1,<br>
2 - АТА-2,<br>
4 - ATA/ATAPI-4...</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>81</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Младший номер версии</i> интерфейса (если не OOOOh или<br>
FFFFh)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>82</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Поддержка команд и свойств</i> (если слова 82 и 83<br>
не равны OOOOh или FFFFh):<br>
Бит 15 - не используется<br>
Бит 14 - команды <i>Nop<br>
</i>Бит 13 - команды <i>Read Buffer<br>
</i>Бит 12 - команды <i>Write Buffer<br>
</i>Бит 11 - не используется<br>
Бит 10 - ограничение доступного пространства<br>
Бит 9 - команда <i>Device Reset<br>
</i>Бит 8 - вырабатывание прерывания во время<br>
выполнения команды <i>Service<br>
</i>Бит 7 - прерывание по освобождению шины<br>
Бит 6 - кэширование с упреждающим<br>
чтением<br>
Бит 5 - кэширование записи<br>
Бит 4 - команда <i>Packet<br>
</i>Бит 3 - управление энергопотреблением<br>
Бит 2 - смена носителя<br>
Бит 1 - команды <i>Security<br>
</i>Бит 0 - <i>SMART</i></font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>83</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Поддержка команд и свойств</i> (как и слово 82):<br>
Бит 15-0<br>
Бит 14 = 1<br>
БИТЬ! 13-5 зарезервированы<br>
Бит 4 - уведомление о смене<br>
носителя<br>
Бит 3 - расширенное управление<br>
энергопотреблением<br>
Бит 2 - команды <i>CFA<br>
</i>Бит 1 - команды <i>Read/Write DMA Queued<br>
</i>Бит 0 - команда <i>Download Microcode</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>84</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Поддержка команд и свойств</i> (если слова 82, 83 и 84 не<br>
равны OOOOh или FFFFh):<br>
Бит 15 &deg; 0<br>
Бит 14 = 1<br>
Биты 13-0 зарезервированы</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>85-87</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Разрешенные команды и свойства;</i> поля и правила<br>
аналогичны словам 82-84</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>88</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>

<p>
<font face="Times New Roman" size=2>R</font>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Режим Uttm DMA<br>
</i>Биты 15-11 зарезервированы<br>
Биты 10-8: активный режим Ultra DMA:<br>
бит 8-1 - Mode 0, бит 9"1 - Mode 1 и т. д.<br>
Единичное значение может иметь только<br>
один бит</font>

<p>
<font face="Times New Roman" size=2>Биты 7-3 зарезервированы<br>
Биты 2-0: поддерживаемые режимы одиночного<br>
обмена DMA бит 0=1 - Mode 0, бит 1=1 - Mode 1<br>
и т. д.</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>89</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Время защитного стирания:</i> О-не указано; значение<br>
1 - 254, умноженное на 2, дает время в минутах,<br>
255 - более 508 мин</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>90</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Время расширенного защитного стирания</i> (аналогично<br>
слову 89)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>91</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Текущий уровень<br>
Advanced Power Management</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>92-126</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>127</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-2 -зарезервированы<br>
Биты 1 -0 - <i>уведомление о смене носителя:<br>
</i>00 - не поддерживается,<br>
01 - поддерживается,<br>
1х - зарезервированы</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>128</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Состояние защиты:</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-9 зарезервированы</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 8 - уровень защиты:</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>0 - высокий,</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>1 - максимальный</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 7-6 - зарезервированы</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 5: 1 - поддержка расширенного защитного</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>стирания</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 4: 1 - счетчик попыток иссяк</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 3: 1 - команды защиты блокированы</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 2: 1 - устройство заблокировано</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 1: 1 -защита разрешена</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 0: 1 - защита поддерживается</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>129-159</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Специфично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>160-255</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>Команда установки параметров <i>Initialize Device Parameters</i> за-<br>
дает режим трансляции логической геометрии в системе CHS.<br>
Регистр SC указывает число логических секторов на трек, а<br>
в поле номера головки регистра <i>DH</i> указывается уменьшен-<br>
ное на единицу число логических головок. Если запрошенный<br>
режим трансляции устройство не поддерживает, оно выдаст<br>
ошибку "команда отвергнута" (прежняя спецификация АТА<br>
не четко описывала эту ситуацию, и некоторые системы не<br>
обнаруживали отказ при данной команде). После запроса<br>
неподдерживаемого режима трансляции устройство блоки-<br>
рует доступ к носителю с ошибкой <i>ID Not Found</i> до запроса<br>
поддерживаемого режима трансляции. Устройство обязано<br>
поддерживать режим, описанный словами 1, 3 и 6 блока его<br>
параметров. Некоторые устройства АТА-1 требовали, чтобы<br>
данная команда выполнялась до доступа к носителю.</font>

<p>
<font face="Times New Roman" size=2>Команда установки свойств <i>Set Features</i> (специфичная для<br>
устройства) подразумевает помещение кода подкоманды<br>
(табл. 6.6) в регистр свойств.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Код</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>01h1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Разрешение 8-битного обмена</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>02h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Разрешение кэширования записи</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Код</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>пв^г-вчснмс</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>03h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Установка режима передачи по значению регистра SC<br>
(табл. 6.7)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>04h'</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Разрешение автоматического переназначения дефектных<br>
блоков</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>05h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Разрешение расширенного управления энергопотреблением<br>
(уровень в регистре SC)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>31h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет уведомления о смене носителя</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>33h'</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет повторов</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>44h'</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Установка количества дополнительных байт в командах<br>
<i>Read Long/Write Long</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>54h1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Установка количества сегментов кэша по значению регистра<br>
SC</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>55h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет упреждающего чтения</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>5Dh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Разрешение прерывания по освобождению шины</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>5Eh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Разрешение прерывания при выполнении команды <i>Service</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>66h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет возврата к параметрам по умолчанию<br>
при включении питания</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>77h1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет ЕСС</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>81 h1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет 8-битного обмена</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>82h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет кэширования записи</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>84h1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет автоматического переназначения дефектных блоков</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>85h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет расширенного управления энергопотреблением</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>88h1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Разрешение ЕСС</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>99h1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Разрешение повторов</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>9Ah1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Ограничение тока потребления значением в регистре SC,<br>
умноженным на 4 (мА)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>AAh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Разрешение упреждающего чтения</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>ABh1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Установка максимального количества кэшируемых блоков<br>
по регистру SC</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>BBh1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Установка 4-байтной длины дополнительного поля<br>
для команд <i>Read Long/Write Long</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>CCh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Разрешение возврата к параметрам по умолчанию<br>
при включении питания</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>DDh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет прерывания по освобождению шины</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>DEh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Запрет прерывания при выполнении команды <i>Service</i></font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2><i>1</i> В АТА-4 подкоманда изъята.<br>
9 Зак.№530</font>
<hr>

<p>
<font face="Times New Roman" size=2>После включения питания или аппаратного сброса установ-<br>
ленные свойства заменяются на принятые по умолчанию. Ре-<br>
зультат подкоманд можно и закрепить, подав подкоманду 66h<br>
(отмена - подкоманда с кодом CCh).</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Биты [7:0]</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Режим обмена</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>00000000</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Режим PIO, принятый для устройства по умолчанию</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>00000001</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Режим PIO, принятый для устройства по умолчанию;<br>
запрет IORDY</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>00001 <i>mm</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Режим PIO Mode x* с сигналом IORDY</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>00010 <i>ппп</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Режим одиночного DMA Mode x</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>00100 <i>ппп</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Режим множественного DMA Mode x</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>01000 <i>ппп</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Режим Ultra DMA Mode x</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>10000 <i>mm</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервированы</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>* x определяется значением поля <i>ппп</i></font>

<p>
<font face="Times New Roman" size=2><i>Команда задания параметров блочного режима</i> передачи <i>Set<br>
Multiple Mode</i> через регистр SC указывает число секторов,<br>
передаваемых с одним запросом прерывания. Значению SC==0<br>
соответствует запрет блочного режима. После включения<br>
питания или аппаратного сброса блочный режим запрещен.</font>

<p>
<font face="Times New Roman" size=2><i>Команда диагностики Execute Device Diagnostic,</i> адресуясь все-<br>
гда к ведущему устройству, выполняется одновременно обоими<br>
устройствами. О ее результате ведомое устройство сообщает<br>
ведущему (сигналом PDIAG#). Состояние обоих устройств опре-<br>
деляется по диагностическому коду (табл. 6.8), который счи-<br>
тывается из бит [6:0] регистра ошибок нулевого устройства.</font>

<p>
<font face="Times New Roman" size=2><i>Фиктивная команда Nop,</i> не изменяя содержимого регистров,<br>
позволяет считать информацию о состоянии устройства, вы-<br>
полнив всего одну 16-битную запись по адресу в регистре <i>DH.<br>
</i>Команда всегда возвращает бит ошибки "команда отвергну-<br>
та". В АТА-4 команда объявлена обязательной для устройств<br>
ATAPI и всех, поддерживающих перекрывающиеся команды.<br>
Она имеет подкоманды, указываемые в регистре свойств. Под-<br>
команда с кодом 00 сбрасывает всю оставшуюся очередь, а с<br>
кодом 01 <i>(NOP Auto Poll)</i> на очередь не влияет.</font>
<hr>

<p>

<table align=left border=1>
<tr>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Код</font>
</td>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Ведущее устройство</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Ведомое устройство</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Olh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Нормально</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Нормально или отсутствует</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>OOh, 02h-7Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Неисправно</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Нормально или отсутствует</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>81h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Нормально</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Неисправно</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>80h, 82h-FFh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Неисправно</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Неисправно</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=3><b>6.3.3. Дополнительные сервисные функции</b></font>

<p>
<font face="Times New Roman" size=2>Устройства АТА и ATAPI могут поддерживать управление<br>
энергопотреблением, защищать данные от несанкциониро-<br>
ванного доступа, выполнять мониторинг своего состояния<br>
для предупреждения об угрозе отказа и перезаписывать<br>
встроенную микропрограмму.</font>

<p>
<font face="Times New Roman" size=2>Средства <i>управления энергопотреблением - Power Management -<br>
</i>не обязательны. Различают следующие состояния, перечис-<br>
ленные в порядке возрастания энергопотребления:</font>

<p>
<font face="Times New Roman" size=2><i>Sleep -</i> "заснувшее" устройство - потребляет минимум энер-<br>
гии, "разбудить" его может только сброс. Время "пробуж-<br>
дения" - не более 30 с.</font>

<p>
<font face="Times New Roman" size=2><i>Standby Mode</i> (дежурный режим) - устройство способно при-<br>
нимать команду по интерфейсу, но для доступа к носителю<br>
может потребоваться столь же большое время. В это состоя-<br>
ние устройство может перейти как по команде, так и по тай-<br>
меру <i>(Standby Timer),</i> отсчитывающему время от последнего<br>
запроса, полученного в состоянии ожидания или активном<br>
состоянии. Время срабатывания таймера программируется;</font>

<p>
<font face="Times New Roman" size=2>он может быть запрещен.</font>

<p>
<font face="Times New Roman" size=2><i>Idle Mode</i> (состояние ожидания) - устройство способно сразу<br>
начать обслуживание обращения к носителю, не слишком<br>
быстро, так как некоторые узлы отключены.</font>

<p>
<font face="Times New Roman" size=2><i>Active Mode</i> (активный режим) - устройство все запросы об-<br>
служивает за кратчайшее время.</font>

<p>
<font face="Times New Roman" size=2>Команда проверки режима энергопотребления <i>Check Power<br>
Mode через</i> регистр SC возвращает состояние: SC=0 - уст-<br>
ройство находится в состоянии <i>Standby</i> или переходит в него,<br>
<i>SC^SS</i> - устройство активно или в состоянии ожидания.</font>
<hr>

<p>
<font face="Times New Roman" size=2>Команда <i>Idle</i> переводит устройство в режим ожидания из<br>
активного или дежурного режимов, а также через регистр<br>
<i>SC</i> программирует таймер дежурного режима (табл. 6.9).</font>

<p>
<font face="Times New Roman" size=2>Команда <i>Idle Immediate</i> непосредственного перевода в режим<br>
ожидания таймер не программирует.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Содержимое SC</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Тайм-аут</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>О(ООЬ)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Тайм-аут запрещен</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>x=l-240(01h-FOh)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>(хх5)с</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>х-241-251 (Flh-FBh)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>((х-240)х30) мин</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>252(FCh)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>21 мин</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>253 (FDh)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Период, заданный производителем<br>
(в пределах 8-12 ч)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>254 (FEh)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>255(FFh)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>21 мин 15 с</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>Команда Steep является единственным способом перевода<br>
устройства в "спящий" режим. После получения команды<br>
устройство генерирует запрос прерывания. Хост должен счи-<br>
тать регистр состояния, что сбросит прерывание и позволит<br>
устройству "заснуть". "Разбудить" устройство можно толь-<br>
ко аппаратным или программным сбросом. Состояние, в ко-<br>
торое оно перейдет, определяется типом сброса и програм-<br>
мируется. Поскольку не каждый хост "знает", что после<br>
команды нужно прочитать регистр состояния, устройство ав-<br>
томатически сбросит запрос прерывания и "заснет" через<br>
определенный период времени (не менее 2 с).</font>

<p>
<font face="Times New Roman" size=2>Команда <i>Standby</i> переводит устройство в дежурный режим<br>
потребления и через параметр в регистре SC программирует<br>
таймер. Команда <i>Standby Immediate</i> таймер не программирует.</font>

<p>
<font face="Times New Roman" size=2>Устройства могут поддерживать расширенное управление<br>
энергопотреблением <i>АРМ (Advanced Power Management).</i> При<br>
этом задается уровень <i>АРМ Level,</i> определяющий степень<br>
активности: Olh - минимальное потребление, FEh - макси-<br>
мальная производительность. Уровень выше 80h не позво-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ляет устройству останавливать двигатель. АРМ управляет-<br>
ся подкомандами Set <i>Features.</i> Устройства с пакетным ин-<br>
терфейсом для управления энергопотреблением могут ис-<br>
пользовать также команды пакетного протокола.</font>

<p>
<font face="Times New Roman" size=2>Начиная с АТА-3 в стандарт введена <i>группа команд защиты.<br>
</i>Защищенное устройство по включению питания или аппа-<br>
ратному сбросу будет находиться в заблокированном состо-<br>
янии, при котором любой доступ к информации на носите-<br>
ле запрещен. Система защиты поддерживает два пароля -<br>
<i>главный (Master Password)</i> и <i>пользовательский (User Password).<br>
</i>Главный пароль устанавливается изготовителем или продав-<br>
цом устройства. Пароль устанавливается командой <i>Security<br>
Set Password,</i> этой же командой устанавливается защита. В<br>
передаваемом блоке данных (512 байт) нулевое слово явля-<br>
ется управляющим:</font>

<p>
<font face="Times New Roman" size=2><i>ш</i> Бит 0 определяет тип пароля (0 - User, 1 - Master);</font>

<p>
<font face="Times New Roman" size=2>^ Бит 8 определяет степень защиты (0 - High, 1 - Maximum).</font>

<p>
<font face="Times New Roman" size=2>Слова 1-16 содержат пароль, остальные игнорируются. При<br>
установке главного пароля состояние защиты не меняется.</font>

<p>
<font face="Times New Roman" size=2>Разблокировать устройство позволяет команда <i>Security<br>
Unlock,</i> при этом необходимо указать пароль пользователя.<br>
Если пароль утерян, можно использовать главный пароль,<br>
но доступ к данным будет предоставлен, только если была<br>
выбрана степень защиты High. Если была выбрана степень<br>
защиты Maximum, разблокировать устройство по главному<br>
паролю можно только командой <i>Security Erase Unit,</i> но при<br>
этом вся информация с носителя будет стерта. Чтобы за-<br>
страховаться от случайного стирания, непосредственно пе-<br>
ред этой командой должна быть выполнена команда <i>Security<br>
Erase Prepare.</i> Команда <i>Security Freeze Lock</i> блокирует вы-<br>
полнение любых команд защиты до следующего сброса. Для<br>
осложнения подбора пароля (его длина составляет 32 байт)<br>
служит счетчик неудачных попыток разблокировки, по сра-<br>
батывании которого команды разблокировки будут отвер-<br>
гаться до выключения питания или аппаратного сброса. От-<br>
менить защиту разблокированного устройства можно<br>
командой <i>Security Disable Password</i> (предъявив один из двух<br>
паролей).</font>
<hr>

<p>
<font face="Times New Roman" size=2>Команды защиты в АТА-4 дополнены ограничением макси-<br>
мального адреса, доступного пользователю (сообщаемого<br>
в блоке параметров идентификации), командой <i>Set Max<br>
Address.</i> Узнать реальный максимальный адрес позволяет<br>
команда <i>Read Native Address.</i></font>

<p>
<font face="Times New Roman" size=2>Для предупреждения о возможном отказе устройства слу-<br>
жит технология <i>SMART</i> (Self-Monitoring, Analysis and<br>
Reporting Technology - технология самонаблюдения, анали-<br>
за и сообщений). <i>Предсказуемые отказы</i> (Predictable Failure)<br>
появляются в результате выхода параметров за некоторый<br>
порог. Отслеживаемые параметры: время разгона до заданной<br>
скорости, время позиционирования, процент ошибок пози-<br>
ционирования, высота полета головок, производительность<br>
(зависящая от числа повторов), количество использованных<br>
резервных секторов и др. Мониторинг может осуществлять-<br>
ся двояко: в рабочем режиме <i>(On-Line)</i> одновременно с вы-<br>
полнением команд хоста (при некотором возможном замед-<br>
лении). Мониторинг <i>Off-Line</i> выполняется устройством в<br>
паузе между "полезными" командами, не снижая произво-<br>
дительности. Если во время выполнения этой процедуры<br>
придет внешняя команда, то мониторинг прервется на вре-<br>
мя исполнения команды, но начало исполнения команды<br>
может задержаться на время до двух секунд. Значения ат-<br>
рибутов, за которыми ведется наблюдение, сохраняются в<br>
энергонезависимой памяти устройства.</font>

<p>
<font face="Times New Roman" size=2>Для непакетных устройств имеется команда <i>Smart</i> (пакет-<br>
ные используют для этих целей собственный протокол), под-<br>
команды которой задаются через регистр свойств. Из этих<br>
подкоманд стандартизованы следующие:</font>

<p>
<font face="Times New Roman" size=2>^ <i>Smart Read Data</i> (DOh) - чтение блока данных SMART;</font>

<p>
<font face="Times New Roman" size=2>^ <i>Smart Enable/Disable Attribute Autosave</i> (D2h) -управле-<br>
ние автосохранением атрибутов;</font>

<p>
<font face="Times New Roman" size=2>^ <i>Smart Save Attribute Values</i> (D3h) - сохранение значений<br>
атрибутов;</font>

<p>
<font face="Times New Roman" size=2>^ <i>Smart Execute Off-Line Immediate</i> (D4h) - немедленное<br>
выполнение мониторинга Off-Line;</font>

<p>
<font face="Times New Roman" size=2>^ <i>Smart Enable Operations</i> (D8h) - разрешение команд и<br>
внутренних функций SMART;</font>
<hr>

<p>
<font face="Times New Roman" size=2>^ <i>Smart Disable Operations</i> (D9h) - запрет команд и функ-<br>
ций SMART;</font>

<p>
<font face="Times New Roman" size=2>^ <i>Smart Return Status</i> (DAh) - опрос результатов монито-<br>
ринга. Если какой-либо порог перейден, регистры <i>СН</i> и<br>
<i>CL</i> будут иметь значения C2h и 4Fh соответственно, если<br>
все в порядке - 2Ch и F4h.</font>

<p>
<font face="Times New Roman" size=2><i>Команда загрузки микрокода Download Microcode</i> позволяет<br>
модифицировать <i>firmware -</i> встроенное ПО устройства. В<br>
зависимости от кода в регистре свойств загруженный мик-<br>
рокод будет действовать до выключения питания (Ffl=01h)<br>
или постоянно (РД=07п). Количество загруженных блоков<br>
задается регистром <i>SN</i> (старший байт) и SC (младший байт).<br>
Таким образом может быть загружено от 0 до 33 553 920 байт,<br>
что более чем достаточно для встроенного ПО. Некоррект-<br>
ная модификация кода может привести к выходу устрой-<br>
ства из строя.</font>

<p>
<font face="Times New Roman" size=4><b>6.4. Протоколы взаимодействия хоста<br>
и устройства</b></font>

<p>
<font face="Times New Roman" size=2>Обычный протокол взаимодействия хоста с устройством<br>
выглядит следующим образом:</font>

<p>
<font face="Times New Roman" size=2>1. Хост читает регистр состояния устройства, дожидаясь<br>
нулевого значения бита <i>BSY.</i> Если присутствуют два уст-<br>
ройства, хост обращается к ним "наугад" - состояние<br>
будет сообщать последнее выбранное устройство.</font>

<p>
<font face="Times New Roman" size=2>2. Дождавшись освобождения устройства, хост записывает<br>
в регистр <i>DH</i> байт, у которого бит <i>DEV</i> указывает на ад-<br>
ресуемое устройство. Здесь кроется причина невозмож-<br>
ности параллельной работы двух устройств на одной шине<br>
АТА: обратиться к устройству можно только после осво-<br>
бождения обоих устройств.</font>

<p>
<font face="Times New Roman" size=2>3. Хост читает основной или альтернативный регистр со-<br>
стояния адресованного устройства, дожидаясь признака<br>
готовности <i>(DRDY=i),</i></font>

<p>
<font face="Times New Roman" size=2>4. Хост заносит требуемые параметры в блок командных<br>
регистров.</font>
<hr>

<p>
<font face="Times New Roman" size=2>5. Хост записывает код команды в регистр команд.</font>

<p>
<font face="Times New Roman" size=2>6. Устройство устанавливает бит <i>BSY</i> и переходит к испол-<br>
нению команды. Дальнейшие действия зависят от прото-<br>
кола передачи данных, заданного командой (см. графу<br>
"Протокол" в табл. 6.4).</font>

<p>
<font face="Times New Roman" size=2>Для команд, <i>не требующих передачи данных (ND):</i></font>

<p>
<font face="Times New Roman" size=2><i>7.</i> Завершив исполнение команды, устройство сбрасывает<br>
бит <i>BSY</i> и устанавливает запрос прерывания (если он не<br>
запрещен). К этому моменту в регистрах состояния и<br>
ошибок уже имеется информация о результате исполне-<br>
ния. Выполнение завершается.</font>

<p>
<font face="Times New Roman" size=2>Единичное значение бита <i>BSY</i> может промелькнуть между<br>
шагами 6 и 7 так быстро, что хост его не зафиксирует, но<br>
для фиксации факта выполнения команды или ее части и<br>
предназначен запрос прерывания.</font>

<p>
<font face="Times New Roman" size=2>Для команд, требующих <i>чтения данных в режиме PIO (Р1):</i></font>

<p>
<font face="Times New Roman" size=2><i>7.</i> Подготовившись к передаче первого блока данных по<br>
шине АТА, устройство устанавливает бит <i>DRQ.</i> Если была<br>
ошибка, она фиксируется в регистрах состояния и оши-<br>
бок. Далее устройство сбрасывает бит <i>BSY</i> и устанавли-<br>
вает запрос прерывания (если он не запрещен).</font>

<p>
<font face="Times New Roman" size=2>8. Зафиксировав обнуление бита <i>BSY</i> (или по прерыванию),<br>
хост считывает регистр состояния, что приводит к сбро-<br>
су прерывания от устройства.</font>

<p>
<font face="Times New Roman" size=2>9. Если хост обнаружил единичное значение бита <i>DRQ,</i> он<br>
производит чтение первого блока данных в режиме PIO<br>
(адресуясь к регистру данных). Если обнаружена ошиб-<br>
ка, считанные данные могут быть недостоверными.</font>

<p>
<font face="Times New Roman" size=2>После передачи блока данных возможно одно из следующих<br>
действий:</font>

<p>
<font face="Times New Roman" size=2>^ Если на шаге 8 ошибка не обнаружена, а требуется пере-<br>
дача следующего блока, устройство устанавливает бит <i>BSY,<br>
</i>и данная последовательность повторяется с шага 7.</font>
<hr>

<p>
<font face="Times New Roman" size=2>^ Если есть ошибка или передан последний блок данных,<br>
устройство сбрасывает бит <i>DRQ</i> и выполнение команды<br>
завершается.</font>

<p>
<font face="Times New Roman" size=2>Для <i>операций записи данных</i> после шага 6 для устройства<br>
начинается активная фаза записи на носитель, что отмеча-<br>
ется установкой бита <i>BSY.</i></font>

<p>
<font face="Times New Roman" size=2>Для команд, требующих <i>записи данных в режиме РЮ (РО</i> и Р):</font>

<p>
<font face="Times New Roman" size=2>7. Подготовившись к приему первого блока данных по шине<br>
АТА, устройство устанавливает бит <i>DRQ</i> (если нет оши-<br>
бок) и сбрасывает бит <i>BSY.</i> Если была ошибка, она фик-<br>
сируется.</font>

<p>
<font face="Times New Roman" size=2>8. Зафиксировав обнуление бита <i>BSY,</i> хост считывает регистр<br>
состояния.</font>

<p>
<font face="Times New Roman" size=2>9. Если хост обнаружил единичное значение бита <i>DRQ,</i> он<br>
производит запись первого блока данных в режиме РЮ<br>
по адресу в регистре данных.</font>

<p>
<font face="Times New Roman" size=2>10. После передачи блока данных возможно одно из следую-<br>
щих действий:</font>

<p>
<font face="Times New Roman" size=2>^ Если обнаружена ошибка, устройство сбрасывает бит <i>DRQ,<br>
</i>устанавливает запрос прерывания и выполнение коман-<br>
ды завершается. Переданные по шине данные остаются<br>
необработанными устройством (не записываются на но-<br>
ситель).</font>

<p>
<font face="Times New Roman" size=2>^ Если ошибка не обнаружена, устройство устанавливает<br>
бит <i>BSY</i> и переходит к следующему шагу.</font>

<p>
<font face="Times New Roman" size=2>11. Устройство обрабатывает принятый блок данных, затем:</font>

<p>
<font face="Times New Roman" size=2><i>"</i> если нет ошибок и обработанный блок - последний, уст-<br>
ройство сбрасывает бит <i>BSY</i> и устанавливает запрос пре-<br>
рывания, на чем выполнение команды успешно заверша-<br>
ется;</font>

<p align=center>
<font face="Times New Roman" size=2>^ если обнаружена ошибка, выполнение команды заверша-<br>
ется таким же образом, но с установкой бит ошибок;</font>

<p>
<font face="Times New Roman" size=2>^ если нет ошибок и требуется передача следующего бло-<br>
ка, выполняются следующие шаги:</font>
<hr>

<p>
<font face="Times New Roman" size=2>12. По готовности приема следующего блока устройство уста-<br>
навливает бит <i>DRQ,</i> сбрасывает бит <i>BSY и</i> устанавливает<br>
запрос прерывания.</font>

<p>
<font face="Times New Roman" size=2>13. По обнулению бита <i>BSY</i> (или по прерыванию) хост счи-<br>
тывает регистр состояния.</font>

<p>
<font face="Times New Roman" size=2>14. Обнаружив бит <i>DRQ,</i> хост выполняет запись очередного<br>
блока в регистр данных, и последовательность повторя-<br>
ется с шага 11.</font>

<p>
<font face="Times New Roman" size=2>Команды с <i>передачей данных в режиме DMA</i> выполняются<br>
похожим образом, но:</font>

<p>
<font face="Times New Roman" size=2>^ Вместо PIO используется прямой доступ к памяти. Хост<br>
должен проинициализировать канал DMA до записи кода<br>
в регистр команд, чтобы по появлении сигнала <i>DMARQ<br>
</i>начался обмен.</font>

<p align=center>
<font face="Times New Roman" size=2>1s Запрос прерывания даже в многосекторных передачах<br>
производится один раз - по выполнении команды.</font>

<p>
<font face="Times New Roman" size=4><b>6.5. Протоколы и режимы передачи данных</b></font>

<p>
<font face="Times New Roman" size=2>Программа общается с устройствами АТА через регистры,<br>
используя инструкции ввода/вывода <i>IN</i> и <i>OUT.</i> Для переда-<br>
чи данных с максимальной скоростью применяют программ-<br>
ный доступ к регистру данных или DMA. Тип обмена зада-<br>
ется командой. Программный доступ обязателен для всех<br>
устройств. Команды режима DMA устройствами могут не<br>
поддерживаться.</font>

<p>
<font face="Times New Roman" size=2><i>Программный доступ PIO</i> (Programmed Input/Output) вы-<br>
полняется в виде следующих друг за другом операций чте-<br>
ния или записи в пространстве ввода/вывода по адресу ре-<br>
гистра данных. В отличие от программно-управляемого<br>
ввода/вывода, применяемого, например, для общения с LPT-<br>
портом, передача блока данных в режиме PIO производится<br>
без программного опроса какого-либо бита готовности для<br>
передачи каждого слова. Готовность устройства проверяется<br>
перед началом передачи блока, после чего хост производит<br>
серию операций в определенном темпе. Темп определяется<br>
выбранным режимом <i>PIO Mode.</i> Для режимов определены</font>
<hr>

<p>
<font face="Times New Roman" size=2>допустимые параметры временной диаграммы цикла обме-<br>
на (табл. 6.10). Обмен PIO программно реализуется с помо-<br>
щью инструкций ввода/вывода строк <i>REP INS</i> или <i>REP OUTS<br>
с</i> занесенным в регистр СХ количеством слов (или байт) в<br>
передаваемом блоке. Эти инструкции обеспечивают макси-<br>
мально возможную скорость обмена для данного процессо-<br>
ра и системной шины. "Обуздать" процессор в соответствии<br>
с выбранным режимом входит в задачу адаптера АТА, кото-<br>
рый использует для удлинения цикла сигнал готовности<br>
шины (для ISA - IOCHRDY). Традиционные режимы 0, 1 и 2<br>
имеют временные параметры, фиксируемые только хост-адап-<br>
тером. Для прогрессивных режимов АТА-2 (PIO Mode 3 и<br>
старше) устройство может затормозить обмен, используя<br>
сигнал готовности IORDY. Программный обмен на все время<br>
передачи блока занимает и процессор, и системную шину.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>PIO<br>
mode</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>МимимаяьмА"</font>

<p>
<font face="Times New Roman" size=1>ГяП-М^ЧОЛвтЧ^С</font>

<p>
<font face="Times New Roman" size=1>время цикла, нс</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Скорость<br>
передачи,<br>
Мбайт/с</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Интерфейс</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>600</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>3,3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>АТА</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>383</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>5,2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>АТА</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>240</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>8,3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>АТА</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>180</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>11,1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>E-IDE, АТА-2<br>
(используется IORDY)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>120</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>16,6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>E-IDE, Fast АТА-2<br>
(используется IORDY)</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2><i>Обмен по каналу DMA</i> занимает исключительно шины ввода/<br>
вывода и памяти. Процессору требуется выполнить только<br>
процедуру инициализации канала, после чего до прерывания<br>
от устройства в конце передачи блока он свободен (этим мо-<br>
гут воспользоваться многозадачные системы). Стандартные<br>
каналы DMA шины ISA для интерфейса АТА практически<br>
не используются из-за низкой пропускной способности. Вы-<br>
сокопроизводительные адаптеры АТА могут иметь собствен-<br>
ные более эффективные контроллеры. Режимы обмена по ка-<br>
налу DMA бывают одиночными и множественными. При<br>
<i>одиночном режиме (Single Word DMA)</i> устройство для переда-</font>
<hr>

<p>
<font face="Times New Roman" size=2>чи каждого слова вырабатывает сигнал запроса DMARQ и сбра-<br>
сывает его по сигналу DMACK#, подтверждающему цикл об-<br>
мена. При <i>множественном режиме (Multiword DMA)</i> на сиг-<br>
нал DMARQ хост отвечает потоком циклов, сопровождаемых<br>
сигналами DMACK#. Если устройство не справляется с пото-<br>
ком, оно может приостановить его снятием сигнала DMARQ, а<br>
по готовности установить его снова. Множественный режим<br>
позволяет развить более высокую скорость передачи.</font>

<p>
<font face="Times New Roman" size=2>Новейшее достижение - режим <i>Ultra DMA,</i> позволяющий до-<br>
стигнуть скорости передачи 33 Мбайт/с и обеспечить досто-<br>
верность передачи, чего не делалось ни в PIO, ни в стандарт-<br>
ных режимах DMA (а зря!). Стандартом АТА-4 определено 3<br>
режима Ultra DMA (0, 1 и 2), выбор режима осуществляется<br>
командой <i>Set Features.</i> В режимах Ultra DMA сигналы DMARQ<br>
и DACK# сохраняют свое назначение, а вот смысл сигналов<br>
DIOR#, DIOW# и IORDY на время передачи пакета (Ultra DMA<br>
Burst) существенно меняется (см. 6.1). В пакете данные на<br>
шине сопровождаются стробом, генерируемым источником<br>
данных, причем для синхронизации используются оба пере-<br>
пада сигналов. Это позволяет повысить пропускную способ-<br>
ность шины, не увеличивая частоту переключении сигналов<br>
сверх 8,33 с'1 (этот предел для обычного кабеля достигается в<br>
режиме PIO Mode 4 и Multiword DMA Mode 2). Каждое пе-<br>
реданное слово участвует в подсчете CRC-кода, который пе-<br>
редается в конце пакета. Подсчет ведется и источником<br>
данных, и приемником. При несовпадении принятого и ожи-<br>
даемого кода фиксируется ошибка передачи. Передача в па-<br>
кете может приостанавливаться, если приемник снимет сиг-<br>
нал готовности (DDMARDY# или HDMARDY#). Передача пакета<br>
может прекращаться по инициативе устройства (снятием сиг-<br>
нала) или хоста (сигналом STOP). Противоположная сторона<br>
должна подтвердить окончание цикла сигналом STOP или<br>
DMARQ соответственно.</font>

<p>
<font face="Times New Roman" size=2>Правильный <i>выбор режима обмена</i> обеспечивает надежность<br>
и производительность. Все устройства поддерживают режим<br>
PIO Mode 0, в котором считывается блок параметров иден-<br>
тификации. В блоке имеются поля, описывающие режим<br>
обмена по умолчанию и более эффективные режимы обме-<br>
на, поддерживаемые устройством. Командой <i>Set Features</i></font>
<hr>

<p>
<font face="Times New Roman" size=2>можно изменить параметры режима. Иногда накопитель не<br>
обеспечивает надежной передачи данных в заявленном вы-<br>
сокоскоростном режиме. Если данные начинают пропадать,<br>
первым делом следует понизить режим обмена.</font>

<p>
<font face="Times New Roman" size=2>Параметры стандартных режимов обмена по DMA приведе-<br>
ны в табл. 6.11.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Режим</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>МмиЫиЯЯШПА ВПАЛАв</font>

<p>
<font face="Times New Roman" size=1>^•--n^4DAB-w^ <i>W^W^^W</i></font>

<p>
<font face="Times New Roman" size=1>цикла,нс</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>Скорость передачи,<br>
Мбайт/с</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Single word DMA Mode 0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>960</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>2,08</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Single word DMA Mode 1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>480</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>4,16</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Single word DMA Mode 2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>240</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>8,33</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Multiword DMA Mode 0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>480</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>4,12</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Multiword DMA Mode 1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>150</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>13,3</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Multiword DMA Mode 2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>120</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>16,6</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Ultra DMA Mode 0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>240*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>16,6</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Ultra DMA Mode 1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>160*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>25</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=1>Ultra DMA Mode 2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>120*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=1>33</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>* В пакете данных режима Ultra DMA за каждый такт передаются два<br>
слова данных, один по фронту синхронизирующего сигнала, другой -<br>
поспаду.</font>

<p>
<font face="Times New Roman" size=2>BIOS определяет режим обмена с каждым устройством с уче-<br>
том ограничений, заданных в Setup. Старые диски, не сооб-<br>
щающие своих параметров, могут не работать со старшими<br>
режимами PIO. На одном шлейфе (канале АТА) могут при-<br>
сутствовать устройства с разным режимом обмена - специ-<br>
фикация это допускает. Однако реально могут возникать<br>
аппаратные или программные ограничения. Некоторые чип-<br>
сеты не позволяют независимо программировать режим об-<br>
мена для устройств канала. В таком случае при подключе-<br>
нии двух разных устройств (например, PIO Mode 1 и 3)<br>
обмен с обоими устройствами будет происходить со ско-<br>
ростью меньшего (PIO Mode 1). Поэтому не рекомендуется<br>
к одному каналу АТА (порту IDE, что то же самое) подклю-<br>
чать быстрый винчестер и медленный CD-ROM. Иногда за-<br>
вязка режимов обмена двух устройств обусловлена ограни-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ченным набором параметров конфигурации в BIOS. Быстрые<br>
режимы множественного обмена по DMA реализуются толь-<br>
ко драйверами ОС. "Глупый" драйвер может попытаться на-<br>
вязать медленный режим обоим устройствам канала, так что<br>
смешивать разные устройства не стоит и по этой причине.</font>

<p>
<font face="Times New Roman" size=2>Протокол обмена <i>PIO</i> хорош только для <i>однозадачных ОС.<br>
Для многозадачных ОС</i> больший интерес представляет обмен<br>
по DMA, если, конечно, поддерживаемый режим обеспечива-<br>
ет приемлемую скорость обмена (с{&gt;авните табл. 6.10 и 6.11).</font>

<p>
<font face="Times New Roman" size=4><b>6.6. Средства многозадачности (ДТА-4)</b></font>

<p>
<font face="Times New Roman" size=2>Главным недостатком интерфейса АТА в многозадачных си-<br>
стемах является то, что когда одно устройство на шине ис-<br>
полняет команду, другое использоваться не может. В этом<br>
АТА существенно уступает SCSI, где устройства на время<br>
длительной внутренней операции могут освобождать шину<br>
и имеется эффективный механизм организации очередей про-<br>
цессов ввода/вывода. Спецификация АТА-4 определяет воз-<br>
можности параллельного выполнения команд обоими ус-<br>
тройствами и создания очередей.</font>

<p>
<font face="Times New Roman" size=2><i>Перекрытие команд - Overlapped Feature -</i> позволяет устрой-<br>
ству, занятому длительной внутренней операцией, освобо-<br>
дить шину. Для этого устройство должно сбросить биты <i>DRQ<br>
</i>и <i>BSY</i> регистра состояния. По окончании выполнения опе-<br>
рации устройство устанавливает бит <i>SERVB</i> своем регистре<br>
состояния. Если хост намерен использовать шину для обра-<br>
щения к другому устройству, он должен запретить прерыва-<br>
ния от устройства, установив бит <i>nIEN</i> в регистре управле-<br>
ния. После того как хост вернется к обслуживанию<br>
устройства, он должен послать ему команду <i>NOP с</i> подко-<br>
мандой 01 для получения информации о состоянии. При<br>
этом он может разрешить прерывание, которое произойдет<br>
по готовности устройства к продолжению. Обнаружив уста-<br>
новленный бит <i>SERV,</i> хост посылает команду <i>Service,</i> кото-<br>
рая вызовет продолжение исполнения команды, во время<br>
которой шина освобождалась. Принятый механизм продол-<br>
жения менее эффективен, чем в SCSI, - он требует привле-<br>
чения хоста для обнаружения готовности устройства. Пере-</font>
<hr>

<p>
<font face="Times New Roman" size=2>крытие допускается только для команд <i>NOP</i> (с подкоман-<br>
дой 01), <i>Packet, Read DMA Queued, Service</i> и <i>Write DMA<br>
Queued.</i></font>

<p>
<font face="Times New Roman" size=2>Устройства могут поддерживать <i>очереди команд,</i> но только<br>
для команд, допускающих перекрытие (эти свойства тесно<br>
связаны). Если при наличии команд в очереди устройство<br>
получает команду, не входящую в этот список, команда от-<br>
вергается (с соответствующим битом в регистре ошибок) и<br>
очередь сбрасывается. Глубина очереди, поддерживаемой<br>
устройством, сообщается в блоке параметров идентифика-<br>
ции. Команды ставятся в очередь с уникальным идентифи-<br>
катором-тегом, который передается через регистр счетчика<br>
секторов. После исполнения команды <i>Service</i> значение тега<br>
для обслуживаемой команды считывается из того же регис-<br>
тра, что позволяет ее идентифицировать. Если устройство<br>
получает команду со значением тега, которое уже присут-<br>
ствует в очереди, и новая, и старая команды отвергаются<br>
(состояние не определено). При возникновении любой ошиб-<br>
ки вся очередь сбрасывается. Следующая команда в очередь<br>
посылается лишь при освобожденной шине. Перед посыл-<br>
кой хост должен запретить прерывания, а разрешить их мо-<br>
жет только после посылки новой команды. Если для выпол-<br>
нения команды устройству не нужно освобождать шину,<br>
команда будет выполнена немедленно, а находящиеся в оче-<br>
реди команды, освободившие шину, будут выполнены поз-<br>
же. Очереди SCSI более эффективны как по набору команд<br>
(в очередь ставятся процессы, которые могут представлять<br>
собой цепочки команд), так и по гибкости управления. SCSI<br>
также обеспечивает независимость исполнения одних команд<br>
очереди от результатов выполнения других.</font>

<p>
<font face="Times New Roman" size=4><b>6.7. Пакетный интерфейс АТДР1</b></font>

<p>
<font face="Times New Roman" size=2>Для подключения к интерфейсу АТА накопителей CD-ROM<br>
и стриммеров (а также других устройств) набора регистров<br>
и системы команд АТА недостаточно. Для них существует<br>
аппаратно-программный интерфейс <i>ATAPI</i> (АТА Package<br>
Interface - пакетный интерфейс АТА). <i>Устройство ATAPI<br>
</i>поддерживает минимальный набор команд АТА, который</font>
<hr>

<p>
<font face="Times New Roman" size=2>неограниченно расширяется 16-байтным командным <i>паке-<br>
том,</i> посылаемым хост-контроллером в регистр данных уст-<br>
ройства по команде <i>Packet.</i> Структура командного пакета<br>
пришла от SCSI, что обеспечивает схожесть драйверов для<br>
устройств со SCSI и ATAPI. Классификация устройств совпа-<br>
дает с принятой в SCSI (см. табл. 5.12), класс устройства<br>
сообщается им в начале блока параметров идентификации.</font>

<p>
<font face="Times New Roman" size=2>Интерфейс ATAPI может использоваться с неинтеллектуаль-<br>
ными адаптерами АТА, поскольку для хост-адаптера поддержка<br>
ATAPI может выполняться чисто программно. Сложные кон-<br>
троллеры АТА, имеющие кэш-память и собственный процес-<br>
сор, неориентированные на интерфейс ATAPI, могут не дога-<br>
даться, что в регистр данных устройства кроме 512-байтных<br>
блоков данных можно записывать 16-байтный с командным<br>
пакетом. Устройства ATAPI имеют следующие особенности:</font>

<p>
<font face="Times New Roman" size=2>^ Команду <i>Identify Device</i> они должны отвергать, чтобы хост<br>
не пытался к ним обратиться как к АТА-устройствам. Для<br>
идентификации устройств ATAPI предназначена специ-<br>
альная команда <i>Identify Packet Device,</i> а блок параметров,<br>
сообщаемых устройством, трактуется иначе (табл. 6.12).</font>

<p>
<font face="Times New Roman" size=2>^ Для программного сброса устройства ATAPI предназна-<br>
чена команда <i>Device Reset,</i> которую устройства АТА от-<br>
вергают. Программный сброс через регистр управления<br>
не прекращает выполнения команды <i>Packet</i></font>

<p>
<font face="Times New Roman" size=2>^ Специфические команды вместе с необходимыми пара-<br>
метрами передаются по команде <i>Packet,</i> код которой яв-<br>
ляется недействительным для устройств АТА.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Общая конфигурационная информация<br>
</i>Биты [15:14] = 10 для всех устройств ATAPI<br>
Бит 13 - зарезервирован<br>
Биты 12-8 - набор поддерживаемых команд<br>
(класс устройства)<br>
Бит 7: 1 - устройство со сменным носителем<br>
Бит 6-5:<br>
00 - устройство установит <i>DRQ</i> в течение<br>
3 мс после получения комавды <i>Packet,</i></font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>01 - устройство введет INTRQ по установке<br>
<i>DRQ</i> после получения команды <i>Packet,<br>
</i>10 - устройство установит <i>DRQ</i> в течение<br>
50 мкс после получения команды <i>Packet,<br>
</i>11 -зарезервировано<br>
Биты 4-2 - зарезервированы<br>
Биты 1-0 - длина командного пакета:<br>
00-12 байт,<br>
01 -16 байт,<br>
1х - зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>1-9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>10-19</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Серийный номер</i> (20 символов ASCII), если<br>
слово 10 не нулевое; иначе - специфичная<br>
информация</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>20-22</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>23-26</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Версия встроенного ПО</i> (8 символов ASCII), если<br>
слово 23 не нулевое; иначе - специфичная<br>
информация</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>27-46</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Номер модели</i> (40 символов ASCII), если<br>
слово 27 не нулевое; иначе - специфичная<br>
информация</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>47-48</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>49</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Возможности:</i></font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 15: 1 - поддержка чередующегося<br>
(interleaved) DMA</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 14: 1 - поддержка очередей команд</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 13: 1 - поддержка перекрывающихся<br>
команд</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 12: 1 - требуется программный сброс<br>
(устарело)</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 11:<br>
1 - IORDY поддерживается (для PIO Mode 3<br>
и выше - обязательно),<br>
0 - IORDY не обязано поддерживаться</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 10: 1 - сигнал IORDY может быть запрещен<br>
командой Set <i>Features</i></font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 9: 1 - поддержка LBA</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 8: 1 - поддержка DMA</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 7-0 специфичны</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>50</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>51</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F<br>
X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>БИТЬ! 15-8: номер PIO Mode<br>
Биты 7-0 специфичны</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>52</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>53</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R<br>
F</font>

<p>
<font face="Times New Roman" size=2>F<br>
V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-3 зарезервированы<br>
Бит 2:<br>
1 - поля в слове 88 действительны,<br>
О-нет</font>

<p>
<font face="Times New Roman" size=2>Бит1:<br>
1 - поля в словах 64-70 действительны,<br>
0-нет<br>
Устройство, поддерживающее PIO Mode 3<br>
и старше или Multiword DMA Mode 1 и выше,<br>
должно использовать эти поля</font>

<p>
<font face="Times New Roman" size=2>Бит 0:<br>
1 - поля в словах 54-58 действительны,<br>
0 - поля могут быть действительны</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>54-62</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>63</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>

<p>
<font face="Times New Roman" size=2>R<br>
V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Режим множественного обмена Multiword DMA:<br>
</i>Биты 15-11 зарезервированы<br>
Биты 10-8: активный режим: бит 8=1 - Mode 0,<br>
бит 9=1 - Mode 1 и т. д. Единичное значение<br>
может иметь только один бит</font>

<p>
<font face="Times New Roman" size=2>Биты 7-3 зарезервированы<br>
Биты 2-0: поддерживаемые режимы: бит 0=1 -<br>
Mode 0, бит 1-1 - Mode 1 и т. д.</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>64</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R<br>
F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-8 зарезервированы</font>

<p>
<font face="Times New Roman" size=2>Биты 7-0 - <i>поддерживаемые прогрессивные<br>
режимы, программного обмена (Advanced PIO):<br>
</i>бит 0=1 - PIO Mode 3, бит l-l - PIO Mode 4,<br>
биты 2-7 - зарезервированы</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>65</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Минимальная длительность цикла передачи<br>
множественного DMA</i> (в наносекувдах)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>66</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Рекомендованная длительность цикла передачи<br>
множественного DMA</i> (в наносекувдах).<br>
При многосекторной передаче обеспечивает<br>
оптимальную скорость, при которой устройство<br>
не тормозит поток снятием запроса DMARQ</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>67</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Минимальная длительность цикла передачи PIO<br>
без использования сигнала готовности<br>
</i>(в наносекундах)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>68</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Минимальная длительность цикла передачи PIO<br>
с использованием сигнала готовности<br>
</i>(в наносекундах)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>69-70</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервированы для поддержки перекрытия<br>
команд и очередей</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>71</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Типовое время от получения команды <i>Packet</i> до<br>
освобождения шины (в наносекундах)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>72</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Типовое время от получения команды <i>Service<br>
</i>до сброса <i>BSY</i> (в наносекундах)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>73-74</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервирован о</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>75</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Глубина очереди команд:</i> биты 15-5 -<br>
зарезервированы, биты 4-0 - максимальная<br>
глубина очереди</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>76-79</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>80</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Номер основной версии</i> интерфейса<br>
(если не OOOOh или FFFFh):<br>
1 - АТА-1,<br>
2 - АТА-2 и т. д.</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>81</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Младший номер версии</i> интерфейса<br>
(если не OOOOh или FFFFh)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>82</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Поддержка команд и свойств (если слова 82<br>
и 83 не равны OOOOh или FFFFh):<br>
Бит 15 - не используется<br>
Бит 14 - команды <i>Nop<br>
</i>Бит 13 - команды <i>Read Buffer<br>
</i>Бит 12 - команды <i>Write Buffer<br>
</i>Бит 11 - не используется<br>
Бит 10 - ограничение доступного пространства<br>
Бит 9 - команда <i>Device Reset<br>
</i>Бит 8 - вырабатывание прерывания во время<br>
команды <i>Service<br>
</i>Бит 7 - прерывание по освобождению шины<br>
Бит 6 - кэширование с упреждающим чтением<br>
Бит 5 - кэширование записи<br>
Бит 4 - команда <i>Packet<br>
</i>Бит 3 - управление энергопотреблением<br>
Бит 2 - смена носителя<br>
Бит 1 - команды <i>Security<br>
</i>Бит 0 - <i>SMART</i></font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>83</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Поддержка команд и свойств</i> (как и слово 82):<br>
Бит 15=0<br>
Бит 14 = 1<br>
Биты 13-5 -зарезервированы<br>
Бит 4 - уведомление о смене носителя<br>
Биты 3-1 - зарезервированы<br>
Бит 0 - команда <i>Download Microcode</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>84</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Поддержка команд и свойств</i> (если слова 82, 83<br>
и 84 не равны ООООЬ или FFFFh):<br>
Бит 15-0<br>
Бит 14 = 1<br>
Биты 13-0-зарезервированы</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>85-87</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Разрешенные команды и свойства -</i> поля<br>
и правила аналогичны словам 82-84</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>88</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>

<p>
<font face="Times New Roman" size=2>R<br>
V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Режим Ultra DMA:<br>
</i>Биты 15-11 -зарезервированы<br>
Биты 10-8 - активный режим Ultra DMA:<br>
бит 8&deg;1 - Mode 0,<br>
бит 9=1 - Mode 1 и т. д. Единичное значение<br>
может иметь только один бит</font>

<p>
<font face="Times New Roman" size=2>Биты 7-3 - зарезервированы<br>
Биты 2-0 - поддерживаемые режимы<br>
одиночного обмена DMA:<br>
бит 0=1 - Mode 0,<br>
бит <i>i=&deg;i -</i> Mode 1 и т. д.</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>89-126</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>127</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R<br>
F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Биты 15-2 -зарезервированы<br>
Биты 1-0 - уведомление о смене носителя:<br>
00 - не поддерживается,<br>
01 -поддерживается,<br>
1х - зарезервированы</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>128</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Состояние защиты:<br>
</i>Биты 15-9 - зарезервированы<br>
Бит 8 - уровень защиты:<br>
0 - высокий,<br>
1 -максимальный<br>
Биты 7-6 - зарезервированы<br>
Бит 5: 1 - поддержка расширенного защитного<br>
стирания<br>
Бит 4: 1 - счетчик попыток иссяк<br>
Бит 3: 1 - команды защиты блокированы</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Слово</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>F/V</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит 2: 1 - устройство заблокировано<br>
Бит 1:1- защита разрешена<br>
Бит 0: 1 - защита поддерживается</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>129-159</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>X</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Специфично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>160-255</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>R</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервировано</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2><i>При подаче команды Packet</i> регистр свойств <i>FR</i> содержит<br>
признаки команды:</font>

<p>
<font face="Times New Roman" size=2>^ Бит 0 - <i>DMA -</i> является указанием на использование<br>
DMA или Ultra DMA для обмена данными.</font>

<p>
<font face="Times New Roman" size=2>^ Бит 1 - <i>OVL -</i> является признаком возможности пере-<br>
крывающегося выполнения.</font>

<p>
<font face="Times New Roman" size=2>Регистры <i>СН</i> и <i>CL</i> содержат лимит счетчика байт данных,<br>
передаваемых по каждому введению <i>DRQ</i> в режиме PIO. Если<br>
команда не предусматривает обмена данными, поле игнори-<br>
руется. Если общее число требуемых байт данных превыша-<br>
ет лимит, значение лимита задается четным. Если оно равно<br>
или меньше лимита, лимит нечетен. Значение лимита FFFFh<br>
воспринимается устройством как FFFEh. Лимит счетчика,<br>
как и бит DMA, к передаче пакета отношения не имеет.</font>

<p>
<font face="Times New Roman" size=2>Регистр <i>DH</i> используется только для выбора устройства. Для<br>
устройств, поддерживающих очереди команд, биты [7:3] ре-<br>
гистра SC содержат тег (Tag).</font>

<p>
<font face="Times New Roman" size=2><i>После подачи команды</i> регистр SC кроме тега будет содер-<br>
жать следующие биты:</font>

<p>
<font face="Times New Roman" size=2>^ Бит 2 - <i>PEL</i> (Release) - признак освобождения шины (для<br>
перекрывающихся команд).</font>

<p>
<font face="Times New Roman" size=2>^ Бит 1 - <i>I/O</i> (Input/Output) - указатель направления пе-<br>
редачи данных (0 - передача к устройству, 1 - к хосту).</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Бит 0 - <i>C/D</i> (Command/Data) - признак передачи коман-<br>
ды (1) или данных (0).</font>

<p>
<font face="Times New Roman" size=2>В <i>регистре состояния</i> некоторые биты получают новое на-<br>
значение:</font>

<p>
<font face="Times New Roman" size=2>^ Бит 5 - <i>DMRDY(DMA</i> Ready) - при ОЯО=1 использует-<br>
ся как признак готовности к обмену в режиме (Ultra)</font>
<hr>

<p>
<font face="Times New Roman" size=2>DMA. При <i>DRQ=0</i> является признаком отказа устрой-<br>
ства <i>DF</i> (Device Fault).</font>

<p>
<font face="Times New Roman" size=2>^ Бит 4 - <i>SERV</i> (Service) - признак готовности к обслужи-<br>
ванию команды, освободившей шину.</font>

<p>
<font face="Times New Roman" size=2>^ Биты 1, 2 не используются.</font>

<p>
<font face="Times New Roman" size=2><i>щ</i> Бит 0 - <i>СНК</i> (Check) - признак ошибки.</font>

<p>
<font face="Times New Roman" size=2>Остальные биты сохранили обычное назначение.</font>

<p>
<font face="Times New Roman" size=2>После подачи команды <i>Packet</i> хост определяет состояние<br>
устройства, прочитав его регистры. Возможны следующие<br>
варианты:</font>

<p>
<font face="Times New Roman" size=2>^ <i>Ожидание команды Packet</i> в регистре SC биты <i>C/D=</i> 1,<br>
<i>1/0=0, REL=0,</i> поле <i>Tag</i> содержит ранее установленное зна-<br>
чение. В регистре состояния <i>BSY-0, DMRDY=0, СНК=0,<br>
DRQ=i,</i> бит <i>SERV</i> может указывать на наличие команды,<br>
ожидающей обслуживания.</font>

<p>
<font face="Times New Roman" size=2><i>т Передача данных:</i> в регистре SC биты <i>C/D=Q, REL=0, I/O<br>
</i>указывает на направление передачи. Регистры <i>СН, CL</i> при<br>
использовании PIO содержат счетчик байт данных. В ре-<br>
гистре состояния <i>BSY=0, DRQ-i, СНК=0, DMRDY</i> указы-<br>
вает на использование DMA, бит <i>SERV</i> может указывать<br>
на наличие команды, ожидающей обслуживания.</font>

<p>
<font face="Times New Roman" size=2>^ <i>Освобождение шины:</i> в регистре SC биты C/D=0, <i>1/0=0,<br>
REL=i,</i> поле <i>Tag</i> содержит тег. В регистре состояния<br>
<i>BSY=0, DMRDY=0, СНК=0, DRQ=0,</i> бит <i>SERV</i> может ука-<br>
зывать на наличие команды, ожидающей обслуживания.</font>

<p>
<font face="Times New Roman" size=2>йй <i>Запрос обслуживания:</i> в регистре SC биты C/D=0, //0=0,<br>
<i>REL=i,</i> поле <i>Tag</i> содержит тег. В регистре состояния<br>
<i>BSY=0, DMRDY=0, CHK-0, DRQ-0, бит SERV=i.</i></font>

<p>
<font face="Times New Roman" size=2><i>m Успешное завершение:</i> в регистре SC биты C/D=1,<i>1/0=1,<br>
REL=0,</i> поле <i>Tag</i> содержит тег. В регистре состояния<br>
<i>BSY=0, DRDY=i, CHK=0, DRQ=0, бит SERV может</i> указы-<br>
вать на наличие команды, ожидающей обслуживания.</font>

<p>
<font face="Times New Roman" size=2><i>m Завершение с ошибкой</i> (только после передачи последнего<br>
байта пакета): в регистре SC биты C/D=1, //0=1, <i>REL=0,<br>
</i>поле <i>Tag</i> содержит тег. В регистре состояния <i>BSY=0,<br>
DRDY=i, DRQ^O,</i> DF=1 при отказе устройства, <i>CHK=i,</i> если</font>
<hr>

<p>
<font face="Times New Roman" size=2>регистр ошибок содержит код ошибки" бит <i>SERV</i> может<br>
указывать на наличие команды, ожидающей обслужива-<br>
ния. В регистре ошибок биты 0 и 1 трактуются в зависи-<br>
мости от команды, бит 2 - признак отвергнутой команды<br>
<i>(ABR7),</i> биты [7:4] могут содержать уточненное состояние.</font>

<p>
<font face="Times New Roman" size=2>Структуру командного пакета см. в 5.5. При любой длине<br>
блока дескрипторов, определяемой кодом команды (нулевой<br>
байт пакета), передаваемый пакет имеет длину 16 байт, но<br>
используется только указанное количество байт. Систему<br>
команд и структуру пакетов стандарт ATA/ATAPI-4 не опи-<br>
сывает, но для каждого класса устройств существует стан-<br>
дартизованный набор команд с определенной структурой<br>
пакетов.</font>

<p>
<font face="Times New Roman" size=4><b>6.8. Адаптеры шины АТА и категории<br>
устройств IDE</b></font>

<p>
<font face="Times New Roman" size=2>Простейший <i>адаптер АТА</i> содержит только буферы сигна-<br>
лов шины и дешифратор зоны адресов. Все регистры кон-<br>
троллера и схемы кодирования размещены в самом устройст-<br>
ве IDE. Шина АТА требует выделения системных ресурсов -<br>
двух областей портов ввода/вывода и линии прерывания;</font>

<p>
<font face="Times New Roman" size=2>дополнительно может использоваться канал DMA. Интер-<br>
фейсу АТА первого канала выделили ресурсы, ранее исполь-<br>
зовавшиеся контроллером жестких дисков. Второму каналу<br>
назначили ресурсы альтернативного контроллера жестких<br>
дисков. Позже определили ресурсы еще для двух каналов<br>
(табл. 6.13). Традиционному контроллеру жестких дисков<br>
выделялся канал DMA3, но он является 8-битным, в то вре-<br>
мя как шина АТА требует 16-битного канала DMA. Произ-<br>
водительности стандартных каналов DMA для шины АТА<br>
явно недостаточно. На системных платах с шиной PCI стан-<br>
дартом является установка <i>двухканального адаптера,</i> зани-<br>
мающего ресурсы каналов 1 и 2. Этот адаптер обеспечивает<br>
шинам АТА 16-битные каналы DMA, поддерживающие вы-<br>
сокоскоростные режимы обмена (см. табл. 6.11). В идеаль-<br>
ном варианте двухканальные контроллеры имеют шины, пол-<br>
ностью изолированные друг от друга буферными и<br>
логическими схемами. В самом дешевом варианте они ис-</font>
<hr>

<p>
<font face="Times New Roman" size=2>пользуют общие буферы для линий данных и управляющих<br>
сигналов и отдельные только для некоторых сугубо индиви-<br>
дуальных сигналов. С точки зрения логики, здесь все в по-<br>
рядке, но следует учитывать нагрузочную способность (вли-<br>
яние паразитных параметров): <i>суммарная длина</i> обоих<br>
шлейфов не должна превышать 46 см, а <i>суммарная емкость<br>
</i>каждой линии со всеми устройствами не должна превышать<br>
35 пФ. Иначе на высокоскоростных режимах обмена возмож-<br>
ны <i>неконтролируемые искажения</i> передаваемых данных.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Канал</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CSO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CS1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>IRQ</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>IFOh-lFZh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3F6h-3F7h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>14</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>170h-177h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>376h-377h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>15 или 10</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>lE8h-lEfh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3EEh-3Efh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>12 или 11</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>168h-16Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>36Eh-36Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>10 или 9</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>Поскольку скорость программного обмена задается хост-адап-<br>
тером, интересно индивидуальное программирование PIO<br>
Mode для каждого канала/устройства. Ряд чипсетов этого не<br>
допускает и при инициализации назначает общий минималь-<br>
ный режим. В результате подключение "тихоходного" уст-<br>
ройства замедляет обмен быстрого соседнего устройства.</font>

<p>
<font face="Times New Roman" size=2>Адаптеры АТА часто размещают на звуковых картах для под-<br>
ключения накопителей CD-ROM. По умолчанию им назна-<br>
чают ресурсы каналов 3 или 4. К этим каналам можно под-<br>
ключать винчестеры, но будет ли их там искать BIOS во время<br>
POST - вопрос. Современные версии BIOS позволяют хра-<br>
нить конфигурационные параметры четырех жестких дисков,<br>
более старые версии - двух. Четыре канала АТА физически<br>
позволяют подключить до восьми накопителей, но работа с<br>
ними лимитирована программными ограничениями.</font>

<p>
<font face="Times New Roman" size=2>Расширенные адаптеры могут иметь аппаратные средства<br>
поддержки высокоэффективных режимов передачи (PIO,<br>
DMA, Bus Master), буферные регистры записи и собствен-<br>
ную кэш-память. Сложные адаптеры аппаратно поддержи-<br>
вают "зеркальные" диски. Некоторые адаптеры позволяют<br>
соединять несколько физических дисков в один логический</font>
<hr>

<p>
<font face="Times New Roman" size=2>на уровне вызовов BIOS (в настоящее время актуальнее об-<br>
ратная задача).</font>

<p>
<font face="Times New Roman" size=2>Существуют гибридные адаптеры для подключения АТА<br>
HDD к шинам XT и МСА или, например, к LPT-порту.</font>

<p>
<font face="Times New Roman" size=2>Интерфейс АТА позволяет подключать <i>устройства различ-<br>
ных категорий,</i> отличающихся "уровнем интеллекта" встро-<br>
енного контроллера. Первые дисковые накопители IDE от-<br>
носятся к категории неинтеллектуальных устройств -<br>
<i>Non-Intelligent IDE.</i> Они не выполняли трансляцию нумера-<br>
ции секторов - их логические параметры совпадали с физи-<br>
ческими. Команды идентификации устройства и установки<br>
параметров не выполнялись. Дефектные блоки, отмеченные<br>
в заводском списке, были видны пользователю. Низкоуров-<br>
невое форматирование выполнялось непосредственно по ко-<br>
манде, так что неудачное форматирование могло понизить<br>
производительность из-за нарушения оптимальных устано-<br>
вок чередования и смещения.</font>

<p>
<font face="Times New Roman" size=2>Более интеллектуальные устройства - <i>Intelligent АТА IDE.<br>
</i>Они способны выполнять расширенные АТА-команды -<br>
идентификацию устройства и установку параметров. Под-<br>
держивается трансляция физических параметров в логичес-<br>
кие. Дефектные сектора скрыты от пользователя (до исчер-<br>
пания резерва). Низкоуровневое форматирование возможно<br>
только при установке логической геометрии, совпадающей с<br>
физической. Однако форматирование опять-таки "сносит"<br>
заводскую оптимизацию. Для ускорения обмена эти устрой-<br>
ства поддерживают блочные режимы передачи <i>Read Multiple<br>
</i>и <i>Write Multiple,</i> а также высокоскоростные режимы обмена<br>
РЮ и DMA.</font>

<p>
<font face="Times New Roman" size=2>К следующей категории относятся устройства с зонным фор-<br>
матом записи - <i>Intelligent Zoned Recording IDE.</i> Поскольку<br>
они имеют различное количество секторов на разных треках<br>
(для повышения плотности хранения), трансляция геомет-<br>
рии является для них обязательной (спецификация АТА не<br>
предусматривает сообщения устройством способа разбиения<br>
на зоны и формата каждой зоны, так что обращаться к ним<br>
можно только по логическому трехмерному (CHS) или ли-<br>
нейному (LBA) адресу).</font>
<hr>

<p>
<font face="Times New Roman" size=2>Устройства IDE отличаются также по интеллектуальности<br>
контроллера: автоматический мониторинг внутренних пара-<br>
метров (SMART), температурная коррекция системы пози-<br>
ционирования, поддержка управления энергопотреблением<br>
и различные усовершенствования, направленные на повы-<br>
шение производительности.</font>

<p>
<font face="Times New Roman" size=4><b>6.9. Конфигурирование устройств</b></font>

<p>
<font face="Times New Roman" size=2>Устройства АТА перед подключением к шине должны быть<br>
корректно сконфигурированы. Конфигурирование подразу-<br>
мевает выбор типа интерфейса и определение адреса устрой-<br>
ства. Тип интерфейса - XT или AT - определяется моделью<br>
накопителя. В изделиях фирмы Seagate тип обозначается<br>
последней буквой в шифре модели: А - АТА (16 бит), Х -<br>
для XT (8 бит), а сочетание АХ означает возможность вы-<br>
бора AT/XT с помощью джампера.</font>

<p>
<font face="Times New Roman" size=2>Существует два способа задания адреса устройства - с по-<br>
мощью кабельной выборки или явным заданием адреса на<br>
каждом из устройств. Режим <i>кабельной выборки</i> включается<br>
перемычкой <i>CS</i> (Cable Select - кабельная выборка). В этом<br>
случае оба устройства на шине конфигурируются одинако-<br>
во-в режим <i>CS,</i> а адрес устройства определяется его поло-<br>
жением на специальном кабеле-шлейфе (рис. 6.2). Кабель-<br>
ная выборка будет работать, если она поддерживается и<br>
задана на всех устройствах канала, включая хост-адаптер, ко-<br>
торый обеспечивает заземление контакта 28. При этом спо-<br>
собе задания адресов исключается синхронизация шпинде-<br>
лей накопителей (актуально в RAID-массивах) через тот же<br>
провод контакта 28. Кабельная выборка применяется редко.<br>
Ее условное преимущество - унификация конфигурирова-<br>
ния устройств, а недостаток - привязка физического поло-<br>
жения устройств к кабелю - ведущее устройство должно<br>
быть ближе к адаптеру, чем ведомое. Возможно подключе-<br>
ние адаптера к среднему разъему, а устройств - к крайним,<br>
но это не всегда удобно.</font>

<p>
<font face="Times New Roman" size=2>Более распространен режим явной адресации, при котором<br>
используется обычный "прямой" кабель (см. рис. 6.1). В этом<br>
случае перемычка <i>CS</i> не устанавливается, а адрес устрой-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ства задается перемычками, состав которых варьируется. В<br>
принципе, достаточно лишь указать устройству его номер<br>
(0/1), но в устройствах, разработанных до стандарта АТА,<br>
ведущему устройству "подсказывали" о наличии ведомого<br>
(по интерфейсу АТА оно могло бы это определить само по<br>
сигналу <i>DASP^).</i> Итак, на устройствах IDE можно увидеть<br>
следующие джамперы:</font>

<p>
<font face="Times New Roman" size=2>^ <i>M/S</i> (Master/Slave - ведущее/ведомое) - переключатель<br>
адреса. Если на шине присутствует одно устройство, оно<br>
должно быть сконфигурировано как ведущее. Если на<br>
шине два устройства - одно должно быть ведущим, дру-<br>
гое - ведомым. Иногда джампер обозначается как "&lt;^/D"<br>
(диск С:/диск D:), но для второго канала IDE такое на-<br>
звание некорректно. Когда появились первые IDE-диски<br>
емкостью 1 Гбайт, для преодоления барьера в 504 Мбайт<br>
некоторые модели допускали конфигурирование в виде<br>
двух устройств (0 и 1) половинной емкости. В таком ре-<br>
жиме на их IDE-шлейф второе физическое устройство<br>
подключать нельзя.</font>

<p>
<font face="Times New Roman" size=2>^ <i>SP</i> (Slave Present), <i>DSP</i> (Drive Slave Present), "Master but<br>
Slave is not ATA-compatible", "Master but Slave uses only<br>
PDIAG-signal" - устанавливается на ведущем устройстве<br>
для указания на присутствие ведомого. Если переключа-<br>
тель установлен, а ведомое устройство не подключено,<br>
POST даст сообщение об ошибке. Джампер применяется<br>
для дисков, не использующих сигнал DASP#.</font>

<p>
<font face="Times New Roman" size=2>^ <i>ACT</i> (Drive Active) - устанавливается на Master (встре-<br>
чается редко).</font>

<p>
<font face="Times New Roman" size=2>Для полностью <i>АТА-совместимых</i> дисков перемычка ставится<br>
только на ведомое устройство, а его присутствие ведущее<br>
определит автоматически.</font>

<p>
<font face="Times New Roman" size=2>Разобраться с джамперами старых устройств трудно, если нет<br>
документации. У современных устройств лишние джамперы<br>
упразднили, а существующие комментируются на наклейке-<br>
шильдике. Если джамперы устанавливаются рядом с интер-<br>
фейсным разъемом, вероятно, они расположены в соответствии<br>
со стандартом АТА (рис. 6.4). Здесь буквой k обозначены по-<br>
зиции ключевых (пропущенных) выводов, контакты 1-40 ис-</font>
<hr>

<p>
<font face="Times New Roman" size=2>пользуются для интерфейса, а контакты А-Н - для установ-<br>
ки джамперов (табл. 6.14).</font>

<p>
<img border=0 vspace=3 hspace=3 src="62.jpg"alt="62.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. 6.4.</b> Джамперы на разъемах интерфейса АТА:</font>

<p align=center>
<font face="Times New Roman" size=2>а - SFF8212, <i>б -</i> SFF8057, в - SFF8058</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Выборка</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SFF8212</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SFF8057</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SFF8058</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Используемые контакты</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>A...D</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Е...Н</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>A...F</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Кабельная выборка</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>B-D</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>E-F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>А-В</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Master</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>G-H</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>E-F</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Master при наличии Slave</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>G-H, E-F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>E-F</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Slave</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>А-В</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>C-D</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>Следует учитывать, что <i>перестановка джамперовчасто</i> воспринимается устройством<br>
только <i>по включении питания.</i> Кроме того, установка на один шлейф двух разно-<br>
<u>типных не-АТА-устройств часто невозможна.</u></font>
<hr>

<p>
<font face="Times New Roman" size=5><b>7. Последовательные шины</b></font>

<p>
<font face="Times New Roman" size=2>Последовательные шины позволяют объединять множество<br>
устройств, используя всего 1-2 пары проводов. При этом<br>
достигается пропускная способность от 100 кбит/с для шины<br>
ACCESS.Bus до 400 Мбит/с у FireWire. Функциональные<br>
возможности этих шин гораздо шире, чем у традиционных<br>
интерфейсов локальных сетей - USB и FireWire способны<br>
передавать изохронный трафик аудио- и видеоданных.</font>

<p>
<font face="Times New Roman" size=4><b>7.1. Шина USB</b></font>

<p>
<font face="Times New Roman" size=2><i>USB</i> (Universal Serial Bus - универсальная последователь-<br>
ная шина) является промышленным стандартом расшире-<br>
ния архитектуры PC, ориентированным на интеграцию с<br>
телефонией и устройствами бытовой электроники. Версия 1.0<br>
была опубликована в январе 1996 года. Архитектура USB<br>
определяется следующими критериями:</font>

<p>
<font face="Times New Roman" size=2>^ Легко реализуемое расширение периферии PC.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Дешевое решение, поддерживающее скорость передачи<br>
до 12 Мбит/с.</font>

<p>
<font face="Times New Roman" size=2><i>ш</i> Полная поддержка в реальном времени передачи аудио-<br>
и (сжатых) видеоданных.</font>

<p>
<font face="Times New Roman" size=2>^ Гибкость протокола смешанной передачи изохронных дан-<br>
ных и асинхронных сообщений.</font>

<p>
<font face="Times New Roman" size=2>^ Интеграция с выпускаемыми устройствами.<br>
^ Доступность в PC всех конфигураций и размеров.</font>

<p>
<font face="Times New Roman" size=2><i>ш</i> Обеспечение стандартного интерфейса, способного быст-<br>
ро завоевать рынок.</font>

<p align=center>
<font face="Times New Roman" size=2>^ Создание новых классов устройств, расширяющих PC.</font>

<p>
<font face="Times New Roman" size=2>С точки зрения конечного пользователя, привлекательны сле-<br>
дующие черты USB:</font>

<p>
<font face="Times New Roman" size=2>^ Простота кабельной системы и подключений.</font>
<HR>
<TABLE WIDTH=100%>
<TR>
<TD align=right valign=top> 
<p>
<DIV ALIGN=center><i><h5>Электронная библиотека InfoCity</i></h5></DIV>
<DIV ALIGN=center><i><h5>Автор и координатор проекта:<a href=mailto:mpinkus@mail.ru>Михаил Пинкус</a></i></h5></DIV>
<DIV ALIGN=center><i><h5>У Вас есть документация, которой нет в нашей библиотеке? <a href="mailto:icity@mail.ru?subject=InfoCity - Doc">Присылайте.</a></h5>
</TD>
</TR></table>
</body>
</html>
