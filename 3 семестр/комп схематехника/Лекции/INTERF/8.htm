<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>8.htm</title>
<meta http-equiv="Content-Type" content="text/html;charset=windows-1251">
</head>
<body background="back1.jpg">

<p>
<font face="Times New Roman" size=5><b>Приложение А.<br>
Системотехника<br>
IBM PC-совместимых<br>
компьютеров</b></font>

<p>
<font face="Times New Roman" size=2>Здесь рассмотрено взаимодействие программ с интерфейс-<br>
ными адаптерами. Приведены краткие сведения по архитек-<br>
туре PC. Описаны организация пространств памяти и вво-<br>
да/вывода, система прерываний и прямой доступ к памяти.<br>
Более подробные сведения можно найти в книге "Аппарат-<br>
ные средства IBM PC. Энциклопедия" ("Питер", 1998).</font>

<p>
<font face="Times New Roman" size=4><b>А.1. Пространство памяти</b></font>

<p>
<font face="Times New Roman" size=2>Логическая структура памяти PC обусловлена системой ад-<br>
ресации процессоров семейства х86. Процессоры 8086/88,<br>
применявшиеся в первых моделях IBM PC, имели адресное<br>
пространство 1 Мбайт (20 бит шины адреса). Начиная с про-<br>
цессора 80286 шина адреса была расширена до 24 бит, затем<br>
(386DX, 486, Pentium) до 32 и, наконец, до 36 бит<br>
(Pentium Pro, Pentium II). В реальном режиме процессора,<br>
используемом в DOS, формально доступен лишь 1 Мбайт<br>
памяти. Однако из-за ошибки эмуляции процессора 8086 в<br>
реальном режиме процессоры 80286 и выше имеют макси-<br>
мально доступный адрес lOFFEFh, что на (64К-16) байт<br>
больше. Область lOOOOOh-lOFFEFh называется <i>высокой па-<br>
мятью - High Memory Area</i> (HMA). В нее помещают часть<br>
ОС реального режима и небольшие резидентные програм-<br>
мы. Для полной совместимости с процессором 8086/88 име-<br>
ется вентиль линии А20 шины адреса - <i>GateA20,</i> который<br>
либо пропускает сигнал от процессора, либо принудительно<br>
обнуляет линию А20 системной шины адреса.</font>
<hr>

<p>
<font face="Times New Roman" size=2>Основную часть адресного пространства занимает <i>оператив-<br>
ная память.</i> Объем установленной памяти определяется те-<br>
стом POST при включении компьютера, начиная с младших<br>
адресов. Натолкнувшись на отсутствие памяти (ошибку), тест<br>
останавливается и сообщает системе объем памяти.</font>

<p>
<font face="Times New Roman" size=2>Память, непосредственно адресуемая процессором, распре-<br>
деляется следующим образом:</font>

<p>
<font face="Times New Roman" size=2>^ OOOOOh-9FFFFh -   <i>Conventional  {Base)   Memory,<br>
</i>640 Кбайт - стандартная (базовая) память, доступная<br>
DOS и программам реального режима. В некоторых сис-<br>
темах с видеоадаптером MDA верхняя граница сдвигает-<br>
ся к AFFFFh (704 Кбайт). Иногда верхние 128 Кбайт<br>
стандартной памяти (область 80000h-9FFFFh) называют<br>
<i>Extended Conventional Memory.</i></font>

<p>
<font face="Times New Roman" size=2><i>^</i> AOOOOh-FFFFFh - <i>Upper Memory Area (UMA),<br>
</i>384 Кбайт - верхняя память, зарезервированная для си-<br>
стемных нужд. В ней размещаются буферы интерфейс-<br>
ных адаптеров (например, видеопамять) и постоянная<br>
память (BIOS с расширениями).</font>

<p>
<font face="Times New Roman" size=2>^ Память выше lOOOOOh - <i>Extended Memory</i> -дополнитель-<br>
ная (расширенная) память, непосредственно доступная<br>
только в защищенном режиме компьютеров 286 и выше.</font>

<p>
<font face="Times New Roman" size=2>Для компьютеров класса AT с 24-битной шиной адреса верх-<br>
няя граница дополнительной памяти - FDFFFFh (макси-<br>
мальный размер 14,9 Мбайт). Область FEOOOOh-FFFFFFh<br>
содержит ПЗУ BIOS (ROM BIOS Area); обращение к ней<br>
эквивалентно обращению к ROM BIOS по адресам OEOOOOh-<br>
OFFFFFh.</font>

<p>
<font face="Times New Roman" size=2>Для процессоров 386 и 32-битной шины адреса теоретичес-<br>
кая верхняя граница - 4 Гбайт, а для Pentium Pro и<br>
Pentium II-64 Гбайт (36-битная шина адреса). Обращение<br>
по адресам, превышающим границу установленной опера-<br>
тивной памяти (или максимально возможного объема),<br>
транслируется на шину PCI, которая имеет 32-битную ад-<br>
ресацию. В компьютерах с 32-разрядной шиной адреса об-<br>
раз BIOS дополнительно проецируется в адреса FFFEOOOOh-<br>
FFFFFFFFh. Иногда используется проекция BIOS в область<br>
FEOOOOh-FFFFFFh, что не позволяет использовать более</font>

<p>
<font face="Times New Roman" size=1>11 Зак.№530</font>
<hr>

<p>
<font face="Times New Roman" size=2>16 Мбайт ОЗУ, поскольку система находит только непре-<br>
рывную область расширенной памяти. Для использования<br>
специфических адаптеров ISA, имеющих буфер с адресами<br>
в 16-м мегабайте памяти, в BIOS Setup предусматривают<br>
опцию <i>Memory Hole At 15- 16М.</i> Ее установка не позволяет<br>
использовать оперативную память свыше 16 Мбайт.</font>

<p>
<font face="Times New Roman" size=2>Для взаимодействия с интерфейсными адаптерами ISA ин-<br>
тересна <i>верхняя память UMA.</i> Стандартное распределение<br>
верхней памяти выглядит следующим образом:</font>

<p>
<font face="Times New Roman" size=2>^ AOOOOh-BFFFFh - <i>Video RAM,</i> 128 Кбайт - видеопамять<br>
(обычно используется не полностью).</font>

<p>
<font face="Times New Roman" size=2>^ COOOOh-DFFFFh - <i>Adapter ROM, Adapter RAM,<br>
</i>128 Кбайт - зарезервировано для адаптеров, использую-<br>
щих собственные модули ROM BIOS и/или специаль-<br>
ное ОЗУ, разделяемое с системной шиной.</font>

<p>
<font face="Times New Roman" size=2>^ EOOOOh-EFFFFh - свободная область, 64 Кбайт, иногда<br>
занятая под System BIOS.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> FOOOOh-FFFFFh - <i>System BIOS,</i> 64 Кбайт - ROM на<br>
системной плате (в XT используется только FEOOOh-<br>
FFFFFh - 8 Кбайт).</font>

<p>
<font face="Times New Roman" size=2><i>т</i> FDOOOh-FDFFFh - <i>ESCD</i> (Extended System Configuration<br>
Data) - область энергонезависимой памяти, используе-<br>
мая для конфигурирования устройств РпР. Эта область<br>
присутствует только при наличии РпР BIOS; ее положе-<br>
ние и размер жестко не заданы.</font>

<p>
<font face="Times New Roman" size=2>В области UMA практически всегда присутствует графичес-<br>
кий адаптер. В зависимости от модели он занимает следую-<br>
щие области:</font>

<p>
<font face="Times New Roman" size=2><i>т MDA RAM -</i> BOOOOh-BOFFFh<br>
<i>т CGA RAM -</i> B8000h-BBFFFh<br>
<i>т EGA ROM -</i> COOOOh-C3FFFh/C7FFFh<br>
<i>m VGA ROM -</i> COOOOh-C7FFFh</font>

<p>
<font face="Times New Roman" size=2><i>m EGA, VGA RAM -</i> AOOOOh-BFFFFh, в зависимости от ви-<br>
деорежима используются следующие области: <i>Graphics -<br>
</i>AOOOOh-AFFFFh; <i>Color Text -</i> B8000h-BFFFFh; <i>Mono<br>
Text -</i> BOOOOh-B7FFFh.</font>
<hr>

<p>
<font face="Times New Roman" size=2>Распространенным потребителем UMA являются <i>расшире-<br>
ния ROM BIOS,</i> расположенные на платах дисковых контрол-<br>
леров, адаптеров SCSI, сетевых картах и т. д. Обычно они<br>
занимают область CSOOOh - CBFFFh/C9FFFh/C8FFFh (для<br>
дисковых контроллеров), но могут перемещаться при кон-<br>
фигурировании адаптеров.</font>

<p>
<font face="Times New Roman" size=4><b>А.2. Пространство ввода/вывода</b></font>

<p>
<font face="Times New Roman" size=2>Процессоры х86 имеют раздельную адресацию памяти и пор-<br>
тов ввода/вывода. Инструкции ввода/вывода порождают<br>
шинные циклы обмена, в которых вырабатываются сигналы<br>
IORD# (чтение порта) и IOWR# (запись в порт) на шинах<br>
ввода/вывода. Эти сигналы отличают пространство ввода/<br>
вывода от пространства памяти, где соответствующие опе-<br>
рации чтения и записи вырабатывают сигналы MEMRD# и<br>
MEMWR#. Для обращения к пространству ввода/вывода пред-<br>
назначены четыре основные инструкции процессора: <i>IN</i> (ввод<br>
в регистр), <i>OUT</i> (вывод из регистра), <i>INS</i> (ввод из порта в<br>
элемент строки памяти) и <i>OUTS</i> (вывод элемента из строки<br>
памяти). Последние две инструкции с префиксом повтора<br>
<i>REP</i> используются для быстрой пересылки блоков данных<br>
между портом и памятью. Разрядность слова, передаваемо-<br>
го за одну инструкцию ввода/вывода, может составлять 8, 16<br>
или 32 бита. В зависимости от выравнивания адреса по гра-<br>
нице слова и разрядности шины это слово может переда-<br>
ваться за один или несколько циклов шины.</font>

<p>
<font face="Times New Roman" size=2>Сигналы IORD# и IOWR# вырабатываются и в циклах DMA;</font>

<p>
<font face="Times New Roman" size=2>в этом случае на шину адреса подается адрес памяти, к кото-<br>
рой производится доступ, а не порта. Для блокировки сраба-<br>
тьшания дешифратора адреса порта в цикле DMA в шине ISA<br>
имеется сигнал AEN. Селективное программное управление<br>
сигналом AENx для каждого слота шины EISA дает возмож-<br>
ность изолировать пространства ввода/вывода портов, что<br>
используется для программного конфигурирования адресов<br>
адаптеров. В шине ISA разделение слотов не предусмотрено,<br>
что объясняет сложность реализации для нее системы РпР.</font>

<p>
<font face="Times New Roman" size=2>Для дешифрации адреса в оригинальном PC из 16 бит ис-<br>
пользовались только младшие 10 (АО-А9), что позволяет об-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ращаться к портам 0-3FFh. Старшие биты адреса, хотя и<br>
поступают на шину, устройствами игнорируются. Так, обра-<br>
щение по адресам 378h, 778h, B78h и F78h воспринимается<br>
устройствами одинаково. В адаптерах для шин МСА и PCI<br>
используются все 16 бит адреса. Современные системные<br>
платы полностью дешифруют адрес.</font>

<p>
<font face="Times New Roman" size=2>В реальном режиме процессора программе доступно все <i>про-<br>
странство</i> адресов ввода/вывода. В защищенном режиме (в<br>
частности, в режиме виртуального процессора 86) можно<br>
программно ограничить пространство ввода/вывода, опре-<br>
делив его максимальный размер. Внутри разрешенной обла-<br>
сти доступ может быть разрешен или запрещен для каждого<br>
конкретного адреса. Размер области и карта разрешенных<br>
портов (70 <i>Permission Bitmap)</i> задаются ОС в дескрипторе<br>
сегмента состояния задачи (TSS). При обращении по нераз-<br>
решенному адресу вырабатывается исключение процессора,<br>
обработчик которого определяется ОС. Возможно снятие<br>
задачи-нарушителя. Не исключено, что по обращению к пор-<br>
ту ОС выполнит некоторые действия, создав для програм-<br>
мы иллюзию реальной операции ввода/вывода.</font>

<p>
<font face="Times New Roman" size=2>Несколько портов вывода могут иметь совпадающие адреса.<br>
Операции записи они будут отрабатывать нормально. Для<br>
операций считывания ситуация другая. Если несколько пор-<br>
тов ввода имеют совпадающий адрес, при считывании они<br>
передают свои данные на шину. Если они находятся на од-<br>
ной физической шине, возникает конфликт. При прочих рав-<br>
ных условиях для каждого бита шины "побеждает" порт,<br>
выводящий логический ноль. Так, если один порт "хочет"<br>
передать байт OFh, а другой - FOh, то процессор считает OOh.<br>
Если порты находятся на разных физических шинах (напри-<br>
мер, один в ISA, а другой - в PCI), конфликта не будет, по-<br>
скольку шины отделены друг от друга буферами данных.<br>
Каждой шине назначается своя область ввода, и дешифра-<br>
тор, расположенный на системной плате, при чтении откры-<br>
вает соответствующие буферы, так что реально считывают-<br>
ся данные только с одной шины. При записи в порты данные<br>
(и сигнал записи) обычно распространяются по всем ши-<br>
нам компьютера. Адреса Oh-OFFh отведены для устройств<br>
системной платы, чтение по этим адресам не распространя-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ется на шины расширения. Для современных плат со встро-<br>
енной периферией и несколькими шинами (ISA, PCI) рас-<br>
пределением адресов управляет BIOS через регистры кон-<br>
фигурирования чипсета.</font>

<p>
<font face="Times New Roman" size=2>Приведенные выше рассуждения справедливы и для про-<br>
странства памяти, но, как правило, они актуальны только<br>
для портов ввода/вывода.</font>

<p>
<font face="Times New Roman" size=2>Карта распределения адресов ввода/вывода стандартных<br>
устройств приведена в табл. АЛ. Подразумевается 10-битная<br>
дешифрация адреса.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>AT и PS/2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PC/XT</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>000-OOF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>000-OOF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроллер DMA #1 8237</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>010-01F</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>PS/2 - расширение DMA # 1</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>020-021</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>020-021</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроллер прерываний #1 - 8259А</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>040-05F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>040-043</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Таймер (PC/XT: 8253, AT: 8254)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>060</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>060</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Диагностический регистр POST (только запись)</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>060-063</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Системный интерфейс 8255</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>060,064</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроллер клавиатуры AT 8042</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>061</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Источники NMI и управление звуком</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>070-07F</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Память CMOS и маска NMI</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>080</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Диагностический регистр</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>080-08F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>080-083</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Регистры страниц DMA</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>090-097</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>PS/2: микроканал, арбитр и т. д.</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>ОАО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Маска NMI</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>OAO-OBF</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроллер прерываний <i>#2 -</i> 8259А</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>OCO-ODF</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроллер DMA #2 8237А-5</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>OFO-OFF</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Сопроцессор 80287</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>100-1 EF</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Управление микроканалом PS/2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>170-177</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроллер НЖМД #2 (IDE#2)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>1FO-1F7</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроллер НЖМД #1 (IDE#1)</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>AT и PS/2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PC/XT</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>200-207</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>200-20F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Игровой адаптер</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>210-217</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Блок расширений</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>238-23F</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>COM4</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>278-27F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>278-27F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Параллельный порт LPT2<br>
(LPT3 при наличии MDA)</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>2А2-2АЗ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Часы MSM48321RS</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>2CO-2DF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>2CO-2DF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>EGA #2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>2ЕО-2Е7</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>COM4</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>2E8-2EF</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>COM4</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>2F8-2FF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>2F8-2FF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>COM2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>300-31F</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Плата-прототип</font>
</td>
</tr>
<tr>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>320-32F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Жесткий диск XT</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>338-33F</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>COM3</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>370-377</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроллер НГМД #2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>376-377</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Порты команд IDE#2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>378-37F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>378-37F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Параллельный порт LPT1<br>
(LPT2 при наличии MDA)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>380-38F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>380-38F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Синхронный адаптер SDLC/BSC #2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3AO-3AF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ЗАО-ЗА9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Синхронный адаптер BSC #1</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>ЗВО-ЗВВ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ЗВО-ЗВВ</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Монохромный адаптер (MDA)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>ЗВ4-ЗС9</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Видеосистема PS/2</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3BC-3BF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3BC-3BF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Параллельный порт LPT1 платы MDA</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3CO-3CF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3CO-3CF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>EGA#1</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3CO-3DF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3CO-3DF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>VGA</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3DO-3DF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3DO-3DF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CGA/EGA</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>ЗЕО-ЗЕ7</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>COM3</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3E8-3EF</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>COM3</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3FO-3F7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3FO-3F7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроллер НГМД #1</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3F6-3F7</font>
</td>
<td>

<p>

</td>
<td>

<p>
<font face="Times New Roman" size=2>Порты команд IDE#1</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>3F8-3FF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3F8-3FF</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>СОМ1</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>
<font face="Times New Roman Narrow" size=4><b>А.3. Аппаратные прерывания</b></font>

<p>
<font face="Times New Roman" size=2>Аппаратные прерывания обеспечивают реакцию процессора<br>
на события, происходящие асинхронно по отношению к ис-<br>
полняемому программному коду. Процессоры х86 поддер-<br>
живают таблицу, содержащую определения до 256 процедур<br>
обслуживания прерываний. <i>Немаскируемые прерывания</i> NMI<br>
обрабатываются процессором независимо от состояния флага<br>
разрешения прерывания <i>IF.</i> К ним относятся прерывания,<br>
приходящие по линии NMI, а для процессоров, поддержива-<br>
ющих режим системного управления, еще и по линии SMI#.</font>

<p>
<font face="Times New Roman" size=2>Сигнал на линию NMI приходит от схем контроля паритета<br>
памяти, от линии 10СНК шины ISA или SERR# шины PCI.<br>
В машинах класса AT сигнал NMI блокируется до входа про-<br>
цессора установкой бита 7 порта 070h в 1, отдельные источ-<br>
ники - битами 2, 3 порта 061h. Идентифицировать источник<br>
NMI позволяют биты 6, 7 регистра 061h.</font>

<p>
<font face="Times New Roman" size=2>В XT NMI вызывается и математическим сопроцессором при<br>
возникновении исключения. Запретить NMI позволяет об-<br>
нуление бита 7 порта OAOh; отдельные источники блокиру-<br>
ются битами 4, 5 регистра 061h; биты 6, 7 регистра 062h<br>
идентифицируют источник.</font>

<p>
<font face="Times New Roman" size=2>Обработка <i>маскируемых прерываний</i> может запрещаться ин-<br>
струкцией <i>DI</i> и разрешаться - <i>Е1</i> (или другим способом воз-<br>
действия на флаг процессора /F). Эти прерывания обслужи-<br>
ваются контроллером, программно-совместимым с 8259А. Он<br>
имеет 8 входов запросов прерываний IRQx от внешних ис-<br>
точников. При обработке запроса контроллер передает по<br>
шине данных 8-битный <i>вектор прерывания,</i> соответствующий<br>
номеру запроса. Этот вектор является индексом, по которо-<br>
му ссылка на процедуру обработки прерывания хранится в<br>
таблице прерываний.</font>

<p>
<font face="Times New Roman" size=2>В машинах класса AT используются два контроллера пре-<br>
рываний. Ведущий (первичный) контроллер 8259А#1 обслу-<br>
живает запросы О, 1, 3-7. К его входу 2 подключен ведомый<br>
(вторичный) контроллер 8259А#2, который обслуживает за-<br>
просы 8-15. При этом используется вложенность приорите-<br>
тов - запросы 8-15 со своим рядом убывающих приорите-</font>
<hr>

<p>
<font face="Times New Roman" size=2>тон вклиниваются между запросами 1 и 3 ведущего контрол-<br>
лера, приоритеты запросов которого также убывают с рос-<br>
том номера. В XT один контроллер 8259А обслуживал все 8<br>
линий запросов.</font>

<p>
<font face="Times New Roman" size=2>На входы контроллеров прерываний поступают запросы от<br>
системных устройств и плат расширения. Эти линии обо-<br>
значаются как IRQx и имеют общепринятое назначение (табл.<br>
А.2). Прерывания в табл. А.2 расположены в порядке убы-<br>
вания их приоритетов. Номера векторов, соответствующих<br>
линиям запросов контроллеров, система приоритетов и дру-<br>
гие параметры могут задаваться программно при инициали-<br>
зации контроллеров.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Имя (номер)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Вектор</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>NMI</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>02h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Контроль канала, паритет (в XT - сопроцессор)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>0</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>08h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Таймер (канал 0 8253/8254)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>09h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Клавиатура</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OAh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>XT - произвольно,<br>
AT - каскад IRQ8-IRQ15</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>70h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>CMOS RTC - часы реального времени</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ9</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>71h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Произвольно</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ10</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>72h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Произвольно</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ11</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>73h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Произвольно</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ12</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>74h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>PS/2-Mouse или произвольно</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>13</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>75h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Математический сопроцессор</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ14</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>76h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>HDC - контроллер НЖМД</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ15</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>77h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Произвольно</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OBh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>COM2, COM4</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OCh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>СОМ1, COM3</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ODh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>XT - HDC,<br>
AT - LPT2, Sound (произвольно)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OEh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>FDC - контроллер НГМД</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>IRQ7</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OFh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>LPT1 - принтер</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>
<font face="Times New Roman" size=2>Назначение номеров прерываний - процесс двухсторонний:</font>

<p>
<font face="Times New Roman" size=2>адаптер должен быть сконфигурирован на использование<br>
конкретной линии шины (джамперами или программно), а<br>
ПО, поддерживающее данный адаптер, должно быть проин-<br>
формировано о номере используемого вектора. Поскольку<br>
прерывания являются дефицитным ресурсом, возникает же-<br>
лание разделить эти линии между несколькими устройства-<br>
ми. Тогда обработчик прерывания устройства, определив, что<br>
источник - не его, вызывал бы обработчик другого устрой-<br>
ства, работающего с той же линией. Однако в шине ISA пре-<br>
рывание вырабатывается по <i>положительному перепаду сиг-<br>
нала</i> на линии запроса. Такой способ подачи сигнала имеет<br>
меньшую помехозащищенность, чем срабатывание по отри-<br>
цательному перепаду, и отрезает путь к нормальному разде-<br>
ляемому использованию линий, для которого полностью<br>
пригоден способ подачи сигнала по низкому уровню. По-<br>
скольку традиционный контроллер позволяет задавать чув-<br>
ствительность - <i>уровень</i> (Level) или <i>перепад</i> (Edge) - толь-<br>
ко для всех входов одновременно, разделяемые прерывания<br>
на шине ISA неработоспособны. Тем не менее, некоторые чип-<br>
сеты, реализующие контроллеры прерываний, допускают<br>
индивидуальное управление чувствительностью каждого вхо-<br>
да. Тогда при соответствующих возможностях BIOS Setup и<br>
адаптеров разделяемые прерывания технически реализуемы.</font>

<p>
<font face="Times New Roman" size=2>При чувствительности к уровню сигнал запроса аппаратно-<br>
го прерывания IRQx должен удерживаться генерирующей<br>
схемой по крайней мерю до цикла подтверждения прерыва-<br>
ния процессором. В противном случае источник прерыва-<br>
ния не будет правильно идентифицирован. Обычно адапте-<br>
ры строят так, что сигнал запроса сбрасывается при<br>
обращении программы обслуживания прерывания к соот-<br>
ветствующим регистрам адаптера.</font>

<p>
<font face="Times New Roman" size=2>Для запросов прерывания с шины PCI используются 4 ли-<br>
нии, которые обозначают как INTR А, В, С, D. Возможно их<br>
разделяемое использование. Линии циклически сдвигаются в<br>
слотах (рис. А.1) и независимо коммутируются на доступные<br>
IRQx с помощью конфигурационных регистров чипсета.<br>
Линии IRQx, используемые шиной PCI, недоступны для шины<br>
ISA. "Дележку" линий между шинами, а также управление</font>
<hr>

<p>
<font face="Times New Roman" size=2>чувствительностью отдельных линий вьшолняют настройки<br>
BIOS Setup, а также система РпР. В опциях настройки <i>ISA<br>
или Legacy</i> подразумевают использование линий IRQx тради-<br>
ционными адаптерами шины ISA (статическое распределение),<br>
a <i>PCI/PnP -</i> адаптерами шины PCI или адаптерами РпР для<br>
шины ISA (динамическое распределение).</font>

<p>
<img border=0 vspace=3 hspace=3 src="81.jpg"alt="81.jpg">
<br clear=all>


<p>
<font face="Times New Roman" size=4><b>А.4. Прямой доступ к памяти и прямое<br>
управление шиной</b></font>

<p>
<font face="Times New Roman" size=2>Прямой доступ к памяти - <i>DMA</i> (Direct Memory Access) -<br>
метод обмена ПУ с памятью без участия процессора. В обыч-<br>
ном программном обмене (PIO) при пересылке блока дан-<br>
ных, например, из порта в память (инструкция <i>REP INSB),<br>
</i>выполняются следующие действия:</font>

<p>
<font face="Times New Roman" size=2>^ Процессор генерирует шинный цикл чтения порта, выстав-<br>
ляя его адрес и формируя сигнал IORD#. Данные из порта<br>
считываются процессором во внутренний шинный буфер.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Процессор генерирует шинный цикл записи в память,<br>
выставляя адрес ячейки и формируя сигнал MEMWR#.<br>
Данные из внутреннего шинного буфера записываются в<br>
память.</font>

<p>
<font face="Times New Roman" size=2>^ Эти шаги автоматически повторяются с изменением ад-<br>
реса памяти. Количество повторов задается в регистре <i>СХ,</i></font>
<hr>

<p>
<font face="Times New Roman" size=2>инкремент/декремент адреса - флагом <i>DF.</i> Во время пе-<br>
редачи всего блока процессор занят.</font>

<p>
<font face="Times New Roman" size=2>В режиме прямого доступа к памяти процессор инициали-<br>
зирует контроллер прямого доступа к памяти - задает на-<br>
чальный адрес, счетчик и режим обмена, после чего осво-<br>
бождается. Обмен производит контроллер и выполняет его<br>
несколько иначе. Контроллер имеет несколько каналов. Для<br>
интерфейса ПУ каждый канал представляется парой сигна-<br>
лов: запрос обмена - DRQx и подтверждение обмена -<br>
DACKx#. В операциях по каналу DMA адрес порта не фигу-<br>
рирует, а используется только пара сигналов, соответствую-<br>
щая номеру канала. Цикл передачи блока в память будет<br>
выглядеть следующим образом (рис. А.2):</font>

<p>
<font face="Times New Roman" size=2>1. По сигналу DRQx контроллер запрашивает управление<br>
шиной и дожидается его предоставления процессором<br>
(и другими контроллерами шины).</font>

<p>
<font face="Times New Roman" size=2>2. Контроллер выставляет адрес ячейки памяти и форми-<br>
рует в одном цикле шины сигналы IORD#, DACKx# и<br>
MEMWR#. Сигнал DACKx# указывает на то, что операция<br>
выполняется для канала "х", a IORD# - на направление в<br>
канале (для пересьыки из памяти в канал использовался<br>
бы сигнал IOWR#). Чтобы по сигналу IORD# не было лож-<br>
ного чтения (по IOWR# - ложной записи) порта, адрес<br>
которого совпадает с адресом памяти, присутствующим<br>
в цикле DMA, контроллер высоким уровнем сигнала AEN<br>
запрещает портам дешифрацию адреса. Байт, считанный<br>
из канала, в том же цикле шины записывается в ячейку<br>
памяти.</font>

<p>
<font face="Times New Roman" size=2>3. Контроллер модифицирует счетчик адреса и повторяет<br>
шаги 1-2 для каждого следующего сигнала DRQx, пока не<br>
будет исчерпан счетчик циклов. В последнем цикле об-<br>
мена контроллер формирует общий сигнал окончания ТС<br>
(Terminate Count), который может быть использован<br>
устройством для формирования сигнала аппаратного пре-<br>
рывания.</font>

<p>
<font face="Times New Roman" size=2>Обратная пересылка отличается только тем, что использу-<br>
ются сигналы IOWR# и MEMRD#.</font>
<hr>

<p>
<img border=0 vspace=3 hspace=3 src="82.jpg"alt="82.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. А.2.</b> Цикл обмена DMA</font>

<p>
<font face="Times New Roman" size=2>Процессор при обмене занят только инициализацией кон-<br>
троллера, которая сводится к записи в его регистры несколь-<br>
ких байт. Затем обмен производят системная шина и кон-<br>
троллер. Если выбранный режим обмена не занимает всей<br>
пропускной способности шины, во время операций DMA<br>
процессор может продолжать работу.</font>

<p>
<font face="Times New Roman" size=2>Прямой доступ к памяти был использован еще в PC/XT,<br>
где применялась микросхема <i>четырехканального контролле-<br>
ра DMA</i> 18237А. Контроллер имеет 16-разрядные регистры<br>
адреса и счетчики, что позволяет программировать переда-<br>
чу блоков до 64 Кбайт. Для доступа к пространству разме-<br>
ром в 1 Мбайт применили внешние 4-разрядные регистры<br>
страниц DMA, отдельные для каждого канала. В них хра-<br>
нятся биты адреса А[19:16], а битами А[15:0] управляет кон-<br>
троллер. При достижении регистром-счетчиком адреса зна-<br>
чения FFFFh следующее его значение будет OOOOh, а внешний<br>
регистр адреса страницы останется неизменным. Таким об-<br>
разом, если блок начинается не с границы страницы памяти<br>
размером в 64 Кбайт, возможно его "сворачивание в кольцо".<br>
Но если для процессоров 80х86 в реальном режиме "свора-<br>
чиваемые" сегменты могут начинаться с адреса, кратного 10h,<br>
то при прямом доступе границы "сворачиваемого" сегмента<br>
кратны 1 OOOOh. Этот эффект обязательно необходимо учи-</font>
<hr>

<p>
<font face="Times New Roman" size=2>тывать при программировании прямого доступа - блок, пе-<br>
ресекающий границу, должен пересылаться за два сеанса<br>
DMA, между которыми канал (включая регистр страниц)<br>
должен быть повторно инициализирован.</font>

<p>
<font face="Times New Roman" size=2>Из четырех каналов DMA XT на шине ISA доступны толь-<br>
ко три (1, 2 и 3). Канал 0 используется для регенерации ди-<br>
намической памяти, адрес регенерируемой строки берется с<br>
линий адреса ISA. Каналы 1, 2 и 3 обеспечивают побайтную<br>
передачу данных и называются 8-битными каналами DMA.</font>

<p>
<font face="Times New Roman" size=2>В архитектуре AT подсистему DMA расширили, добавив вто-<br>
рой контроллер 8237А. Его подключили к шине адреса со<br>
смещением на 1 бит. 16-битные регистры адреса способны<br>
управлять линиями адреса А[16:1], младший бит адреса АО<br>
всегда нулевой. Таким образом, второй контроллер передает<br>
данные только по два байта, поэтому его каналы названы<br>
16-битными. За один сеанс второй контроллер способен пе-<br>
редать до 64 К 16-разрядных слов. Регистры страниц для всех<br>
каналов DMA у AT расширены до 8 бит, что делает доступной<br>
для любого канала область памяти размером 16 Мбайт (0-<br>
FFFFFFh). Эффект "сворачивания" сегментов в каналах пря-<br>
мого доступа сохраняется, только для каналов 5, 6 и 7 "коль-<br>
ца" имеют размер 64 К слов и границы, кратные 20000h.<br>
Микросхемы контроллеров 8237А включены каскадно, и ка-<br>
нал 4 недоступен - через него подключается первый контрол-<br>
лер. Стандартное назначение каналов приведено в табл. А.3.</font>

<p>
<font face="Times New Roman" size=2>Кроме увеличения числа каналов в AT ввели <i>управление<br>
тиной ISA - Bus-Mastering -</i> со стороны адаптера. Оно опи-<br>
рается на контроллер DMA, выполняющий в данном случае<br>
функции арбитра шины. Для получения управления шиной<br>
адаптер посылает запрос по линии DRQx (только для кана-<br>
лов 5-7) и, получив подтверждение DACKx, устанавливает<br>
сигнал MASTERS. Теперь шиной ISA управляет он, но не<br>
имеет права занимать шину более чем на 15 мкс за сеанс.<br>
В противном случае нарушится регенерация памяти. Интел-<br>
лектуальный контроллер может выполнять более эффектив-<br>
ные процедуры обмена, чем стандартный DMA.</font>

<p>
<font face="Times New Roman" size=2>Управление шиной используют высокопроизводительные<br>
адаптеры SCSI и локальных сетей, а также интеллектуаль-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ные графические адаптеры. Однако архитектурой шины до-<br>
ступное им пространство ограничено 16 Мбайт.</font>

<p>
<font face="Times New Roman" size=2>Ограничения на доступную память для "чистого" режима<br>
DMA в новых компьютерах снимаются применением расши-<br>
ренных регистров страниц, но об этом должно "знать" ПО.</font>

<p>
<font face="Times New Roman" size=2>На шине EISA каналы DMA могут работать в 8-, 16-<br>
и 32-битном режиме и, используя все 32 разряда шины ад-<br>
реса, иметь доступ ко всей памяти компьютера. Каждый ка-<br>
нал программируется на 1 из 4 типов цикла передачи:</font>

<p>
<font face="Times New Roman" size=2>^ Compatible - полностью совместим с ISA.</font>

<p>
<font face="Times New Roman" size=2>sii Type A - сокращенный на 25% цикл: время одиночного<br>
цикла 875 нс, в блочном режиме время цикла 750 нс. Ра-<br>
ботает почти со всеми ISA-адаптерами с большей скоро-<br>
стью.</font>

<p>
<font face="Times New Roman" size=2>^ Type В - сокращенный на 50% цикл (750/500 нс на цикл),<br>
работает с большинством EISA-адаптеров и некоторыми<br>
ISA. Возможен только с памятью, непосредственно до-<br>
ступной контроллеру шины EISA (то есть с памятью на<br>
адаптерах EISA и системной, если EISA является основ-<br>
ной шиной). Если декодированный адрес памяти отно-<br>
сится к 8/16-битной памяти ISA, то контроллер DMA<br>
EISA автоматически переводится в режим Compatible.</font>

<p>
<font face="Times New Roman" size=2><i>т</i> Type С (Burst Timing) - сокращенный на 87,5% цикл,<br>
ориентированный на пакетный режим передачи. Работа-<br>
ет с быстрыми EISA-адаптерами. При обмене 32-битных<br>
устройств с 32-битной памятью позволяет развить ско-<br>
рость обмена до 33 Мбайт/с.</font>

<p>
<font face="Times New Roman" size=2>^ В PCI-системах для обмена с устройствами системной пла-<br>
ты (Fast ATA-2 или E-IDE-порты) возможно использова-<br>
ние DMA Type F, при котором между соседними циклами<br>
интервал не должен превышать 3 тактов шины (360 нс).<br>
Для разгрузки системной шины используется 4-байтный<br>
буфер. Режим F может работать только в режиме одиноч-<br>
ной передачи или по запросу и исключительно с инкре-<br>
ментом адреса. На самой шине PCI адаптеры могут ис-<br>
пользовать режим прямого управления шиной, для чего<br>
имеется специальный протокол арбитража.</font>
<hr>

<p>

<table align=left border=1>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>Номер канала DMAft</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>о</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>3</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>4</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>5</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Q</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>7</font>
</td>
</tr>
<tr>
<td rowspan=2>

<p>
<font face="Times New Roman" size=2>Стандартное<br>
назначение</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>XT</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>MRFR*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>FDD</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>HDD</font>
</td>
<td colspan=4>

<p>
<font face="Times New Roman" size=2>Отсутствуют</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>AT</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>SDLC*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>FDD</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>HDD*</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Каскад</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>-</font>
</td>
</tr>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>Разрядность, байт</font>
</td>
<td colspan=4>

<p>
<font face="Times New Roman" size=2>1</font>
</td>
<td colspan=4>

<p>
<font face="Times New Roman" size=2>2 с четного адреса</font>
</td>
</tr>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>Максимальный размер блока</font>
</td>
<td colspan=4>

<p>
<font face="Times New Roman" size=2>64 Кбайта</font>
</td>
<td colspan=4>

<p>
<font face="Times New Roman" size=2>128 Кбайт, четный</font>
</td>
</tr>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>Граница блока</font>
</td>
<td colspan=4>

<p>
<font face="Times New Roman" size=2>Кратна lOOOh</font>
</td>
<td colspan=4>

<p>
<font face="Times New Roman" size=2>Кратна 2000h</font>
</td>
</tr>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>Регистр страниц</font>
</td>
<td colspan=4>

<p>
<font face="Times New Roman" size=2>4 бит А16-А19</font>
</td>
<td colspan=4>

<p>
<font face="Times New Roman" size=2>7 бит А17-А23</font>
</td>
</tr>
<tr>
<td colspan=2 rowspan=4>

<p>
<font face="Times New Roman" size=2>Адреса регистров:<br>
страниц</font>

<p>
<font face="Times New Roman" size=2>начального адреса (W)<br>
текущего адреса (R)</font>

<p>
<font face="Times New Roman" size=2>начального счетчика (W)<br>
текущего счетчика (R)</font>
</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
<td>

<p>

</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>087</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>083</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>081</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>082</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>08F</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>08В</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>089</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>087</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>000</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>002</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>004</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>006</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ОСО</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>ОСА</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ОС8</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>осе</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>001</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>003</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>005</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>007</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ОС2</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ОС6</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ОСА</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>ОСЕ</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>* SDLC-адаптер устанавливается редко.<br>
HDD-контроллер в AT DMA обычно не использует.<br>
Канал 0 в XT используется для регенерации памяти (MRFR).<br>
Канал 4 доступен только в PS/2 МСА.</font>
<hr>

<p>
<font face="Times New Roman" size=4><b>А.5. Обмен данными</b></font>

<p>
<font face="Times New Roman" size=2>Открытая архитектура PC предрасполагает использование<br>
различных адаптеров расширения. Чаще всего ПО общается<br>
с адаптерами через порты ввода/вывода, используя преры-<br>
вания, прямой доступ к памяти и непосредственное управ-<br>
ление шиной. Связь через область памяти, к которой при-<br>
писан адаптер, для "нештатных" адаптеров применяется<br>
редко. Выбор способа связи определяется пропускной спо-<br>
собностью, временем отклика на события, происходящие в<br>
адаптере, и допустимой загрузкой процессора.</font>

<p>
<font face="Times New Roman" size=2><i>Программно-управляемый обмен</i> подразумевает следующие<br>
действия:</font>

<p>
<font face="Times New Roman" size=2>^ операцию чтения регистра состояния устройства для ана-<br>
лиза его готовности;</font>

<p>
<font face="Times New Roman" size=2>^ ожидание готовности (зацикливание предыдущего шага);</font>

<p>
<font face="Times New Roman" size=2>^ обмен байтом или словом данных.</font>

<p>
<font face="Times New Roman" size=2>Такой обмен сильно загружает процессор, особенно если про-<br>
грамма формирует управляющие сигналы обмена. Так, напри-<br>
мер, работает драйвер параллельного порта в стандартном ре-<br>
жиме, когда строб данных формируется двумя инструкциями<br>
<i>OUT.</i> В результате пропускная способность такого порта в за-<br>
висимости от процессора может быть порядка 150 Кбайт/с.<br>
Если разгрузить процессор от анализа готовности и форми-<br>
рования строба, как, например, в ЕРР-режиме параллельного<br>
порта, то производительность порта можно повысить на по-<br>
рядок. Такой режим обмена программно-управляемым назы-<br>
вать некорректно - это <i>режим программного ввода/вывода с<br>
аппаратным контролем потока,</i> где темп обмена определяет<br>
подключенное устройство. Высокоскоростные <i>режимы PIO<br>
</i>применяются в интерфейсе IDE. Они используют инструк-<br>
ции блочной пересылки <i>REP INS/OUTS,</i> при которых процес-<br>
сор пересылает данные между портом и областью памяти за<br>
минимальное количество тактов системной шины. Посколь-<br>
ку такую скорость ПУ обычно не воспринимают, контроллер<br>
интерфейса "притормаживает" обмен до разумных скоростей,<br>
определяемых режимом обмена. Параметры этих режимов,<br>
называемых <i>PIO Mode,</i> приведены в табл. 6.10.</font>
<hr>

<p>
<font face="Times New Roman" size=2><i>Обмен по прямому доступу к памяти</i> (как и <i>режим прямого<br>
управления шиной)</i> в наименьшей степени загружает процес-<br>
сор - он занимается лишь анализом состояния и инициали-<br>
зацией канала DMA, но не передачей данных. Время откли-<br>
ка на запрос, когда контроллер "заряжен" на обмен, не<br>
превышает сотен наносекунд. Однако скорость стандартно-<br>
го канала DMA ограничена значением 2/4 Мбайт/с в зави-<br>
симости от разрядности канала. Производительность в ре-<br>
жимах прямого управления шиной обычно выше, чем у<br>
стандартных каналов DMA. Прогрессивные режимы DMA<br>
обеспечивают более высокие скорости обмена: Ultra DMA -<br>
до 33 Мбайт/с.</font>

<p>
<font face="Times New Roman" size=2>Обсудим теперь <i>инициализацию и синхронизацию.</i> Инициа-<br>
тором обмена выступает или ПО, или ПУ. Программа ожи-<br>
дает какого-либо события в ПУ, периодически читая его ре-<br>
гистр состояния. Такой способ называется <i>обменом по опросу<br>
готовности.</i> Время реакции может составлять доли мик-<br>
росекунды, когда программа опрашивает устройство моно-<br>
польно. Однако при этом процессор загружен бесполезной<br>
работой. Другой подход - использование аппаратных пре-<br>
рываний, вырабатываемых устройством по событиям, тре-<br>
бующим внимания программы. Программные обработчики<br>
аппаратных прерываний инициализируют блочный обмен<br>
или выполняют одиночную операцию пересылки. Время ре-<br>
акции зависит от множества факторов, включая режим ра-<br>
боты процессора. В защищенном режиме прерывание при-<br>
водит к автоматическому сохранению контекста задачи в<br>
стеке и переключению задач. Эти действия связаны с ин-<br>
тенсивным обменом с памятью, так что отклик может до-<br>
стигать десятков микросекунд или гораздо больше, если за-<br>
действована виртуальная память. В реальном режиме<br>
процессора ответ на прерывание приходит за единицы мик-<br>
росекунд.</font>

<p>
<font face="Times New Roman" size=2>Возможно комплексное решение - опрос готовности уст-<br>
ройств по периодическим прерываниям, например, от сис-<br>
темного таймера - <i>polling.</i> Готовое устройство обслуживает-<br>
ся, неготовое - пропускается до следующего прерывания.<br>
Процессор не выполняет бесполезных циклов опроса, а за-<br>
нимается другими задачами. Правда, расходы на обслужи-</font>
<hr>

<p>
<font face="Times New Roman" size=2>вание прерываний остаются, а максимальное время реакции<br>
на событие не может быть меньшим, чем период таймера.<br>
Так работает утилита фоновой печати PRINT.</font>

<p>
<font face="Times New Roman" size=2>Активное использование прерываний характерно для мно-<br>
гозадачных ОС.</font>

<p>
<font face="Times New Roman" size=4><b>А.6. Распределение системных ресурсов</b></font>

<p>
<font face="Times New Roman" size=2>Спецификация ISA требует, чтобы всем картам назначались<br>
свои системные ресурсы - области адресов в пространствах<br>
памяти и ввода/вывода, линии запросов прерываний и ка-<br>
налы прямого доступа к памяти. Платы не должны кон-<br>
фликтовать по ресурсам. Задача конфигурирования ослож-<br>
няется из-за отсутствия общего механизма автоматической<br>
передачи установленных параметров прикладному и систем-<br>
ному ПО. Конфигурирование адаптеров выполняется пере-<br>
ключением джамперов, затем установленные параметры за-<br>
носятся в конфигурационные файлы.</font>

<p>
<font face="Times New Roman" size=2>Применение энергонезависимой памяти (NVRAM или ее<br>
разновидности - EEPROM), хранящей настройки, облегча-<br>
ет конфигурирование. С соответствующими адаптерами по-<br>
ставляется утилита настройки. Отсюда их названия: <i>Software<br>
Configured</i> (программно конфигурируемые) или <i>Jumperless<br>
</i>(без джамперов). Утилита может проверить выбираемые<br>
установки на отсутствие конфликта, однако достоверность<br>
обнаружения конфликта относительна. Некоторые программ-<br>
но конфигурируемые адаптеры все же имеют джамперы, что<br>
бывает полезно для установки типовой настройки, устраня-<br>
ющей конфликты (например, наложение областей памяти се-<br>
тевого адаптера и видеопамяти). Преимуществом NVRAM<br>
является также отсутствие необходимости в конфигураци-<br>
онных файлах.</font>

<p>
<font face="Times New Roman" size=2>Ключевым моментом в автоконфигурировании является изо-<br>
ляция карты от остальных. Тогда ПО конфигурирования<br>
сможет вести с картой диалог, на который не влияет при-<br>
сутствие других устройств. Изоляция карт при конфигури-<br>
ровании заложена в шины МСА, PCI и EISA. В EISA для<br>
каждого слота возможно программное селективное управле-</font>
<hr>

<p>
<font face="Times New Roman" size=2>ние сигналом AEN, запрещающим дешифрацию адресов пор-<br>
тов ввода/вывода. В системе с шиной EISA имеется энерго-<br>
независимая память конфигурирования слотов. Необходи-<br>
мо также обеспечить единый метод двухстороннего обмена<br>
конфигурационной информацией между картой и ПО.</font>

<p>
<font face="Times New Roman" size=2>В шину PCI автоматическое конфигурирование установлен-<br>
ных адаптеров заложено изначально. Здесь конфигурирова-<br>
нию также подлежат <i>мосты шины (PCI Bridge) -</i> аппарат-<br>
ные средства подключения PCI к другим шинам. <i>Host<br>
Bridge -</i> главный мост - используется для подключения к<br>
системной шине. <i>Peer-to-Peer Bridge -</i> одноранговый мост -<br>
используется для соединения двух шин PCI (дополнитель-<br>
ные шины PCI позволяют увеличить количество подключа-<br>
емых устройств). При конфигурировании мостов указыва-<br>
ется распределение системных ресурсов по шинам, которые<br>
они связывают. Таким образом, задаются пути транслирова-<br>
ния управляющих сигналов по шинам и управление буфе-<br>
рами данных, обеспечивая для каждого адреса памяти или<br>
ввода/вывода единственную шину назначения, по крайней<br>
мере для операций чтения (операции записи могут быть<br>
широковещательными). Подобная "маршрутизация" необ-<br>
ходима и для сигналов запросов прерываний (каналы DMA<br>
к шине PCI отношения не имеют).</font>

<p>
<font face="Times New Roman" size=2>Среди устройств РпР (для шин ISA и PCI) выделяется класс<br>
динамически конфигурируемых устройств <i>DCD (Dynamically<br>
Configurable Device).</i> Ресурсы, используемые ими, динами-<br>
чески переназначаются, не требуя перезагрузки ОС. Если<br>
устройство DCD находится в <i>заблокированном состоянии<br>
(Locked DCD),</i> его ресурсы не могут быть изменены.</font>

<p>
<font face="Times New Roman" size=2>Полная поддержка РпР предусматривает наличие РпР BIOS,<br>
плат расширения РпР и/или модулей на системной плате.<br>
Для <i>хранения информации о системных ресурсах</i> необходи-<br>
мо было стандартизовать способы представления конфигу-<br>
рации. В декабре 1994 года компании Compaq, Intel и Phoenix<br>
опубликовали версию 1.03 документа "Extended System<br>
Configuration Data Specification" ("Спецификация расширен-<br>
ных данных о системной конфигурации"), определяющего<br>
методы взаимодействия и структуры данных памяти для</font>
<hr>

<p>
<font face="Times New Roman" size=2>конфигурации устройств <i>ESCD.</i> Данные ESCD хранятся в<br>
энергонезависимом хранилище информации <i>NVS</i> (Non-<br>
volatile Storage). Это может быть память NVRAM или файл<br>
данных для ISA-систем, не имеющих поддержки РпР.<br>
NVRAM может отображаться на область (верхней) памяти,<br>
как полностью, так и постранично. Способ доступа к ESCD<br>
определяется вызовом специальной функции РпР BIOS.</font>

<p>
<font face="Times New Roman" size=2>ESCD разрабатывалась на основе форматов описания уст-<br>
ройств шины EISA, в которой имеется специальная энерго-<br>
независимая память и утилиты конфигурирования <i>ECU<br>
</i>(EISA Configuration Utility). Все устройства описываются<br>
через <i>слоты -</i> специальные структуры данных. В стандарте<br>
EISA слот 0 используется для описаний устройств ISA, раз-<br>
мещенных на системной плате. Слоты 1-15 соответствуют<br>
физическим слотам расширения шины EISA, слоты 16-64<br>
определены для виртуальных (не связанных с конкретным<br>
физическим слотом шины) устройств. В ESCD сохранено<br>
примерно то же назначение слотов. Так устройства шины<br>
PCI (включая мосты) описываются слотами 16-64.</font>

<p>
<font face="Times New Roman" size=2>С данными ESCD взаимодействует РпР BIOS, а также ОС,<br>
поддерживающая РпР. <i>ACFG BIOS</i> (Auto-Configuration BIOS)<br>
имеет поддержку РпР, в частности автоконфигурирование.<br>
Конфигурированием устройств DCD, которые не были скон-<br>
фигурированы ACFG BIOS во время POST, занимается ме-<br>
неджер конфигурирования, являющийся частью системного<br>
ПО. Каждая РпР-плата сообщает менеджеру конфигуриро-<br>
вания о потребностях и возможных диапазонах настройки<br>
ресурсов. Для обычных (Legacy) плат ISA информация в<br>
ESCD заносится с помощью диалоговой утилиты конфигу-<br>
рирования <i>ICU</i> (ISA Configuration Utility). Таким образом,<br>
конфигурирование плат РпР выполняется автоматически, а<br>
обычных карт - джамперами или утилитами.</font>

<p>
<font face="Times New Roman" size=4><b>А.7. Спецификация РпР для шины ISA</b></font>

<p>
<font face="Times New Roman" size=2>Для изоляции карт ISA, программного распределения сис-<br>
темных ресурсов, конфигурирования и передачи параметров<br>
ОС и прикладному ПО компаниями Intel и Microsoft была<br>
выработана спецификация "Plug and Play ISA Specification";</font>
<hr>

<p>
<font face="Times New Roman" size=2>версия l.Oa была опубликована в мае 1994 года. Рассмотрим<br>
реализацию РпР с точки зрения аппаратных средств.</font>

<p>
<font face="Times New Roman" size=2>Конфигурирование в системе РпР состоит из следующих<br>
шагов:</font>

<p>
<font face="Times New Roman" size=2>^ Производится изоляция одной карты от всех остальных.<br>
^ Карте назначается <i>CSN</i> (Card Select Number).</font>

<p>
<font face="Times New Roman" size=2>^ С карты считываются данные о сконфигурированных и<br>
поддерживаемых ресурсах.</font>

<p>
<font face="Times New Roman" size=2>Эти шаги повторяются для всех карт, после чего:</font>

<p>
<font face="Times New Roman" size=2>^ производится распределение системных ресурсов, выде-<br>
ляемых каждой карте;</font>

<p>
<font face="Times New Roman" size=2>^ каждая карта конфигурируется согласно выбранному рас-<br>
пределению ресурсов и переводится в рабочий режим.</font>

<p>
<font face="Times New Roman" size=2>Все шага конфигурирования выполняет POST, если BIOS име-<br>
ет поддержку РпР, или ОС при загрузке. РпР BIOS может<br>
ограничиться конфигурированием и активацией устройств,<br>
участвующих в загрузке. BIOS без поддержки РпР может ис-<br>
пользовать необходимые для загрузки устройства, сконфигу-<br>
рированные с параметрами по умолчанию, а всем остальным<br>
занимается ОС. Конфигурирование выполняется в специаль-<br>
ном состоянии плат, в которое их можно программно переве-<br>
сти специальным ключом инициализации, защищающим кон-<br>
фигурационную информацию от случайного разрушения.</font>

<p>
<font face="Times New Roman" size=2>Для конфигурирования карт РпР необходимы три 8-битных<br>
<i>системных порта</i> (табл. А.4), с которыми процессор обща-<br>
ется по инструкциям ввода/вывода с однобайтной передачей<br>
данных. Карты РпР должны использовать 12-битное декоди-<br>
рование адреса ввода/вывода, а не 10-битное, как в тради-<br>
ционных картах ISA.</font>

<p>
<font face="Times New Roman" size=2>Порт <i>ADDRESS</i> используется для адресации регистров РпР,<br>
запись в него производится перед обращением к портам<br>
<i>WRITE_DATA</i> и <i>READ_DATA.</i> Он же применяется для записи<br>
последовательности кодов ключа инициализации. Выбор ад-<br>
реса для него обусловлен тем, что "разумные" карты рас-<br>
ширения не будут использовать для записи адрес регистра<br>
состояния стандартного LPT-порта.</font>
<hr>

<p>
<font face="Times New Roman" size=2>Порты <i>WRITEJDATA</i> и <i>READ_DATA</i> используются для обмена<br>
данными с регистрами РпР. Адрес порта <i>WRITEJDATA</i> тради-<br>
ционными картами с 10-битным декодированием будет вос-<br>
приниматься как адрес предыдущего порта, так что конф-<br>
ликт исключен. Перемещаемому адресу порта <i>READJDATA</i> ПО<br>
РпР во время протокола изоляции может легко найти бес-<br>
конфликтное положение. Адрес этого порта сообщается всем<br>
картам записью в их управляющий регистр РпР.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Имя порта</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Адрес</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Тип доступа</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>ADDRESS</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>0279h <i>(Printer status port)</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Только запись</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>WFIITEDATA</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OA79h <i>(Printer status port</i> + 0800h)</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Только запись</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>READDATA</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Перемещаемый в диапазоне 0203h-<br>
03FFh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Только чтение</font>
</td>
</tr>
</table>
<br clear=all>

<p>
<font face="Times New Roman" size=2>В конфигурационный режим логика РпР переводится <i>клю-<br>
чом инициализации {Initiation key).</i> Ключ представляет со-<br>
бой предопределенную последовательность записей в порт<br>
<i>ADDRESS.</i> Аппаратная логика карты, проверяющая ключ,<br>
основана на сдвиговом регистре с обратными связями <i>LFSR<br>
(Linear Feedback Shift Register),</i> схема которого приведена на<br>
рис. А.3. Во время проверки ключа на вход С1 подается уро-<br>
вень логического 0, а на вход С2 - стробы записи в порт<br>
<i>ADDRESS.</i> Логика, не показанная на рис. А.3, сравнивает код<br>
в сдвиговом регистре с текущей записью и при несовпаде-<br>
нии сбрасывает <i>LFSR</i> в исходное состояние (код 6Ah). В это<br>
же состояние регистр переводится двумя последовательны-<br>
ми записями нулей в порт <i>ADDRESS.</i> Сдвиг в регистре про-<br>
исходит при каждой записи в порт <i>ADDRESS.</i> Если ключ<br>
(последовательность из 32 записей требуемых байт) будет<br>
приложен верно, после последней записи логика карты пе-<br>
рейдет в режим конфигурирования и подготовится к отра-<br>
ботке протокола изоляции. Точная последовательность байт<br>
ключа в hex-формате выглядит следующим образом:</font>

<p>
<font face="Times New Roman Narrow" size=2>6А. В5. DA, ED. F6. FB. 7D. BE. DF. 6F. 37. IB. OD. 86, СЗ. 61.<br>
ВО. 58. 2С, 16. 8В. 45. А2. Dl. E8. 74, ЗА. 9D. СЕ. Е7. 73. 39.</font>
<hr>

<p>
<img border=0 vspace=3 hspace=3 src="83.jpg"alt="83.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. А.3. Сдвиговый регистр LFSR карты РпР</b></font>

<p>
<font face="Times New Roman" size=2><i>Протокол изоляции</i> основан на идентификаторе <i>Serial<br>
Identifier,</i> хранящемся в памяти каждой карты РпР. Этот<br>
идентификатор представляет собой ненулевое 72-битное чис-<br>
ло, состоящее из двух 32-битных полей и 8-битного конт-<br>
рольного кода, вычисляемого с помощью регистра <i>LFSR.<br>
</i>Первое 32-битное поле представляет собой идентификатор<br>
производителя. Второе поле назначается производителем<br>
каждому экземпляру. Здесь может присутствовать серийный<br>
номер; для адаптера Ethernet это может быть частью МАС-<br>
адреса. Принцип построения идентификатора гарантирует,<br>
что в одной системе не могут встретиться две карты с сов-<br>
падающими идентификаторами. Доступ к идентификатору<br>
осуществляется последовательно, начиная с бита 0 нулевого<br>
байта идентификатора производителя и заканчивая битом 7<br>
контрольной суммы. Во время передачи идентификатора на<br>
вход С1 схемы <i>LFSR</i> поступают текущие биты идентифика-<br>
тора, а на вход С2 - стробы чтения регистра <i>SerialJsolation.<br>
</i>В тактах передачи контрольной суммы ее биты берутся с<br>
выхода сдвигового регистра.</font>

<p>
<font face="Times New Roman" size=2>Протокол изоляции программно инициируется в любой мо-<br>
мент времени посылкой ключа инициализации, переводящего<br>
все карты в конфигурационный режим. В этом режиме каж-<br>
дая карта ожидает 72 пары операций чтения порта<br>
<i>READ_DATA.</i> Ответ каждой карты на эти операции опреде-<br>
ляется значением очередного бита ее идентификатора.</font>

<p>
<font face="Times New Roman" size=2>Если текущий бит идентификатора карты имеет единичное<br>
значение, ее буфер шины данных в первом чтении пары вы-<br>
водит на шину значение 55h. Если текущий бит нулевой, то</font>
<hr>

<p>
<font face="Times New Roman" size=2>буфер работает на <i>чтение</i> шины и логика карты анализиру-<br>
ет ответ других карт - проверяет наличие комбинации 01 в<br>
битах D[1:0] (младшие биты 55h). В следующем цикле чте-<br>
ния пары карта с единичным битом выводит число AAh, a<br>
карта с нулевым текущим битом проверяет наличие комби-<br>
нации 10 в битах D[1:0] (младшие биты AAh). Если карта,<br>
просматривающая вывод данных другими картами, обнару-<br>
жила корректные коды в обоих циклах чтения пары, она в<br>
данной итерации изоляции исключается. Если карта в теку-<br>
щей паре управляла шиной или читала шину, но не обнару-<br>
жила корректных активных ответов других карт, она сдви-<br>
гает идентификатор на один бит и готовится к приему<br>
следующей пары циклов чтения. Эта последовательность<br>
выполняется для всех 72 бит идентификатора. В конце про-<br>
цесса останется лишь одна карта. Записью в управляющий<br>
регистр ей назначается номер <i>CSN,</i> по которому она будет<br>
использоваться в дальнейших операциях. Карта с назначен-<br>
ным <i>CSN</i> в следующих итерациях протокола изоляции не<br>
участвует (на пары чтений не отвечает).</font>

<p>
<font face="Times New Roman" size=2>Во время протокола изоляции карты не имеют права удли-<br>
нять шинные циклы с помощью сигнала IOCHRDY, посколь-<br>
ку это привело бы к неопределенности результатов наблю-<br>
дения за "соседями".</font>

<p>
<font face="Times New Roman" size=2><i>Программа конфигурирования</i> проверяет данные, возвращае-<br>
мые во время пар циклов чтения, и побитно собирает про-<br>
читанный идентификатор. Если в паре приняты байты 55h<br>
и AAh, соответствующий бит считается единичным, в дру-<br>
гих случаях - нулевым. При приеме идентификатора про-<br>
грамма подсчитывает контрольную сумму и сравнивает ее с<br>
принятой. Несовпадение или отсутствие среди принятых<br>
байт 55h и AAh указывает на то, что выбранный адрес пор-<br>
та <i>READ_DATA</i> конфликтует с каким-либо устройством. Тог-<br>
да программа производит итерацию, переместив адрес пор-<br>
та <i>READ_DATA</i> в допустимом диапазоне адресов. Если при<br>
переборе адресов не удается считать корректного идентифи-<br>
катора, принимается решение об отсутствии карт РпР в си-<br>
стеме (вообще или с неназначенными <i>CSN).</i></font>

<p>
<font face="Times New Roman" size=2>Программа должна обеспечить задержку 1 мс после подачи<br>
ключа перед первой парой чтений и 250 мкс между парами</font>
<hr>

<p>
<font face="Times New Roman" size=2>чтений. Это дает карте время для доступа к информации,<br>
которая может храниться в медленных устройствах энерго-<br>
независимой памяти.</font>

<p>
<font face="Times New Roman" size=2>По завершении протокола изоляции ПО имеет список иден-<br>
тификаторов обнаруженных карт и присвоенных им номеров,<br>
сообщенных картам. Далее общение ПО с картой идет по ее<br>
номеру <i>CSN,</i> фигурирующему в командах РпР. Нулевой <i>CSN<br>
</i>присваивается картам по программному или аппаратному<br>
сбросу и используется как широковещательный адрес.</font>

<p>
<font face="Times New Roman" size=2><i>Обращения к регистрам РпР</i> представляют собой операции<br>
записи/чтения портов ввода/вывода по адресам <i>WRITE_DATA/<br>
READ_DATA</i> соответственно. При этом для указания конк-<br>
ретного регистра РпР используется <i>индекс -</i> номер регист-<br>
ра, предварительно записанный в регистр <i>ADDRESS.</i></font>

<p>
<font face="Times New Roman" size=2>Каждая карта имеет стандартный набор регистров РпР; часть<br>
из них относится к карте в целом, а часть - к логическим<br>
устройствам (ЛУ), входящим в карту. В любой момент вре-<br>
мени в индексном пространстве регистров РпР отобража-<br>
ются общие регистры карты и регистры только одного ЛУ<br>
(рис. А.4). Выбор ЛУ, с которым производится общение, осу-<br>
ществляется записью в регистр <i>Logical Device Number.</i></font>

<p>
<img border=0 vspace=3 hspace=3 src="84.jpg"alt="84.jpg">
<br clear=all>


<p align=center>
<font face="Times New Roman" size=2><b>Рис. А.4.</b> Конфигурационные регистры РпР (* - определяется<br>
разработчиком)</font>
<hr>

<p>
<font face="Times New Roman" size=2>С точки зрения системы РпР карта пребывает в некотором<br>
состоянии. Состояние <i>Isolate</i> используется в протоколе изо-<br>
ляции, описанном выше.</font>

<p>
<font face="Times New Roman" size=2>Программирование  карты  начинается  с  команды<br>
<i>WAKE[CSN] -</i> записи байта <i>CSN</i> в регистр с индексом 3. Эта<br>
операция переводит карту с указанным <i>CSN</i> в состояние<br>
<i>Config</i> (конфигурирование), а остальные карты переходят в<br>
состояние <i>Sleep.</i> Для карты выполняются операции чтения<br>
ее конфигурационной информации (как карты в целом, так<br>
и Л У) и программирования используемых ресурсов. Про-<br>
граммирование каждого ЛУ завершается установкой его бита<br>
активации, после чего оно активизируется на шине ISA. Про-<br>
граммирование всей карты завершается переводом ее в со-<br>
стояние <i>Wait/or key</i> (ожидание ключа). По окончании кон-<br>
фигурирования все карты РпР должны быть переведены в<br>
это состояние - тогда их случайное реконфигурирование<br>
будет блокировано 32-байтным ключом.</font>

<p>
<font face="Times New Roman" size=2>Доступ к регистрам РпР через ключ возможен в любое вре-<br>
мя. Возможно переназначение <i>CSN</i> "на ходу" - это требует-<br>
ся в устройствах, допускающих динамическое включение/<br>
выключение, док-станциях <i>(Docking Stations)</i> и при управ-<br>
лении энергопотреблением.</font>

<p>
<font face="Times New Roman" size=2>Все ЛУ карт РпР должны обеспечивать следующую мини-<br>
мальную функциональность:</font>

<p>
<font face="Times New Roman" size=2>^ Регистры ресурсов при чтении должны отражать факти-<br>
ческие текущие настройки.</font>

<p>
<font face="Times New Roman" size=2>^ Бит активации при чтении должен отражать правдивое<br>
состояние активности устройства на шине ISA.</font>

<p>
<font face="Times New Roman" size=2><i>ш</i> Если программа пытается "навязать" карте неподдержи-<br>
ваемую конфигурацию, устройство не должно активиро-<br>
ваться; соответственно, при чтении его флаг активации<br>
должен быть сброшен.</font>

<p>
<font face="Times New Roman" size=2>Стандартные регистры управления картой (табл. А.5) исполь-<br>
зуются для адресации карты и ее ЛУ, а также для чтения кон-<br>
фигурационной информации (дескрипторов). Дескрипторы<br>
ресурсов могут быть считаны побайтно из регистра <i>Resource<br>
Data.</i> При этом могут использоваться данные в короткой или</font>
<hr>

<p>
<font face="Times New Roman" size=2>длинной форме. <i>Короткая форма (Small Resource Data Type)<br>
</i>допускает дескрипторы до 7 байт, <i>длинная форма (Large<br>
Resource Data Type)</i> - до 64 Кбайт. Форма дескриптора и имя<br>
описываемого ресурса определяются первым байтом дескрип-<br>
тора. Его последующие байты описывают требуемые ресурсы<br>
и возможные варианты (диапазоны) конфигурирования.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Регистр</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Индекс и тип</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>SetRD DATA<br>
Port</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>OOh.WO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Установка адреса порта для чтения.<br>
Биты [7:0] задают значение бит [9:2]<br>
адреса порта <i>READJDATA.</i> Только<br>
для записи</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Serial Isolation</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>01 h, RO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Чтение этого регистра в состоянии<br>
<i>Isolation</i> приводит к побитному ана-<br>
лизу идентификатора</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Config Control</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>02h,WO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Бит [2]- сброс <i>CSN</i> в 0<br>
Бит [1] - возврат в состояние <i>Wait<br>
forKey<br>
</i>Бит [0] - сброс всех ЛУ и перевод<br>
конфигурационных регистров в со-<br>
стояние включения питания, но <i>CSN<br>
</i>сохраняется.<br>
Эти биты не запоминаются, так что<br>
необходимости в их программном<br>
сбросе нет</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Wake[CSNJ</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>03h,WO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Запись в этот регистр приведет карту<br>
с записываемым байтом <i>CSN</i> к<br>
переходу из состояния <i>Sleep</i> в со-<br>
стояние <i>Config</i> (если данные не ну-<br>
левые). Запись нулевого байта<br>
переводит все карты в состояние<br>
<i>Isolation.</i> Указатель последовательно<br>
считываемых байт сбрасывается</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Resource Data</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>04h,RO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Чтение этого регистра возвращает<br>
очередной байт информации о ре-<br>
сурсах. Перед чтением должен опра-<br>
шиваться регистр <i>Status</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Status</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>05h, RO</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Регистр состояния. Единичное<br>
значение бита [0] указывает на воз-<br>
можность чтения очередного байта<br>
ресурсов</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Регистр</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Индекс и тип</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Card Select<br>
Number</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>06h,RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Регистр хранения селективного адре-<br>
са <i>CSN,</i> обеспечивающего выбор кон-<br>
кретной карты командой <i>Wake[CSN]</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Logical Device<br>
Number</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>07h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Выбор текущего ЛУ, к которому отно-<br>
сятся вое операции обмена конфигу-<br>
рационной информацией, проверки<br>
диапазона адресов ввода/вывода и ак-<br>
тивации. Если карта имеет одно<br>
устройство, регистр допускает только<br>
чтение и всегда имеет нулевое значение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Card Level<br>
Reserved</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>08h-lFh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервированы</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Card Level,<br>
Vendor Defined</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>20h-2Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Используются по усмотрению произ-<br>
водителя</font>
</td>
</tr>
</table>
<br clear=all>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Регистр</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Индекс и тип</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Activate</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>30h,RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Регистр активации:<br>
</i>Бит [0] единичным значением раз-<br>
решает активность ЛУ на шине ISA.<br>
Биты [7:1] зарезервированы, при<br>
чтении должны возвращать нули.<br>
Перед активацией проверка диапа-<br>
зона адресов ввода/вывода должна<br>
быть запрещена</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>I/O Range<br>
Check</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>31 h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Регистр проверки диапазона адресов<br>
ввода/вывода:<br>
</i>Биты [7:2] зарезервированы, при чте-<br>
нии должны возвращать нули<br>
Бит [1] - разрешение проверки<br>
Бит [0] - управление диагностичес-<br>
ким ответом:<br>
О-ответААп,<br>
1 - ответ 55h</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Logical Device<br>
Control<br>
Reserved</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>32h-37h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Зарезервированы</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2><i>Logical Device<br>
Control Vendor<br>
Defined</i></font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>38h-3Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Используются по усмотрению произ-<br>
водителя</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>
<font face="Times New Roman" size=2>Стандартные регистры управления ЛУ (табл. А.6) исполь-<br>
зуются для активации карт и проверки отсутствия конф-<br>
ликтов на шине ISA в выбранном диапазоне адресов ввода/<br>
вывода. Когда включен режим проверки конфликтов, на чте-<br>
ние по любому адресу установленного диапазона портов вво-<br>
да/вывода ЛУ отвечает байтом 55h или AAh в зависимости<br>
от состояния бита 0 регистра проверки диапазона адресов.<br>
В рабочем режиме этот "автоответчик" отключен.</font>

<p>
<font face="Times New Roman" size=2>Оперативные данные конфигурирования доступны через<br>
регистры ЛУ. Каждое логическое устройство имеет собствен-<br>
ные дескрипторы используемых системных ресурсов:</font>

<p>
<font face="Times New Roman" size=2>^ Обычные 24-битные (4) и 32-битные (4) дескрипторы<br>
памяти. Поля базового адреса и длины неиспользуемого<br>
дескриптора памяти должны быть нулевыми. Одна кар-<br>
та не может одновременно использовать 24-битные и<br>
32-битные дескрипторы памяти.</font>

<p>
<font face="Times New Roman" size=2>^ Дескрипторы областей портов ввода/вывода (8). Поле<br>
базового адреса неиспользуемого дескриптора портов вво-<br>
да/вывода должно быть нулевым. Размер области адре-<br>
сов определяется в блоке данных описателя.</font>

<p>
<font face="Times New Roman" size=2>^ Дескрипторы запросов прерываний (2). Неиспользуемый<br>
селектор запроса прерывания должен быть нулевым (ну-<br>
левой номер запроса занят системным таймером). Для<br>
линии IRQ2/9 шины ISA применяют номер 2.</font>

<p>
<font face="Times New Roman" size=2>^ Дескрипторы каналов прямого доступа к памяти. Неис-<br>
пользуемый дескриптор канала должен иметь значение 4<br>
(этот канал недоступен - используется для каскадирова-<br>
ния контроллеров).</font>

<p>
<font face="Times New Roman" size=2>Назначение регистров дескрипторов и их положение в ин-<br>
дексном пространстве РпР описано в табл. А.7.</font>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Индекс и тип</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>40h-5Fh - <i>Обычные дескрипторы памяти</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>40h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор памяти</i> ft базовый адрес памяти,<br>
биты [23:16]</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Индекс и тип</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>41h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор памяти 0:</i> базовый адрес памяти,<br>
биты [15:8]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>42h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор памяти О:</i> управление.<br>
Бит [1] - режим обращения:<br>
0-8 бит,<br>
1 -16 бит.<br>
Бит [0] (RO) - способ задания диапазона:<br>
0 - следующее поле воспринимается как размер<br>
области,<br>
1 - как старший адрес</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>43h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор памяти 0:</i> размер или старший адрес<br>
области, биты [23:16]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>44h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор памяти 0:</i> размер или старший адрес<br>
области, биты [15:8]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>45h-47h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Заполнитель</i> (зарезервировано)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>48h-4Ch</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор памяти 1</i> (аналогично предыдущему)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>4Dh-4Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Заполнитель</i> (зарезервировано)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>50h-54h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор памяти 2</i> (аналогично предыдущему)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>55h-57h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Заполнитель</i> (зарезервировано)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>58h-5Ch</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор памяти 3</i> (аналогично предыдущему)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>5Dh-5Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Заполнитель</i> (зарезервировано)</font>
</td>
</tr>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>60h-6Fh <i>-Дескрипторы пространства ввода/вывода</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>60h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор портов 0:</i> базовый адрес, биты [15:8].<br>
Если ЛУ использует только 10-битное<br>
декодирование адреса, биты [15:10] могут<br>
игнорироваться</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>61 h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор портов 0:</i> базовый адрес, биты [7:0]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>62h-63h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор портов 1 -</i> аналогично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>64h-65h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор портов 2 -</i> аналогично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>66h-67h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор портов 3 -</i> аналогично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>68h-69h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор портов 4 -</i> аналогично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>6Ah-6Bh, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор портов 5 -</i> аналогично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>6Ch-6Dh, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор портов 6 -</i> аналогично</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>6Eh-6Fh, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Дескриптор портов 7 -</i> аналогично</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Индекс и тип</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>70h-73h - <i>Дескрипторы запросов прерываний</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>70h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Селектор запроса прерывания 0:</i> Биты [3:0] задают<br>
номер линии IRQ</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>71 h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Тип сигнала запроса прерывания 0-.<br>
</i>Бит[1] -активный уровень:<br>
1 - высокий,<br>
0 - низкий<br>
Бит[0] - тип:<br>
1 - уровень,<br>
0 - перепад<br>
Если карта поддерживает только один тип сигнала,<br>
регистр может быть типа RO</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>72h,RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Селектор запроса прерывания 1</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>73h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Тип сигнала запроса прерывания 1</i></font>
</td>
</tr>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>74h-75h - <i>Дескрипторы каналов прямого доступа</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>74h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Селектор 0 канала DMA.</i> Биты [2:0] задают номер<br>
используемого канала<br>
(001 -DMAO,... Ill -DMA7)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>75h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Селектор 1 канала DMA</i></font>
</td>
</tr>
<tr>
<td colspan=2>

<p>
<font face="Times New Roman" size=2>76h-A8h - <i>32-битные дескрипторы памяти</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>76h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 0:</i> базовый адрес<br>
памяти, биты [31:24]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>77h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 0:</i> базовый адрес<br>
памяти, биты [23:16]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>78h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 0'.</i> базовый адрес<br>
памяти, биты [15:8]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>79h, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 0:</i> базовый адрес<br>
памяти, биты [7:0]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>7Ah,RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 0:</i> управление<br>
Биты [7:3] - зарезервированы, при чтении должны<br>
возвращать нули<br>
Биты [2:1] - управление доступом:<br>
00 - 8-битная память,<br>
01 - 16-битная память,<br>
10 - зарезервировано,<br>
11 - 32-битная память<br>
Бит [0] (RO) - способ задания диапазона:<br>
0 - следующее поле воспринимается как размер<br>
области,<br>
1 - следующее поле воспринимается как старший<br>
адрес</font>
</td>
</tr>
</table>
<br clear=all>
<hr>

<p>

<table align=left border=1>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>Индекс и тип</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2>Назначение</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>7Bh, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти (h<br>
</i>размер или старший адрес области, биты [31:24]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>7Ch, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 0:<br>
</i>размер или старший адрес области, биты [23:16]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>7Dh, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 0-.<br>
</i>размер или старший адрес области, биты [15:8]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>7Eh, RW</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 0'.<br>
</i>размер или старший адрес области, биты [7:0]</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>7Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Заполнитель</i> (зарезервировано)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>80h-88h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 1</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>89h-8Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Заполнитель</i> (зарезервировано)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>90h-98h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 2</i></font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>99h-9Fh</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>Заполнитель</i> (зарезервировано)</font>
</td>
</tr>
<tr>
<td>

<p>
<font face="Times New Roman" size=2>AOh-A8h</font>
</td>
<td>

<p>
<font face="Times New Roman" size=2><i>32-битный дескриптор памяти 3</i></font>
</td>
</tr>
</table>
<br clear=all>
<HR>
<TABLE WIDTH=100%>
<TR>
<TD align=right valign=top> 
<p>
<DIV ALIGN=center><i><h5>Электронная библиотека InfoCity</i></h5></DIV>
<DIV ALIGN=center><i><h5>Автор и координатор проекта:<a href=mailto:mpinkus@mail.ru>Михаил Пинкус</a></i></h5></DIV>
<DIV ALIGN=center><i><h5>У Вас есть документация, которой нет в нашей библиотеке? <a href="mailto:icity@mail.ru?subject=InfoCity - Doc">Присылайте.</a></h5>
</TD>
</TR></table>
</body>
</html>
